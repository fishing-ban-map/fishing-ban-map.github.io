function yy(i,n){for(var f=0;f<n.length;f++){const x=n[f];if(typeof x!="string"&&!Array.isArray(x)){for(const A in x)if(A!=="default"&&!(A in i)){const R=Object.getOwnPropertyDescriptor(x,A);R&&Object.defineProperty(i,A,R.get?R:{enumerable:!0,get:()=>x[A]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))x(A);new MutationObserver(A=>{for(const R of A)if(R.type==="childList")for(const S of R.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&x(S)}).observe(document,{childList:!0,subtree:!0});function f(A){const R={};return A.integrity&&(R.integrity=A.integrity),A.referrerPolicy&&(R.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?R.credentials="include":A.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function x(A){if(A.ep)return;A.ep=!0;const R=f(A);fetch(A.href,R)}})();function Y_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Rm={exports:{}},N0={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ug;function by(){if(Ug)return N0;Ug=1;var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function f(x,A,R){var S=null;if(R!==void 0&&(S=""+R),A.key!==void 0&&(S=""+A.key),"key"in A){R={};for(var h in A)h!=="key"&&(R[h]=A[h])}else R=A;return A=R.ref,{$$typeof:i,type:x,key:S,ref:A!==void 0?A:null,props:R}}return N0.Fragment=n,N0.jsx=f,N0.jsxs=f,N0}var Hg;function xy(){return Hg||(Hg=1,Rm.exports=by()),Rm.exports}var Dt=xy(),Pm={exports:{}},Ti={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jg;function vy(){if(jg)return Ti;jg=1;var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),S=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),Q=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),Me=Symbol.iterator;function Ae(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=Me&&Ee[Me]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var he={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ve=Object.assign,Vt={};function li(Ee,ct,Et){this.props=Ee,this.context=ct,this.refs=Vt,this.updater=Et||he}li.prototype.isReactComponent={},li.prototype.setState=function(Ee,ct){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,ct,"setState")},li.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function Pi(){}Pi.prototype=li.prototype;function Bi(Ee,ct,Et){this.props=Ee,this.context=ct,this.refs=Vt,this.updater=Et||he}var jt=Bi.prototype=new Pi;jt.constructor=Bi,Ve(jt,li.prototype),jt.isPureReactComponent=!0;var et=Array.isArray,Ie={H:null,A:null,T:null,S:null,V:null},Oe=Object.prototype.hasOwnProperty;function pt(Ee,ct,Et,Mt,Nt,Wt){return Et=Wt.ref,{$$typeof:i,type:Ee,key:ct,ref:Et!==void 0?Et:null,props:Wt}}function xt(Ee,ct){return pt(Ee.type,ct,void 0,void 0,void 0,Ee.props)}function ai(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===i}function Kt(Ee){var ct={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(Et){return ct[Et]})}var Si=/\/+/g;function hi(Ee,ct){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?Kt(""+Ee.key):ct.toString(36)}function Gi(){}function zi(Ee){switch(Ee.status){case"fulfilled":return Ee.value;case"rejected":throw Ee.reason;default:switch(typeof Ee.status=="string"?Ee.then(Gi,Gi):(Ee.status="pending",Ee.then(function(ct){Ee.status==="pending"&&(Ee.status="fulfilled",Ee.value=ct)},function(ct){Ee.status==="pending"&&(Ee.status="rejected",Ee.reason=ct)})),Ee.status){case"fulfilled":return Ee.value;case"rejected":throw Ee.reason}}throw Ee}function xa(Ee,ct,Et,Mt,Nt){var Wt=typeof Ee;(Wt==="undefined"||Wt==="boolean")&&(Ee=null);var Zt=!1;if(Ee===null)Zt=!0;else switch(Wt){case"bigint":case"string":case"number":Zt=!0;break;case"object":switch(Ee.$$typeof){case i:case n:Zt=!0;break;case ge:return Zt=Ee._init,xa(Zt(Ee._payload),ct,Et,Mt,Nt)}}if(Zt)return Nt=Nt(Ee),Zt=Mt===""?"."+hi(Ee,0):Mt,et(Nt)?(Et="",Zt!=null&&(Et=Zt.replace(Si,"$&/")+"/"),xa(Nt,ct,Et,"",function(Va){return Va})):Nt!=null&&(ai(Nt)&&(Nt=xt(Nt,Et+(Nt.key==null||Ee&&Ee.key===Nt.key?"":(""+Nt.key).replace(Si,"$&/")+"/")+Zt)),ct.push(Nt)),1;Zt=0;var si=Mt===""?".":Mt+":";if(et(Ee))for(var yi=0;yi<Ee.length;yi++)Mt=Ee[yi],Wt=si+hi(Mt,yi),Zt+=xa(Mt,ct,Et,Wt,Nt);else if(yi=Ae(Ee),typeof yi=="function")for(Ee=yi.call(Ee),yi=0;!(Mt=Ee.next()).done;)Mt=Mt.value,Wt=si+hi(Mt,yi++),Zt+=xa(Mt,ct,Et,Wt,Nt);else if(Wt==="object"){if(typeof Ee.then=="function")return xa(zi(Ee),ct,Et,Mt,Nt);throw ct=String(Ee),Error("Objects are not valid as a React child (found: "+(ct==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":ct)+"). If you meant to render a collection of children, use an array instead.")}return Zt}function Je(Ee,ct,Et){if(Ee==null)return Ee;var Mt=[],Nt=0;return xa(Ee,Mt,"","",function(Wt){return ct.call(Et,Wt,Nt++)}),Mt}function St(Ee){if(Ee._status===-1){var ct=Ee._result;ct=ct(),ct.then(function(Et){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=Et)},function(Et){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=Et)}),Ee._status===-1&&(Ee._status=0,Ee._result=ct)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var At=typeof reportError=="function"?reportError:function(Ee){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ct=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ee=="object"&&Ee!==null&&typeof Ee.message=="string"?String(Ee.message):String(Ee),error:Ee});if(!window.dispatchEvent(ct))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ee);return}console.error(Ee)};function Ei(){}return Ti.Children={map:Je,forEach:function(Ee,ct,Et){Je(Ee,function(){ct.apply(this,arguments)},Et)},count:function(Ee){var ct=0;return Je(Ee,function(){ct++}),ct},toArray:function(Ee){return Je(Ee,function(ct){return ct})||[]},only:function(Ee){if(!ai(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},Ti.Component=li,Ti.Fragment=f,Ti.Profiler=A,Ti.PureComponent=Bi,Ti.StrictMode=x,Ti.Suspense=Z,Ti.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ie,Ti.__COMPILER_RUNTIME={__proto__:null,c:function(Ee){return Ie.H.useMemoCache(Ee)}},Ti.cache=function(Ee){return function(){return Ee.apply(null,arguments)}},Ti.cloneElement=function(Ee,ct,Et){if(Ee==null)throw Error("The argument must be a React element, but you passed "+Ee+".");var Mt=Ve({},Ee.props),Nt=Ee.key,Wt=void 0;if(ct!=null)for(Zt in ct.ref!==void 0&&(Wt=void 0),ct.key!==void 0&&(Nt=""+ct.key),ct)!Oe.call(ct,Zt)||Zt==="key"||Zt==="__self"||Zt==="__source"||Zt==="ref"&&ct.ref===void 0||(Mt[Zt]=ct[Zt]);var Zt=arguments.length-2;if(Zt===1)Mt.children=Et;else if(1<Zt){for(var si=Array(Zt),yi=0;yi<Zt;yi++)si[yi]=arguments[yi+2];Mt.children=si}return pt(Ee.type,Nt,void 0,void 0,Wt,Mt)},Ti.createContext=function(Ee){return Ee={$$typeof:S,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null},Ee.Provider=Ee,Ee.Consumer={$$typeof:R,_context:Ee},Ee},Ti.createElement=function(Ee,ct,Et){var Mt,Nt={},Wt=null;if(ct!=null)for(Mt in ct.key!==void 0&&(Wt=""+ct.key),ct)Oe.call(ct,Mt)&&Mt!=="key"&&Mt!=="__self"&&Mt!=="__source"&&(Nt[Mt]=ct[Mt]);var Zt=arguments.length-2;if(Zt===1)Nt.children=Et;else if(1<Zt){for(var si=Array(Zt),yi=0;yi<Zt;yi++)si[yi]=arguments[yi+2];Nt.children=si}if(Ee&&Ee.defaultProps)for(Mt in Zt=Ee.defaultProps,Zt)Nt[Mt]===void 0&&(Nt[Mt]=Zt[Mt]);return pt(Ee,Wt,void 0,void 0,null,Nt)},Ti.createRef=function(){return{current:null}},Ti.forwardRef=function(Ee){return{$$typeof:h,render:Ee}},Ti.isValidElement=ai,Ti.lazy=function(Ee){return{$$typeof:ge,_payload:{_status:-1,_result:Ee},_init:St}},Ti.memo=function(Ee,ct){return{$$typeof:Q,type:Ee,compare:ct===void 0?null:ct}},Ti.startTransition=function(Ee){var ct=Ie.T,Et={};Ie.T=Et;try{var Mt=Ee(),Nt=Ie.S;Nt!==null&&Nt(Et,Mt),typeof Mt=="object"&&Mt!==null&&typeof Mt.then=="function"&&Mt.then(Ei,At)}catch(Wt){At(Wt)}finally{Ie.T=ct}},Ti.unstable_useCacheRefresh=function(){return Ie.H.useCacheRefresh()},Ti.use=function(Ee){return Ie.H.use(Ee)},Ti.useActionState=function(Ee,ct,Et){return Ie.H.useActionState(Ee,ct,Et)},Ti.useCallback=function(Ee,ct){return Ie.H.useCallback(Ee,ct)},Ti.useContext=function(Ee){return Ie.H.useContext(Ee)},Ti.useDebugValue=function(){},Ti.useDeferredValue=function(Ee,ct){return Ie.H.useDeferredValue(Ee,ct)},Ti.useEffect=function(Ee,ct,Et){var Mt=Ie.H;if(typeof Et=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Mt.useEffect(Ee,ct)},Ti.useId=function(){return Ie.H.useId()},Ti.useImperativeHandle=function(Ee,ct,Et){return Ie.H.useImperativeHandle(Ee,ct,Et)},Ti.useInsertionEffect=function(Ee,ct){return Ie.H.useInsertionEffect(Ee,ct)},Ti.useLayoutEffect=function(Ee,ct){return Ie.H.useLayoutEffect(Ee,ct)},Ti.useMemo=function(Ee,ct){return Ie.H.useMemo(Ee,ct)},Ti.useOptimistic=function(Ee,ct){return Ie.H.useOptimistic(Ee,ct)},Ti.useReducer=function(Ee,ct,Et){return Ie.H.useReducer(Ee,ct,Et)},Ti.useRef=function(Ee){return Ie.H.useRef(Ee)},Ti.useState=function(Ee){return Ie.H.useState(Ee)},Ti.useSyncExternalStore=function(Ee,ct,Et){return Ie.H.useSyncExternalStore(Ee,ct,Et)},Ti.useTransition=function(){return Ie.H.useTransition()},Ti.version="19.1.0",Ti}var qg;function _g(){return qg||(qg=1,Pm.exports=vy()),Pm.exports}var Ct=_g(),Lm={exports:{}},k0={},Om={exports:{}},Nm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vg;function Ty(){return Vg||(Vg=1,function(i){function n(Je,St){var At=Je.length;Je.push(St);e:for(;0<At;){var Ei=At-1>>>1,Ee=Je[Ei];if(0<A(Ee,St))Je[Ei]=St,Je[At]=Ee,At=Ei;else break e}}function f(Je){return Je.length===0?null:Je[0]}function x(Je){if(Je.length===0)return null;var St=Je[0],At=Je.pop();if(At!==St){Je[0]=At;e:for(var Ei=0,Ee=Je.length,ct=Ee>>>1;Ei<ct;){var Et=2*(Ei+1)-1,Mt=Je[Et],Nt=Et+1,Wt=Je[Nt];if(0>A(Mt,At))Nt<Ee&&0>A(Wt,Mt)?(Je[Ei]=Wt,Je[Nt]=At,Ei=Nt):(Je[Ei]=Mt,Je[Et]=At,Ei=Et);else if(Nt<Ee&&0>A(Wt,At))Je[Ei]=Wt,Je[Nt]=At,Ei=Nt;else break e}}return St}function A(Je,St){var At=Je.sortIndex-St.sortIndex;return At!==0?At:Je.id-St.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var R=performance;i.unstable_now=function(){return R.now()}}else{var S=Date,h=S.now();i.unstable_now=function(){return S.now()-h}}var Z=[],Q=[],ge=1,Me=null,Ae=3,he=!1,Ve=!1,Vt=!1,li=!1,Pi=typeof setTimeout=="function"?setTimeout:null,Bi=typeof clearTimeout=="function"?clearTimeout:null,jt=typeof setImmediate<"u"?setImmediate:null;function et(Je){for(var St=f(Q);St!==null;){if(St.callback===null)x(Q);else if(St.startTime<=Je)x(Q),St.sortIndex=St.expirationTime,n(Z,St);else break;St=f(Q)}}function Ie(Je){if(Vt=!1,et(Je),!Ve)if(f(Z)!==null)Ve=!0,Oe||(Oe=!0,hi());else{var St=f(Q);St!==null&&xa(Ie,St.startTime-Je)}}var Oe=!1,pt=-1,xt=5,ai=-1;function Kt(){return li?!0:!(i.unstable_now()-ai<xt)}function Si(){if(li=!1,Oe){var Je=i.unstable_now();ai=Je;var St=!0;try{e:{Ve=!1,Vt&&(Vt=!1,Bi(pt),pt=-1),he=!0;var At=Ae;try{t:{for(et(Je),Me=f(Z);Me!==null&&!(Me.expirationTime>Je&&Kt());){var Ei=Me.callback;if(typeof Ei=="function"){Me.callback=null,Ae=Me.priorityLevel;var Ee=Ei(Me.expirationTime<=Je);if(Je=i.unstable_now(),typeof Ee=="function"){Me.callback=Ee,et(Je),St=!0;break t}Me===f(Z)&&x(Z),et(Je)}else x(Z);Me=f(Z)}if(Me!==null)St=!0;else{var ct=f(Q);ct!==null&&xa(Ie,ct.startTime-Je),St=!1}}break e}finally{Me=null,Ae=At,he=!1}St=void 0}}finally{St?hi():Oe=!1}}}var hi;if(typeof jt=="function")hi=function(){jt(Si)};else if(typeof MessageChannel<"u"){var Gi=new MessageChannel,zi=Gi.port2;Gi.port1.onmessage=Si,hi=function(){zi.postMessage(null)}}else hi=function(){Pi(Si,0)};function xa(Je,St){pt=Pi(function(){Je(i.unstable_now())},St)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Je){Je.callback=null},i.unstable_forceFrameRate=function(Je){0>Je||125<Je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xt=0<Je?Math.floor(1e3/Je):5},i.unstable_getCurrentPriorityLevel=function(){return Ae},i.unstable_next=function(Je){switch(Ae){case 1:case 2:case 3:var St=3;break;default:St=Ae}var At=Ae;Ae=St;try{return Je()}finally{Ae=At}},i.unstable_requestPaint=function(){li=!0},i.unstable_runWithPriority=function(Je,St){switch(Je){case 1:case 2:case 3:case 4:case 5:break;default:Je=3}var At=Ae;Ae=Je;try{return St()}finally{Ae=At}},i.unstable_scheduleCallback=function(Je,St,At){var Ei=i.unstable_now();switch(typeof At=="object"&&At!==null?(At=At.delay,At=typeof At=="number"&&0<At?Ei+At:Ei):At=Ei,Je){case 1:var Ee=-1;break;case 2:Ee=250;break;case 5:Ee=1073741823;break;case 4:Ee=1e4;break;default:Ee=5e3}return Ee=At+Ee,Je={id:ge++,callback:St,priorityLevel:Je,startTime:At,expirationTime:Ee,sortIndex:-1},At>Ei?(Je.sortIndex=At,n(Q,Je),f(Z)===null&&Je===f(Q)&&(Vt?(Bi(pt),pt=-1):Vt=!0,xa(Ie,At-Ei))):(Je.sortIndex=Ee,n(Z,Je),Ve||he||(Ve=!0,Oe||(Oe=!0,hi()))),Je},i.unstable_shouldYield=Kt,i.unstable_wrapCallback=function(Je){var St=Ae;return function(){var At=Ae;Ae=St;try{return Je.apply(this,arguments)}finally{Ae=At}}}}(Nm)),Nm}var Gg;function Ey(){return Gg||(Gg=1,Om.exports=Ty()),Om.exports}var km={exports:{}},Br={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zg;function wy(){if(Zg)return Br;Zg=1;var i=_g();function n(Z){var Q="https://react.dev/errors/"+Z;if(1<arguments.length){Q+="?args[]="+encodeURIComponent(arguments[1]);for(var ge=2;ge<arguments.length;ge++)Q+="&args[]="+encodeURIComponent(arguments[ge])}return"Minified React error #"+Z+"; visit "+Q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(){}var x={d:{f,r:function(){throw Error(n(522))},D:f,C:f,L:f,m:f,X:f,S:f,M:f},p:0,findDOMNode:null},A=Symbol.for("react.portal");function R(Z,Q,ge){var Me=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:Me==null?null:""+Me,children:Z,containerInfo:Q,implementation:ge}}var S=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(Z,Q){if(Z==="font")return"";if(typeof Q=="string")return Q==="use-credentials"?Q:""}return Br.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,Br.createPortal=function(Z,Q){var ge=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q||Q.nodeType!==1&&Q.nodeType!==9&&Q.nodeType!==11)throw Error(n(299));return R(Z,Q,null,ge)},Br.flushSync=function(Z){var Q=S.T,ge=x.p;try{if(S.T=null,x.p=2,Z)return Z()}finally{S.T=Q,x.p=ge,x.d.f()}},Br.preconnect=function(Z,Q){typeof Z=="string"&&(Q?(Q=Q.crossOrigin,Q=typeof Q=="string"?Q==="use-credentials"?Q:"":void 0):Q=null,x.d.C(Z,Q))},Br.prefetchDNS=function(Z){typeof Z=="string"&&x.d.D(Z)},Br.preinit=function(Z,Q){if(typeof Z=="string"&&Q&&typeof Q.as=="string"){var ge=Q.as,Me=h(ge,Q.crossOrigin),Ae=typeof Q.integrity=="string"?Q.integrity:void 0,he=typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0;ge==="style"?x.d.S(Z,typeof Q.precedence=="string"?Q.precedence:void 0,{crossOrigin:Me,integrity:Ae,fetchPriority:he}):ge==="script"&&x.d.X(Z,{crossOrigin:Me,integrity:Ae,fetchPriority:he,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}},Br.preinitModule=function(Z,Q){if(typeof Z=="string")if(typeof Q=="object"&&Q!==null){if(Q.as==null||Q.as==="script"){var ge=h(Q.as,Q.crossOrigin);x.d.M(Z,{crossOrigin:ge,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}}else Q==null&&x.d.M(Z)},Br.preload=function(Z,Q){if(typeof Z=="string"&&typeof Q=="object"&&Q!==null&&typeof Q.as=="string"){var ge=Q.as,Me=h(ge,Q.crossOrigin);x.d.L(Z,ge,{crossOrigin:Me,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0,type:typeof Q.type=="string"?Q.type:void 0,fetchPriority:typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0,referrerPolicy:typeof Q.referrerPolicy=="string"?Q.referrerPolicy:void 0,imageSrcSet:typeof Q.imageSrcSet=="string"?Q.imageSrcSet:void 0,imageSizes:typeof Q.imageSizes=="string"?Q.imageSizes:void 0,media:typeof Q.media=="string"?Q.media:void 0})}},Br.preloadModule=function(Z,Q){if(typeof Z=="string")if(Q){var ge=h(Q.as,Q.crossOrigin);x.d.m(Z,{as:typeof Q.as=="string"&&Q.as!=="script"?Q.as:void 0,crossOrigin:ge,integrity:typeof Q.integrity=="string"?Q.integrity:void 0})}else x.d.m(Z)},Br.requestFormReset=function(Z){x.d.r(Z)},Br.unstable_batchedUpdates=function(Z,Q){return Z(Q)},Br.useFormState=function(Z,Q,ge){return S.H.useFormState(Z,Q,ge)},Br.useFormStatus=function(){return S.H.useHostTransitionStatus()},Br.version="19.1.0",Br}var Yg;function $_(){if(Yg)return km.exports;Yg=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),km.exports=wy(),km.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $g;function Ay(){if($g)return k0;$g=1;var i=Ey(),n=_g(),f=$_();function x(a){var u="https://react.dev/errors/"+a;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function A(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function R(a){var u=a,d=a;if(a.alternate)for(;u.return;)u=u.return;else{a=u;do u=a,(u.flags&4098)!==0&&(d=u.return),a=u.return;while(a)}return u.tag===3?d:null}function S(a){if(a.tag===13){var u=a.memoizedState;if(u===null&&(a=a.alternate,a!==null&&(u=a.memoizedState)),u!==null)return u.dehydrated}return null}function h(a){if(R(a)!==a)throw Error(x(188))}function Z(a){var u=a.alternate;if(!u){if(u=R(a),u===null)throw Error(x(188));return u!==a?null:a}for(var d=a,_=u;;){var w=d.return;if(w===null)break;var D=w.alternate;if(D===null){if(_=w.return,_!==null){d=_;continue}break}if(w.child===D.child){for(D=w.child;D;){if(D===d)return h(w),a;if(D===_)return h(w),u;D=D.sibling}throw Error(x(188))}if(d.return!==_.return)d=w,_=D;else{for(var q=!1,W=w.child;W;){if(W===d){q=!0,d=w,_=D;break}if(W===_){q=!0,_=w,d=D;break}W=W.sibling}if(!q){for(W=D.child;W;){if(W===d){q=!0,d=D,_=w;break}if(W===_){q=!0,_=D,d=w;break}W=W.sibling}if(!q)throw Error(x(189))}}if(d.alternate!==_)throw Error(x(190))}if(d.tag!==3)throw Error(x(188));return d.stateNode.current===d?a:u}function Q(a){var u=a.tag;if(u===5||u===26||u===27||u===6)return a;for(a=a.child;a!==null;){if(u=Q(a),u!==null)return u;a=a.sibling}return null}var ge=Object.assign,Me=Symbol.for("react.element"),Ae=Symbol.for("react.transitional.element"),he=Symbol.for("react.portal"),Ve=Symbol.for("react.fragment"),Vt=Symbol.for("react.strict_mode"),li=Symbol.for("react.profiler"),Pi=Symbol.for("react.provider"),Bi=Symbol.for("react.consumer"),jt=Symbol.for("react.context"),et=Symbol.for("react.forward_ref"),Ie=Symbol.for("react.suspense"),Oe=Symbol.for("react.suspense_list"),pt=Symbol.for("react.memo"),xt=Symbol.for("react.lazy"),ai=Symbol.for("react.activity"),Kt=Symbol.for("react.memo_cache_sentinel"),Si=Symbol.iterator;function hi(a){return a===null||typeof a!="object"?null:(a=Si&&a[Si]||a["@@iterator"],typeof a=="function"?a:null)}var Gi=Symbol.for("react.client.reference");function zi(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Gi?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Ve:return"Fragment";case li:return"Profiler";case Vt:return"StrictMode";case Ie:return"Suspense";case Oe:return"SuspenseList";case ai:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case he:return"Portal";case jt:return(a.displayName||"Context")+".Provider";case Bi:return(a._context.displayName||"Context")+".Consumer";case et:var u=a.render;return a=a.displayName,a||(a=u.displayName||u.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case pt:return u=a.displayName||null,u!==null?u:zi(a.type)||"Memo";case xt:u=a._payload,a=a._init;try{return zi(a(u))}catch{}}return null}var xa=Array.isArray,Je=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,St=f.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,At={pending:!1,data:null,method:null,action:null},Ei=[],Ee=-1;function ct(a){return{current:a}}function Et(a){0>Ee||(a.current=Ei[Ee],Ei[Ee]=null,Ee--)}function Mt(a,u){Ee++,Ei[Ee]=a.current,a.current=u}var Nt=ct(null),Wt=ct(null),Zt=ct(null),si=ct(null);function yi(a,u){switch(Mt(Zt,u),Mt(Wt,a),Mt(Nt,null),u.nodeType){case 9:case 11:a=(a=u.documentElement)&&(a=a.namespaceURI)?I0(a):0;break;default:if(a=u.tagName,u=u.namespaceURI)u=I0(u),a=D0(u,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Et(Nt),Mt(Nt,a)}function Va(){Et(Nt),Et(Wt),Et(Zt)}function es(a){a.memoizedState!==null&&Mt(si,a);var u=Nt.current,d=D0(u,a.type);u!==d&&(Mt(Wt,a),Mt(Nt,d))}function bn(a){Wt.current===a&&(Et(Nt),Et(Wt)),si.current===a&&(Et(si),ue._currentValue=At)}var On=Object.prototype.hasOwnProperty,hn=i.unstable_scheduleCallback,Hi=i.unstable_cancelCallback,ts=i.unstable_shouldYield,so=i.unstable_requestPaint,ka=i.unstable_now,Cl=i.unstable_getCurrentPriorityLevel,Ru=i.unstable_ImmediatePriority,Zn=i.unstable_UserBlockingPriority,sr=i.unstable_NormalPriority,zo=i.unstable_LowPriority,oo=i.unstable_IdlePriority,Ds=i.log,Pu=i.unstable_setDisableYieldValue,is=null,an=null;function xn(a){if(typeof Ds=="function"&&Pu(a),an&&typeof an.setStrictMode=="function")try{an.setStrictMode(is,a)}catch{}}var Ba=Math.clz32?Math.clz32:Ar,uo=Math.log,Lu=Math.LN2;function Ar(a){return a>>>=0,a===0?32:31-(uo(a)/Lu|0)|0}var dn=256,or=4194304;function De(a){var u=a&42;if(u!==0)return u;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function X(a,u,d){var _=a.pendingLanes;if(_===0)return 0;var w=0,D=a.suspendedLanes,q=a.pingedLanes;a=a.warmLanes;var W=_&134217727;return W!==0?(_=W&~D,_!==0?w=De(_):(q&=W,q!==0?w=De(q):d||(d=W&~a,d!==0&&(w=De(d))))):(W=_&~D,W!==0?w=De(W):q!==0?w=De(q):d||(d=_&~a,d!==0&&(w=De(d)))),w===0?0:u!==0&&u!==w&&(u&D)===0&&(D=w&-w,d=u&-u,D>=d||D===32&&(d&4194048)!==0)?u:w}function K(a,u){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&u)===0}function ie(a,u){switch(a){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function de(){var a=dn;return dn<<=1,(dn&4194048)===0&&(dn=256),a}function Te(){var a=or;return or<<=1,(or&62914560)===0&&(or=4194304),a}function te(a){for(var u=[],d=0;31>d;d++)u.push(a);return u}function Ne(a,u){a.pendingLanes|=u,u!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Se(a,u,d,_,w,D){var q=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var W=a.entanglements,_e=a.expirationTimes,Ue=a.hiddenUpdates;for(d=q&~d;0<d;){var nt=31-Ba(d),ot=1<<nt;W[nt]=0,_e[nt]=-1;var Ze=Ue[nt];if(Ze!==null)for(Ue[nt]=null,nt=0;nt<Ze.length;nt++){var Xe=Ze[nt];Xe!==null&&(Xe.lane&=-536870913)}d&=~ot}_!==0&&Le(a,_,0),D!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=D&~(q&~u))}function Le(a,u,d){a.pendingLanes|=u,a.suspendedLanes&=~u;var _=31-Ba(u);a.entangledLanes|=u,a.entanglements[_]=a.entanglements[_]|1073741824|d&4194090}function He(a,u){var d=a.entangledLanes|=u;for(a=a.entanglements;d;){var _=31-Ba(d),w=1<<_;w&u|a[_]&u&&(a[_]|=u),d&=~w}}function Re(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function at(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function yt(){var a=St.p;return a!==0?a:(a=window.event,a===void 0?32:Pt(a.type))}function Tt(a,u){var d=St.p;try{return St.p=a,u()}finally{St.p=d}}var Lt=Math.random().toString(36).slice(2),Ft="__reactFiber$"+Lt,Ot="__reactProps$"+Lt,Ye="__reactContainer$"+Lt,Ci="__reactEvents$"+Lt,bi="__reactListeners$"+Lt,Mi="__reactHandles$"+Lt,Yt="__reactResources$"+Lt,it="__reactMarker$"+Lt;function qt(a){delete a[Ft],delete a[Ot],delete a[Ci],delete a[bi],delete a[Mi]}function Xt(a){var u=a[Ft];if(u)return u;for(var d=a.parentNode;d;){if(u=d[Ye]||d[Ft]){if(d=u.alternate,u.child!==null||d!==null&&d.child!==null)for(a=Cu(a);a!==null;){if(d=a[Ft])return d;a=Cu(a)}return u}a=d,d=a.parentNode}return null}function Zi(a){if(a=a[Ft]||a[Ye]){var u=a.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return a}return null}function Wi(a){var u=a.tag;if(u===5||u===26||u===27||u===6)return a.stateNode;throw Error(x(33))}function $a(a){var u=a[Yt];return u||(u=a[Yt]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function Ut(a){a[it]=!0}var Fo=new Set,Ou={};function ur(a,u){as(a,u),as(a+"Capture",u)}function as(a,u){for(Ou[a]=u,a=0;a<u.length;a++)Fo.add(u[a])}var Rs=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lo={},Sa={};function lr(a){return On.call(Sa,a)?!0:On.call(lo,a)?!1:Rs.test(a)?Sa[a]=!0:(lo[a]=!0,!1)}function Yi(a,u,d){if(lr(u))if(d===null)a.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(u);return;case"boolean":var _=u.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){a.removeAttribute(u);return}}a.setAttribute(u,""+d)}}function co(a,u,d){if(d===null)a.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttribute(u,""+d)}}function Yn(a,u,d,_){if(_===null)a.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(u,d,""+_)}}var Ml,ho;function $n(a){if(Ml===void 0)try{throw Error()}catch(d){var u=d.stack.trim().match(/\n( *(at )?)/);Ml=u&&u[1]||"",ho=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ml+a+ho}var yc=!1;function Il(a,u){if(!a||yc)return"";yc=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(u){var ot=function(){throw Error()};if(Object.defineProperty(ot.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ot,[])}catch(Xe){var Ze=Xe}Reflect.construct(a,[],ot)}else{try{ot.call()}catch(Xe){Ze=Xe}a.call(ot.prototype)}}else{try{throw Error()}catch(Xe){Ze=Xe}(ot=a())&&typeof ot.catch=="function"&&ot.catch(function(){})}}catch(Xe){if(Xe&&Ze&&typeof Xe.stack=="string")return[Xe.stack,Ze.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=_.DetermineComponentFrameRoot(),q=D[0],W=D[1];if(q&&W){var _e=q.split(`
`),Ue=W.split(`
`);for(w=_=0;_<_e.length&&!_e[_].includes("DetermineComponentFrameRoot");)_++;for(;w<Ue.length&&!Ue[w].includes("DetermineComponentFrameRoot");)w++;if(_===_e.length||w===Ue.length)for(_=_e.length-1,w=Ue.length-1;1<=_&&0<=w&&_e[_]!==Ue[w];)w--;for(;1<=_&&0<=w;_--,w--)if(_e[_]!==Ue[w]){if(_!==1||w!==1)do if(_--,w--,0>w||_e[_]!==Ue[w]){var nt=`
`+_e[_].replace(" at new "," at ");return a.displayName&&nt.includes("<anonymous>")&&(nt=nt.replace("<anonymous>",a.displayName)),nt}while(1<=_&&0<=w);break}}}finally{yc=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?$n(d):""}function vd(a){switch(a.tag){case 26:case 27:case 5:return $n(a.type);case 16:return $n("Lazy");case 13:return $n("Suspense");case 19:return $n("SuspenseList");case 0:case 15:return Il(a.type,!1);case 11:return Il(a.type.render,!1);case 1:return Il(a.type,!0);case 31:return $n("Activity");default:return""}}function Uo(a){try{var u="";do u+=vd(a),a=a.return;while(a);return u}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function cr(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Td(a){var u=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function Uf(a){var u=Td(a)?"checked":"value",d=Object.getOwnPropertyDescriptor(a.constructor.prototype,u),_=""+a[u];if(!a.hasOwnProperty(u)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var w=d.get,D=d.set;return Object.defineProperty(a,u,{configurable:!0,get:function(){return w.call(this)},set:function(q){_=""+q,D.call(this,q)}}),Object.defineProperty(a,u,{enumerable:d.enumerable}),{getValue:function(){return _},setValue:function(q){_=""+q},stopTracking:function(){a._valueTracker=null,delete a[u]}}}}function bc(a){a._valueTracker||(a._valueTracker=Uf(a))}function wh(a){if(!a)return!1;var u=a._valueTracker;if(!u)return!0;var d=u.getValue(),_="";return a&&(_=Td(a)?a.checked?"true":"false":a.value),a=_,a!==d?(u.setValue(a),!0):!1}function Nu(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ho=/[\n"\\]/g;function Xn(a){return a.replace(Ho,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function xc(a,u,d,_,w,D,q,W){a.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?a.type=q:a.removeAttribute("type"),u!=null?q==="number"?(u===0&&a.value===""||a.value!=u)&&(a.value=""+cr(u)):a.value!==""+cr(u)&&(a.value=""+cr(u)):q!=="submit"&&q!=="reset"||a.removeAttribute("value"),u!=null?Dl(a,q,cr(u)):d!=null?Dl(a,q,cr(d)):_!=null&&a.removeAttribute("value"),w==null&&D!=null&&(a.defaultChecked=!!D),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?a.name=""+cr(W):a.removeAttribute("name")}function fo(a,u,d,_,w,D,q,W){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(a.type=D),u!=null||d!=null){if(!(D!=="submit"&&D!=="reset"||u!=null))return;d=d!=null?""+cr(d):"",u=u!=null?""+cr(u):d,W||u===a.value||(a.value=u),a.defaultValue=u}_=_??w,_=typeof _!="function"&&typeof _!="symbol"&&!!_,a.checked=W?a.checked:!!_,a.defaultChecked=!!_,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(a.name=q)}function Dl(a,u,d){u==="number"&&Nu(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function ku(a,u,d,_){if(a=a.options,u){u={};for(var w=0;w<d.length;w++)u["$"+d[w]]=!0;for(d=0;d<a.length;d++)w=u.hasOwnProperty("$"+a[d].value),a[d].selected!==w&&(a[d].selected=w),w&&_&&(a[d].defaultSelected=!0)}else{for(d=""+cr(d),u=null,w=0;w<a.length;w++){if(a[w].value===d){a[w].selected=!0,_&&(a[w].defaultSelected=!0);return}u!==null||a[w].disabled||(u=a[w])}u!==null&&(u.selected=!0)}}function Bu(a,u,d){if(u!=null&&(u=""+cr(u),u!==a.value&&(a.value=u),d==null)){a.defaultValue!==u&&(a.defaultValue=u);return}a.defaultValue=d!=null?""+cr(d):""}function zu(a,u,d,_){if(u==null){if(_!=null){if(d!=null)throw Error(x(92));if(xa(_)){if(1<_.length)throw Error(x(93));_=_[0]}d=_}d==null&&(d=""),u=d}d=cr(u),a.defaultValue=d,_=a.textContent,_===d&&_!==""&&_!==null&&(a.value=_)}function po(a,u){if(u){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=u;return}}a.textContent=u}var Nn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vi(a,u,d){var _=u.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?_?a.setProperty(u,""):u==="float"?a.cssFloat="":a[u]="":_?a.setProperty(u,d):typeof d!="number"||d===0||Nn.has(u)?u==="float"?a.cssFloat=d:a[u]=(""+d).trim():a[u]=d+"px"}function jo(a,u,d){if(u!=null&&typeof u!="object")throw Error(x(62));if(a=a.style,d!=null){for(var _ in d)!d.hasOwnProperty(_)||u!=null&&u.hasOwnProperty(_)||(_.indexOf("--")===0?a.setProperty(_,""):_==="float"?a.cssFloat="":a[_]="");for(var w in u)_=u[w],u.hasOwnProperty(w)&&d[w]!==_&&vi(a,w,_)}else for(var D in u)u.hasOwnProperty(D)&&vi(a,D,u[D])}function fn(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mo(a){return xi.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Vo=null;function go(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Xa=null,Ca=null;function Ma(a){var u=Zi(a);if(u&&(a=u.stateNode)){var d=a[Ot]||null;e:switch(a=u.stateNode,u.type){case"input":if(xc(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),u=d.name,d.type==="radio"&&u!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Xn(""+u)+'"][type="radio"]'),u=0;u<d.length;u++){var _=d[u];if(_!==a&&_.form===a.form){var w=_[Ot]||null;if(!w)throw Error(x(90));xc(_,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(u=0;u<d.length;u++)_=d[u],_.form===a.form&&wh(_)}break e;case"textarea":Bu(a,d.value,d.defaultValue);break e;case"select":u=d.value,u!=null&&ku(a,!!d.multiple,u,!1)}}}var Qa=!1;function Ji(a,u,d){if(Qa)return a(u,d);Qa=!0;try{var _=a(u);return _}finally{if(Qa=!1,(Xa!==null||Ca!==null)&&(Rn(),Xa&&(u=Xa,a=Ca,Ca=Xa=null,Ma(u),a)))for(u=0;u<a.length;u++)Ma(a[u])}}function ns(a,u){var d=a.stateNode;if(d===null)return null;var _=d[Ot]||null;if(_===null)return null;d=_[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(a=a.type,_=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!_;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(x(231,u,typeof d));return d}var va=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kn=!1;if(va)try{var nn={};Object.defineProperty(nn,"passive",{get:function(){kn=!0}}),window.addEventListener("test",nn,nn),window.removeEventListener("test",nn,nn)}catch{kn=!1}var Sr=null,Ni=null,ra=null;function mi(){if(ra)return ra;var a,u=Ni,d=u.length,_,w="value"in Sr?Sr.value:Sr.textContent,D=w.length;for(a=0;a<d&&u[a]===w[a];a++);var q=d-a;for(_=1;_<=q&&u[d-_]===w[D-_];_++);return ra=w.slice(a,1<_?1-_:void 0)}function Qt(a){var u=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&u===13&&(a=13)):a=u,a===10&&(a=13),32<=a||a===13?a:0}function Ps(){return!0}function oi(){return!1}function pn(a){function u(d,_,w,D,q){this._reactName=d,this._targetInst=w,this.type=_,this.nativeEvent=D,this.target=q,this.currentTarget=null;for(var W in a)a.hasOwnProperty(W)&&(d=a[W],this[W]=d?d(D):D[W]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Ps:oi,this.isPropagationStopped=oi,this}return ge(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ps)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ps)},persist:function(){},isPersistent:Ps}),u}var Ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fu=pn(Ia),Go=ge({},Ia,{view:0,detail:0}),Rl=pn(Go),_o,Zo,Yo,$o=ge({},Go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jo,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Yo&&(Yo&&a.type==="mousemove"?(_o=a.screenX-Yo.screenX,Zo=a.screenY-Yo.screenY):Zo=_o=0,Yo=a),_o)},movementY:function(a){return"movementY"in a?a.movementY:Zo}}),Uu=pn($o),Xo=ge({},$o,{dataTransfer:0}),rn=pn(Xo),Qo=ge({},Go,{relatedTarget:0}),Ko=pn(Qo),yo=ge({},Ia,{animationName:0,elapsedTime:0,pseudoElement:0}),sn=pn(yo),vc=ge({},Ia,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Tc=pn(vc),Ed=ge({},Ia,{data:0}),wd=pn(Ed),vn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wo(a){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(a):(a=rs[a])?!!u[a]:!1}function Jo(){return Wo}var Cr=ge({},Go,{key:function(a){if(a.key){var u=vn[a.key]||a.key;if(u!=="Unidentified")return u}return a.type==="keypress"?(a=Qt(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Pl[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jo,charCode:function(a){return a.type==="keypress"?Qt(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Qt(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),eu=pn(Cr),Ec=ge({},$o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ad=pn(Ec),Ah=ge({},Go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jo}),Hf=pn(Ah),jf=ge({},Ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),qf=pn(jf),wc=ge({},$o,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Hu=pn(wc),Ac=ge({},Ia,{newState:0,oldState:0}),Sc=pn(Ac),Cc=[9,13,27,32],Mr=va&&"CompositionEvent"in window,ju=null;va&&"documentMode"in document&&(ju=document.documentMode);var Sh=va&&"TextEvent"in window&&!ju,qu=va&&(!Mr||ju&&8<ju&&11>=ju),Vu=" ",Sd=!1;function Ll(a,u){switch(a){case"keyup":return Cc.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ch(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ir=!1;function Cd(a,u){switch(a){case"compositionend":return Ch(u);case"keypress":return u.which!==32?null:(Sd=!0,Vu);case"textInput":return a=u.data,a===Vu&&Sd?null:a;default:return null}}function Md(a,u){if(Ir)return a==="compositionend"||!Mr&&Ll(a,u)?(a=mi(),ra=Ni=Sr=null,Ir=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return qu&&u.locale!=="ko"?null:u.data;default:return null}}var Vf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mh(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u==="input"?!!Vf[a.type]:u==="textarea"}function Gu(a,u,d,_){Xa?Ca?Ca.push(_):Ca=[_]:Xa=_,u=bl(u,"onChange"),0<u.length&&(d=new Fu("onChange","change",null,d,_),a.push({event:d,listeners:u}))}var Zu=null,Yu=null;function Id(a){Au(a,0)}function $u(a){var u=Wi(a);if(wh(u))return a}function Ls(a,u){if(a==="change")return u}var Ih=!1;if(va){var Mc;if(va){var bo="oninput"in document;if(!bo){var Dh=document.createElement("div");Dh.setAttribute("oninput","return;"),bo=typeof Dh.oninput=="function"}Mc=bo}else Mc=!1;Ih=Mc&&(!document.documentMode||9<document.documentMode)}function Ol(){Zu&&(Zu.detachEvent("onpropertychange",Dd),Yu=Zu=null)}function Dd(a){if(a.propertyName==="value"&&$u(Yu)){var u=[];Gu(u,Yu,a,go(a)),Ji(Id,u)}}function Gf(a,u,d){a==="focusin"?(Ol(),Zu=u,Yu=d,Zu.attachEvent("onpropertychange",Dd)):a==="focusout"&&Ol()}function Rh(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return $u(Yu)}function Rd(a,u){if(a==="click")return $u(u)}function Pd(a,u){if(a==="input"||a==="change")return $u(u)}function Ph(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var Qn=typeof Object.is=="function"?Object.is:Ph;function gi(a,u){if(Qn(a,u))return!0;if(typeof a!="object"||a===null||typeof u!="object"||u===null)return!1;var d=Object.keys(a),_=Object.keys(u);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var w=d[_];if(!On.call(u,w)||!Qn(a[w],u[w]))return!1}return!0}function ss(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ic(a,u){var d=ss(a);a=0;for(var _;d;){if(d.nodeType===3){if(_=a+d.textContent.length,a<=u&&_>=u)return{node:d,offset:u-a};a=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=ss(d)}}function Dc(a,u){return a&&u?a===u?!0:a&&a.nodeType===3?!1:u&&u.nodeType===3?Dc(a,u.parentNode):"contains"in a?a.contains(u):a.compareDocumentPosition?!!(a.compareDocumentPosition(u)&16):!1:!1}function Rc(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var u=Nu(a.document);u instanceof a.HTMLIFrameElement;){try{var d=typeof u.contentWindow.location.href=="string"}catch{d=!1}if(d)a=u.contentWindow;else break;u=Nu(a.document)}return u}function Pc(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u&&(u==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||u==="textarea"||a.contentEditable==="true")}var Lh=va&&"documentMode"in document&&11>=document.documentMode,Dr=null,Nl=null,kl=null,Oh=!1;function Ld(a,u,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Oh||Dr==null||Dr!==Nu(_)||(_=Dr,"selectionStart"in _&&Pc(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),kl&&gi(kl,_)||(kl=_,_=bl(Nl,"onSelect"),0<_.length&&(u=new Fu("onSelect","select",null,u,d),a.push({event:u,listeners:_}),u.target=Dr)))}function tu(a,u){var d={};return d[a.toLowerCase()]=u.toLowerCase(),d["Webkit"+a]="webkit"+u,d["Moz"+a]="moz"+u,d}var iu={animationend:tu("Animation","AnimationEnd"),animationiteration:tu("Animation","AnimationIteration"),animationstart:tu("Animation","AnimationStart"),transitionrun:tu("Transition","TransitionRun"),transitionstart:tu("Transition","TransitionStart"),transitioncancel:tu("Transition","TransitionCancel"),transitionend:tu("Transition","TransitionEnd")},Nh={},kh={};va&&(kh=document.createElement("div").style,"AnimationEvent"in window||(delete iu.animationend.animation,delete iu.animationiteration.animation,delete iu.animationstart.animation),"TransitionEvent"in window||delete iu.transitionend.transition);function os(a){if(Nh[a])return Nh[a];if(!iu[a])return a;var u=iu[a],d;for(d in u)if(u.hasOwnProperty(d)&&d in kh)return Nh[a]=u[d];return a}var Bl=os("animationend"),zl=os("animationiteration"),Lc=os("animationstart"),au=os("transitionrun"),Oc=os("transitionstart"),Xu=os("transitioncancel"),hr=os("transitionend"),Bh=new Map,Nc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nc.push("scrollEnd");function dr(a,u){Bh.set(a,u),ur(u,[a])}var xo=new WeakMap;function Bn(a,u){if(typeof a=="object"&&a!==null){var d=xo.get(a);return d!==void 0?d:(u={value:a,source:u,stack:Uo(u)},xo.set(a,u),u)}return{value:a,source:u,stack:Uo(u)}}var zn=[],us=0,Qu=0;function nu(){for(var a=us,u=Qu=us=0;u<a;){var d=zn[u];zn[u++]=null;var _=zn[u];zn[u++]=null;var w=zn[u];zn[u++]=null;var D=zn[u];if(zn[u++]=null,_!==null&&w!==null){var q=_.pending;q===null?w.next=w:(w.next=q.next,q.next=w),_.pending=w}D!==0&&Fl(d,w,D)}}function Os(a,u,d,_){zn[us++]=a,zn[us++]=u,zn[us++]=d,zn[us++]=_,Qu|=_,a.lanes|=_,a=a.alternate,a!==null&&(a.lanes|=_)}function vo(a,u,d,_){return Os(a,u,d,_),di(a)}function ru(a,u){return Os(a,null,null,u),di(a)}function Fl(a,u,d){a.lanes|=d;var _=a.alternate;_!==null&&(_.lanes|=d);for(var w=!1,D=a.return;D!==null;)D.childLanes|=d,_=D.alternate,_!==null&&(_.childLanes|=d),D.tag===22&&(a=D.stateNode,a===null||a._visibility&1||(w=!0)),a=D,D=D.return;return a.tag===3?(D=a.stateNode,w&&u!==null&&(w=31-Ba(d),a=D.hiddenUpdates,_=a[w],_===null?a[w]=[u]:_.push(u),u.lane=d|536870912),D):null}function di(a){if(50<ed)throw ed=0,rf=null,Error(x(185));for(var u=a.return;u!==null;)a=u,u=a.return;return a.tag===3?a.stateNode:null}var Ns={};function kc(a,u,d,_){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(a,u,d,_){return new kc(a,u,d,_)}function su(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ks(a,u){var d=a.alternate;return d===null?(d=Fn(a.tag,u,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=u,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,u=a.dependencies,d.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function Od(a,u){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=u,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,u=d.dependencies,a.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),a}function Ul(a,u,d,_,w,D){var q=0;if(_=a,typeof a=="function")su(a)&&(q=1);else if(typeof a=="string")q=P(a,d,Nt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case ai:return a=Fn(31,d,u,w),a.elementType=ai,a.lanes=D,a;case Ve:return ou(d.children,w,D,u);case Vt:q=8,w|=24;break;case li:return a=Fn(12,d,u,w|2),a.elementType=li,a.lanes=D,a;case Ie:return a=Fn(13,d,u,w),a.elementType=Ie,a.lanes=D,a;case Oe:return a=Fn(19,d,u,w),a.elementType=Oe,a.lanes=D,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Pi:case jt:q=10;break e;case Bi:q=9;break e;case et:q=11;break e;case pt:q=14;break e;case xt:q=16,_=null;break e}q=29,d=Error(x(130,a===null?"null":typeof a,"")),_=null}return u=Fn(q,d,u,w),u.elementType=a,u.type=_,u.lanes=D,u}function ou(a,u,d,_){return a=Fn(7,a,_,u),a.lanes=d,a}function Ku(a,u,d){return a=Fn(6,a,null,u),a.lanes=d,a}function uu(a,u,d){return u=Fn(4,a.children!==null?a.children:[],a.key,u),u.lanes=d,u.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},u}var Bs=[],To=0,lu=null,Wu=0,Tn=[],En=0,Fr=null,Ur=1,fr="";function ls(a,u){Bs[To++]=Wu,Bs[To++]=lu,lu=a,Wu=u}function zh(a,u,d){Tn[En++]=Ur,Tn[En++]=fr,Tn[En++]=Fr,Fr=a;var _=Ur;a=fr;var w=32-Ba(_)-1;_&=~(1<<w),d+=1;var D=32-Ba(u)+w;if(30<D){var q=w-w%5;D=(_&(1<<q)-1).toString(32),_>>=q,w-=q,Ur=1<<32-Ba(u)+w|d<<w|_,fr=D+a}else Ur=1<<D|d<<w|_,fr=a}function Ju(a){a.return!==null&&(ls(a,1),zh(a,1,0))}function Hl(a){for(;a===lu;)lu=Bs[--To],Bs[To]=null,Wu=Bs[--To],Bs[To]=null;for(;a===Fr;)Fr=Tn[--En],Tn[En]=null,fr=Tn[--En],Tn[En]=null,Ur=Tn[--En],Tn[En]=null}var wn=null,Ta=null,Ii=!1,cs=null,Hr=!1,cu=Error(x(519));function $i(a){var u=Error(x(418,""));throw Wn(Bn(u,a)),cu}function zs(a){var u=a.stateNode,d=a.type,_=a.memoizedProps;switch(u[Ft]=a,u[Ot]=_,d){case"dialog":Ai("cancel",u),Ai("close",u);break;case"iframe":case"object":case"embed":Ai("load",u);break;case"video":case"audio":for(d=0;d<rd.length;d++)Ai(rd[d],u);break;case"source":Ai("error",u);break;case"img":case"image":case"link":Ai("error",u),Ai("load",u);break;case"details":Ai("toggle",u);break;case"input":Ai("invalid",u),fo(u,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0),bc(u);break;case"select":Ai("invalid",u);break;case"textarea":Ai("invalid",u),zu(u,_.value,_.defaultValue,_.children),bc(u)}d=_.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||u.textContent===""+d||_.suppressHydrationWarning===!0||C0(u.textContent,d)?(_.popover!=null&&(Ai("beforetoggle",u),Ai("toggle",u)),_.onScroll!=null&&Ai("scroll",u),_.onScrollEnd!=null&&Ai("scrollend",u),_.onClick!=null&&(u.onclick=ud),u=!0):u=!1,u||$i(a)}function Kn(a){for(wn=a.return;wn;)switch(wn.tag){case 5:case 13:Hr=!1;return;case 27:case 3:Hr=!0;return;default:wn=wn.return}}function hu(a){if(a!==wn)return!1;if(!Ii)return Kn(a),Ii=!0,!1;var u=a.tag,d;if((d=u!==3&&u!==27)&&((d=u===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||xf(a.type,a.memoizedProps)),d=!d),d&&Ta&&$i(a),Kn(a),u===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(x(317));e:{for(a=a.nextSibling,u=0;a;){if(a.nodeType===8)if(d=a.data,d==="/$"){if(u===0){Ta=er(a.nextSibling);break e}u--}else d!=="$"&&d!=="$!"&&d!=="$?"||u++;a=a.nextSibling}Ta=null}}else u===27?(u=Ta,Su(a.type)?(a=cn,cn=null,Ta=a):Ta=u):Ta=wn?er(a.stateNode.nextSibling):null;return!0}function Fs(){Ta=wn=null,Ii=!1}function Bc(){var a=cs;return a!==null&&(vr===null?vr=a:vr.push.apply(vr,a),cs=null),a}function Wn(a){cs===null?cs=[a]:cs.push(a)}var jl=ct(null),jr=null,qr=null;function Us(a,u,d){Mt(jl,u._currentValue),u._currentValue=d}function hs(a){a._currentValue=jl.current,Et(jl)}function zc(a,u,d){for(;a!==null;){var _=a.alternate;if((a.childLanes&u)!==u?(a.childLanes|=u,_!==null&&(_.childLanes|=u)):_!==null&&(_.childLanes&u)!==u&&(_.childLanes|=u),a===d)break;a=a.return}}function Eo(a,u,d,_){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var D=w.dependencies;if(D!==null){var q=w.child;D=D.firstContext;e:for(;D!==null;){var W=D;D=w;for(var _e=0;_e<u.length;_e++)if(W.context===u[_e]){D.lanes|=d,W=D.alternate,W!==null&&(W.lanes|=d),zc(D.return,d,a),_||(q=null);break e}D=W.next}}else if(w.tag===18){if(q=w.return,q===null)throw Error(x(341));q.lanes|=d,D=q.alternate,D!==null&&(D.lanes|=d),zc(q,d,a),q=null}else q=w.child;if(q!==null)q.return=w;else for(q=w;q!==null;){if(q===a){q=null;break}if(w=q.sibling,w!==null){w.return=q.return,q=w;break}q=q.return}w=q}}function ds(a,u,d,_){a=null;for(var w=u,D=!1;w!==null;){if(!D){if((w.flags&524288)!==0)D=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var q=w.alternate;if(q===null)throw Error(x(387));if(q=q.memoizedProps,q!==null){var W=w.type;Qn(w.pendingProps.value,q.value)||(a!==null?a.push(W):a=[W])}}else if(w===si.current){if(q=w.alternate,q===null)throw Error(x(387));q.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(ue):a=[ue])}w=w.return}a!==null&&Eo(u,a,d,_),u.flags|=262144}function Da(a){for(a=a.firstContext;a!==null;){if(!Qn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Rr(a){jr=a,qr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function on(a){return Fh(jr,a)}function ql(a,u){return jr===null&&Rr(a),Fh(a,u)}function Fh(a,u){var d=u._currentValue;if(u={context:u,memoizedValue:d,next:null},qr===null){if(a===null)throw Error(x(308));qr=u,a.dependencies={lanes:0,firstContext:u},a.flags|=524288}else qr=qr.next=u;return d}var el=typeof AbortController<"u"?AbortController:function(){var a=[],u=this.signal={aborted:!1,addEventListener:function(d,_){a.push(_)}};this.abort=function(){u.aborted=!0,a.forEach(function(d){return d()})}},Uh=i.unstable_scheduleCallback,Fc=i.unstable_NormalPriority,Ga={$$typeof:jt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wo(){return{controller:new el,data:new Map,refCount:0}}function tl(a){a.refCount--,a.refCount===0&&Uh(Fc,function(){a.controller.abort()})}var Za=null,pr=0,Vr=0,An=null;function il(a,u){if(Za===null){var d=Za=[];pr=0,Vr=pf(),An={status:"pending",value:void 0,then:function(_){d.push(_)}}}return pr++,u.then(Vl,Vl),u}function Vl(){if(--pr===0&&Za!==null){An!==null&&(An.status="fulfilled");var a=Za;Za=null,Vr=0,An=null;for(var u=0;u<a.length;u++)(0,a[u])()}}function Zf(a,u){var d=[],_={status:"pending",value:null,reason:null,then:function(w){d.push(w)}};return a.then(function(){_.status="fulfilled",_.value=u;for(var w=0;w<d.length;w++)(0,d[w])(u)},function(w){for(_.status="rejected",_.reason=w,w=0;w<d.length;w++)(0,d[w])(void 0)}),_}var Uc=Je.S;Je.S=function(a,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&il(a,u),Uc!==null&&Uc(a,u)};var fs=ct(null);function Gl(){var a=fs.current;return a!==null?a:Qi.pooledCache}function Hs(a,u){u===null?Mt(fs,fs.current):Mt(fs,u.pool)}function Gr(){var a=Gl();return a===null?null:{parent:Ga._currentValue,pool:a}}var wt=Error(x(460)),Zl=Error(x(474)),du=Error(x(542)),Hc={then:function(){}};function fu(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Ao(){}function jc(a,u,d){switch(d=a[d],d===void 0?a.push(u):d!==u&&(u.then(Ao,Ao),u=d),u.status){case"fulfilled":return u.value;case"rejected":throw a=u.reason,Nd(a),a;default:if(typeof u.status=="string")u.then(Ao,Ao);else{if(a=Qi,a!==null&&100<a.shellSuspendCounter)throw Error(x(482));a=u,a.status="pending",a.then(function(_){if(u.status==="pending"){var w=u;w.status="fulfilled",w.value=_}},function(_){if(u.status==="pending"){var w=u;w.status="rejected",w.reason=_}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw a=u.reason,Nd(a),a}throw ci=u,wt}}var ci=null;function Yl(){if(ci===null)throw Error(x(459));var a=ci;return ci=null,a}function Nd(a){if(a===wt||a===du)throw Error(x(483))}var ps=!1;function qc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Vc(a,u){a=a.updateQueue,u.updateQueue===a&&(u.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ms(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Zr(a,u,d){var _=a.updateQueue;if(_===null)return null;if(_=_.shared,(ta&2)!==0){var w=_.pending;return w===null?u.next=u:(u.next=w.next,w.next=u),_.pending=u,u=di(a),Fl(a,null,d),u}return Os(a,_,u,d),di(a)}function js(a,u,d){if(u=u.updateQueue,u!==null&&(u=u.shared,(d&4194048)!==0)){var _=u.lanes;_&=a.pendingLanes,d|=_,u.lanes=d,He(a,d)}}function Hh(a,u){var d=a.updateQueue,_=a.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var w=null,D=null;if(d=d.firstBaseUpdate,d!==null){do{var q={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};D===null?w=D=q:D=D.next=q,d=d.next}while(d!==null);D===null?w=D=u:D=D.next=u}else w=D=u;d={baseState:_.baseState,firstBaseUpdate:w,lastBaseUpdate:D,shared:_.shared,callbacks:_.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=u}var al=!1;function $l(){if(al){var a=An;if(a!==null)throw a}}function Xl(a,u,d,_){al=!1;var w=a.updateQueue;ps=!1;var D=w.firstBaseUpdate,q=w.lastBaseUpdate,W=w.shared.pending;if(W!==null){w.shared.pending=null;var _e=W,Ue=_e.next;_e.next=null,q===null?D=Ue:q.next=Ue,q=_e;var nt=a.alternate;nt!==null&&(nt=nt.updateQueue,W=nt.lastBaseUpdate,W!==q&&(W===null?nt.firstBaseUpdate=Ue:W.next=Ue,nt.lastBaseUpdate=_e))}if(D!==null){var ot=w.baseState;q=0,nt=Ue=_e=null,W=D;do{var Ze=W.lane&-536870913,Xe=Ze!==W.lane;if(Xe?(Oi&Ze)===Ze:(_&Ze)===Ze){Ze!==0&&Ze===Vr&&(al=!0),nt!==null&&(nt=nt.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var ni=a,Jt=W;Ze=u;var ua=d;switch(Jt.tag){case 1:if(ni=Jt.payload,typeof ni=="function"){ot=ni.call(ua,ot,Ze);break e}ot=ni;break e;case 3:ni.flags=ni.flags&-65537|128;case 0:if(ni=Jt.payload,Ze=typeof ni=="function"?ni.call(ua,ot,Ze):ni,Ze==null)break e;ot=ge({},ot,Ze);break e;case 2:ps=!0}}Ze=W.callback,Ze!==null&&(a.flags|=64,Xe&&(a.flags|=8192),Xe=w.callbacks,Xe===null?w.callbacks=[Ze]:Xe.push(Ze))}else Xe={lane:Ze,tag:W.tag,payload:W.payload,callback:W.callback,next:null},nt===null?(Ue=nt=Xe,_e=ot):nt=nt.next=Xe,q|=Ze;if(W=W.next,W===null){if(W=w.shared.pending,W===null)break;Xe=W,W=Xe.next,Xe.next=null,w.lastBaseUpdate=Xe,w.shared.pending=null}}while(!0);nt===null&&(_e=ot),w.baseState=_e,w.firstBaseUpdate=Ue,w.lastBaseUpdate=nt,D===null&&(w.shared.lanes=0),vu|=q,a.lanes=q,a.memoizedState=ot}}function gs(a,u){if(typeof a!="function")throw Error(x(191,a));a.call(u)}function ea(a,u){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)gs(d[a],u)}var _s=ct(null),nl=ct(0);function jh(a,u){a=Oo,Mt(nl,a),Mt(_s,u),Oo=a|u.baseLanes}function Gc(){Mt(nl,Oo),Mt(_s,_s.current)}function Zc(){Oo=nl.current,Et(_s),Et(nl)}var So=0,$t=null,ki=null,vt=null,Ht=!1,ys=!1,qs=!1,rl=0,ma=0,Co=null,Pr=0;function Ra(){throw Error(x(321))}function Vs(a,u){if(u===null)return!1;for(var d=0;d<u.length&&d<a.length;d++)if(!Qn(a[d],u[d]))return!1;return!0}function la(a,u,d,_,w,D){return So=D,$t=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Je.H=a===null||a.memoizedState===null?Jl:qh,qs=!1,D=d(_,w),qs=!1,ys&&(D=pu(u,d,_,w)),ca(a),D}function ca(a){Je.H=qi;var u=ki!==null&&ki.next!==null;if(So=0,vt=ki=$t=null,Ht=!1,ma=0,Co=null,u)throw Error(x(300));a===null||mn||(a=a.dependencies,a!==null&&Da(a)&&(mn=!0))}function pu(a,u,d,_){$t=a;var w=0;do{if(ys&&(Co=null),ma=0,ys=!1,25<=w)throw Error(x(301));if(w+=1,vt=ki=null,a.updateQueue!=null){var D=a.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}Je.H=kd,D=u(d,_)}while(ys);return D}function Ql(){var a=Je.H,u=a.useState()[0];return u=typeof u.then=="function"?g(u):u,a=a.useState()[0],(ki!==null?ki.memoizedState:null)!==a&&($t.flags|=1024),u}function mu(){var a=rl!==0;return rl=0,a}function Gs(a,u,d){u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~d}function Kl(a){if(Ht){for(a=a.memoizedState;a!==null;){var u=a.queue;u!==null&&(u.pending=null),a=a.next}Ht=!1}So=0,vt=ki=$t=null,ys=!1,ma=rl=0,Co=null}function Sn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?$t.memoizedState=vt=a:vt=vt.next=a,vt}function ha(){if(ki===null){var a=$t.alternate;a=a!==null?a.memoizedState:null}else a=ki.next;var u=vt===null?$t.memoizedState:vt.next;if(u!==null)vt=u,ki=a;else{if(a===null)throw $t.alternate===null?Error(x(467)):Error(x(310));ki=a,a={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},vt===null?$t.memoizedState=vt=a:vt=vt.next=a}return vt}function Wl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function g(a){var u=ma;return ma+=1,Co===null&&(Co=[]),a=jc(Co,a,u),u=$t,(vt===null?u.memoizedState:vt.next)===null&&(u=u.alternate,Je.H=u===null||u.memoizedState===null?Jl:qh),a}function e(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return g(a);if(a.$$typeof===jt)return on(a)}throw Error(x(438,String(a)))}function r(a){var u=null,d=$t.updateQueue;if(d!==null&&(u=d.memoCache),u==null){var _=$t.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(u={data:_.data.map(function(w){return w.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),d===null&&(d=Wl(),$t.updateQueue=d),d.memoCache=u,d=u.data[u.index],d===void 0)for(d=u.data[u.index]=Array(a),_=0;_<a;_++)d[_]=Kt;return u.index++,d}function c(a,u){return typeof u=="function"?u(a):u}function p(a){var u=ha();return y(u,ki,a)}function y(a,u,d){var _=a.queue;if(_===null)throw Error(x(311));_.lastRenderedReducer=d;var w=a.baseQueue,D=_.pending;if(D!==null){if(w!==null){var q=w.next;w.next=D.next,D.next=q}u.baseQueue=w=D,_.pending=null}if(D=a.baseState,w===null)a.memoizedState=D;else{u=w.next;var W=q=null,_e=null,Ue=u,nt=!1;do{var ot=Ue.lane&-536870913;if(ot!==Ue.lane?(Oi&ot)===ot:(So&ot)===ot){var Ze=Ue.revertLane;if(Ze===0)_e!==null&&(_e=_e.next={lane:0,revertLane:0,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null}),ot===Vr&&(nt=!0);else if((So&Ze)===Ze){Ue=Ue.next,Ze===Vr&&(nt=!0);continue}else ot={lane:0,revertLane:Ue.revertLane,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},_e===null?(W=_e=ot,q=D):_e=_e.next=ot,$t.lanes|=Ze,vu|=Ze;ot=Ue.action,qs&&d(D,ot),D=Ue.hasEagerState?Ue.eagerState:d(D,ot)}else Ze={lane:ot,revertLane:Ue.revertLane,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},_e===null?(W=_e=Ze,q=D):_e=_e.next=Ze,$t.lanes|=ot,vu|=ot;Ue=Ue.next}while(Ue!==null&&Ue!==u);if(_e===null?q=D:_e.next=W,!Qn(D,a.memoizedState)&&(mn=!0,nt&&(d=An,d!==null)))throw d;a.memoizedState=D,a.baseState=q,a.baseQueue=_e,_.lastRenderedState=D}return w===null&&(_.lanes=0),[a.memoizedState,_.dispatch]}function T(a){var u=ha(),d=u.queue;if(d===null)throw Error(x(311));d.lastRenderedReducer=a;var _=d.dispatch,w=d.pending,D=u.memoizedState;if(w!==null){d.pending=null;var q=w=w.next;do D=a(D,q.action),q=q.next;while(q!==w);Qn(D,u.memoizedState)||(mn=!0),u.memoizedState=D,u.baseQueue===null&&(u.baseState=D),d.lastRenderedState=D}return[D,_]}function C(a,u,d){var _=$t,w=ha(),D=Ii;if(D){if(d===void 0)throw Error(x(407));d=d()}else d=u();var q=!Qn((ki||w).memoizedState,d);q&&(w.memoizedState=d,mn=!0),w=w.queue;var W=k.bind(null,_,w,a);if(rt(2048,8,W,[a]),w.getSnapshot!==u||q||vt!==null&&vt.memoizedState.tag&1){if(_.flags|=2048,qe(9,$e(),O.bind(null,_,w,d,u),null),Qi===null)throw Error(x(349));D||(So&124)!==0||I(_,u,d)}return d}function I(a,u,d){a.flags|=16384,a={getSnapshot:u,value:d},u=$t.updateQueue,u===null?(u=Wl(),$t.updateQueue=u,u.stores=[a]):(d=u.stores,d===null?u.stores=[a]:d.push(a))}function O(a,u,d,_){u.value=d,u.getSnapshot=_,F(u)&&z(a)}function k(a,u,d){return d(function(){F(u)&&z(a)})}function F(a){var u=a.getSnapshot;a=a.value;try{var d=u();return!Qn(a,d)}catch{return!0}}function z(a){var u=ru(a,2);u!==null&&Kr(u,a,2)}function G(a){var u=Sn();if(typeof a=="function"){var d=a;if(a=d(),qs){xn(!0);try{d()}finally{xn(!1)}}}return u.memoizedState=u.baseState=a,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:a},u}function Y(a,u,d,_){return a.baseState=d,y(a,ki,typeof _=="function"?_:c)}function ne(a,u,d,_,w){if(Ea(a))throw Error(x(485));if(a=u.action,a!==null){var D={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){D.listeners.push(q)}};Je.T!==null?d(!0):D.isTransition=!1,_(D),d=u.pending,d===null?(D.next=u.pending=D,ae(u,D)):(D.next=d.next,u.pending=d.next=D)}}function ae(a,u){var d=u.action,_=u.payload,w=a.state;if(u.isTransition){var D=Je.T,q={};Je.T=q;try{var W=d(w,_),_e=Je.S;_e!==null&&_e(q,W),re(a,u,W)}catch(Ue){me(a,u,Ue)}finally{Je.T=D}}else try{D=d(w,_),re(a,u,D)}catch(Ue){me(a,u,Ue)}}function re(a,u,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(_){le(a,u,_)},function(_){return me(a,u,_)}):le(a,u,d)}function le(a,u,d){u.status="fulfilled",u.value=d,pe(u),a.state=d,u=a.pending,u!==null&&(d=u.next,d===u?a.pending=null:(d=d.next,u.next=d,ae(a,d)))}function me(a,u,d){var _=a.pending;if(a.pending=null,_!==null){_=_.next;do u.status="rejected",u.reason=d,pe(u),u=u.next;while(u!==_)}a.action=null}function pe(a){a=a.listeners;for(var u=0;u<a.length;u++)(0,a[u])()}function be(a,u){return u}function we(a,u){if(Ii){var d=Qi.formState;if(d!==null){e:{var _=$t;if(Ii){if(Ta){t:{for(var w=Ta,D=Hr;w.nodeType!==8;){if(!D){w=null;break t}if(w=er(w.nextSibling),w===null){w=null;break t}}D=w.data,w=D==="F!"||D==="F"?w:null}if(w){Ta=er(w.nextSibling),_=w.data==="F!";break e}}$i(_)}_=!1}_&&(u=d[0])}}return d=Sn(),d.memoizedState=d.baseState=u,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:be,lastRenderedState:u},d.queue=_,d=Xs.bind(null,$t,_),_.dispatch=d,_=G(!1),D=xs.bind(null,$t,!1,_.queue),_=Sn(),w={state:u,dispatch:null,action:a,pending:null},_.queue=w,d=ne.bind(null,$t,w,D,d),w.dispatch=d,_.memoizedState=a,[u,d,!1]}function xe(a){var u=ha();return ke(u,ki,a)}function ke(a,u,d){if(u=y(a,u,be)[0],a=p(c)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var _=g(u)}catch(q){throw q===wt?du:q}else _=u;u=ha();var w=u.queue,D=w.dispatch;return d!==u.memoizedState&&($t.flags|=2048,qe(9,$e(),Ke.bind(null,w,d),null)),[_,D,a]}function Ke(a,u){a.action=u}function Ge(a){var u=ha(),d=ki;if(d!==null)return ke(u,d,a);ha(),u=u.memoizedState,d=ha();var _=d.queue.dispatch;return d.memoizedState=a,[u,_,!1]}function qe(a,u,d,_){return a={tag:a,create:d,deps:_,inst:u,next:null},u=$t.updateQueue,u===null&&(u=Wl(),$t.updateQueue=u),d=u.lastEffect,d===null?u.lastEffect=a.next=a:(_=d.next,d.next=a,a.next=_,u.lastEffect=a),a}function $e(){return{destroy:void 0,resource:void 0}}function _t(){return ha().memoizedState}function mt(a,u,d,_){var w=Sn();_=_===void 0?null:_,$t.flags|=a,w.memoizedState=qe(1|u,$e(),d,_)}function rt(a,u,d,_){var w=ha();_=_===void 0?null:_;var D=w.memoizedState.inst;ki!==null&&_!==null&&Vs(_,ki.memoizedState.deps)?w.memoizedState=qe(u,D,d,_):($t.flags|=a,w.memoizedState=qe(1|u,D,d,_))}function Rt(a,u){mt(8390656,8,a,u)}function ui(a,u){rt(2048,8,a,u)}function _i(a,u){return rt(4,2,a,u)}function da(a,u){return rt(4,4,a,u)}function ji(a,u){if(typeof u=="function"){a=a();var d=u(a);return function(){typeof d=="function"?d():u(null)}}if(u!=null)return a=a(),u.current=a,function(){u.current=null}}function fa(a,u,d){d=d!=null?d.concat([a]):null,rt(4,4,ji.bind(null,u,a),d)}function sa(){}function Xi(a,u){var d=ha();u=u===void 0?null:u;var _=d.memoizedState;return u!==null&&Vs(u,_[1])?_[0]:(d.memoizedState=[a,u],a)}function Di(a,u){var d=ha();u=u===void 0?null:u;var _=d.memoizedState;if(u!==null&&Vs(u,_[1]))return _[0];if(_=a(),qs){xn(!0);try{a()}finally{xn(!1)}}return d.memoizedState=[_,u],_}function za(a,u,d){return d===void 0||(So&1073741824)!==0?a.memoizedState=u:(a.memoizedState=d,a=sf(),$t.lanes|=a,vu|=a,d)}function Ka(a,u,d,_){return Qn(d,u)?d:_s.current!==null?(a=za(a,d,_),Qn(a,u)||(mn=!0),a):(So&42)===0?(mn=!0,a.memoizedState=d):(a=sf(),$t.lanes|=a,vu|=a,u)}function un(a,u,d,_,w){var D=St.p;St.p=D!==0&&8>D?D:8;var q=Je.T,W={};Je.T=W,xs(a,!1,u,d);try{var _e=w(),Ue=Je.S;if(Ue!==null&&Ue(W,_e),_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var nt=Zf(_e,_);gr(a,u,nt,Tr(a))}else gr(a,u,_,Tr(a))}catch(ot){gr(a,u,{then:function(){},status:"rejected",reason:ot},Tr())}finally{St.p=D,Je.T=q}}function Li(){}function bs(a,u,d,_){if(a.tag!==5)throw Error(x(476));var w=Yr(a).queue;un(a,w,u,At,d===null?Li:function(){return Zs(a),d(_)})}function Yr(a){var u=a.memoizedState;if(u!==null)return u;u={memoizedState:At,baseState:At,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:At},next:null};var d={};return u.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:d},next:null},a.memoizedState=u,a=a.alternate,a!==null&&(a.memoizedState=u),u}function Zs(a){var u=Yr(a).next.queue;gr(a,u,{},Tr())}function Ys(){return on(ue)}function sl(){return ha().memoizedState}function $s(){return ha().memoizedState}function gu(a){for(var u=a.return;u!==null;){switch(u.tag){case 24:case 3:var d=Tr();a=ms(d);var _=Zr(u,a,d);_!==null&&(Kr(_,u,d),js(_,u,d)),u={cache:wo()},a.payload=u;return}u=u.return}}function mr(a,u,d){var _=Tr();d={lane:_,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Ea(a)?Fa(u,d):(d=vo(a,u,d,_),d!==null&&(Kr(d,a,_),Cn(d,u,_)))}function Xs(a,u,d){var _=Tr();gr(a,u,d,_)}function gr(a,u,d,_){var w={lane:_,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ea(a))Fa(u,w);else{var D=a.alternate;if(a.lanes===0&&(D===null||D.lanes===0)&&(D=u.lastRenderedReducer,D!==null))try{var q=u.lastRenderedState,W=D(q,d);if(w.hasEagerState=!0,w.eagerState=W,Qn(W,q))return Os(a,u,w,0),Qi===null&&nu(),!1}catch{}finally{}if(d=vo(a,u,w,_),d!==null)return Kr(d,a,_),Cn(d,u,_),!0}return!1}function xs(a,u,d,_){if(_={lane:2,revertLane:pf(),action:_,hasEagerState:!1,eagerState:null,next:null},Ea(a)){if(u)throw Error(x(479))}else u=vo(a,d,_,2),u!==null&&Kr(u,a,2)}function Ea(a){var u=a.alternate;return a===$t||u!==null&&u===$t}function Fa(a,u){ys=Ht=!0;var d=a.pending;d===null?u.next=u:(u.next=d.next,d.next=u),a.pending=u}function Cn(a,u,d){if((d&4194048)!==0){var _=u.lanes;_&=a.pendingLanes,d|=_,u.lanes=d,He(a,d)}}var qi={readContext:on,use:e,useCallback:Ra,useContext:Ra,useEffect:Ra,useImperativeHandle:Ra,useLayoutEffect:Ra,useInsertionEffect:Ra,useMemo:Ra,useReducer:Ra,useRef:Ra,useState:Ra,useDebugValue:Ra,useDeferredValue:Ra,useTransition:Ra,useSyncExternalStore:Ra,useId:Ra,useHostTransitionStatus:Ra,useFormState:Ra,useActionState:Ra,useOptimistic:Ra,useMemoCache:Ra,useCacheRefresh:Ra},Jl={readContext:on,use:e,useCallback:function(a,u){return Sn().memoizedState=[a,u===void 0?null:u],a},useContext:on,useEffect:Rt,useImperativeHandle:function(a,u,d){d=d!=null?d.concat([a]):null,mt(4194308,4,ji.bind(null,u,a),d)},useLayoutEffect:function(a,u){return mt(4194308,4,a,u)},useInsertionEffect:function(a,u){mt(4,2,a,u)},useMemo:function(a,u){var d=Sn();u=u===void 0?null:u;var _=a();if(qs){xn(!0);try{a()}finally{xn(!1)}}return d.memoizedState=[_,u],_},useReducer:function(a,u,d){var _=Sn();if(d!==void 0){var w=d(u);if(qs){xn(!0);try{d(u)}finally{xn(!1)}}}else w=u;return _.memoizedState=_.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},_.queue=a,a=a.dispatch=mr.bind(null,$t,a),[_.memoizedState,a]},useRef:function(a){var u=Sn();return a={current:a},u.memoizedState=a},useState:function(a){a=G(a);var u=a.queue,d=Xs.bind(null,$t,u);return u.dispatch=d,[a.memoizedState,d]},useDebugValue:sa,useDeferredValue:function(a,u){var d=Sn();return za(d,a,u)},useTransition:function(){var a=G(!1);return a=un.bind(null,$t,a.queue,!0,!1),Sn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,u,d){var _=$t,w=Sn();if(Ii){if(d===void 0)throw Error(x(407));d=d()}else{if(d=u(),Qi===null)throw Error(x(349));(Oi&124)!==0||I(_,u,d)}w.memoizedState=d;var D={value:d,getSnapshot:u};return w.queue=D,Rt(k.bind(null,_,D,a),[a]),_.flags|=2048,qe(9,$e(),O.bind(null,_,D,d,u),null),d},useId:function(){var a=Sn(),u=Qi.identifierPrefix;if(Ii){var d=fr,_=Ur;d=(_&~(1<<32-Ba(_)-1)).toString(32)+d,u=""+u+"R"+d,d=rl++,0<d&&(u+="H"+d.toString(32)),u+=""}else d=Pr++,u=""+u+"r"+d.toString(32)+"";return a.memoizedState=u},useHostTransitionStatus:Ys,useFormState:we,useActionState:we,useOptimistic:function(a){var u=Sn();u.memoizedState=u.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=d,u=xs.bind(null,$t,!0,d),d.dispatch=u,[a,u]},useMemoCache:r,useCacheRefresh:function(){return Sn().memoizedState=gu.bind(null,$t)}},qh={readContext:on,use:e,useCallback:Xi,useContext:on,useEffect:ui,useImperativeHandle:fa,useInsertionEffect:_i,useLayoutEffect:da,useMemo:Di,useReducer:p,useRef:_t,useState:function(){return p(c)},useDebugValue:sa,useDeferredValue:function(a,u){var d=ha();return Ka(d,ki.memoizedState,a,u)},useTransition:function(){var a=p(c)[0],u=ha().memoizedState;return[typeof a=="boolean"?a:g(a),u]},useSyncExternalStore:C,useId:sl,useHostTransitionStatus:Ys,useFormState:xe,useActionState:xe,useOptimistic:function(a,u){var d=ha();return Y(d,ki,a,u)},useMemoCache:r,useCacheRefresh:$s},kd={readContext:on,use:e,useCallback:Xi,useContext:on,useEffect:ui,useImperativeHandle:fa,useInsertionEffect:_i,useLayoutEffect:da,useMemo:Di,useReducer:T,useRef:_t,useState:function(){return T(c)},useDebugValue:sa,useDeferredValue:function(a,u){var d=ha();return ki===null?za(d,a,u):Ka(d,ki.memoizedState,a,u)},useTransition:function(){var a=T(c)[0],u=ha().memoizedState;return[typeof a=="boolean"?a:g(a),u]},useSyncExternalStore:C,useId:sl,useHostTransitionStatus:Ys,useFormState:Ge,useActionState:Ge,useOptimistic:function(a,u){var d=ha();return ki!==null?Y(d,ki,a,u):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:r,useCacheRefresh:$s},ol=null,_u=0;function Mo(a){var u=_u;return _u+=1,ol===null&&(ol=[]),jc(ol,a,u)}function Mn(a,u){u=u.props.ref,a.ref=u!==void 0?u:null}function _r(a,u){throw u.$$typeof===Me?Error(x(525)):(a=Object.prototype.toString.call(u),Error(x(31,a==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":a)))}function yr(a){var u=a._init;return u(a._payload)}function vs(a){function u(Pe,Ce){if(a){var ze=Pe.deletions;ze===null?(Pe.deletions=[Ce],Pe.flags|=16):ze.push(Ce)}}function d(Pe,Ce){if(!a)return null;for(;Ce!==null;)u(Pe,Ce),Ce=Ce.sibling;return null}function _(Pe){for(var Ce=new Map;Pe!==null;)Pe.key!==null?Ce.set(Pe.key,Pe):Ce.set(Pe.index,Pe),Pe=Pe.sibling;return Ce}function w(Pe,Ce){return Pe=ks(Pe,Ce),Pe.index=0,Pe.sibling=null,Pe}function D(Pe,Ce,ze){return Pe.index=ze,a?(ze=Pe.alternate,ze!==null?(ze=ze.index,ze<Ce?(Pe.flags|=67108866,Ce):ze):(Pe.flags|=67108866,Ce)):(Pe.flags|=1048576,Ce)}function q(Pe){return a&&Pe.alternate===null&&(Pe.flags|=67108866),Pe}function W(Pe,Ce,ze,lt){return Ce===null||Ce.tag!==6?(Ce=Ku(ze,Pe.mode,lt),Ce.return=Pe,Ce):(Ce=w(Ce,ze),Ce.return=Pe,Ce)}function _e(Pe,Ce,ze,lt){var zt=ze.type;return zt===Ve?nt(Pe,Ce,ze.props.children,lt,ze.key):Ce!==null&&(Ce.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===xt&&yr(zt)===Ce.type)?(Ce=w(Ce,ze.props),Mn(Ce,ze),Ce.return=Pe,Ce):(Ce=Ul(ze.type,ze.key,ze.props,null,Pe.mode,lt),Mn(Ce,ze),Ce.return=Pe,Ce)}function Ue(Pe,Ce,ze,lt){return Ce===null||Ce.tag!==4||Ce.stateNode.containerInfo!==ze.containerInfo||Ce.stateNode.implementation!==ze.implementation?(Ce=uu(ze,Pe.mode,lt),Ce.return=Pe,Ce):(Ce=w(Ce,ze.children||[]),Ce.return=Pe,Ce)}function nt(Pe,Ce,ze,lt,zt){return Ce===null||Ce.tag!==7?(Ce=ou(ze,Pe.mode,lt,zt),Ce.return=Pe,Ce):(Ce=w(Ce,ze),Ce.return=Pe,Ce)}function ot(Pe,Ce,ze){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return Ce=Ku(""+Ce,Pe.mode,ze),Ce.return=Pe,Ce;if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case Ae:return ze=Ul(Ce.type,Ce.key,Ce.props,null,Pe.mode,ze),Mn(ze,Ce),ze.return=Pe,ze;case he:return Ce=uu(Ce,Pe.mode,ze),Ce.return=Pe,Ce;case xt:var lt=Ce._init;return Ce=lt(Ce._payload),ot(Pe,Ce,ze)}if(xa(Ce)||hi(Ce))return Ce=ou(Ce,Pe.mode,ze,null),Ce.return=Pe,Ce;if(typeof Ce.then=="function")return ot(Pe,Mo(Ce),ze);if(Ce.$$typeof===jt)return ot(Pe,ql(Pe,Ce),ze);_r(Pe,Ce)}return null}function Ze(Pe,Ce,ze,lt){var zt=Ce!==null?Ce.key:null;if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return zt!==null?null:W(Pe,Ce,""+ze,lt);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case Ae:return ze.key===zt?_e(Pe,Ce,ze,lt):null;case he:return ze.key===zt?Ue(Pe,Ce,ze,lt):null;case xt:return zt=ze._init,ze=zt(ze._payload),Ze(Pe,Ce,ze,lt)}if(xa(ze)||hi(ze))return zt!==null?null:nt(Pe,Ce,ze,lt,null);if(typeof ze.then=="function")return Ze(Pe,Ce,Mo(ze),lt);if(ze.$$typeof===jt)return Ze(Pe,Ce,ql(Pe,ze),lt);_r(Pe,ze)}return null}function Xe(Pe,Ce,ze,lt,zt){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Pe=Pe.get(ze)||null,W(Ce,Pe,""+lt,zt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case Ae:return Pe=Pe.get(lt.key===null?ze:lt.key)||null,_e(Ce,Pe,lt,zt);case he:return Pe=Pe.get(lt.key===null?ze:lt.key)||null,Ue(Ce,Pe,lt,zt);case xt:var ri=lt._init;return lt=ri(lt._payload),Xe(Pe,Ce,ze,lt,zt)}if(xa(lt)||hi(lt))return Pe=Pe.get(ze)||null,nt(Ce,Pe,lt,zt,null);if(typeof lt.then=="function")return Xe(Pe,Ce,ze,Mo(lt),zt);if(lt.$$typeof===jt)return Xe(Pe,Ce,ze,ql(Ce,lt),zt);_r(Ce,lt)}return null}function ni(Pe,Ce,ze,lt){for(var zt=null,ri=null,Gt=Ce,ei=Ce=0,Ln=null;Gt!==null&&ei<ze.length;ei++){Gt.index>ei?(Ln=Gt,Gt=null):Ln=Gt.sibling;var Ui=Ze(Pe,Gt,ze[ei],lt);if(Ui===null){Gt===null&&(Gt=Ln);break}a&&Gt&&Ui.alternate===null&&u(Pe,Gt),Ce=D(Ui,Ce,ei),ri===null?zt=Ui:ri.sibling=Ui,ri=Ui,Gt=Ln}if(ei===ze.length)return d(Pe,Gt),Ii&&ls(Pe,ei),zt;if(Gt===null){for(;ei<ze.length;ei++)Gt=ot(Pe,ze[ei],lt),Gt!==null&&(Ce=D(Gt,Ce,ei),ri===null?zt=Gt:ri.sibling=Gt,ri=Gt);return Ii&&ls(Pe,ei),zt}for(Gt=_(Gt);ei<ze.length;ei++)Ln=Xe(Gt,Pe,ei,ze[ei],lt),Ln!==null&&(a&&Ln.alternate!==null&&Gt.delete(Ln.key===null?ei:Ln.key),Ce=D(Ln,Ce,ei),ri===null?zt=Ln:ri.sibling=Ln,ri=Ln);return a&&Gt.forEach(function(vl){return u(Pe,vl)}),Ii&&ls(Pe,ei),zt}function Jt(Pe,Ce,ze,lt){if(ze==null)throw Error(x(151));for(var zt=null,ri=null,Gt=Ce,ei=Ce=0,Ln=null,Ui=ze.next();Gt!==null&&!Ui.done;ei++,Ui=ze.next()){Gt.index>ei?(Ln=Gt,Gt=null):Ln=Gt.sibling;var vl=Ze(Pe,Gt,Ui.value,lt);if(vl===null){Gt===null&&(Gt=Ln);break}a&&Gt&&vl.alternate===null&&u(Pe,Gt),Ce=D(vl,Ce,ei),ri===null?zt=vl:ri.sibling=vl,ri=vl,Gt=Ln}if(Ui.done)return d(Pe,Gt),Ii&&ls(Pe,ei),zt;if(Gt===null){for(;!Ui.done;ei++,Ui=ze.next())Ui=ot(Pe,Ui.value,lt),Ui!==null&&(Ce=D(Ui,Ce,ei),ri===null?zt=Ui:ri.sibling=Ui,ri=Ui);return Ii&&ls(Pe,ei),zt}for(Gt=_(Gt);!Ui.done;ei++,Ui=ze.next())Ui=Xe(Gt,Pe,ei,Ui.value,lt),Ui!==null&&(a&&Ui.alternate!==null&&Gt.delete(Ui.key===null?ei:Ui.key),Ce=D(Ui,Ce,ei),ri===null?zt=Ui:ri.sibling=Ui,ri=Ui);return a&&Gt.forEach(function(Vn){return u(Pe,Vn)}),Ii&&ls(Pe,ei),zt}function ua(Pe,Ce,ze,lt){if(typeof ze=="object"&&ze!==null&&ze.type===Ve&&ze.key===null&&(ze=ze.props.children),typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case Ae:e:{for(var zt=ze.key;Ce!==null;){if(Ce.key===zt){if(zt=ze.type,zt===Ve){if(Ce.tag===7){d(Pe,Ce.sibling),lt=w(Ce,ze.props.children),lt.return=Pe,Pe=lt;break e}}else if(Ce.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===xt&&yr(zt)===Ce.type){d(Pe,Ce.sibling),lt=w(Ce,ze.props),Mn(lt,ze),lt.return=Pe,Pe=lt;break e}d(Pe,Ce);break}else u(Pe,Ce);Ce=Ce.sibling}ze.type===Ve?(lt=ou(ze.props.children,Pe.mode,lt,ze.key),lt.return=Pe,Pe=lt):(lt=Ul(ze.type,ze.key,ze.props,null,Pe.mode,lt),Mn(lt,ze),lt.return=Pe,Pe=lt)}return q(Pe);case he:e:{for(zt=ze.key;Ce!==null;){if(Ce.key===zt)if(Ce.tag===4&&Ce.stateNode.containerInfo===ze.containerInfo&&Ce.stateNode.implementation===ze.implementation){d(Pe,Ce.sibling),lt=w(Ce,ze.children||[]),lt.return=Pe,Pe=lt;break e}else{d(Pe,Ce);break}else u(Pe,Ce);Ce=Ce.sibling}lt=uu(ze,Pe.mode,lt),lt.return=Pe,Pe=lt}return q(Pe);case xt:return zt=ze._init,ze=zt(ze._payload),ua(Pe,Ce,ze,lt)}if(xa(ze))return ni(Pe,Ce,ze,lt);if(hi(ze)){if(zt=hi(ze),typeof zt!="function")throw Error(x(150));return ze=zt.call(ze),Jt(Pe,Ce,ze,lt)}if(typeof ze.then=="function")return ua(Pe,Ce,Mo(ze),lt);if(ze.$$typeof===jt)return ua(Pe,Ce,ql(Pe,ze),lt);_r(Pe,ze)}return typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint"?(ze=""+ze,Ce!==null&&Ce.tag===6?(d(Pe,Ce.sibling),lt=w(Ce,ze),lt.return=Pe,Pe=lt):(d(Pe,Ce),lt=Ku(ze,Pe.mode,lt),lt.return=Pe,Pe=lt),q(Pe)):d(Pe,Ce)}return function(Pe,Ce,ze,lt){try{_u=0;var zt=ua(Pe,Ce,ze,lt);return ol=null,zt}catch(Gt){if(Gt===wt||Gt===du)throw Gt;var ri=Fn(29,Gt,null,Pe.mode);return ri.lanes=lt,ri.return=Pe,ri}finally{}}}var Qs=vs(!0),Ks=vs(!1),Jn=ct(null),Ws=null;function Io(a){var u=a.alternate;Mt(ln,ln.current&1),Mt(Jn,a),Ws===null&&(u===null||_s.current!==null||u.memoizedState!==null)&&(Ws=a)}function Yf(a){if(a.tag===22){if(Mt(ln,ln.current),Mt(Jn,a),Ws===null){var u=a.alternate;u!==null&&u.memoizedState!==null&&(Ws=a)}}else Lr()}function Lr(){Mt(ln,ln.current),Mt(Jn,Jn.current)}function br(a){Et(Jn),Ws===a&&(Ws=null),Et(ln)}var ln=ct(0);function Bd(a){for(var u=a;u!==null;){if(u.tag===13){var d=u.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||R0(d)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function Vh(a,u,d,_){u=a.memoizedState,d=d(_,u),d=d==null?u:ge({},u,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var zd={enqueueSetState:function(a,u,d){a=a._reactInternals;var _=Tr(),w=ms(_);w.payload=u,d!=null&&(w.callback=d),u=Zr(a,w,_),u!==null&&(Kr(u,a,_),js(u,a,_))},enqueueReplaceState:function(a,u,d){a=a._reactInternals;var _=Tr(),w=ms(_);w.tag=1,w.payload=u,d!=null&&(w.callback=d),u=Zr(a,w,_),u!==null&&(Kr(u,a,_),js(u,a,_))},enqueueForceUpdate:function(a,u){a=a._reactInternals;var d=Tr(),_=ms(d);_.tag=2,u!=null&&(_.callback=u),u=Zr(a,_,d),u!==null&&(Kr(u,a,d),js(u,a,d))}};function rp(a,u,d,_,w,D,q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(_,D,q):u.prototype&&u.prototype.isPureReactComponent?!gi(d,_)||!gi(w,D):!0}function $f(a,u,d,_){a=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(d,_),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(d,_),u.state!==a&&zd.enqueueReplaceState(u,u.state,null)}function ec(a,u){var d=u;if("ref"in u){d={};for(var _ in u)_!=="ref"&&(d[_]=u[_])}if(a=a.defaultProps){d===u&&(d=ge({},d));for(var w in a)d[w]===void 0&&(d[w]=a[w])}return d}var Yc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function sp(a){Yc(a)}function Fd(a){console.error(a)}function Xf(a){Yc(a)}function Gh(a,u){try{var d=a.onUncaughtError;d(u.value,{componentStack:u.stack})}catch(_){setTimeout(function(){throw _})}}function ul(a,u,d){try{var _=a.onCaughtError;_(d.value,{componentStack:d.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Qf(a,u,d){return d=ms(d),d.tag=3,d.payload={element:null},d.callback=function(){Gh(a,u)},d}function $c(a){return a=ms(a),a.tag=3,a}function Zh(a,u,d,_){var w=d.type.getDerivedStateFromError;if(typeof w=="function"){var D=_.value;a.payload=function(){return w(D)},a.callback=function(){ul(u,d,_)}}var q=d.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(a.callback=function(){ul(u,d,_),typeof w!="function"&&(ml===null?ml=new Set([this]):ml.add(this));var W=_.stack;this.componentDidCatch(_.value,{componentStack:W!==null?W:""})})}function Ud(a,u,d,_,w){if(d.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(u=d.alternate,u!==null&&ds(u,d,w,!0),d=Jn.current,d!==null){switch(d.tag){case 13:return Ws===null?_l():d.alternate===null&&Oa===0&&(Oa=3),d.flags&=-257,d.flags|=65536,d.lanes=w,_===Hc?d.flags|=16384:(u=d.updateQueue,u===null?d.updateQueue=new Set([_]):u.add(_),hf(a,_,w)),!1;case 22:return d.flags|=65536,_===Hc?d.flags|=16384:(u=d.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([_])},d.updateQueue=u):(d=u.retryQueue,d===null?u.retryQueue=new Set([_]):d.add(_)),hf(a,_,w)),!1}throw Error(x(435,d.tag))}return hf(a,_,w),_l(),!1}if(Ii)return u=Jn.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=w,_!==cu&&(a=Error(x(422),{cause:_}),Wn(Bn(a,d)))):(_!==cu&&(u=Error(x(423),{cause:_}),Wn(Bn(u,d))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,_=Bn(_,d),w=Qf(a.stateNode,_,w),Hh(a,w),Oa!==4&&(Oa=2)),!1;var D=Error(x(520),{cause:_});if(D=Bn(D,d),Wh===null?Wh=[D]:Wh.push(D),Oa!==4&&(Oa=2),u===null)return!0;_=Bn(_,d),d=u;do{switch(d.tag){case 3:return d.flags|=65536,a=w&-w,d.lanes|=a,a=Qf(d.stateNode,_,a),Hh(d,a),!1;case 1:if(u=d.type,D=d.stateNode,(d.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(ml===null||!ml.has(D))))return d.flags|=65536,w&=-w,d.lanes|=w,w=$c(w),Zh(w,a,d,_),Hh(d,w),!1}d=d.return}while(d!==null);return!1}var Kf=Error(x(461)),mn=!1;function Un(a,u,d,_){u.child=a===null?Ks(u,null,d,_):Qs(u,a.child,d,_)}function op(a,u,d,_,w){d=d.render;var D=u.ref;if("ref"in _){var q={};for(var W in _)W!=="ref"&&(q[W]=_[W])}else q=_;return Rr(u),_=la(a,u,d,q,D,w),W=mu(),a!==null&&!mn?(Gs(a,u,w),Do(a,u,w)):(Ii&&W&&Ju(u),u.flags|=1,Un(a,u,_,w),u.child)}function Wf(a,u,d,_,w){if(a===null){var D=d.type;return typeof D=="function"&&!su(D)&&D.defaultProps===void 0&&d.compare===null?(u.tag=15,u.type=D,Jf(a,u,D,_,w)):(a=Ul(d.type,null,_,u,u.mode,w),a.ref=u.ref,a.return=u,u.child=a)}if(D=a.child,!yu(a,w)){var q=D.memoizedProps;if(d=d.compare,d=d!==null?d:gi,d(q,_)&&a.ref===u.ref)return Do(a,u,w)}return u.flags|=1,a=ks(D,_),a.ref=u.ref,a.return=u,u.child=a}function Jf(a,u,d,_,w){if(a!==null){var D=a.memoizedProps;if(gi(D,_)&&a.ref===u.ref)if(mn=!1,u.pendingProps=_=D,yu(a,w))(a.flags&131072)!==0&&(mn=!0);else return u.lanes=a.lanes,Do(a,u,w)}return Hd(a,u,d,_,w)}function e0(a,u,d){var _=u.pendingProps,w=_.children,D=a!==null?a.memoizedState:null;if(_.mode==="hidden"){if((u.flags&128)!==0){if(_=D!==null?D.baseLanes|d:d,a!==null){for(w=u.child=a.child,D=0;w!==null;)D=D|w.lanes|w.childLanes,w=w.sibling;u.childLanes=D&~_}else u.childLanes=0,u.child=null;return up(a,u,_,d)}if((d&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},a!==null&&Hs(u,D!==null?D.cachePool:null),D!==null?jh(u,D):Gc(),Yf(u);else return u.lanes=u.childLanes=536870912,up(a,u,D!==null?D.baseLanes|d:d,d)}else D!==null?(Hs(u,D.cachePool),jh(u,D),Lr(),u.memoizedState=null):(a!==null&&Hs(u,null),Gc(),Lr());return Un(a,u,w,d),u.child}function up(a,u,d,_){var w=Gl();return w=w===null?null:{parent:Ga._currentValue,pool:w},u.memoizedState={baseLanes:d,cachePool:w},a!==null&&Hs(u,null),Gc(),Yf(u),a!==null&&ds(a,u,_,!0),null}function Xc(a,u){var d=u.ref;if(d===null)a!==null&&a.ref!==null&&(u.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(x(284));(a===null||a.ref!==d)&&(u.flags|=4194816)}}function Hd(a,u,d,_,w){return Rr(u),d=la(a,u,d,_,void 0,w),_=mu(),a!==null&&!mn?(Gs(a,u,w),Do(a,u,w)):(Ii&&_&&Ju(u),u.flags|=1,Un(a,u,d,w),u.child)}function jd(a,u,d,_,w,D){return Rr(u),u.updateQueue=null,d=pu(u,_,d,w),ca(a),_=mu(),a!==null&&!mn?(Gs(a,u,D),Do(a,u,D)):(Ii&&_&&Ju(u),u.flags|=1,Un(a,u,d,D),u.child)}function Qc(a,u,d,_,w){if(Rr(u),u.stateNode===null){var D=Ns,q=d.contextType;typeof q=="object"&&q!==null&&(D=on(q)),D=new d(_,D),u.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=zd,u.stateNode=D,D._reactInternals=u,D=u.stateNode,D.props=_,D.state=u.memoizedState,D.refs={},qc(u),q=d.contextType,D.context=typeof q=="object"&&q!==null?on(q):Ns,D.state=u.memoizedState,q=d.getDerivedStateFromProps,typeof q=="function"&&(Vh(u,d,q,_),D.state=u.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(q=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),q!==D.state&&zd.enqueueReplaceState(D,D.state,null),Xl(u,_,D,w),$l(),D.state=u.memoizedState),typeof D.componentDidMount=="function"&&(u.flags|=4194308),_=!0}else if(a===null){D=u.stateNode;var W=u.memoizedProps,_e=ec(d,W);D.props=_e;var Ue=D.context,nt=d.contextType;q=Ns,typeof nt=="object"&&nt!==null&&(q=on(nt));var ot=d.getDerivedStateFromProps;nt=typeof ot=="function"||typeof D.getSnapshotBeforeUpdate=="function",W=u.pendingProps!==W,nt||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(W||Ue!==q)&&$f(u,D,_,q),ps=!1;var Ze=u.memoizedState;D.state=Ze,Xl(u,_,D,w),$l(),Ue=u.memoizedState,W||Ze!==Ue||ps?(typeof ot=="function"&&(Vh(u,d,ot,_),Ue=u.memoizedState),(_e=ps||rp(u,d,_e,_,Ze,Ue,q))?(nt||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(u.flags|=4194308)):(typeof D.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=_,u.memoizedState=Ue),D.props=_,D.state=Ue,D.context=q,_=_e):(typeof D.componentDidMount=="function"&&(u.flags|=4194308),_=!1)}else{D=u.stateNode,Vc(a,u),q=u.memoizedProps,nt=ec(d,q),D.props=nt,ot=u.pendingProps,Ze=D.context,Ue=d.contextType,_e=Ns,typeof Ue=="object"&&Ue!==null&&(_e=on(Ue)),W=d.getDerivedStateFromProps,(Ue=typeof W=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==ot||Ze!==_e)&&$f(u,D,_,_e),ps=!1,Ze=u.memoizedState,D.state=Ze,Xl(u,_,D,w),$l();var Xe=u.memoizedState;q!==ot||Ze!==Xe||ps||a!==null&&a.dependencies!==null&&Da(a.dependencies)?(typeof W=="function"&&(Vh(u,d,W,_),Xe=u.memoizedState),(nt=ps||rp(u,d,nt,_,Ze,Xe,_e)||a!==null&&a.dependencies!==null&&Da(a.dependencies))?(Ue||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(_,Xe,_e),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(_,Xe,_e)),typeof D.componentDidUpdate=="function"&&(u.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof D.componentDidUpdate!="function"||q===a.memoizedProps&&Ze===a.memoizedState||(u.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===a.memoizedProps&&Ze===a.memoizedState||(u.flags|=1024),u.memoizedProps=_,u.memoizedState=Xe),D.props=_,D.state=Xe,D.context=_e,_=nt):(typeof D.componentDidUpdate!="function"||q===a.memoizedProps&&Ze===a.memoizedState||(u.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===a.memoizedProps&&Ze===a.memoizedState||(u.flags|=1024),_=!1)}return D=_,Xc(a,u),_=(u.flags&128)!==0,D||_?(D=u.stateNode,d=_&&typeof d.getDerivedStateFromError!="function"?null:D.render(),u.flags|=1,a!==null&&_?(u.child=Qs(u,a.child,null,w),u.child=Qs(u,null,d,w)):Un(a,u,d,w),u.memoizedState=D.state,a=u.child):a=Do(a,u,w),a}function Or(a,u,d,_){return Fs(),u.flags|=256,Un(a,u,d,_),u.child}var qd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Yh(a){return{baseLanes:a,cachePool:Gr()}}function t0(a,u,d){return a=a!==null?a.childLanes&~d:0,u&&(a|=Es),a}function i0(a,u,d){var _=u.pendingProps,w=!1,D=(u.flags&128)!==0,q;if((q=D)||(q=a!==null&&a.memoizedState===null?!1:(ln.current&2)!==0),q&&(w=!0,u.flags&=-129),q=(u.flags&32)!==0,u.flags&=-33,a===null){if(Ii){if(w?Io(u):Lr(),Ii){var W=Ta,_e;if(_e=W){e:{for(_e=W,W=Hr;_e.nodeType!==8;){if(!W){W=null;break e}if(_e=er(_e.nextSibling),_e===null){W=null;break e}}W=_e}W!==null?(u.memoizedState={dehydrated:W,treeContext:Fr!==null?{id:Ur,overflow:fr}:null,retryLane:536870912,hydrationErrors:null},_e=Fn(18,null,null,0),_e.stateNode=W,_e.return=u,u.child=_e,wn=u,Ta=null,_e=!0):_e=!1}_e||$i(u)}if(W=u.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return R0(W)?u.lanes=32:u.lanes=536870912,null;br(u)}return W=_.children,_=_.fallback,w?(Lr(),w=u.mode,W=Vd({mode:"hidden",children:W},w),_=ou(_,w,d,null),W.return=u,_.return=u,W.sibling=_,u.child=W,w=u.child,w.memoizedState=Yh(d),w.childLanes=t0(a,q,d),u.memoizedState=qd,_):(Io(u),a0(u,W))}if(_e=a.memoizedState,_e!==null&&(W=_e.dehydrated,W!==null)){if(D)u.flags&256?(Io(u),u.flags&=-257,u=n0(a,u,d)):u.memoizedState!==null?(Lr(),u.child=a.child,u.flags|=128,u=null):(Lr(),w=_.fallback,W=u.mode,_=Vd({mode:"visible",children:_.children},W),w=ou(w,W,d,null),w.flags|=2,_.return=u,w.return=u,_.sibling=w,u.child=_,Qs(u,a.child,null,d),_=u.child,_.memoizedState=Yh(d),_.childLanes=t0(a,q,d),u.memoizedState=qd,u=w);else if(Io(u),R0(W)){if(q=W.nextSibling&&W.nextSibling.dataset,q)var Ue=q.dgst;q=Ue,_=Error(x(419)),_.stack="",_.digest=q,Wn({value:_,source:null,stack:null}),u=n0(a,u,d)}else if(mn||ds(a,u,d,!1),q=(d&a.childLanes)!==0,mn||q){if(q=Qi,q!==null&&(_=d&-d,_=(_&42)!==0?1:Re(_),_=(_&(q.suspendedLanes|d))!==0?0:_,_!==0&&_!==_e.retryLane))throw _e.retryLane=_,ru(a,_),Kr(q,a,_),Kf;W.data==="$?"||_l(),u=n0(a,u,d)}else W.data==="$?"?(u.flags|=192,u.child=a.child,u=null):(a=_e.treeContext,Ta=er(W.nextSibling),wn=u,Ii=!0,cs=null,Hr=!1,a!==null&&(Tn[En++]=Ur,Tn[En++]=fr,Tn[En++]=Fr,Ur=a.id,fr=a.overflow,Fr=u),u=a0(u,_.children),u.flags|=4096);return u}return w?(Lr(),w=_.fallback,W=u.mode,_e=a.child,Ue=_e.sibling,_=ks(_e,{mode:"hidden",children:_.children}),_.subtreeFlags=_e.subtreeFlags&65011712,Ue!==null?w=ks(Ue,w):(w=ou(w,W,d,null),w.flags|=2),w.return=u,_.return=u,_.sibling=w,u.child=_,_=w,w=u.child,W=a.child.memoizedState,W===null?W=Yh(d):(_e=W.cachePool,_e!==null?(Ue=Ga._currentValue,_e=_e.parent!==Ue?{parent:Ue,pool:Ue}:_e):_e=Gr(),W={baseLanes:W.baseLanes|d,cachePool:_e}),w.memoizedState=W,w.childLanes=t0(a,q,d),u.memoizedState=qd,_):(Io(u),d=a.child,a=d.sibling,d=ks(d,{mode:"visible",children:_.children}),d.return=u,d.sibling=null,a!==null&&(q=u.deletions,q===null?(u.deletions=[a],u.flags|=16):q.push(a)),u.child=d,u.memoizedState=null,d)}function a0(a,u){return u=Vd({mode:"visible",children:u},a.mode),u.return=a,a.child=u}function Vd(a,u){return a=Fn(22,a,null,u),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function n0(a,u,d){return Qs(u,a.child,null,d),a=a0(u,u.pendingProps.children),a.flags|=2,u.memoizedState=null,a}function lp(a,u,d){a.lanes|=u;var _=a.alternate;_!==null&&(_.lanes|=u),zc(a.return,u,d)}function $h(a,u,d,_,w){var D=a.memoizedState;D===null?a.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:w}:(D.isBackwards=u,D.rendering=null,D.renderingStartTime=0,D.last=_,D.tail=d,D.tailMode=w)}function Gd(a,u,d){var _=u.pendingProps,w=_.revealOrder,D=_.tail;if(Un(a,u,_.children,d),_=ln.current,(_&2)!==0)_=_&1|2,u.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=u.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&lp(a,d,u);else if(a.tag===19)lp(a,d,u);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===u)break e;for(;a.sibling===null;){if(a.return===null||a.return===u)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}_&=1}switch(Mt(ln,_),w){case"forwards":for(d=u.child,w=null;d!==null;)a=d.alternate,a!==null&&Bd(a)===null&&(w=d),d=d.sibling;d=w,d===null?(w=u.child,u.child=null):(w=d.sibling,d.sibling=null),$h(u,!1,w,d,D);break;case"backwards":for(d=null,w=u.child,u.child=null;w!==null;){if(a=w.alternate,a!==null&&Bd(a)===null){u.child=w;break}a=w.sibling,w.sibling=d,d=w,w=a}$h(u,!0,d,null,D);break;case"together":$h(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Do(a,u,d){if(a!==null&&(u.dependencies=a.dependencies),vu|=u.lanes,(d&u.childLanes)===0)if(a!==null){if(ds(a,u,d,!1),(d&u.childLanes)===0)return null}else return null;if(a!==null&&u.child!==a.child)throw Error(x(153));if(u.child!==null){for(a=u.child,d=ks(a,a.pendingProps),u.child=d,d.return=u;a.sibling!==null;)a=a.sibling,d=d.sibling=ks(a,a.pendingProps),d.return=u;d.sibling=null}return u.child}function yu(a,u){return(a.lanes&u)!==0?!0:(a=a.dependencies,!!(a!==null&&Da(a)))}function Xh(a,u,d){switch(u.tag){case 3:yi(u,u.stateNode.containerInfo),Us(u,Ga,a.memoizedState.cache),Fs();break;case 27:case 5:es(u);break;case 4:yi(u,u.stateNode.containerInfo);break;case 10:Us(u,u.type,u.memoizedProps.value);break;case 13:var _=u.memoizedState;if(_!==null)return _.dehydrated!==null?(Io(u),u.flags|=128,null):(d&u.child.childLanes)!==0?i0(a,u,d):(Io(u),a=Do(a,u,d),a!==null?a.sibling:null);Io(u);break;case 19:var w=(a.flags&128)!==0;if(_=(d&u.childLanes)!==0,_||(ds(a,u,d,!1),_=(d&u.childLanes)!==0),w){if(_)return Gd(a,u,d);u.flags|=128}if(w=u.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Mt(ln,ln.current),_)break;return null;case 22:case 23:return u.lanes=0,e0(a,u,d);case 24:Us(u,Ga,a.memoizedState.cache)}return Do(a,u,d)}function cp(a,u,d){if(a!==null)if(a.memoizedProps!==u.pendingProps)mn=!0;else{if(!yu(a,d)&&(u.flags&128)===0)return mn=!1,Xh(a,u,d);mn=(a.flags&131072)!==0}else mn=!1,Ii&&(u.flags&1048576)!==0&&zh(u,Wu,u.index);switch(u.lanes=0,u.tag){case 16:e:{a=u.pendingProps;var _=u.elementType,w=_._init;if(_=w(_._payload),u.type=_,typeof _=="function")su(_)?(a=ec(_,a),u.tag=1,u=Qc(null,u,_,a,d)):(u.tag=0,u=Hd(null,u,_,a,d));else{if(_!=null){if(w=_.$$typeof,w===et){u.tag=11,u=op(null,u,_,a,d);break e}else if(w===pt){u.tag=14,u=Wf(null,u,_,a,d);break e}}throw u=zi(_)||_,Error(x(306,u,""))}}return u;case 0:return Hd(a,u,u.type,u.pendingProps,d);case 1:return _=u.type,w=ec(_,u.pendingProps),Qc(a,u,_,w,d);case 3:e:{if(yi(u,u.stateNode.containerInfo),a===null)throw Error(x(387));_=u.pendingProps;var D=u.memoizedState;w=D.element,Vc(a,u),Xl(u,_,null,d);var q=u.memoizedState;if(_=q.cache,Us(u,Ga,_),_!==D.cache&&Eo(u,[Ga],d,!0),$l(),_=q.element,D.isDehydrated)if(D={element:_,isDehydrated:!1,cache:q.cache},u.updateQueue.baseState=D,u.memoizedState=D,u.flags&256){u=Or(a,u,_,d);break e}else if(_!==w){w=Bn(Error(x(424)),u),Wn(w),u=Or(a,u,_,d);break e}else{switch(a=u.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Ta=er(a.firstChild),wn=u,Ii=!0,cs=null,Hr=!0,d=Ks(u,null,_,d),u.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Fs(),_===w){u=Do(a,u,d);break e}Un(a,u,_,d)}u=u.child}return u;case 26:return Xc(a,u),a===null?(d=gh(u.type,null,u.pendingProps,null))?u.memoizedState=d:Ii||(d=u.type,a=u.pendingProps,_=io(Zt.current).createElement(d),_[Ft]=u,_[Ot]=a,Pn(_,d,a),Ut(_),u.stateNode=_):u.memoizedState=gh(u.type,a.memoizedProps,u.pendingProps,a.memoizedState),null;case 27:return es(u),a===null&&Ii&&(_=u.stateNode=wf(u.type,u.pendingProps,Zt.current),wn=u,Hr=!0,w=Ta,Su(u.type)?(cn=w,Ta=er(_.firstChild)):Ta=w),Un(a,u,u.pendingProps.children,d),Xc(a,u),a===null&&(u.flags|=4194304),u.child;case 5:return a===null&&Ii&&((w=_=Ta)&&(_=Ef(_,u.type,u.pendingProps,Hr),_!==null?(u.stateNode=_,wn=u,Ta=er(_.firstChild),Hr=!1,w=!0):w=!1),w||$i(u)),es(u),w=u.type,D=u.pendingProps,q=a!==null?a.memoizedProps:null,_=D.children,xf(w,D)?_=null:q!==null&&xf(w,q)&&(u.flags|=32),u.memoizedState!==null&&(w=la(a,u,Ql,null,null,d),ue._currentValue=w),Xc(a,u),Un(a,u,_,d),u.child;case 6:return a===null&&Ii&&((a=d=Ta)&&(d=Cm(d,u.pendingProps,Hr),d!==null?(u.stateNode=d,wn=u,Ta=null,a=!0):a=!1),a||$i(u)),null;case 13:return i0(a,u,d);case 4:return yi(u,u.stateNode.containerInfo),_=u.pendingProps,a===null?u.child=Qs(u,null,_,d):Un(a,u,_,d),u.child;case 11:return op(a,u,u.type,u.pendingProps,d);case 7:return Un(a,u,u.pendingProps,d),u.child;case 8:return Un(a,u,u.pendingProps.children,d),u.child;case 12:return Un(a,u,u.pendingProps.children,d),u.child;case 10:return _=u.pendingProps,Us(u,u.type,_.value),Un(a,u,_.children,d),u.child;case 9:return w=u.type._context,_=u.pendingProps.children,Rr(u),w=on(w),_=_(w),u.flags|=1,Un(a,u,_,d),u.child;case 14:return Wf(a,u,u.type,u.pendingProps,d);case 15:return Jf(a,u,u.type,u.pendingProps,d);case 19:return Gd(a,u,d);case 31:return _=u.pendingProps,d=u.mode,_={mode:_.mode,children:_.children},a===null?(d=Vd(_,d),d.ref=u.ref,u.child=d,d.return=u,u=d):(d=ks(a.child,_),d.ref=u.ref,u.child=d,d.return=u,u=d),u;case 22:return e0(a,u,d);case 24:return Rr(u),_=on(Ga),a===null?(w=Gl(),w===null&&(w=Qi,D=wo(),w.pooledCache=D,D.refCount++,D!==null&&(w.pooledCacheLanes|=d),w=D),u.memoizedState={parent:_,cache:w},qc(u),Us(u,Ga,w)):((a.lanes&d)!==0&&(Vc(a,u),Xl(u,null,null,d),$l()),w=a.memoizedState,D=u.memoizedState,w.parent!==_?(w={parent:_,cache:_},u.memoizedState=w,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=w),Us(u,Ga,_)):(_=D.cache,Us(u,Ga,_),_!==w.cache&&Eo(u,[Ga],d,!0))),Un(a,u,u.pendingProps.children,d),u.child;case 29:throw u.pendingProps}throw Error(x(156,u.tag))}function bu(a){a.flags|=4}function hp(a,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!N(u)){if(u=Jn.current,u!==null&&((Oi&4194048)===Oi?Ws!==null:(Oi&62914560)!==Oi&&(Oi&536870912)===0||u!==Ws))throw ci=Hc,Zl;a.flags|=8192}}function Zd(a,u){u!==null&&(a.flags|=4),a.flags&16384&&(u=a.tag!==22?Te():536870912,a.lanes|=u,Tu|=u)}function Qh(a,u){if(!Ii)switch(a.tailMode){case"hidden":u=a.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?u||a.tail===null?a.tail=null:a.tail.sibling=null:_.sibling=null}}function Ua(a){var u=a.alternate!==null&&a.alternate.child===a.child,d=0,_=0;if(u)for(var w=a.child;w!==null;)d|=w.lanes|w.childLanes,_|=w.subtreeFlags&65011712,_|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)d|=w.lanes|w.childLanes,_|=w.subtreeFlags,_|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=_,a.childLanes=d,u}function ym(a,u,d){var _=u.pendingProps;switch(Hl(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ua(u),null;case 1:return Ua(u),null;case 3:return d=u.stateNode,_=null,a!==null&&(_=a.memoizedState.cache),u.memoizedState.cache!==_&&(u.flags|=2048),hs(Ga),Va(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&(hu(u)?bu(u):a===null||a.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Bc())),Ua(u),null;case 26:return d=u.memoizedState,a===null?(bu(u),d!==null?(Ua(u),hp(u,d)):(Ua(u),u.flags&=-16777217)):d?d!==a.memoizedState?(bu(u),Ua(u),hp(u,d)):(Ua(u),u.flags&=-16777217):(a.memoizedProps!==_&&bu(u),Ua(u),u.flags&=-16777217),null;case 27:bn(u),d=Zt.current;var w=u.type;if(a!==null&&u.stateNode!=null)a.memoizedProps!==_&&bu(u);else{if(!_){if(u.stateNode===null)throw Error(x(166));return Ua(u),null}a=Nt.current,hu(u)?zs(u):(a=wf(w,_,d),u.stateNode=a,bu(u))}return Ua(u),null;case 5:if(bn(u),d=u.type,a!==null&&u.stateNode!=null)a.memoizedProps!==_&&bu(u);else{if(!_){if(u.stateNode===null)throw Error(x(166));return Ua(u),null}if(a=Nt.current,hu(u))zs(u);else{switch(w=io(Zt.current),a){case 1:a=w.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:a=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":a=w.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":a=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":a=w.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof _.is=="string"?w.createElement("select",{is:_.is}):w.createElement("select"),_.multiple?a.multiple=!0:_.size&&(a.size=_.size);break;default:a=typeof _.is=="string"?w.createElement(d,{is:_.is}):w.createElement(d)}}a[Ft]=u,a[Ot]=_;e:for(w=u.child;w!==null;){if(w.tag===5||w.tag===6)a.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===u)break e;for(;w.sibling===null;){if(w.return===null||w.return===u)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}u.stateNode=a;e:switch(Pn(a,d,_),d){case"button":case"input":case"select":case"textarea":a=!!_.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&bu(u)}}return Ua(u),u.flags&=-16777217,null;case 6:if(a&&u.stateNode!=null)a.memoizedProps!==_&&bu(u);else{if(typeof _!="string"&&u.stateNode===null)throw Error(x(166));if(a=Zt.current,hu(u)){if(a=u.stateNode,d=u.memoizedProps,_=null,w=wn,w!==null)switch(w.tag){case 27:case 5:_=w.memoizedProps}a[Ft]=u,a=!!(a.nodeValue===d||_!==null&&_.suppressHydrationWarning===!0||C0(a.nodeValue,d)),a||$i(u)}else a=io(a).createTextNode(_),a[Ft]=u,u.stateNode=a}return Ua(u),null;case 13:if(_=u.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=hu(u),_!==null&&_.dehydrated!==null){if(a===null){if(!w)throw Error(x(318));if(w=u.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(x(317));w[Ft]=u}else Fs(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Ua(u),w=!1}else w=Bc(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return u.flags&256?(br(u),u):(br(u),null)}if(br(u),(u.flags&128)!==0)return u.lanes=d,u;if(d=_!==null,a=a!==null&&a.memoizedState!==null,d){_=u.child,w=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(w=_.alternate.memoizedState.cachePool.pool);var D=null;_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(D=_.memoizedState.cachePool.pool),D!==w&&(_.flags|=2048)}return d!==a&&d&&(u.child.flags|=8192),Zd(u,u.updateQueue),Ua(u),null;case 4:return Va(),a===null&&gf(u.stateNode.containerInfo),Ua(u),null;case 10:return hs(u.type),Ua(u),null;case 19:if(Et(ln),w=u.memoizedState,w===null)return Ua(u),null;if(_=(u.flags&128)!==0,D=w.rendering,D===null)if(_)Qh(w,!1);else{if(Oa!==0||a!==null&&(a.flags&128)!==0)for(a=u.child;a!==null;){if(D=Bd(a),D!==null){for(u.flags|=128,Qh(w,!1),a=D.updateQueue,u.updateQueue=a,Zd(u,a),u.subtreeFlags=0,a=d,d=u.child;d!==null;)Od(d,a),d=d.sibling;return Mt(ln,ln.current&1|2),u.child}a=a.sibling}w.tail!==null&&ka()>tf&&(u.flags|=128,_=!0,Qh(w,!1),u.lanes=4194304)}else{if(!_)if(a=Bd(D),a!==null){if(u.flags|=128,_=!0,a=a.updateQueue,u.updateQueue=a,Zd(u,a),Qh(w,!0),w.tail===null&&w.tailMode==="hidden"&&!D.alternate&&!Ii)return Ua(u),null}else 2*ka()-w.renderingStartTime>tf&&d!==536870912&&(u.flags|=128,_=!0,Qh(w,!1),u.lanes=4194304);w.isBackwards?(D.sibling=u.child,u.child=D):(a=w.last,a!==null?a.sibling=D:u.child=D,w.last=D)}return w.tail!==null?(u=w.tail,w.rendering=u,w.tail=u.sibling,w.renderingStartTime=ka(),u.sibling=null,a=ln.current,Mt(ln,_?a&1|2:a&1),u):(Ua(u),null);case 22:case 23:return br(u),Zc(),_=u.memoizedState!==null,a!==null?a.memoizedState!==null!==_&&(u.flags|=8192):_&&(u.flags|=8192),_?(d&536870912)!==0&&(u.flags&128)===0&&(Ua(u),u.subtreeFlags&6&&(u.flags|=8192)):Ua(u),d=u.updateQueue,d!==null&&Zd(u,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),_=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(_=u.memoizedState.cachePool.pool),_!==d&&(u.flags|=2048),a!==null&&Et(fs),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),u.memoizedState.cache!==d&&(u.flags|=2048),hs(Ga),Ua(u),null;case 25:return null;case 30:return null}throw Error(x(156,u.tag))}function r0(a,u){switch(Hl(u),u.tag){case 1:return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 3:return hs(Ga),Va(),a=u.flags,(a&65536)!==0&&(a&128)===0?(u.flags=a&-65537|128,u):null;case 26:case 27:case 5:return bn(u),null;case 13:if(br(u),a=u.memoizedState,a!==null&&a.dehydrated!==null){if(u.alternate===null)throw Error(x(340));Fs()}return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 19:return Et(ln),null;case 4:return Va(),null;case 10:return hs(u.type),null;case 22:case 23:return br(u),Zc(),a!==null&&Et(fs),a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 24:return hs(Ga),null;case 25:return null;default:return null}}function dp(a,u){switch(Hl(u),u.tag){case 3:hs(Ga),Va();break;case 26:case 27:case 5:bn(u);break;case 4:Va();break;case 13:br(u);break;case 19:Et(ln);break;case 10:hs(u.type);break;case 22:case 23:br(u),Zc(),a!==null&&Et(fs);break;case 24:hs(Ga)}}function Kc(a,u){try{var d=u.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var w=_.next;d=w;do{if((d.tag&a)===a){_=void 0;var D=d.create,q=d.inst;_=D(),q.destroy=_}d=d.next}while(d!==w)}}catch(W){pa(u,u.return,W)}}function Ts(a,u,d){try{var _=u.updateQueue,w=_!==null?_.lastEffect:null;if(w!==null){var D=w.next;_=D;do{if((_.tag&a)===a){var q=_.inst,W=q.destroy;if(W!==void 0){q.destroy=void 0,w=u;var _e=d,Ue=W;try{Ue()}catch(nt){pa(w,_e,nt)}}}_=_.next}while(_!==D)}}catch(nt){pa(u,u.return,nt)}}function fp(a){var u=a.updateQueue;if(u!==null){var d=a.stateNode;try{ea(u,d)}catch(_){pa(a,a.return,_)}}}function Pa(a,u,d){d.props=ec(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(_){pa(a,u,_)}}function Ro(a,u){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var _=a.stateNode;break;case 30:_=a.stateNode;break;default:_=a.stateNode}typeof d=="function"?a.refCleanup=d(_):d.current=_}}catch(w){pa(a,u,w)}}function Js(a,u){var d=a.ref,_=a.refCleanup;if(d!==null)if(typeof _=="function")try{_()}catch(w){pa(a,u,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(w){pa(a,u,w)}else d.current=null}function Kh(a){var u=a.type,d=a.memoizedProps,_=a.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":d.autoFocus&&_.focus();break e;case"img":d.src?_.src=d.src:d.srcSet&&(_.srcset=d.srcSet)}}catch(w){pa(a,a.return,w)}}function Wc(a,u,d){try{var _=a.stateNode;Rp(_,a.type,d,u),_[Ot]=u}catch(w){pa(a,a.return,w)}}function Jc(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Su(a.type)||a.tag===4}function Yd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Jc(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Su(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function $d(a,u,d){var _=a.tag;if(_===5||_===6)a=a.stateNode,u?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,u):(u=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,u.appendChild(a),d=d._reactRootContainer,d!=null||u.onclick!==null||(u.onclick=ud));else if(_!==4&&(_===27&&Su(a.type)&&(d=a.stateNode,u=null),a=a.child,a!==null))for($d(a,u,d),a=a.sibling;a!==null;)$d(a,u,d),a=a.sibling}function ll(a,u,d){var _=a.tag;if(_===5||_===6)a=a.stateNode,u?d.insertBefore(a,u):d.appendChild(a);else if(_!==4&&(_===27&&Su(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(ll(a,u,d),a=a.sibling;a!==null;)ll(a,u,d),a=a.sibling}function Xd(a){var u=a.stateNode,d=a.memoizedProps;try{for(var _=a.type,w=u.attributes;w.length;)u.removeAttributeNode(w[0]);Pn(u,_,d),u[Ft]=a,u[Ot]=d}catch(D){pa(a,a.return,D)}}var Nr=!1,La=!1,cl=!1,eh=typeof WeakSet=="function"?WeakSet:Set,In=null;function pp(a,u){if(a=a.containerInfo,M0=ht,a=Rc(a),Pc(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var w=_.anchorOffset,D=_.focusNode;_=_.focusOffset;try{d.nodeType,D.nodeType}catch{d=null;break e}var q=0,W=-1,_e=-1,Ue=0,nt=0,ot=a,Ze=null;t:for(;;){for(var Xe;ot!==d||w!==0&&ot.nodeType!==3||(W=q+w),ot!==D||_!==0&&ot.nodeType!==3||(_e=q+_),ot.nodeType===3&&(q+=ot.nodeValue.length),(Xe=ot.firstChild)!==null;)Ze=ot,ot=Xe;for(;;){if(ot===a)break t;if(Ze===d&&++Ue===w&&(W=q),Ze===D&&++nt===_&&(_e=q),(Xe=ot.nextSibling)!==null)break;ot=Ze,Ze=ot.parentNode}ot=Xe}d=W===-1||_e===-1?null:{start:W,end:_e}}else d=null}d=d||{start:0,end:0}}else d=null;for(bf={focusedElem:a,selectionRange:d},ht=!1,In=u;In!==null;)if(u=In,a=u.child,(u.subtreeFlags&1024)!==0&&a!==null)a.return=u,In=a;else for(;In!==null;){switch(u=In,D=u.alternate,a=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&D!==null){a=void 0,d=u,w=D.memoizedProps,D=D.memoizedState,_=d.stateNode;try{var ni=ec(d.type,w,d.elementType===d.type);a=_.getSnapshotBeforeUpdate(ni,D),_.__reactInternalSnapshotBeforeUpdate=a}catch(Jt){pa(d,d.return,Jt)}}break;case 3:if((a&1024)!==0){if(a=u.stateNode.containerInfo,d=a.nodeType,d===9)ph(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":ph(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(x(163))}if(a=u.sibling,a!==null){a.return=u.return,In=a;break}In=u.return}}function hl(a,u,d){var _=d.flags;switch(d.tag){case 0:case 11:case 15:Po(a,d),_&4&&Kc(5,d);break;case 1:if(Po(a,d),_&4)if(a=d.stateNode,u===null)try{a.componentDidMount()}catch(q){pa(d,d.return,q)}else{var w=ec(d.type,u.memoizedProps);u=u.memoizedState;try{a.componentDidUpdate(w,u,a.__reactInternalSnapshotBeforeUpdate)}catch(q){pa(d,d.return,q)}}_&64&&fp(d),_&512&&Ro(d,d.return);break;case 3:if(Po(a,d),_&64&&(a=d.updateQueue,a!==null)){if(u=null,d.child!==null)switch(d.child.tag){case 27:case 5:u=d.child.stateNode;break;case 1:u=d.child.stateNode}try{ea(a,u)}catch(q){pa(d,d.return,q)}}break;case 27:u===null&&_&4&&Xd(d);case 26:case 5:Po(a,d),u===null&&_&4&&Kh(d),_&512&&Ro(d,d.return);break;case 12:Po(a,d);break;case 13:Po(a,d),_&4&&o0(a,d),_&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=No.bind(null,d),Mm(a,d))));break;case 22:if(_=d.memoizedState!==null||Nr,!_){u=u!==null&&u.memoizedState!==null||La,w=Nr;var D=La;Nr=_,(La=u)&&!D?Lo(a,d,(d.subtreeFlags&8772)!==0):Po(a,d),Nr=w,La=D}break;case 30:break;default:Po(a,d)}}function mp(a){var u=a.alternate;u!==null&&(a.alternate=null,mp(u)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(u=a.stateNode,u!==null&&qt(u)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var wa=null,Dn=!1;function eo(a,u,d){for(d=d.child;d!==null;)s0(a,u,d),d=d.sibling}function s0(a,u,d){if(an&&typeof an.onCommitFiberUnmount=="function")try{an.onCommitFiberUnmount(is,d)}catch{}switch(d.tag){case 26:La||Js(d,u),eo(a,u,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:La||Js(d,u);var _=wa,w=Dn;Su(d.type)&&(wa=d.stateNode,Dn=!1),eo(a,u,d),mh(d.stateNode),wa=_,Dn=w;break;case 5:La||Js(d,u);case 6:if(_=wa,w=Dn,wa=null,eo(a,u,d),wa=_,Dn=w,wa!==null)if(Dn)try{(wa.nodeType===9?wa.body:wa.nodeName==="HTML"?wa.ownerDocument.body:wa).removeChild(d.stateNode)}catch(D){pa(d,u,D)}else try{wa.removeChild(d.stateNode)}catch(D){pa(d,u,D)}break;case 18:wa!==null&&(Dn?(a=wa,ld(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),ya(a)):ld(wa,d.stateNode));break;case 4:_=wa,w=Dn,wa=d.stateNode.containerInfo,Dn=!0,eo(a,u,d),wa=_,Dn=w;break;case 0:case 11:case 14:case 15:La||Ts(2,d,u),La||Ts(4,d,u),eo(a,u,d);break;case 1:La||(Js(d,u),_=d.stateNode,typeof _.componentWillUnmount=="function"&&Pa(d,u,_)),eo(a,u,d);break;case 21:eo(a,u,d);break;case 22:La=(_=La)||d.memoizedState!==null,eo(a,u,d),La=_;break;default:eo(a,u,d)}}function o0(a,u){if(u.memoizedState===null&&(a=u.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ya(a)}catch(d){pa(u,u.return,d)}}function bm(a){switch(a.tag){case 13:case 19:var u=a.stateNode;return u===null&&(u=a.stateNode=new eh),u;case 22:return a=a.stateNode,u=a._retryCache,u===null&&(u=a._retryCache=new eh),u;default:throw Error(x(435,a.tag))}}function u0(a,u){var d=bm(a);u.forEach(function(_){var w=yl.bind(null,a,_);d.has(_)||(d.add(_),_.then(w,w))})}function $r(a,u){var d=u.deletions;if(d!==null)for(var _=0;_<d.length;_++){var w=d[_],D=a,q=u,W=q;e:for(;W!==null;){switch(W.tag){case 27:if(Su(W.type)){wa=W.stateNode,Dn=!1;break e}break;case 5:wa=W.stateNode,Dn=!1;break e;case 3:case 4:wa=W.stateNode.containerInfo,Dn=!0;break e}W=W.return}if(wa===null)throw Error(x(160));s0(D,q,w),wa=null,Dn=!1,D=w.alternate,D!==null&&(D.return=null),w.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)gp(u,a),u=u.sibling}var to=null;function gp(a,u){var d=a.alternate,_=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:$r(u,a),xr(a),_&4&&(Ts(3,a,a.return),Kc(3,a),Ts(5,a,a.return));break;case 1:$r(u,a),xr(a),_&512&&(La||d===null||Js(d,d.return)),_&64&&Nr&&(a=a.updateQueue,a!==null&&(_=a.callbacks,_!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?_:d.concat(_))));break;case 26:var w=to;if($r(u,a),xr(a),_&512&&(La||d===null||Js(d,d.return)),_&4){var D=d!==null?d.memoizedState:null;if(_=a.memoizedState,d===null)if(_===null)if(a.stateNode===null){e:{_=a.type,d=a.memoizedProps,w=w.ownerDocument||w;t:switch(_){case"title":D=w.getElementsByTagName("title")[0],(!D||D[it]||D[Ft]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=w.createElement(_),w.head.insertBefore(D,w.querySelector("head > title"))),Pn(D,_,d),D[Ft]=a,Ut(D),_=D;break e;case"link":var q=E("link","href",w).get(_+(d.href||""));if(q){for(var W=0;W<q.length;W++)if(D=q[W],D.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&D.getAttribute("rel")===(d.rel==null?null:d.rel)&&D.getAttribute("title")===(d.title==null?null:d.title)&&D.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){q.splice(W,1);break t}}D=w.createElement(_),Pn(D,_,d),w.head.appendChild(D);break;case"meta":if(q=E("meta","content",w).get(_+(d.content||""))){for(W=0;W<q.length;W++)if(D=q[W],D.getAttribute("content")===(d.content==null?null:""+d.content)&&D.getAttribute("name")===(d.name==null?null:d.name)&&D.getAttribute("property")===(d.property==null?null:d.property)&&D.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&D.getAttribute("charset")===(d.charSet==null?null:d.charSet)){q.splice(W,1);break t}}D=w.createElement(_),Pn(D,_,d),w.head.appendChild(D);break;default:throw Error(x(468,_))}D[Ft]=a,Ut(D),_=D}a.stateNode=_}else M(w,a.type,a.stateNode);else a.stateNode=s(w,_,a.memoizedProps);else D!==_?(D===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):D.count--,_===null?M(w,a.type,a.stateNode):s(w,_,a.memoizedProps)):_===null&&a.stateNode!==null&&Wc(a,a.memoizedProps,d.memoizedProps)}break;case 27:$r(u,a),xr(a),_&512&&(La||d===null||Js(d,d.return)),d!==null&&_&4&&Wc(a,a.memoizedProps,d.memoizedProps);break;case 5:if($r(u,a),xr(a),_&512&&(La||d===null||Js(d,d.return)),a.flags&32){w=a.stateNode;try{po(w,"")}catch(Xe){pa(a,a.return,Xe)}}_&4&&a.stateNode!=null&&(w=a.memoizedProps,Wc(a,w,d!==null?d.memoizedProps:w)),_&1024&&(cl=!0);break;case 6:if($r(u,a),xr(a),_&4){if(a.stateNode===null)throw Error(x(162));_=a.memoizedProps,d=a.stateNode;try{d.nodeValue=_}catch(Xe){pa(a,a.return,Xe)}}break;case 3:if(v=null,w=to,to=Sf(u.containerInfo),$r(u,a),to=w,xr(a),_&4&&d!==null&&d.memoizedState.isDehydrated)try{ya(u.containerInfo)}catch(Xe){pa(a,a.return,Xe)}cl&&(cl=!1,l0(a));break;case 4:_=to,to=Sf(a.stateNode.containerInfo),$r(u,a),xr(a),to=_;break;case 12:$r(u,a),xr(a);break;case 13:$r(u,a),xr(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(p0=ka()),_&4&&(_=a.updateQueue,_!==null&&(a.updateQueue=null,u0(a,_)));break;case 22:w=a.memoizedState!==null;var _e=d!==null&&d.memoizedState!==null,Ue=Nr,nt=La;if(Nr=Ue||w,La=nt||_e,$r(u,a),La=nt,Nr=Ue,xr(a),_&8192)e:for(u=a.stateNode,u._visibility=w?u._visibility&-2:u._visibility|1,w&&(d===null||_e||Nr||La||dl(a)),d=null,u=a;;){if(u.tag===5||u.tag===26){if(d===null){_e=d=u;try{if(D=_e.stateNode,w)q=D.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{W=_e.stateNode;var ot=_e.memoizedProps.style,Ze=ot!=null&&ot.hasOwnProperty("display")?ot.display:null;W.style.display=Ze==null||typeof Ze=="boolean"?"":(""+Ze).trim()}}catch(Xe){pa(_e,_e.return,Xe)}}}else if(u.tag===6){if(d===null){_e=u;try{_e.stateNode.nodeValue=w?"":_e.memoizedProps}catch(Xe){pa(_e,_e.return,Xe)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===a)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break e;for(;u.sibling===null;){if(u.return===null||u.return===a)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}_&4&&(_=a.updateQueue,_!==null&&(d=_.retryQueue,d!==null&&(_.retryQueue=null,u0(a,d))));break;case 19:$r(u,a),xr(a),_&4&&(_=a.updateQueue,_!==null&&(a.updateQueue=null,u0(a,_)));break;case 30:break;case 21:break;default:$r(u,a),xr(a)}}function xr(a){var u=a.flags;if(u&2){try{for(var d,_=a.return;_!==null;){if(Jc(_)){d=_;break}_=_.return}if(d==null)throw Error(x(160));switch(d.tag){case 27:var w=d.stateNode,D=Yd(a);ll(a,D,w);break;case 5:var q=d.stateNode;d.flags&32&&(po(q,""),d.flags&=-33);var W=Yd(a);ll(a,W,q);break;case 3:case 4:var _e=d.stateNode.containerInfo,Ue=Yd(a);$d(a,Ue,_e);break;default:throw Error(x(161))}}catch(nt){pa(a,a.return,nt)}a.flags&=-3}u&4096&&(a.flags&=-4097)}function l0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var u=a;l0(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),a=a.sibling}}function Po(a,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)hl(a,u.alternate,u),u=u.sibling}function dl(a){for(a=a.child;a!==null;){var u=a;switch(u.tag){case 0:case 11:case 14:case 15:Ts(4,u,u.return),dl(u);break;case 1:Js(u,u.return);var d=u.stateNode;typeof d.componentWillUnmount=="function"&&Pa(u,u.return,d),dl(u);break;case 27:mh(u.stateNode);case 26:case 5:Js(u,u.return),dl(u);break;case 22:u.memoizedState===null&&dl(u);break;case 30:dl(u);break;default:dl(u)}a=a.sibling}}function Lo(a,u,d){for(d=d&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var _=u.alternate,w=a,D=u,q=D.flags;switch(D.tag){case 0:case 11:case 15:Lo(w,D,d),Kc(4,D);break;case 1:if(Lo(w,D,d),_=D,w=_.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Ue){pa(_,_.return,Ue)}if(_=D,w=_.updateQueue,w!==null){var W=_.stateNode;try{var _e=w.shared.hiddenCallbacks;if(_e!==null)for(w.shared.hiddenCallbacks=null,w=0;w<_e.length;w++)gs(_e[w],W)}catch(Ue){pa(_,_.return,Ue)}}d&&q&64&&fp(D),Ro(D,D.return);break;case 27:Xd(D);case 26:case 5:Lo(w,D,d),d&&_===null&&q&4&&Kh(D),Ro(D,D.return);break;case 12:Lo(w,D,d);break;case 13:Lo(w,D,d),d&&q&4&&o0(w,D);break;case 22:D.memoizedState===null&&Lo(w,D,d),Ro(D,D.return);break;case 30:break;default:Lo(w,D,d)}u=u.sibling}}function Qd(a,u){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(a=u.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&tl(d))}function Kd(a,u){a=null,u.alternate!==null&&(a=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==a&&(u.refCount++,a!=null&&tl(a))}function Xr(a,u,d,_){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)c0(a,u,d,_),u=u.sibling}function c0(a,u,d,_){var w=u.flags;switch(u.tag){case 0:case 11:case 15:Xr(a,u,d,_),w&2048&&Kc(9,u);break;case 1:Xr(a,u,d,_);break;case 3:Xr(a,u,d,_),w&2048&&(a=null,u.alternate!==null&&(a=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==a&&(u.refCount++,a!=null&&tl(a)));break;case 12:if(w&2048){Xr(a,u,d,_),a=u.stateNode;try{var D=u.memoizedProps,q=D.id,W=D.onPostCommit;typeof W=="function"&&W(q,u.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(_e){pa(u,u.return,_e)}}else Xr(a,u,d,_);break;case 13:Xr(a,u,d,_);break;case 23:break;case 22:D=u.stateNode,q=u.alternate,u.memoizedState!==null?D._visibility&2?Xr(a,u,d,_):th(a,u):D._visibility&2?Xr(a,u,d,_):(D._visibility|=2,tc(a,u,d,_,(u.subtreeFlags&10256)!==0)),w&2048&&Qd(q,u);break;case 24:Xr(a,u,d,_),w&2048&&Kd(u.alternate,u);break;default:Xr(a,u,d,_)}}function tc(a,u,d,_,w){for(w=w&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var D=a,q=u,W=d,_e=_,Ue=q.flags;switch(q.tag){case 0:case 11:case 15:tc(D,q,W,_e,w),Kc(8,q);break;case 23:break;case 22:var nt=q.stateNode;q.memoizedState!==null?nt._visibility&2?tc(D,q,W,_e,w):th(D,q):(nt._visibility|=2,tc(D,q,W,_e,w)),w&&Ue&2048&&Qd(q.alternate,q);break;case 24:tc(D,q,W,_e,w),w&&Ue&2048&&Kd(q.alternate,q);break;default:tc(D,q,W,_e,w)}u=u.sibling}}function th(a,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var d=a,_=u,w=_.flags;switch(_.tag){case 22:th(d,_),w&2048&&Qd(_.alternate,_);break;case 24:th(d,_),w&2048&&Kd(_.alternate,_);break;default:th(d,_)}u=u.sibling}}var xu=8192;function ih(a){if(a.subtreeFlags&xu)for(a=a.child;a!==null;)Wd(a),a=a.sibling}function Wd(a){switch(a.tag){case 26:ih(a),a.flags&xu&&a.memoizedState!==null&&j(to,a.memoizedState,a.memoizedProps);break;case 5:ih(a);break;case 3:case 4:var u=to;to=Sf(a.stateNode.containerInfo),ih(a),to=u;break;case 22:a.memoizedState===null&&(u=a.alternate,u!==null&&u.memoizedState!==null?(u=xu,xu=16777216,ih(a),xu=u):ih(a));break;default:ih(a)}}function ah(a){var u=a.alternate;if(u!==null&&(a=u.child,a!==null)){u.child=null;do u=a.sibling,a.sibling=null,a=u;while(a!==null)}}function ic(a){var u=a.deletions;if((a.flags&16)!==0){if(u!==null)for(var d=0;d<u.length;d++){var _=u[d];In=_,h0(_,a)}ah(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)_p(a),a=a.sibling}function _p(a){switch(a.tag){case 0:case 11:case 15:ic(a),a.flags&2048&&Ts(9,a,a.return);break;case 3:ic(a);break;case 12:ic(a);break;case 22:var u=a.stateNode;a.memoizedState!==null&&u._visibility&2&&(a.return===null||a.return.tag!==13)?(u._visibility&=-3,Jd(a)):ic(a);break;default:ic(a)}}function Jd(a){var u=a.deletions;if((a.flags&16)!==0){if(u!==null)for(var d=0;d<u.length;d++){var _=u[d];In=_,h0(_,a)}ah(a)}for(a=a.child;a!==null;){switch(u=a,u.tag){case 0:case 11:case 15:Ts(8,u,u.return),Jd(u);break;case 22:d=u.stateNode,d._visibility&2&&(d._visibility&=-3,Jd(u));break;default:Jd(u)}a=a.sibling}}function h0(a,u){for(;In!==null;){var d=In;switch(d.tag){case 0:case 11:case 15:Ts(8,d,u);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var _=d.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:tl(d.memoizedState.cache)}if(_=d.child,_!==null)_.return=d,In=_;else e:for(d=a;In!==null;){_=In;var w=_.sibling,D=_.return;if(mp(_),_===d){In=null;break e}if(w!==null){w.return=D,In=w;break e}In=D}}}var yp={getCacheForType:function(a){var u=on(Ga),d=u.data.get(a);return d===void 0&&(d=a(),u.data.set(a,d)),d}},xm=typeof WeakMap=="function"?WeakMap:Map,ta=0,Qi=null,wi=null,Oi=0,ia=0,Qr=null,fl=!1,nh=!1,d0=!1,Oo=0,Oa=0,vu=0,pl=0,ef=0,Es=0,Tu=0,Wh=null,vr=null,f0=!1,p0=0,tf=1/0,Jh=null,ml=null,Hn=0,ws=null,ac=null,gl=0,af=0,Ha=null,nf=null,ed=0,rf=null;function Tr(){if((ta&2)!==0&&Oi!==0)return Oi&-Oi;if(Je.T!==null){var a=Vr;return a!==0?a:pf()}return yt()}function sf(){Es===0&&(Es=(Oi&536870912)===0||Ii?de():536870912);var a=Jn.current;return a!==null&&(a.flags|=32),Es}function Kr(a,u,d){(a===Qi&&(ia===2||ia===9)||a.cancelPendingCommit!==null)&&(nc(a,0),Eu(a,Oi,Es,!1)),Ne(a,d),((ta&2)===0||a!==Qi)&&(a===Qi&&((ta&2)===0&&(pl|=d),Oa===4&&Eu(a,Oi,Es,!1)),As(a))}function bp(a,u,d){if((ta&6)!==0)throw Error(x(327));var _=!d&&(u&124)===0&&(u&a.expiredLanes)===0||K(a,u),w=_?Tm(a,u):sh(a,u,!0),D=_;do{if(w===0){nh&&!_&&Eu(a,u,0,!1);break}else{if(d=a.current.alternate,D&&!vm(d)){w=sh(a,u,!1),D=!1;continue}if(w===2){if(D=u,a.errorRecoveryDisabledLanes&D)var q=0;else q=a.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){u=q;e:{var W=a;w=Wh;var _e=W.current.memoizedState.isDehydrated;if(_e&&(nc(W,q).flags|=256),q=sh(W,q,!1),q!==2){if(d0&&!_e){W.errorRecoveryDisabledLanes|=D,pl|=D,w=4;break e}D=vr,vr=w,D!==null&&(vr===null?vr=D:vr.push.apply(vr,D))}w=q}if(D=!1,w!==2)continue}}if(w===1){nc(a,0),Eu(a,u,0,!0);break}e:{switch(_=a,D=w,D){case 0:case 1:throw Error(x(345));case 4:if((u&4194048)!==u)break;case 6:Eu(_,u,Es,!fl);break e;case 2:vr=null;break;case 3:case 5:break;default:throw Error(x(329))}if((u&62914560)===u&&(w=p0+300-ka(),10<w)){if(Eu(_,u,Es,!fl),X(_,0,!0)!==0)break e;_.timeoutHandle=Pp(xp.bind(null,_,d,vr,Jh,f0,u,Es,pl,Tu,fl,D,2,-0,0),w);break e}xp(_,d,vr,Jh,f0,u,Es,pl,Tu,fl,D,0,-0,0)}}break}while(!0);As(a)}function xp(a,u,d,_,w,D,q,W,_e,Ue,nt,ot,Ze,Xe){if(a.timeoutHandle=-1,ot=u.subtreeFlags,(ot&8192||(ot&16785408)===16785408)&&(B={stylesheets:null,count:0,unsuspend:U},Wd(u),ot=V(),ot!==null)){a.cancelPendingCommit=ot(uf.bind(null,a,u,D,d,_,w,q,W,_e,nt,1,Ze,Xe)),Eu(a,D,q,!Ue);return}uf(a,u,D,d,_,w,q,W,_e)}function vm(a){for(var u=a;;){var d=u.tag;if((d===0||d===11||d===15)&&u.flags&16384&&(d=u.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var _=0;_<d.length;_++){var w=d[_],D=w.getSnapshot;w=w.value;try{if(!Qn(D(),w))return!1}catch{return!1}}if(d=u.child,u.subtreeFlags&16384&&d!==null)d.return=u,u=d;else{if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function Eu(a,u,d,_){u&=~ef,u&=~pl,a.suspendedLanes|=u,a.pingedLanes&=~u,_&&(a.warmLanes|=u),_=a.expirationTimes;for(var w=u;0<w;){var D=31-Ba(w),q=1<<D;_[D]=-1,w&=~q}d!==0&&Le(a,d,u)}function Rn(){return(ta&6)===0?(oc(0),!1):!0}function td(){if(wi!==null){if(ia===0)var a=wi.return;else a=wi,qr=jr=null,Kl(a),ol=null,_u=0,a=wi;for(;a!==null;)dp(a.alternate,a),a=a.return;wi=null}}function nc(a,u){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,Lp(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),td(),Qi=a,wi=d=ks(a.current,null),Oi=u,ia=0,Qr=null,fl=!1,nh=K(a,u),d0=!1,Tu=Es=ef=pl=vu=Oa=0,vr=Wh=null,f0=!1,(u&8)!==0&&(u|=u&32);var _=a.entangledLanes;if(_!==0)for(a=a.entanglements,_&=u;0<_;){var w=31-Ba(_),D=1<<w;u|=a[w],_&=~D}return Oo=u,nu(),d}function wu(a,u){$t=null,Je.H=qi,u===wt||u===du?(u=Yl(),ia=3):u===Zl?(u=Yl(),ia=4):ia=u===Kf?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,Qr=u,wi===null&&(Oa=1,Gh(a,Bn(u,a.current)))}function id(){var a=Je.H;return Je.H=qi,a===null?qi:a}function rh(){var a=Je.A;return Je.A=yp,a}function _l(){Oa=4,fl||(Oi&4194048)!==Oi&&Jn.current!==null||(nh=!0),(vu&134217727)===0&&(pl&134217727)===0||Qi===null||Eu(Qi,Oi,Es,!1)}function sh(a,u,d){var _=ta;ta|=2;var w=id(),D=rh();(Qi!==a||Oi!==u)&&(Jh=null,nc(a,u)),u=!1;var q=Oa;e:do try{if(ia!==0&&wi!==null){var W=wi,_e=Qr;switch(ia){case 8:td(),q=6;break e;case 3:case 2:case 9:case 6:Jn.current===null&&(u=!0);var Ue=ia;if(ia=0,Qr=null,oh(a,W,_e,Ue),d&&nh){q=0;break e}break;default:Ue=ia,ia=0,Qr=null,oh(a,W,_e,Ue)}}of(),q=Oa;break}catch(nt){wu(a,nt)}while(!0);return u&&a.shellSuspendCounter++,qr=jr=null,ta=_,Je.H=w,Je.A=D,wi===null&&(Qi=null,Oi=0,nu()),q}function of(){for(;wi!==null;)m0(wi)}function Tm(a,u){var d=ta;ta|=2;var _=id(),w=rh();Qi!==a||Oi!==u?(Jh=null,tf=ka()+500,nc(a,u)):nh=K(a,u);e:do try{if(ia!==0&&wi!==null){u=wi;var D=Qr;t:switch(ia){case 1:ia=0,Qr=null,oh(a,u,D,1);break;case 2:case 9:if(fu(D)){ia=0,Qr=null,g0(u);break}u=function(){ia!==2&&ia!==9||Qi!==a||(ia=7),As(a)},D.then(u,u);break e;case 3:ia=7;break e;case 4:ia=5;break e;case 7:fu(D)?(ia=0,Qr=null,g0(u)):(ia=0,Qr=null,oh(a,u,D,7));break;case 5:var q=null;switch(wi.tag){case 26:q=wi.memoizedState;case 5:case 27:var W=wi;if(!q||N(q)){ia=0,Qr=null;var _e=W.sibling;if(_e!==null)wi=_e;else{var Ue=W.return;Ue!==null?(wi=Ue,ad(Ue)):wi=null}break t}}ia=0,Qr=null,oh(a,u,D,5);break;case 6:ia=0,Qr=null,oh(a,u,D,6);break;case 8:td(),Oa=6;break e;default:throw Error(x(462))}}Em();break}catch(nt){wu(a,nt)}while(!0);return qr=jr=null,Je.H=_,Je.A=w,ta=d,wi!==null?0:(Qi=null,Oi=0,nu(),Oa)}function Em(){for(;wi!==null&&!ts();)m0(wi)}function m0(a){var u=cp(a.alternate,a,Oo);a.memoizedProps=a.pendingProps,u===null?ad(a):wi=u}function g0(a){var u=a,d=u.alternate;switch(u.tag){case 15:case 0:u=jd(d,u,u.pendingProps,u.type,void 0,Oi);break;case 11:u=jd(d,u,u.pendingProps,u.type.render,u.ref,Oi);break;case 5:Kl(u);default:dp(d,u),u=wi=Od(u,Oo),u=cp(d,u,Oo)}a.memoizedProps=a.pendingProps,u===null?ad(a):wi=u}function oh(a,u,d,_){qr=jr=null,Kl(u),ol=null,_u=0;var w=u.return;try{if(Ud(a,w,u,d,Oi)){Oa=1,Gh(a,Bn(d,a.current)),wi=null;return}}catch(D){if(w!==null)throw wi=w,D;Oa=1,Gh(a,Bn(d,a.current)),wi=null;return}u.flags&32768?(Ii||_===1?a=!0:nh||(Oi&536870912)!==0?a=!1:(fl=a=!0,(_===2||_===9||_===3||_===6)&&(_=Jn.current,_!==null&&_.tag===13&&(_.flags|=16384))),_0(u,a)):ad(u)}function ad(a){var u=a;do{if((u.flags&32768)!==0){_0(u,fl);return}a=u.return;var d=ym(u.alternate,u,Oo);if(d!==null){wi=d;return}if(u=u.sibling,u!==null){wi=u;return}wi=u=a}while(u!==null);Oa===0&&(Oa=5)}function _0(a,u){do{var d=r0(a.alternate,a);if(d!==null){d.flags&=32767,wi=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!u&&(a=a.sibling,a!==null)){wi=a;return}wi=a=d}while(a!==null);Oa=6,wi=null}function uf(a,u,d,_,w,D,q,W,_e){a.cancelPendingCommit=null;do cf();while(Hn!==0);if((ta&6)!==0)throw Error(x(327));if(u!==null){if(u===a.current)throw Error(x(177));if(D=u.lanes|u.childLanes,D|=Qu,Se(a,d,D,q,W,_e),a===Qi&&(wi=Qi=null,Oi=0),ac=u,ws=a,gl=d,af=D,Ha=w,nf=_,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,Sp(sr,function(){return Ep(),null})):(a.callbackNode=null,a.callbackPriority=0),_=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||_){_=Je.T,Je.T=null,w=St.p,St.p=2,q=ta,ta|=4;try{pp(a,u,d)}finally{ta=q,St.p=w,Je.T=_}}Hn=1,lf(),vp(),y0()}}function lf(){if(Hn===1){Hn=0;var a=ws,u=ac,d=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||d){d=Je.T,Je.T=null;var _=St.p;St.p=2;var w=ta;ta|=4;try{gp(u,a);var D=bf,q=Rc(a.containerInfo),W=D.focusedElem,_e=D.selectionRange;if(q!==W&&W&&W.ownerDocument&&Dc(W.ownerDocument.documentElement,W)){if(_e!==null&&Pc(W)){var Ue=_e.start,nt=_e.end;if(nt===void 0&&(nt=Ue),"selectionStart"in W)W.selectionStart=Ue,W.selectionEnd=Math.min(nt,W.value.length);else{var ot=W.ownerDocument||document,Ze=ot&&ot.defaultView||window;if(Ze.getSelection){var Xe=Ze.getSelection(),ni=W.textContent.length,Jt=Math.min(_e.start,ni),ua=_e.end===void 0?Jt:Math.min(_e.end,ni);!Xe.extend&&Jt>ua&&(q=ua,ua=Jt,Jt=q);var Pe=Ic(W,Jt),Ce=Ic(W,ua);if(Pe&&Ce&&(Xe.rangeCount!==1||Xe.anchorNode!==Pe.node||Xe.anchorOffset!==Pe.offset||Xe.focusNode!==Ce.node||Xe.focusOffset!==Ce.offset)){var ze=ot.createRange();ze.setStart(Pe.node,Pe.offset),Xe.removeAllRanges(),Jt>ua?(Xe.addRange(ze),Xe.extend(Ce.node,Ce.offset)):(ze.setEnd(Ce.node,Ce.offset),Xe.addRange(ze))}}}}for(ot=[],Xe=W;Xe=Xe.parentNode;)Xe.nodeType===1&&ot.push({element:Xe,left:Xe.scrollLeft,top:Xe.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<ot.length;W++){var lt=ot[W];lt.element.scrollLeft=lt.left,lt.element.scrollTop=lt.top}}ht=!!M0,bf=M0=null}finally{ta=w,St.p=_,Je.T=d}}a.current=u,Hn=2}}function vp(){if(Hn===2){Hn=0;var a=ws,u=ac,d=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||d){d=Je.T,Je.T=null;var _=St.p;St.p=2;var w=ta;ta|=4;try{hl(a,u.alternate,u)}finally{ta=w,St.p=_,Je.T=d}}Hn=3}}function y0(){if(Hn===4||Hn===3){Hn=0,so();var a=ws,u=ac,d=gl,_=nf;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?Hn=5:(Hn=0,ac=ws=null,Tp(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(ml=null),at(d),u=u.stateNode,an&&typeof an.onCommitFiberRoot=="function")try{an.onCommitFiberRoot(is,u,void 0,(u.current.flags&128)===128)}catch{}if(_!==null){u=Je.T,w=St.p,St.p=2,Je.T=null;try{for(var D=a.onRecoverableError,q=0;q<_.length;q++){var W=_[q];D(W.value,{componentStack:W.stack})}}finally{Je.T=u,St.p=w}}(gl&3)!==0&&cf(),As(a),w=a.pendingLanes,(d&4194090)!==0&&(w&42)!==0?a===rf?ed++:(ed=0,rf=a):ed=0,oc(0)}}function Tp(a,u){(a.pooledCacheLanes&=u)===0&&(u=a.pooledCache,u!=null&&(a.pooledCache=null,tl(u)))}function cf(a){return lf(),vp(),y0(),Ep()}function Ep(){if(Hn!==5)return!1;var a=ws,u=af;af=0;var d=at(gl),_=Je.T,w=St.p;try{St.p=32>d?32:d,Je.T=null,d=Ha,Ha=null;var D=ws,q=gl;if(Hn=0,ac=ws=null,gl=0,(ta&6)!==0)throw Error(x(331));var W=ta;if(ta|=4,_p(D.current),c0(D,D.current,q,d),ta=W,oc(0,!1),an&&typeof an.onPostCommitFiberRoot=="function")try{an.onPostCommitFiberRoot(is,D)}catch{}return!0}finally{St.p=w,Je.T=_,Tp(a,u)}}function wp(a,u,d){u=Bn(d,u),u=Qf(a.stateNode,u,2),a=Zr(a,u,2),a!==null&&(Ne(a,2),As(a))}function pa(a,u,d){if(a.tag===3)wp(a,a,d);else for(;u!==null;){if(u.tag===3){wp(u,a,d);break}else if(u.tag===1){var _=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(ml===null||!ml.has(_))){a=Bn(d,a),d=$c(2),_=Zr(u,d,2),_!==null&&(Zh(d,_,u,a),Ne(_,2),As(_));break}}u=u.return}}function hf(a,u,d){var _=a.pingCache;if(_===null){_=a.pingCache=new xm;var w=new Set;_.set(u,w)}else w=_.get(u),w===void 0&&(w=new Set,_.set(u,w));w.has(d)||(d0=!0,w.add(d),a=Ap.bind(null,a,u,d),u.then(a,a))}function Ap(a,u,d){var _=a.pingCache;_!==null&&_.delete(u),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,Qi===a&&(Oi&d)===d&&(Oa===4||Oa===3&&(Oi&62914560)===Oi&&300>ka()-p0?(ta&2)===0&&nc(a,0):ef|=d,Tu===Oi&&(Tu=0)),As(a)}function uh(a,u){u===0&&(u=Te()),a=ru(a,u),a!==null&&(Ne(a,u),As(a))}function No(a){var u=a.memoizedState,d=0;u!==null&&(d=u.retryLane),uh(a,d)}function yl(a,u){var d=0;switch(a.tag){case 13:var _=a.stateNode,w=a.memoizedState;w!==null&&(d=w.retryLane);break;case 19:_=a.stateNode;break;case 22:_=a.stateNode._retryCache;break;default:throw Error(x(314))}_!==null&&_.delete(u),uh(a,d)}function Sp(a,u){return hn(a,u)}var lh=null,ch=null,b0=!1,rc=!1,nd=!1,sc=0;function As(a){a!==ch&&a.next===null&&(ch===null?lh=ch=a:ch=ch.next=a),rc=!0,b0||(b0=!0,ff())}function oc(a,u){if(!nd&&rc){nd=!0;do for(var d=!1,_=lh;_!==null;){if(a!==0){var w=_.pendingLanes;if(w===0)var D=0;else{var q=_.suspendedLanes,W=_.pingedLanes;D=(1<<31-Ba(42|a)+1)-1,D&=w&~(q&~W),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(d=!0,T0(_,D))}else D=Oi,D=X(_,_===Qi?D:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(D&3)===0||K(_,D)||(d=!0,T0(_,D));_=_.next}while(d);nd=!1}}function hh(){x0()}function x0(){rc=b0=!1;var a=0;sc!==0&&(Sm()&&(a=sc),sc=0);for(var u=ka(),d=null,_=lh;_!==null;){var w=_.next,D=v0(_,u);D===0?(_.next=null,d===null?lh=w:d.next=w,w===null&&(ch=d)):(d=_,(a!==0||(D&3)!==0)&&(rc=!0)),_=w}oc(a)}function v0(a,u){for(var d=a.suspendedLanes,_=a.pingedLanes,w=a.expirationTimes,D=a.pendingLanes&-62914561;0<D;){var q=31-Ba(D),W=1<<q,_e=w[q];_e===-1?((W&d)===0||(W&_)!==0)&&(w[q]=ie(W,u)):_e<=u&&(a.expiredLanes|=W),D&=~W}if(u=Qi,d=Oi,d=X(a,a===u?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),_=a.callbackNode,d===0||a===u&&(ia===2||ia===9)||a.cancelPendingCommit!==null)return _!==null&&_!==null&&Hi(_),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||K(a,d)){if(u=d&-d,u===a.callbackPriority)return u;switch(_!==null&&Hi(_),at(d)){case 2:case 8:d=Zn;break;case 32:d=sr;break;case 268435456:d=oo;break;default:d=sr}return _=df.bind(null,a),d=hn(d,_),a.callbackPriority=u,a.callbackNode=d,u}return _!==null&&_!==null&&Hi(_),a.callbackPriority=2,a.callbackNode=null,2}function df(a,u){if(Hn!==0&&Hn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(cf()&&a.callbackNode!==d)return null;var _=Oi;return _=X(a,a===Qi?_:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),_===0?null:(bp(a,_,u),v0(a,ka()),a.callbackNode!=null&&a.callbackNode===d?df.bind(null,a):null)}function T0(a,u){if(cf())return null;bp(a,u,!0)}function ff(){Op(function(){(ta&6)!==0?hn(Ru,hh):x0()})}function pf(){return sc===0&&(sc=de()),sc}function Cp(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:mo(""+a)}function Mp(a,u){var d=u.ownerDocument.createElement("input");return d.name=u.name,d.value=u.value,a.id&&d.setAttribute("form",a.id),u.parentNode.insertBefore(d,u),a=new FormData(a),d.parentNode.removeChild(d),a}function Ip(a,u,d,_,w){if(u==="submit"&&d&&d.stateNode===w){var D=Cp((w[Ot]||null).action),q=_.submitter;q&&(u=(u=q[Ot]||null)?Cp(u.formAction):q.getAttribute("formAction"),u!==null&&(D=u,q=null));var W=new Fu("action","action",null,_,w);a.push({event:W,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(sc!==0){var _e=q?Mp(w,q):new FormData(w);bs(d,{pending:!0,data:_e,method:w.method,action:D},null,_e)}}else typeof D=="function"&&(W.preventDefault(),_e=q?Mp(w,q):new FormData(w),bs(d,{pending:!0,data:_e,method:w.method,action:D},D,_e))},currentTarget:w}]})}}for(var E0=0;E0<Nc.length;E0++){var w0=Nc[E0],wm=w0.toLowerCase(),Am=w0[0].toUpperCase()+w0.slice(1);dr(wm,"on"+Am)}dr(Bl,"onAnimationEnd"),dr(zl,"onAnimationIteration"),dr(Lc,"onAnimationStart"),dr("dblclick","onDoubleClick"),dr("focusin","onFocus"),dr("focusout","onBlur"),dr(au,"onTransitionRun"),dr(Oc,"onTransitionStart"),dr(Xu,"onTransitionCancel"),dr(hr,"onTransitionEnd"),as("onMouseEnter",["mouseout","mouseover"]),as("onMouseLeave",["mouseout","mouseover"]),as("onPointerEnter",["pointerout","pointerover"]),as("onPointerLeave",["pointerout","pointerover"]),ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ur("onBeforeInput",["compositionend","keypress","textInput","paste"]),ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(rd));function Au(a,u){u=(u&4)!==0;for(var d=0;d<a.length;d++){var _=a[d],w=_.event;_=_.listeners;e:{var D=void 0;if(u)for(var q=_.length-1;0<=q;q--){var W=_[q],_e=W.instance,Ue=W.currentTarget;if(W=W.listener,_e!==D&&w.isPropagationStopped())break e;D=W,w.currentTarget=Ue;try{D(w)}catch(nt){Yc(nt)}w.currentTarget=null,D=_e}else for(q=0;q<_.length;q++){if(W=_[q],_e=W.instance,Ue=W.currentTarget,W=W.listener,_e!==D&&w.isPropagationStopped())break e;D=W,w.currentTarget=Ue;try{D(w)}catch(nt){Yc(nt)}w.currentTarget=null,D=_e}}}}function Ai(a,u){var d=u[Ci];d===void 0&&(d=u[Ci]=new Set);var _=a+"__bubble";d.has(_)||(S0(u,a,2,!1),d.add(_))}function mf(a,u,d){var _=0;u&&(_|=4),S0(d,a,_,u)}var sd="_reactListening"+Math.random().toString(36).slice(2);function gf(a){if(!a[sd]){a[sd]=!0,Fo.forEach(function(d){d!=="selectionchange"&&(A0.has(d)||mf(d,!1,a),mf(d,!0,a))});var u=a.nodeType===9?a:a.ownerDocument;u===null||u[sd]||(u[sd]=!0,mf("selectionchange",!1,u))}}function S0(a,u,d,_){switch(Pt(u)){case 2:var w=ut;break;case 8:w=ft;break;default:w=We}d=w.bind(null,u,d,a),w=void 0,!kn||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(w=!0),_?w!==void 0?a.addEventListener(u,d,{capture:!0,passive:w}):a.addEventListener(u,d,!0):w!==void 0?a.addEventListener(u,d,{passive:w}):a.addEventListener(u,d,!1)}function od(a,u,d,_,w){var D=_;if((u&1)===0&&(u&2)===0&&_!==null)e:for(;;){if(_===null)return;var q=_.tag;if(q===3||q===4){var W=_.stateNode.containerInfo;if(W===w)break;if(q===4)for(q=_.return;q!==null;){var _e=q.tag;if((_e===3||_e===4)&&q.stateNode.containerInfo===w)return;q=q.return}for(;W!==null;){if(q=Xt(W),q===null)return;if(_e=q.tag,_e===5||_e===6||_e===26||_e===27){_=D=q;continue e}W=W.parentNode}}_=_.return}Ji(function(){var Ue=D,nt=go(d),ot=[];e:{var Ze=Bh.get(a);if(Ze!==void 0){var Xe=Fu,ni=a;switch(a){case"keypress":if(Qt(d)===0)break e;case"keydown":case"keyup":Xe=eu;break;case"focusin":ni="focus",Xe=Ko;break;case"focusout":ni="blur",Xe=Ko;break;case"beforeblur":case"afterblur":Xe=Ko;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=Uu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=Hf;break;case Bl:case zl:case Lc:Xe=sn;break;case hr:Xe=qf;break;case"scroll":case"scrollend":Xe=Rl;break;case"wheel":Xe=Hu;break;case"copy":case"cut":case"paste":Xe=Tc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=Ad;break;case"toggle":case"beforetoggle":Xe=Sc}var Jt=(u&4)!==0,ua=!Jt&&(a==="scroll"||a==="scrollend"),Pe=Jt?Ze!==null?Ze+"Capture":null:Ze;Jt=[];for(var Ce=Ue,ze;Ce!==null;){var lt=Ce;if(ze=lt.stateNode,lt=lt.tag,lt!==5&&lt!==26&&lt!==27||ze===null||Pe===null||(lt=ns(Ce,Pe),lt!=null&&Jt.push(dh(Ce,lt,ze))),ua)break;Ce=Ce.return}0<Jt.length&&(Ze=new Xe(Ze,ni,null,d,nt),ot.push({event:Ze,listeners:Jt}))}}if((u&7)===0){e:{if(Ze=a==="mouseover"||a==="pointerover",Xe=a==="mouseout"||a==="pointerout",Ze&&d!==Vo&&(ni=d.relatedTarget||d.fromElement)&&(Xt(ni)||ni[Ye]))break e;if((Xe||Ze)&&(Ze=nt.window===nt?nt:(Ze=nt.ownerDocument)?Ze.defaultView||Ze.parentWindow:window,Xe?(ni=d.relatedTarget||d.toElement,Xe=Ue,ni=ni?Xt(ni):null,ni!==null&&(ua=R(ni),Jt=ni.tag,ni!==ua||Jt!==5&&Jt!==27&&Jt!==6)&&(ni=null)):(Xe=null,ni=Ue),Xe!==ni)){if(Jt=Uu,lt="onMouseLeave",Pe="onMouseEnter",Ce="mouse",(a==="pointerout"||a==="pointerover")&&(Jt=Ad,lt="onPointerLeave",Pe="onPointerEnter",Ce="pointer"),ua=Xe==null?Ze:Wi(Xe),ze=ni==null?Ze:Wi(ni),Ze=new Jt(lt,Ce+"leave",Xe,d,nt),Ze.target=ua,Ze.relatedTarget=ze,lt=null,Xt(nt)===Ue&&(Jt=new Jt(Pe,Ce+"enter",ni,d,nt),Jt.target=ze,Jt.relatedTarget=ua,lt=Jt),ua=lt,Xe&&ni)t:{for(Jt=Xe,Pe=ni,Ce=0,ze=Jt;ze;ze=uc(ze))Ce++;for(ze=0,lt=Pe;lt;lt=uc(lt))ze++;for(;0<Ce-ze;)Jt=uc(Jt),Ce--;for(;0<ze-Ce;)Pe=uc(Pe),ze--;for(;Ce--;){if(Jt===Pe||Pe!==null&&Jt===Pe.alternate)break t;Jt=uc(Jt),Pe=uc(Pe)}Jt=null}else Jt=null;Xe!==null&&_f(ot,Ze,Xe,Jt,!1),ni!==null&&ua!==null&&_f(ot,ua,ni,Jt,!0)}}e:{if(Ze=Ue?Wi(Ue):window,Xe=Ze.nodeName&&Ze.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&Ze.type==="file")var zt=Ls;else if(Mh(Ze))if(Ih)zt=Pd;else{zt=Rh;var ri=Gf}else Xe=Ze.nodeName,!Xe||Xe.toLowerCase()!=="input"||Ze.type!=="checkbox"&&Ze.type!=="radio"?Ue&&fn(Ue.elementType)&&(zt=Ls):zt=Rd;if(zt&&(zt=zt(a,Ue))){Gu(ot,zt,d,nt);break e}ri&&ri(a,Ze,Ue),a==="focusout"&&Ue&&Ze.type==="number"&&Ue.memoizedProps.value!=null&&Dl(Ze,"number",Ze.value)}switch(ri=Ue?Wi(Ue):window,a){case"focusin":(Mh(ri)||ri.contentEditable==="true")&&(Dr=ri,Nl=Ue,kl=null);break;case"focusout":kl=Nl=Dr=null;break;case"mousedown":Oh=!0;break;case"contextmenu":case"mouseup":case"dragend":Oh=!1,Ld(ot,d,nt);break;case"selectionchange":if(Lh)break;case"keydown":case"keyup":Ld(ot,d,nt)}var Gt;if(Mr)e:{switch(a){case"compositionstart":var ei="onCompositionStart";break e;case"compositionend":ei="onCompositionEnd";break e;case"compositionupdate":ei="onCompositionUpdate";break e}ei=void 0}else Ir?Ll(a,d)&&(ei="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(ei="onCompositionStart");ei&&(qu&&d.locale!=="ko"&&(Ir||ei!=="onCompositionStart"?ei==="onCompositionEnd"&&Ir&&(Gt=mi()):(Sr=nt,Ni="value"in Sr?Sr.value:Sr.textContent,Ir=!0)),ri=bl(Ue,ei),0<ri.length&&(ei=new wd(ei,a,null,d,nt),ot.push({event:ei,listeners:ri}),Gt?ei.data=Gt:(Gt=Ch(d),Gt!==null&&(ei.data=Gt)))),(Gt=Sh?Cd(a,d):Md(a,d))&&(ei=bl(Ue,"onBeforeInput"),0<ei.length&&(ri=new wd("onBeforeInput","beforeinput",null,d,nt),ot.push({event:ri,listeners:ei}),ri.data=Gt)),Ip(ot,a,Ue,d,nt)}Au(ot,u)})}function dh(a,u,d){return{instance:a,listener:u,currentTarget:d}}function bl(a,u){for(var d=u+"Capture",_=[];a!==null;){var w=a,D=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||D===null||(w=ns(a,d),w!=null&&_.unshift(dh(a,w,D)),w=ns(a,u),w!=null&&_.push(dh(a,w,D))),a.tag===3)return _;a=a.return}return[]}function uc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function _f(a,u,d,_,w){for(var D=u._reactName,q=[];d!==null&&d!==_;){var W=d,_e=W.alternate,Ue=W.stateNode;if(W=W.tag,_e!==null&&_e===_)break;W!==5&&W!==26&&W!==27||Ue===null||(_e=Ue,w?(Ue=ns(d,D),Ue!=null&&q.unshift(dh(d,Ue,_e))):w||(Ue=ns(d,D),Ue!=null&&q.push(dh(d,Ue,_e)))),d=d.return}q.length!==0&&a.push({event:u,listeners:q})}var Dp=/\r\n?/g,Wr=/\u0000|\uFFFD/g;function lc(a){return(typeof a=="string"?a:""+a).replace(Dp,`
`).replace(Wr,"")}function C0(a,u){return u=lc(u),lc(a)===u}function ud(){}function aa(a,u,d,_,w,D){switch(d){case"children":typeof _=="string"?u==="body"||u==="textarea"&&_===""||po(a,_):(typeof _=="number"||typeof _=="bigint")&&u!=="body"&&po(a,""+_);break;case"className":co(a,"class",_);break;case"tabIndex":co(a,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":co(a,d,_);break;case"style":jo(a,_,D);break;case"data":if(u!=="object"){co(a,"data",_);break}case"src":case"href":if(_===""&&(u!=="a"||d!=="href")){a.removeAttribute(d);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){a.removeAttribute(d);break}_=mo(""+_),a.setAttribute(d,_);break;case"action":case"formAction":if(typeof _=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(d==="formAction"?(u!=="input"&&aa(a,u,"name",w.name,w,null),aa(a,u,"formEncType",w.formEncType,w,null),aa(a,u,"formMethod",w.formMethod,w,null),aa(a,u,"formTarget",w.formTarget,w,null)):(aa(a,u,"encType",w.encType,w,null),aa(a,u,"method",w.method,w,null),aa(a,u,"target",w.target,w,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){a.removeAttribute(d);break}_=mo(""+_),a.setAttribute(d,_);break;case"onClick":_!=null&&(a.onclick=ud);break;case"onScroll":_!=null&&Ai("scroll",a);break;case"onScrollEnd":_!=null&&Ai("scrollend",a);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(x(61));if(d=_.__html,d!=null){if(w.children!=null)throw Error(x(60));a.innerHTML=d}}break;case"multiple":a.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":a.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){a.removeAttribute("xlink:href");break}d=mo(""+_),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?a.setAttribute(d,""+_):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":_===!0?a.setAttribute(d,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?a.setAttribute(d,_):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?a.setAttribute(d,_):a.removeAttribute(d);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?a.removeAttribute(d):a.setAttribute(d,_);break;case"popover":Ai("beforetoggle",a),Ai("toggle",a),Yi(a,"popover",_);break;case"xlinkActuate":Yn(a,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Yn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Yn(a,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Yn(a,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Yn(a,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Yn(a,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Yn(a,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Yn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Yn(a,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Yi(a,"is",_);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=qo.get(d)||d,Yi(a,d,_))}}function yf(a,u,d,_,w,D){switch(d){case"style":jo(a,_,D);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(x(61));if(d=_.__html,d!=null){if(w.children!=null)throw Error(x(60));a.innerHTML=d}}break;case"children":typeof _=="string"?po(a,_):(typeof _=="number"||typeof _=="bigint")&&po(a,""+_);break;case"onScroll":_!=null&&Ai("scroll",a);break;case"onScrollEnd":_!=null&&Ai("scrollend",a);break;case"onClick":_!=null&&(a.onclick=ud);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ou.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(w=d.endsWith("Capture"),u=d.slice(2,w?d.length-7:void 0),D=a[Ot]||null,D=D!=null?D[d]:null,typeof D=="function"&&a.removeEventListener(u,D,w),typeof _=="function")){typeof D!="function"&&D!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(u,_,w);break e}d in a?a[d]=_:_===!0?a.setAttribute(d,""):Yi(a,d,_)}}}function Pn(a,u,d){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ai("error",a),Ai("load",a);var _=!1,w=!1,D;for(D in d)if(d.hasOwnProperty(D)){var q=d[D];if(q!=null)switch(D){case"src":_=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(x(137,u));default:aa(a,u,D,q,d,null)}}w&&aa(a,u,"srcSet",d.srcSet,d,null),_&&aa(a,u,"src",d.src,d,null);return;case"input":Ai("invalid",a);var W=D=q=w=null,_e=null,Ue=null;for(_ in d)if(d.hasOwnProperty(_)){var nt=d[_];if(nt!=null)switch(_){case"name":w=nt;break;case"type":q=nt;break;case"checked":_e=nt;break;case"defaultChecked":Ue=nt;break;case"value":D=nt;break;case"defaultValue":W=nt;break;case"children":case"dangerouslySetInnerHTML":if(nt!=null)throw Error(x(137,u));break;default:aa(a,u,_,nt,d,null)}}fo(a,D,W,_e,Ue,q,w,!1),bc(a);return;case"select":Ai("invalid",a),_=q=D=null;for(w in d)if(d.hasOwnProperty(w)&&(W=d[w],W!=null))switch(w){case"value":D=W;break;case"defaultValue":q=W;break;case"multiple":_=W;default:aa(a,u,w,W,d,null)}u=D,d=q,a.multiple=!!_,u!=null?ku(a,!!_,u,!1):d!=null&&ku(a,!!_,d,!0);return;case"textarea":Ai("invalid",a),D=w=_=null;for(q in d)if(d.hasOwnProperty(q)&&(W=d[q],W!=null))switch(q){case"value":_=W;break;case"defaultValue":w=W;break;case"children":D=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(x(91));break;default:aa(a,u,q,W,d,null)}zu(a,_,w,D),bc(a);return;case"option":for(_e in d)if(d.hasOwnProperty(_e)&&(_=d[_e],_!=null))switch(_e){case"selected":a.selected=_&&typeof _!="function"&&typeof _!="symbol";break;default:aa(a,u,_e,_,d,null)}return;case"dialog":Ai("beforetoggle",a),Ai("toggle",a),Ai("cancel",a),Ai("close",a);break;case"iframe":case"object":Ai("load",a);break;case"video":case"audio":for(_=0;_<rd.length;_++)Ai(rd[_],a);break;case"image":Ai("error",a),Ai("load",a);break;case"details":Ai("toggle",a);break;case"embed":case"source":case"link":Ai("error",a),Ai("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ue in d)if(d.hasOwnProperty(Ue)&&(_=d[Ue],_!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":throw Error(x(137,u));default:aa(a,u,Ue,_,d,null)}return;default:if(fn(u)){for(nt in d)d.hasOwnProperty(nt)&&(_=d[nt],_!==void 0&&yf(a,u,nt,_,d,void 0));return}}for(W in d)d.hasOwnProperty(W)&&(_=d[W],_!=null&&aa(a,u,W,_,d,null))}function Rp(a,u,d,_){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,D=null,q=null,W=null,_e=null,Ue=null,nt=null;for(Xe in d){var ot=d[Xe];if(d.hasOwnProperty(Xe)&&ot!=null)switch(Xe){case"checked":break;case"value":break;case"defaultValue":_e=ot;default:_.hasOwnProperty(Xe)||aa(a,u,Xe,null,_,ot)}}for(var Ze in _){var Xe=_[Ze];if(ot=d[Ze],_.hasOwnProperty(Ze)&&(Xe!=null||ot!=null))switch(Ze){case"type":D=Xe;break;case"name":w=Xe;break;case"checked":Ue=Xe;break;case"defaultChecked":nt=Xe;break;case"value":q=Xe;break;case"defaultValue":W=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(x(137,u));break;default:Xe!==ot&&aa(a,u,Ze,Xe,_,ot)}}xc(a,q,W,_e,Ue,nt,D,w);return;case"select":Xe=q=W=Ze=null;for(D in d)if(_e=d[D],d.hasOwnProperty(D)&&_e!=null)switch(D){case"value":break;case"multiple":Xe=_e;default:_.hasOwnProperty(D)||aa(a,u,D,null,_,_e)}for(w in _)if(D=_[w],_e=d[w],_.hasOwnProperty(w)&&(D!=null||_e!=null))switch(w){case"value":Ze=D;break;case"defaultValue":W=D;break;case"multiple":q=D;default:D!==_e&&aa(a,u,w,D,_,_e)}u=W,d=q,_=Xe,Ze!=null?ku(a,!!d,Ze,!1):!!_!=!!d&&(u!=null?ku(a,!!d,u,!0):ku(a,!!d,d?[]:"",!1));return;case"textarea":Xe=Ze=null;for(W in d)if(w=d[W],d.hasOwnProperty(W)&&w!=null&&!_.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:aa(a,u,W,null,_,w)}for(q in _)if(w=_[q],D=d[q],_.hasOwnProperty(q)&&(w!=null||D!=null))switch(q){case"value":Ze=w;break;case"defaultValue":Xe=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(x(91));break;default:w!==D&&aa(a,u,q,w,_,D)}Bu(a,Ze,Xe);return;case"option":for(var ni in d)if(Ze=d[ni],d.hasOwnProperty(ni)&&Ze!=null&&!_.hasOwnProperty(ni))switch(ni){case"selected":a.selected=!1;break;default:aa(a,u,ni,null,_,Ze)}for(_e in _)if(Ze=_[_e],Xe=d[_e],_.hasOwnProperty(_e)&&Ze!==Xe&&(Ze!=null||Xe!=null))switch(_e){case"selected":a.selected=Ze&&typeof Ze!="function"&&typeof Ze!="symbol";break;default:aa(a,u,_e,Ze,_,Xe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Jt in d)Ze=d[Jt],d.hasOwnProperty(Jt)&&Ze!=null&&!_.hasOwnProperty(Jt)&&aa(a,u,Jt,null,_,Ze);for(Ue in _)if(Ze=_[Ue],Xe=d[Ue],_.hasOwnProperty(Ue)&&Ze!==Xe&&(Ze!=null||Xe!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(x(137,u));break;default:aa(a,u,Ue,Ze,_,Xe)}return;default:if(fn(u)){for(var ua in d)Ze=d[ua],d.hasOwnProperty(ua)&&Ze!==void 0&&!_.hasOwnProperty(ua)&&yf(a,u,ua,void 0,_,Ze);for(nt in _)Ze=_[nt],Xe=d[nt],!_.hasOwnProperty(nt)||Ze===Xe||Ze===void 0&&Xe===void 0||yf(a,u,nt,Ze,_,Xe);return}}for(var Pe in d)Ze=d[Pe],d.hasOwnProperty(Pe)&&Ze!=null&&!_.hasOwnProperty(Pe)&&aa(a,u,Pe,null,_,Ze);for(ot in _)Ze=_[ot],Xe=d[ot],!_.hasOwnProperty(ot)||Ze===Xe||Ze==null&&Xe==null||aa(a,u,ot,Ze,_,Xe)}var M0=null,bf=null;function io(a){return a.nodeType===9?a:a.ownerDocument}function I0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function D0(a,u){if(a===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&u==="foreignObject"?0:a}function xf(a,u){return a==="textarea"||a==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var vf=null;function Sm(){var a=window.event;return a&&a.type==="popstate"?a===vf?!1:(vf=a,!0):(vf=null,!1)}var Pp=typeof setTimeout=="function"?setTimeout:void 0,Lp=typeof clearTimeout=="function"?clearTimeout:void 0,fh=typeof Promise=="function"?Promise:void 0,Op=typeof queueMicrotask=="function"?queueMicrotask:typeof fh<"u"?function(a){return fh.resolve(null).then(a).catch(Tf)}:Pp;function Tf(a){setTimeout(function(){throw a})}function Su(a){return a==="head"}function ld(a,u){var d=u,_=0,w=0;do{var D=d.nextSibling;if(a.removeChild(d),D&&D.nodeType===8)if(d=D.data,d==="/$"){if(0<_&&8>_){d=_;var q=a.ownerDocument;if(d&1&&mh(q.documentElement),d&2&&mh(q.body),d&4)for(d=q.head,mh(d),q=d.firstChild;q;){var W=q.nextSibling,_e=q.nodeName;q[it]||_e==="SCRIPT"||_e==="STYLE"||_e==="LINK"&&q.rel.toLowerCase()==="stylesheet"||d.removeChild(q),q=W}}if(w===0){a.removeChild(D),ya(u);return}w--}else d==="$"||d==="$?"||d==="$!"?w++:_=d.charCodeAt(0)-48;else _=0;d=D}while(d);ya(u)}function ph(a){var u=a.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var d=u;switch(u=u.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":ph(d),qt(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function Ef(a,u,d,_){for(;a.nodeType===1;){var w=d;if(a.nodeName.toLowerCase()!==u.toLowerCase()){if(!_&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(_){if(!a[it])switch(u){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(D=a.getAttribute("rel"),D==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(D!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(D=a.getAttribute("src"),(D!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&D&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(u==="input"&&a.type==="hidden"){var D=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===D)return a}else return a;if(a=er(a.nextSibling),a===null)break}return null}function Cm(a,u,d){if(u==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=er(a.nextSibling),a===null))return null;return a}function R0(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function Mm(a,u){var d=a.ownerDocument;if(a.data!=="$?"||d.readyState==="complete")u();else{var _=function(){u(),d.removeEventListener("DOMContentLoaded",_)};d.addEventListener("DOMContentLoaded",_),a._reactRetry=_}}function er(a){for(;a!=null;a=a.nextSibling){var u=a.nodeType;if(u===1||u===3)break;if(u===8){if(u=a.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return a}var cn=null;function Cu(a){a=a.previousSibling;for(var u=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"){if(u===0)return a;u--}else d==="/$"&&u++}a=a.previousSibling}return null}function wf(a,u,d){switch(u=io(d),a){case"html":if(a=u.documentElement,!a)throw Error(x(452));return a;case"head":if(a=u.head,!a)throw Error(x(453));return a;case"body":if(a=u.body,!a)throw Error(x(454));return a;default:throw Error(x(451))}}function mh(a){for(var u=a.attributes;u.length;)a.removeAttributeNode(u[0]);qt(a)}var Jr=new Map,Af=new Set;function Sf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ko=St.d;St.d={f:Np,r:Im,D:P0,C:kp,L:cd,m:L0,X:O0,S:Bp,M:Mf};function Np(){var a=ko.f(),u=Rn();return a||u}function Im(a){var u=Zi(a);u!==null&&u.tag===5&&u.type==="form"?Zs(u):ko.r(a)}var cc=typeof document>"u"?null:document;function Cf(a,u,d){var _=cc;if(_&&typeof u=="string"&&u){var w=Xn(u);w='link[rel="'+a+'"][href="'+w+'"]',typeof d=="string"&&(w+='[crossorigin="'+d+'"]'),Af.has(w)||(Af.add(w),a={rel:a,crossOrigin:d,href:u},_.querySelector(w)===null&&(u=_.createElement("link"),Pn(u,"link",a),Ut(u),_.head.appendChild(u)))}}function P0(a){ko.D(a),Cf("dns-prefetch",a,null)}function kp(a,u){ko.C(a,u),Cf("preconnect",a,u)}function cd(a,u,d){ko.L(a,u,d);var _=cc;if(_&&a&&u){var w='link[rel="preload"][as="'+Xn(u)+'"]';u==="image"&&d&&d.imageSrcSet?(w+='[imagesrcset="'+Xn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(w+='[imagesizes="'+Xn(d.imageSizes)+'"]')):w+='[href="'+Xn(a)+'"]';var D=w;switch(u){case"style":D=xl(a);break;case"script":D=o(a)}Jr.has(D)||(a=ge({rel:"preload",href:u==="image"&&d&&d.imageSrcSet?void 0:a,as:u},d),Jr.set(D,a),_.querySelector(w)!==null||u==="style"&&_.querySelector(hc(D))||u==="script"&&_.querySelector(t(D))||(u=_.createElement("link"),Pn(u,"link",a),Ut(u),_.head.appendChild(u)))}}function L0(a,u){ko.m(a,u);var d=cc;if(d&&a){var _=u&&typeof u.as=="string"?u.as:"script",w='link[rel="modulepreload"][as="'+Xn(_)+'"][href="'+Xn(a)+'"]',D=w;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=o(a)}if(!Jr.has(D)&&(a=ge({rel:"modulepreload",href:a},u),Jr.set(D,a),d.querySelector(w)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(t(D)))return}_=d.createElement("link"),Pn(_,"link",a),Ut(_),d.head.appendChild(_)}}}function Bp(a,u,d){ko.S(a,u,d);var _=cc;if(_&&a){var w=$a(_).hoistableStyles,D=xl(a);u=u||"default";var q=w.get(D);if(!q){var W={loading:0,preload:null};if(q=_.querySelector(hc(D)))W.loading=5;else{a=ge({rel:"stylesheet",href:a,"data-precedence":u},d),(d=Jr.get(D))&&m(a,d);var _e=q=_.createElement("link");Ut(_e),Pn(_e,"link",a),_e._p=new Promise(function(Ue,nt){_e.onload=Ue,_e.onerror=nt}),_e.addEventListener("load",function(){W.loading|=1}),_e.addEventListener("error",function(){W.loading|=2}),W.loading|=4,l(q,u,_)}q={type:"stylesheet",instance:q,count:1,state:W},w.set(D,q)}}}function O0(a,u){ko.X(a,u);var d=cc;if(d&&a){var _=$a(d).hoistableScripts,w=o(a),D=_.get(w);D||(D=d.querySelector(t(w)),D||(a=ge({src:a,async:!0},u),(u=Jr.get(w))&&b(a,u),D=d.createElement("script"),Ut(D),Pn(D,"link",a),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(w,D))}}function Mf(a,u){ko.M(a,u);var d=cc;if(d&&a){var _=$a(d).hoistableScripts,w=o(a),D=_.get(w);D||(D=d.querySelector(t(w)),D||(a=ge({src:a,async:!0,type:"module"},u),(u=Jr.get(w))&&b(a,u),D=d.createElement("script"),Ut(D),Pn(D,"link",a),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(w,D))}}function gh(a,u,d,_){var w=(w=Zt.current)?Sf(w):null;if(!w)throw Error(x(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(u=xl(d.href),d=$a(w).hoistableStyles,_=d.get(u),_||(_={type:"style",instance:null,count:0,state:null},d.set(u,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=xl(d.href);var D=$a(w).hoistableStyles,q=D.get(a);if(q||(w=w.ownerDocument||w,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(a,q),(D=w.querySelector(hc(a)))&&!D._p&&(q.instance=D,q.state.loading=5),Jr.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Jr.set(a,d),D||Dm(w,a,d,q.state))),u&&_===null)throw Error(x(528,""));return q}if(u&&_!==null)throw Error(x(529,""));return null;case"script":return u=d.async,d=d.src,typeof d=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=o(d),d=$a(w).hoistableScripts,_=d.get(u),_||(_={type:"script",instance:null,count:0,state:null},d.set(u,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(x(444,a))}}function xl(a){return'href="'+Xn(a)+'"'}function hc(a){return'link[rel="stylesheet"]['+a+"]"}function If(a){return ge({},a,{"data-precedence":a.precedence,precedence:null})}function Dm(a,u,d,_){a.querySelector('link[rel="preload"][as="style"]['+u+"]")?_.loading=1:(u=a.createElement("link"),_.preload=u,u.addEventListener("load",function(){return _.loading|=1}),u.addEventListener("error",function(){return _.loading|=2}),Pn(u,"link",d),Ut(u),a.head.appendChild(u))}function o(a){return'[src="'+Xn(a)+'"]'}function t(a){return"script[async]"+a}function s(a,u,d){if(u.count++,u.instance===null)switch(u.type){case"style":var _=a.querySelector('style[data-href~="'+Xn(d.href)+'"]');if(_)return u.instance=_,Ut(_),_;var w=ge({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return _=(a.ownerDocument||a).createElement("style"),Ut(_),Pn(_,"style",w),l(_,d.precedence,a),u.instance=_;case"stylesheet":w=xl(d.href);var D=a.querySelector(hc(w));if(D)return u.state.loading|=4,u.instance=D,Ut(D),D;_=If(d),(w=Jr.get(w))&&m(_,w),D=(a.ownerDocument||a).createElement("link"),Ut(D);var q=D;return q._p=new Promise(function(W,_e){q.onload=W,q.onerror=_e}),Pn(D,"link",_),u.state.loading|=4,l(D,d.precedence,a),u.instance=D;case"script":return D=o(d.src),(w=a.querySelector(t(D)))?(u.instance=w,Ut(w),w):(_=d,(w=Jr.get(D))&&(_=ge({},d),b(_,w)),a=a.ownerDocument||a,w=a.createElement("script"),Ut(w),Pn(w,"link",_),a.head.appendChild(w),u.instance=w);case"void":return null;default:throw Error(x(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(_=u.instance,u.state.loading|=4,l(_,d.precedence,a));return u.instance}function l(a,u,d){for(var _=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=_.length?_[_.length-1]:null,D=w,q=0;q<_.length;q++){var W=_[q];if(W.dataset.precedence===u)D=W;else if(D!==w)break}D?D.parentNode.insertBefore(a,D.nextSibling):(u=d.nodeType===9?d.head:d,u.insertBefore(a,u.firstChild))}function m(a,u){a.crossOrigin==null&&(a.crossOrigin=u.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=u.referrerPolicy),a.title==null&&(a.title=u.title)}function b(a,u){a.crossOrigin==null&&(a.crossOrigin=u.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=u.referrerPolicy),a.integrity==null&&(a.integrity=u.integrity)}var v=null;function E(a,u,d){if(v===null){var _=new Map,w=v=new Map;w.set(d,_)}else w=v,_=w.get(d),_||(_=new Map,w.set(d,_));if(_.has(a))return _;for(_.set(a,null),d=d.getElementsByTagName(a),w=0;w<d.length;w++){var D=d[w];if(!(D[it]||D[Ft]||a==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var q=D.getAttribute(u)||"";q=a+q;var W=_.get(q);W?W.push(D):_.set(q,[D])}}return _}function M(a,u,d){a=a.ownerDocument||a,a.head.insertBefore(d,u==="title"?a.querySelector("head > title"):null)}function P(a,u,d){if(d===1||u.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return a=u.disabled,typeof u.precedence=="string"&&a==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function N(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var B=null;function U(){}function j(a,u,d){if(B===null)throw Error(x(475));var _=B;if(u.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var w=xl(d.href),D=a.querySelector(hc(w));if(D){a=D._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(_.count++,_=$.bind(_),a.then(_,_)),u.state.loading|=4,u.instance=D,Ut(D);return}D=a.ownerDocument||a,d=If(d),(w=Jr.get(w))&&m(d,w),D=D.createElement("link"),Ut(D);var q=D;q._p=new Promise(function(W,_e){q.onload=W,q.onerror=_e}),Pn(D,"link",d),u.instance=D}_.stylesheets===null&&(_.stylesheets=new Map),_.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(_.count++,u=$.bind(_),a.addEventListener("load",u),a.addEventListener("error",u))}}function V(){if(B===null)throw Error(x(475));var a=B;return a.stylesheets&&a.count===0&&oe(a,a.stylesheets),0<a.count?function(u){var d=setTimeout(function(){if(a.stylesheets&&oe(a,a.stylesheets),a.unsuspend){var _=a.unsuspend;a.unsuspend=null,_()}},6e4);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(d)}}:null}function $(){if(this.count--,this.count===0){if(this.stylesheets)oe(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var ee=null;function oe(a,u){a.stylesheets=null,a.unsuspend!==null&&(a.count++,ee=new Map,u.forEach(ve,a),ee=null,$.call(a))}function ve(a,u){if(!(u.state.loading&4)){var d=ee.get(a);if(d)var _=d.get(null);else{d=new Map,ee.set(a,d);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<w.length;D++){var q=w[D];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(d.set(q.dataset.precedence,q),_=q)}_&&d.set(null,_)}w=u.instance,q=w.getAttribute("data-precedence"),D=d.get(q)||_,D===_&&d.set(null,w),d.set(q,w),this.count++,_=$.bind(this),w.addEventListener("load",_),w.addEventListener("error",_),D?D.parentNode.insertBefore(w,D.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),u.state.loading|=4}}var ue={$$typeof:jt,Provider:null,Consumer:null,_currentValue:At,_currentValue2:At,_threadCount:0};function H(a,u,d,_,w,D,q,W){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=te(0),this.hiddenUpdates=te(null),this.identifierPrefix=_,this.onUncaughtError=w,this.onCaughtError=D,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function J(a,u,d,_,w,D,q,W,_e,Ue,nt,ot){return a=new H(a,u,d,q,W,_e,Ue,ot),u=1,D===!0&&(u|=24),D=Fn(3,null,null,u),a.current=D,D.stateNode=a,u=wo(),u.refCount++,a.pooledCache=u,u.refCount++,D.memoizedState={element:_,isDehydrated:d,cache:u},qc(D),a}function fe(a){return a?(a=Ns,a):Ns}function Be(a,u,d,_,w,D){w=fe(w),_.context===null?_.context=w:_.pendingContext=w,_=ms(u),_.payload={element:d},D=D===void 0?null:D,D!==null&&(_.callback=D),d=Zr(a,_,u),d!==null&&(Kr(d,a,u),js(d,a,u))}function st(a,u){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<u?d:u}}function je(a,u){st(a,u),(a=a.alternate)&&st(a,u)}function Qe(a){if(a.tag===13){var u=ru(a,67108864);u!==null&&Kr(u,a,67108864),je(a,67108864)}}var ht=!0;function ut(a,u,d,_){var w=Je.T;Je.T=null;var D=St.p;try{St.p=2,We(a,u,d,_)}finally{St.p=D,Je.T=w}}function ft(a,u,d,_){var w=Je.T;Je.T=null;var D=St.p;try{St.p=8,We(a,u,d,_)}finally{St.p=D,Je.T=w}}function We(a,u,d,_){if(ht){var w=It(_);if(w===null)od(a,u,_,Bt,d),Wa(a,_);else if(_n(w,a,u,d,_))_.stopPropagation();else if(Wa(a,_),u&4&&-1<_a.indexOf(a)){for(;w!==null;){var D=Zi(w);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var q=De(D.pendingLanes);if(q!==0){var W=D;for(W.pendingLanes|=2,W.entangledLanes|=2;q;){var _e=1<<31-Ba(q);W.entanglements[1]|=_e,q&=~_e}As(D),(ta&6)===0&&(tf=ka()+500,oc(0))}}break;case 13:W=ru(D,2),W!==null&&Kr(W,D,2),Rn(),je(D,2)}if(D=It(_),D===null&&od(a,u,_,Bt,d),D===w)break;w=D}w!==null&&_.stopPropagation()}else od(a,u,_,null,d)}}function It(a){return a=go(a),kt(a)}var Bt=null;function kt(a){if(Bt=null,a=Xt(a),a!==null){var u=R(a);if(u===null)a=null;else{var d=u.tag;if(d===13){if(a=S(u),a!==null)return a;a=null}else if(d===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;a=null}else u!==a&&(a=null)}}return Bt=a,null}function Pt(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Cl()){case Ru:return 2;case Zn:return 8;case sr:case zo:return 32;case oo:return 268435456;default:return 32}default:return 32}}var pi=!1,Fi=null,oa=null,Aa=null,jn=new Map,gn=new Map,ga=[],_a="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Wa(a,u){switch(a){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":oa=null;break;case"mouseover":case"mouseout":Aa=null;break;case"pointerover":case"pointerout":jn.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":gn.delete(u.pointerId)}}function ja(a,u,d,_,w,D){return a===null||a.nativeEvent!==D?(a={blockedOn:u,domEventName:d,eventSystemFlags:_,nativeEvent:D,targetContainers:[w]},u!==null&&(u=Zi(u),u!==null&&Qe(u)),a):(a.eventSystemFlags|=_,u=a.targetContainers,w!==null&&u.indexOf(w)===-1&&u.push(w),a)}function _n(a,u,d,_,w){switch(u){case"focusin":return Fi=ja(Fi,a,u,d,_,w),!0;case"dragenter":return oa=ja(oa,a,u,d,_,w),!0;case"mouseover":return Aa=ja(Aa,a,u,d,_,w),!0;case"pointerover":var D=w.pointerId;return jn.set(D,ja(jn.get(D)||null,a,u,d,_,w)),!0;case"gotpointercapture":return D=w.pointerId,gn.set(D,ja(gn.get(D)||null,a,u,d,_,w)),!0}return!1}function qn(a){var u=Xt(a.target);if(u!==null){var d=R(u);if(d!==null){if(u=d.tag,u===13){if(u=S(d),u!==null){a.blockedOn=u,Tt(a.priority,function(){if(d.tag===13){var _=Tr();_=Re(_);var w=ru(d,_);w!==null&&Kr(w,d,_),je(d,_)}});return}}else if(u===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function tr(a){if(a.blockedOn!==null)return!1;for(var u=a.targetContainers;0<u.length;){var d=It(a.nativeEvent);if(d===null){d=a.nativeEvent;var _=new d.constructor(d.type,d);Vo=_,d.target.dispatchEvent(_),Vo=null}else return u=Zi(d),u!==null&&Qe(u),a.blockedOn=d,!1;u.shift()}return!0}function Ja(a,u,d){tr(a)&&d.delete(u)}function Er(){pi=!1,Fi!==null&&tr(Fi)&&(Fi=null),oa!==null&&tr(oa)&&(oa=null),Aa!==null&&tr(Aa)&&(Aa=null),jn.forEach(Ja),gn.forEach(Ja)}function Na(a,u){a.blockedOn===u&&(a.blockedOn=null,pi||(pi=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Er)))}var qa=null;function en(a){qa!==a&&(qa=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){qa===a&&(qa=null);for(var u=0;u<a.length;u+=3){var d=a[u],_=a[u+1],w=a[u+2];if(typeof _!="function"){if(kt(_||d)===null)continue;break}var D=Zi(d);D!==null&&(a.splice(u,3),u-=3,bs(D,{pending:!0,data:w,method:d.method,action:_},_,w))}}))}function ya(a){function u(_e){return Na(_e,a)}Fi!==null&&Na(Fi,a),oa!==null&&Na(oa,a),Aa!==null&&Na(Aa,a),jn.forEach(u),gn.forEach(u);for(var d=0;d<ga.length;d++){var _=ga[d];_.blockedOn===a&&(_.blockedOn=null)}for(;0<ga.length&&(d=ga[0],d.blockedOn===null);)qn(d),d.blockedOn===null&&ga.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(_=0;_<d.length;_+=3){var w=d[_],D=d[_+1],q=w[Ot]||null;if(typeof D=="function")q||en(d);else if(q){var W=null;if(D&&D.hasAttribute("formAction")){if(w=D,q=D[Ot]||null)W=q.formAction;else if(kt(w)!==null)continue}else W=q.action;typeof W=="function"?d[_+1]=W:(d.splice(_,3),_-=3),en(d)}}}function Ki(a){this._internalRoot=a}kr.prototype.render=Ki.prototype.render=function(a){var u=this._internalRoot;if(u===null)throw Error(x(409));var d=u.current,_=Tr();Be(d,_,a,u,null,null)},kr.prototype.unmount=Ki.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var u=a.containerInfo;Be(a.current,2,null,a,null,null),Rn(),u[Ye]=null}};function kr(a){this._internalRoot=a}kr.prototype.unstable_scheduleHydration=function(a){if(a){var u=yt();a={blockedOn:null,target:a,priority:u};for(var d=0;d<ga.length&&u!==0&&u<ga[d].priority;d++);ga.splice(d,0,a),d===0&&qn(a)}};var dc=n.version;if(dc!=="19.1.0")throw Error(x(527,dc,"19.1.0"));St.findDOMNode=function(a){var u=a._reactInternals;if(u===void 0)throw typeof a.render=="function"?Error(x(188)):(a=Object.keys(a).join(","),Error(x(268,a)));return a=Z(u),a=a!==null?Q(a):null,a=a===null?null:a.stateNode,a};var ao={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Je,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Df=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Df.isDisabled&&Df.supportsFiber)try{is=Df.inject(ao),an=Df}catch{}}return k0.createRoot=function(a,u){if(!A(a))throw Error(x(299));var d=!1,_="",w=sp,D=Fd,q=Xf,W=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(_=u.identifierPrefix),u.onUncaughtError!==void 0&&(w=u.onUncaughtError),u.onCaughtError!==void 0&&(D=u.onCaughtError),u.onRecoverableError!==void 0&&(q=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(W=u.unstable_transitionCallbacks)),u=J(a,1,!1,null,null,d,_,w,D,q,W,null),a[Ye]=u.current,gf(a),new Ki(u)},k0.hydrateRoot=function(a,u,d){if(!A(a))throw Error(x(299));var _=!1,w="",D=sp,q=Fd,W=Xf,_e=null,Ue=null;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(w=d.identifierPrefix),d.onUncaughtError!==void 0&&(D=d.onUncaughtError),d.onCaughtError!==void 0&&(q=d.onCaughtError),d.onRecoverableError!==void 0&&(W=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(_e=d.unstable_transitionCallbacks),d.formState!==void 0&&(Ue=d.formState)),u=J(a,1,!0,u,d??null,_,w,D,q,W,_e,Ue),u.context=fe(null),d=u.current,_=Tr(),_=Re(_),w=ms(_),w.callback=null,Zr(d,w,_),d=_,u.current.lanes=d,Ne(u,d),As(u),a[Ye]=u.current,gf(a),new kr(u)},k0.version="19.1.0",k0}var Xg;function Sy(){if(Xg)return Lm.exports;Xg=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),Lm.exports=Ay(),Lm.exports}var Cy=Sy(),Vp={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.5.0/LICENSE.txt
 */var My=Vp.exports,Qg;function Iy(){return Qg||(Qg=1,function(i,n){(function(f,x){i.exports=x()})(My,function(){var f={},x={};function A(S,h,Z){if(x[S]=Z,S==="index"){var Q="var sharedModule = {}; ("+x.shared+")(sharedModule); ("+x.worker+")(sharedModule);",ge={};return x.shared(ge),x.index(f,ge),typeof window<"u"&&f.setWorkerUrl(window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"}))),f}}A("shared",["exports"],function(S){function h(o,t,s,l){return new(s||(s=Promise))(function(m,b){function v(P){try{M(l.next(P))}catch(N){b(N)}}function E(P){try{M(l.throw(P))}catch(N){b(N)}}function M(P){var N;P.done?m(P.value):(N=P.value,N instanceof s?N:new s(function(B){B(N)})).then(v,E)}M((l=l.apply(o,t||[])).next())})}function Z(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Q,ge;function Me(){if(ge)return Q;function o(t,s){this.x=t,this.y=s}return ge=1,Q=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,s){return this.clone()._rotateAround(t,s)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var s=t.x-this.x,l=t.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult:function(t){var s=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var s=Math.cos(t),l=Math.sin(t),m=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=m,this},_rotateAround:function(t,s){var l=Math.cos(t),m=Math.sin(t),b=s.y+m*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-m*(this.y-s.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t},Q}typeof SuppressedError=="function"&&SuppressedError;var Ae,he,Ve=Z(Me()),Vt=function(){if(he)return Ae;function o(t,s,l,m){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=l,this.p2y=m}return he=1,Ae=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,m=0;m<8;m++){var b=this.sampleCurveX(l)-t;if(Math.abs(b)<s)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=b/v}var E=0,M=1;for(l=t,m=0;m<20&&(b=this.sampleCurveX(l),!(Math.abs(b-t)<s));m++)t>b?E=l:M=l,l=.5*(M-E)+E;return l},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},Ae}(),li=Z(Vt);let Pi,Bi;function jt(){return Pi==null&&(Pi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pi}function et(){if(Bi==null&&(Bi=!1,jt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const m=4*l;t.fillStyle=`rgb(${m},${m+1},${m+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&s[l]!==l){Bi=!0;break}}}return Bi||!1}var Ie=1e-6,Oe=typeof Float32Array<"u"?Float32Array:Array;function pt(){var o=new Oe(9);return Oe!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function xt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ai(){var o=new Oe(3);return Oe!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Kt(o){return Math.hypot(o[0],o[1],o[2])}function Si(o,t,s){var l=new Oe(3);return l[0]=o,l[1]=t,l[2]=s,l}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var hi,Gi=Kt;function zi(o,t,s){var l=t[0],m=t[1],b=t[2],v=t[3];return o[0]=s[0]*l+s[4]*m+s[8]*b+s[12]*v,o[1]=s[1]*l+s[5]*m+s[9]*b+s[13]*v,o[2]=s[2]*l+s[6]*m+s[10]*b+s[14]*v,o[3]=s[3]*l+s[7]*m+s[11]*b+s[15]*v,o}function xa(){var o=new Oe(4);return Oe!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Je(){var o=new Oe(2);return Oe!=Float32Array&&(o[0]=0,o[1]=0),o}function St(o,t){var s=new Oe(2);return s[0]=o,s[1]=t,s}ai(),hi=new Oe(4),Oe!=Float32Array&&(hi[0]=0,hi[1]=0,hi[2]=0,hi[3]=0),ai(),Si(1,0,0),Si(0,1,0),xa(),xa(),pt(),Je();const At=8192;function Ei(o,t,s){return t*(At/(o.tileSize*Math.pow(2,s-o.tileID.overscaledZ)))}function Ee(o,t){return(o%t+t)%t}function ct(o,t,s){return o*(1-s)+t*s}function Et(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,s=t*o;return 4*(o<.5?s:3*(o-t)+s-.75)}function Mt(o,t,s,l){const m=new li(o,t,s,l);return b=>m.solve(b)}const Nt=Mt(.25,.1,.25,1);function Wt(o,t,s){return Math.min(s,Math.max(t,o))}function Zt(o,t,s){const l=s-t,m=((o-t)%l+l)%l+t;return m===t?s:m}function si(o,...t){for(const s of t)for(const l in s)o[l]=s[l];return o}let yi=1;function Va(o,t,s){const l={};for(const m in o)l[m]=t.call(this,o[m],m,o);return l}function es(o,t,s){const l={};for(const m in o)t.call(this,o[m],m,o)&&(l[m]=o[m]);return l}function bn(o){return Array.isArray(o)?o.map(bn):typeof o=="object"&&o?Va(o,bn):o}const On={};function hn(o){On[o]||(typeof console<"u"&&console.warn(o),On[o]=!0)}function Hi(o,t,s){return(s.y-o.y)*(t.x-o.x)>(t.y-o.y)*(s.x-o.x)}function ts(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let so=null;function ka(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const Cl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ru(o,t,s,l,m){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(o,{timestamp:0});try{const v=b==null?void 0:b.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const E=v.startsWith("BGR"),M=new Uint8ClampedArray(l*m*4);if(yield b.copyTo(M,function(P,N,B,U,j){const V=4*Math.max(1,0),$=(Math.max(0,B)-B)*U*4+V,ee=4*U,oe=Math.max(0,N),ve=Math.max(0,B);return{rect:{x:oe,y:ve,width:Math.min(P.width,N+U)-oe,height:Math.min(P.height,B+j)-ve},layout:[{offset:$,stride:ee}]}}(o,t,s,l,m)),E)for(let P=0;P<M.length;P+=4){const N=M[P];M[P]=M[P+2],M[P+2]=N}return M}finally{b.close()}})}let Zn,sr;function zo(o,t,s,l){return o.addEventListener(t,s,l),{unsubscribe:()=>{o.removeEventListener(t,s,l)}}}function oo(o){return o*Math.PI/180}function Ds(o){return o/Math.PI*180}const Pu={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},is={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},an="AbortError";function xn(){return new Error(an)}const Ba={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function uo(o){return Ba.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const Lu="global-dispatcher";class Ar extends Error{constructor(t,s,l,m){super(`AJAXError: ${s} (${t}): ${l}`),this.status=t,this.statusText=s,this.url=l,this.body=m}}const dn=()=>ts(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,or=function(o,t){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const l=uo(o.url);if(l)return l(o,t);if(ts(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:Lu},t)}if(!(/^file:/.test(s=o.url)||/^file:/.test(dn())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,m){return h(this,void 0,void 0,function*(){const b=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:dn(),signal:m.signal});let v,E;l.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{v=yield fetch(b)}catch(P){throw new Ar(0,P.message,l.url,new Blob)}if(!v.ok){const P=yield v.blob();throw new Ar(v.status,v.statusText,l.url,P)}E=l.type==="arrayBuffer"||l.type==="image"?v.arrayBuffer():l.type==="json"?v.json():v.text();const M=yield E;if(m.signal.aborted)throw xn();return{data:M,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(o,t);if(ts(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:Lu},t)}var s;return function(l,m){return new Promise((b,v)=>{var E;const M=new XMLHttpRequest;M.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(M.responseType="arraybuffer");for(const P in l.headers)M.setRequestHeader(P,l.headers[P]);l.type==="json"&&(M.responseType="text",!((E=l.headers)===null||E===void 0)&&E.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=l.credentials==="include",M.onerror=()=>{v(new Error(M.statusText))},M.onload=()=>{if(!m.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let P=M.response;if(l.type==="json")try{P=JSON.parse(M.response)}catch(N){return void v(N)}b({data:P,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const P=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});v(new Ar(M.status,M.statusText,l.url,P))}},m.signal.addEventListener("abort",()=>{M.abort(),v(xn())}),M.send(l.body)})}(o,t)};function De(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const t=new URL(o),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function X(o,t,s){s[o]&&s[o].indexOf(t)!==-1||(s[o]=s[o]||[],s[o].push(t))}function K(o,t,s){if(s&&s[o]){const l=s[o].indexOf(t);l!==-1&&s[o].splice(l,1)}}class ie{constructor(t,s={}){si(this,s),this.type=t}}class de extends ie{constructor(t,s={}){super("error",si({error:t},s))}}class Te{on(t,s){return this._listeners=this._listeners||{},X(t,s,this._listeners),{unsubscribe:()=>{this.off(t,s)}}}off(t,s){return K(t,s,this._listeners),K(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},X(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){typeof t=="string"&&(t=new ie(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const m=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const E of m)E.call(this,t);const b=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const E of b)K(l,E,this._oneTimeListeners),E.call(this,t);const v=this._eventedParent;v&&(si(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof de&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ne=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Se(o,t){const s={};for(const l in o)l!=="ref"&&(s[l]=o[l]);return Ne.forEach(l=>{l in t&&(s[l]=t[l])}),s}function Le(o,t){if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let s=0;s<o.length;s++)if(!Le(o[s],t[s]))return!1;return!0}if(typeof o=="object"&&o!==null&&t!==null){if(typeof t!="object"||Object.keys(o).length!==Object.keys(t).length)return!1;for(const s in o)if(!Le(o[s],t[s]))return!1;return!0}return o===t}function He(o,t){o.push(t)}function Re(o,t,s){He(s,{command:"addSource",args:[o,t[o]]})}function at(o,t,s){He(t,{command:"removeSource",args:[o]}),s[o]=!0}function yt(o,t,s,l){at(o,s,l),Re(o,t,s)}function Tt(o,t,s){let l;for(l in o[s])if(Object.prototype.hasOwnProperty.call(o[s],l)&&l!=="data"&&!Le(o[s][l],t[s][l]))return!1;for(l in t[s])if(Object.prototype.hasOwnProperty.call(t[s],l)&&l!=="data"&&!Le(o[s][l],t[s][l]))return!1;return!0}function Lt(o,t,s,l,m,b){o=o||{},t=t||{};for(const v in o)Object.prototype.hasOwnProperty.call(o,v)&&(Le(o[v],t[v])||s.push({command:b,args:[l,v,t[v],m]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(o,v)&&(Le(o[v],t[v])||s.push({command:b,args:[l,v,t[v],m]}))}function Ft(o){return o.id}function Ot(o,t){return o[t.id]=t,o}class Ye{constructor(t,s,l,m){this.message=(t?`${t}: `:"")+l,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ci(o,...t){for(const s of t)for(const l in s)o[l]=s[l];return o}class bi extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Mi{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,m]of s)this.bindings[l]=m}concat(t){return new Mi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Yt={kind:"null"},it={kind:"number"},qt={kind:"string"},Xt={kind:"boolean"},Zi={kind:"color"},Wi={kind:"projectionDefinition"},$a={kind:"object"},Ut={kind:"value"},Fo={kind:"collator"},Ou={kind:"formatted"},ur={kind:"padding"},as={kind:"colorArray"},Rs={kind:"numberArray"},lo={kind:"resolvedImage"},Sa={kind:"variableAnchorOffsetCollection"};function lr(o,t){return{kind:"array",itemType:o,N:t}}function Yi(o){if(o.kind==="array"){const t=Yi(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}const co=[Yt,it,qt,Xt,Zi,Wi,Ou,$a,lr(Ut),ur,Rs,as,lo,Sa];function Yn(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Yn(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(const s of co)if(!Yn(s,t))return null}}return`Expected ${Yi(o)} but found ${Yi(t)} instead.`}function Ml(o,t){return t.some(s=>s.kind===o.kind)}function ho(o,t){return t.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}function $n(o,t){return o.kind==="array"&&t.kind==="array"?o.itemType.kind===t.itemType.kind&&typeof o.N=="number":o.kind===t.kind}const yc=.96422,Il=.82521,vd=4/29,Uo=6/29,cr=3*Uo*Uo,Td=Uo*Uo*Uo,Uf=Math.PI/180,bc=180/Math.PI;function wh(o){return(o%=360)<0&&(o+=360),o}function Nu([o,t,s,l]){let m,b;const v=Xn((.2225045*(o=Ho(o))+.7168786*(t=Ho(t))+.0606169*(s=Ho(s)))/1);o===t&&t===s?m=b=v:(m=Xn((.4360747*o+.3850649*t+.1430804*s)/yc),b=Xn((.0139322*o+.0971045*t+.7141733*s)/Il));const E=116*v-16;return[E<0?0:E,500*(m-v),200*(v-b),l]}function Ho(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Xn(o){return o>Td?Math.pow(o,1/3):o/cr+vd}function xc([o,t,s,l]){let m=(o+16)/116,b=isNaN(t)?m:m+t/500,v=isNaN(s)?m:m-s/200;return m=1*Dl(m),b=yc*Dl(b),v=Il*Dl(v),[fo(3.1338561*b-1.6168667*m-.4906146*v),fo(-.9787684*b+1.9161415*m+.033454*v),fo(.0719453*b-.2289914*m+1.4052427*v),l]}function fo(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Dl(o){return o>Uo?o*o*o:cr*(o-vd)}const ku=Object.hasOwn||function(o,t){return Object.prototype.hasOwnProperty.call(o,t)};function Bu(o,t){return ku(o,t)?o[t]:void 0}function zu(o){return parseInt(o.padEnd(2,o),16)/255}function po(o,t){return Nn(t?o/100:o,0,1)}function Nn(o,t,s){return Math.min(Math.max(t,o),s)}function vi(o){return!o.some(Number.isNaN)}const jo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fn(o,t,s){return o+s*(t-o)}function qo(o,t,s){return o.map((l,m)=>fn(l,t[m],s))}class xi{constructor(t,s,l,m=1,b=!0){this.r=t,this.g=s,this.b=l,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[t,s,l,m]))}static parse(t){if(t instanceof xi)return t;if(typeof t!="string")return;const s=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Bu(jo,l);if(m){const[v,E,M]=m;return[v/255,E/255,M/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let E=1;return[zu(l.slice(E,E+=v)),zu(l.slice(E,E+=v)),zu(l.slice(E,E+=v)),zu(l.slice(E,E+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[E,M,P,N,B,U,j,V,$,ee,oe,ve]=v,ue=[N||" ",j||" ",ee].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const H=[P,U,$].join(""),J=H==="%%%"?100:H===""?255:0;if(J){const fe=[Nn(+M/J,0,1),Nn(+B/J,0,1),Nn(+V/J,0,1),oe?po(+oe,ve):1];if(vi(fe))return fe}}return}}const b=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[v,E,M,P,N,B,U,j,V]=b,$=[M||" ",N||" ",U].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const ee=[+E,Nn(+P,0,100),Nn(+B,0,100),j?po(+j,V):1];if(vi(ee))return function([oe,ve,ue,H]){function J(fe){const Be=(fe+oe/30)%12,st=ve*Math.min(ue,1-ue);return ue-st*Math.max(-1,Math.min(Be-3,9-Be,1))}return oe=wh(oe),ve/=100,ue/=100,[J(0),J(8),J(4),H]}(ee)}}}(t);return s?new xi(...s,!1):void 0}get rgb(){const{r:t,g:s,b:l,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[t/b,s/b,l/b,m])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,l,m,b]=Nu(t),v=Math.sqrt(l*l+m*m);return[Math.round(1e4*v)?wh(Math.atan2(m,l)*bc):NaN,v,s,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nu(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,l,m]=this.rgb;return`rgba(${[t,s,l].map(b=>Math.round(255*b)).join(",")},${m})`}static interpolate(t,s,l,m="rgb"){switch(m){case"rgb":{const[b,v,E,M]=qo(t.rgb,s.rgb,l);return new xi(b,v,E,M,!1)}case"hcl":{const[b,v,E,M]=t.hcl,[P,N,B,U]=s.hcl;let j,V;if(isNaN(b)||isNaN(P))isNaN(b)?isNaN(P)?j=NaN:(j=P,E!==1&&E!==0||(V=N)):(j=b,B!==1&&B!==0||(V=v));else{let ue=P-b;P>b&&ue>180?ue-=360:P<b&&b-P>180&&(ue+=360),j=b+l*ue}const[$,ee,oe,ve]=function([ue,H,J,fe]){return ue=isNaN(ue)?0:ue*Uf,xc([J,Math.cos(ue)*H,Math.sin(ue)*H,fe])}([j,V??fn(v,N,l),fn(E,B,l),fn(M,U,l)]);return new xi($,ee,oe,ve,!1)}case"lab":{const[b,v,E,M]=xc(qo(t.lab,s.lab,l));return new xi(b,v,E,M,!1)}}}}xi.black=new xi(0,0,0,1),xi.white=new xi(1,1,1,1),xi.transparent=new xi(0,0,0,0),xi.red=new xi(1,0,0,1);class mo{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Vo=["bottom","center","top"];class go{constructor(t,s,l,m,b,v){this.text=t,this.image=s,this.scale=l,this.fontStack=m,this.textColor=b,this.verticalAlign=v}}class Xa{constructor(t){this.sections=t}static fromString(t){return new Xa([new go(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Xa?t:Xa.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Ca{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ca)return t;if(typeof t=="number")return new Ca([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Ca(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l){return new Ca(qo(t.values,s.values,l))}}class Ma{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ma)return t;if(typeof t=="number")return new Ma([t]);if(Array.isArray(t)){for(const s of t)if(typeof s!="number")return;return new Ma(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l){return new Ma(qo(t.values,s.values,l))}}class Qa{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Qa)return t;if(typeof t=="string"){const l=xi.parse(t);return l?new Qa([l]):void 0}if(!Array.isArray(t))return;const s=[];for(const l of t){if(typeof l!="string")return;const m=xi.parse(l);if(!m)return;s.push(m)}return new Qa(s)}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l,m="rgb"){const b=[];if(t.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let v=0;v<t.values.length;v++)b.push(xi.interpolate(t.values[v],s.values[v],l,m));return new Qa(b)}}class Ji extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ns=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class va{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof va)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const l=t[s],m=t[s+1];if(typeof l!="string"||!ns.has(l)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new va(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l){const m=t.values,b=s.values;if(m.length!==b.length)throw new Ji(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${s.toString()}`);const v=[];for(let E=0;E<m.length;E+=2){if(m[E]!==b[E])throw new Ji(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${m[E]}, to[${E}]: ${b[E]}`);v.push(m[E]);const[M,P]=m[E+1],[N,B]=b[E+1];v.push([fn(M,N,l),fn(P,B,l)])}return new va(v)}}class kn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new kn({name:t,available:!1}):null}}class nn{constructor(t,s,l){this.from=t,this.to=s,this.transition=l}static interpolate(t,s,l){return new nn(t,s,l)}static parse(t){return t instanceof nn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new nn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new nn(t.from,t.to,t.transition):typeof t=="string"?new nn(t,t,1):void 0}}function Sr(o,t,s,l){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,t,s,l]:[o,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ni(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof nn||o instanceof xi||o instanceof mo||o instanceof Xa||o instanceof Ca||o instanceof Ma||o instanceof Qa||o instanceof va||o instanceof kn)return!0;if(Array.isArray(o)){for(const t of o)if(!Ni(t))return!1;return!0}if(typeof o=="object"){for(const t in o)if(!Ni(o[t]))return!1;return!0}return!1}function ra(o){if(o===null)return Yt;if(typeof o=="string")return qt;if(typeof o=="boolean")return Xt;if(typeof o=="number")return it;if(o instanceof xi)return Zi;if(o instanceof nn)return Wi;if(o instanceof mo)return Fo;if(o instanceof Xa)return Ou;if(o instanceof Ca)return ur;if(o instanceof Ma)return Rs;if(o instanceof Qa)return as;if(o instanceof va)return Sa;if(o instanceof kn)return lo;if(Array.isArray(o)){const t=o.length;let s;for(const l of o){const m=ra(l);if(s){if(s===m)continue;s=Ut;break}s=m}return lr(s||Ut,t)}return $a}function mi(o){const t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof xi||o instanceof nn||o instanceof Xa||o instanceof Ca||o instanceof Ma||o instanceof Qa||o instanceof va||o instanceof kn?o.toString():JSON.stringify(o)}class Qt{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ni(t[1]))return s.error("invalid value");const l=t[1];let m=ra(l);const b=s.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Qt(m,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ps={string:qt,number:it,boolean:Xt,object:$a};class oi{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,m=1;const b=t[0];if(b==="array"){let E,M;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ps)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ps[P],m++}else E=Ut;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);M=t[2],m++}l=lr(E,M)}else{if(!Ps[b])throw new Error(`Types doesn't contain name = ${b}`);l=Ps[b]}const v=[];for(;m<t.length;m++){const E=s.parse(t[m],m,Ut);if(!E)return null;v.push(E)}return new oi(l,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!Yn(this.type,ra(l)))return l;if(s===this.args.length-1)throw new Ji(`Expected value to be of type ${Yi(this.type)}, but found ${Yi(ra(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const pn={"to-boolean":Xt,"to-color":Zi,"to-number":it,"to-string":qt};class Ia{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(!pn[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return s.error("Expected one argument.");const m=pn[l],b=[];for(let v=1;v<t.length;v++){const E=s.parse(t[v],v,Ut);if(!E)return null;b.push(E)}return new Ia(m,b)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,l;for(const m of this.args){if(s=m.evaluate(t),l=null,s instanceof xi)return s;if(typeof s=="string"){const b=t.parseColor(s);if(b)return b}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Sr(s[0],s[1],s[2],s[3]),!l))return new xi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ji(l||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const l of this.args){s=l.evaluate(t);const m=Ca.parse(s);if(m)return m}throw new Ji(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const l of this.args){s=l.evaluate(t);const m=Ma.parse(s);if(m)return m}throw new Ji(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const l of this.args){s=l.evaluate(t);const m=Qa.parse(s);if(m)return m}throw new Ji(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const l of this.args){s=l.evaluate(t);const m=va.parse(s);if(m)return m}throw new Ji(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const l of this.args){if(s=l.evaluate(t),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new Ji(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Xa.fromString(mi(this.args[0].evaluate(t)));case"resolvedImage":return kn.fromString(mi(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return mi(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Fu=["Unknown","Point","LineString","Polygon"];class Go{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache.get(t);return s||(s=xi.parse(t),this._parseColorCache.set(t,s)),s}}class Rl{constructor(t,s,l=[],m,b=new Mi,v=[]){this.registry=t,this.path=l,this.key=l.map(E=>`[${E}]`).join(""),this.scope=b,this.errors=v,this.expectedType=m,this._isConstant=s}parse(t,s,l,m,b={}){return s?this.concat(s,l,m)._parse(t,b):this._parse(t,b)}_parse(t,s){function l(m,b,v){return v==="assert"?new oi(b,[m]):v==="coerce"?new Ia(b,[m]):m}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let v=b.parse(t,this);if(!v)return null;if(this.expectedType){const E=this.expectedType,M=v.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value"){if(E.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(E.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(E.kind)&&["value","number","array"].includes(M.kind)||E.kind==="colorArray"&&["value","string","array"].includes(M.kind)||E.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))v=l(v,E,s.typeAnnotation||"coerce");else if(this.checkSubtype(E,M))return null}else v=l(v,E,s.typeAnnotation||"assert")}if(!(v instanceof Qt)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const E=new Go;try{v=new Qt(v.type,v.evaluate(E))}catch(M){return this.error(M.message),null}}return v}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const m=typeof t=="number"?this.path.concat(t):this.path,b=l?this.scope.concat(l):this.scope;return new Rl(this.registry,this._isConstant,m,s||null,b,this.errors)}error(t,...s){const l=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new bi(l,t))}checkSubtype(t,s){const l=Yn(t,s);return l&&this.error(l),l}}class _o{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let b=1;b<t.length-1;b+=2){const v=t[b];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",b);const E=s.parse(t[b+1],b+1);if(!E)return null;l.push([v,E])}const m=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return m?new _o(l,m):null}outputDefined(){return this.result.outputDefined()}}class Zo{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new Zo(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Yo{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,it),m=s.parse(t[2],2,lr(s.expectedType||Ut));return l&&m?new Yo(m.type.itemType,l,m):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new Ji(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new Ji(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new Ji(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $o{constructor(t,s){this.type=Xt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Ut),m=s.parse(t[2],2,Ut);return l&&m?Ml(l.type,[Xt,qt,it,Yt,Ut])?new $o(l,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ho(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(ra(s))} instead.`);if(!ho(l,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Yi(ra(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Uu{constructor(t,s,l){this.type=it,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Ut),m=s.parse(t[2],2,Ut);if(!l||!m)return null;if(!Ml(l.type,[Xt,qt,it,Yt,Ut]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(l.type)} instead`);if(t.length===4){const b=s.parse(t[3],3,it);return b?new Uu(l,m,b):null}return new Uu(l,m)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ho(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(ra(s))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(t)),ho(l,["string"])){const b=l.indexOf(s,m);return b===-1?-1:[...l.slice(0,b)].length}if(ho(l,["array"]))return l.indexOf(s,m);throw new Ji(`Expected second argument to be of type array or string, but found ${Yi(ra(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Xo{constructor(t,s,l,m,b,v){this.inputType=t,this.type=s,this.input=l,this.cases=m,this.outputs=b,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const b={},v=[];for(let P=2;P<t.length-1;P+=2){let N=t[P];const B=t[P+1];Array.isArray(N)||(N=[N]);const U=s.concat(P);if(N.length===0)return U.error("Expected at least one branch label.");for(const V of N){if(typeof V!="number"&&typeof V!="string")return U.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return U.error("Numeric branch labels must be integer values.");if(l){if(U.checkSubtype(l,ra(V)))return null}else l=ra(V);if(b[String(V)]!==void 0)return U.error("Branch labels must be unique.");b[String(V)]=v.length}const j=s.parse(B,P,m);if(!j)return null;m=m||j.type,v.push(j)}const E=s.parse(t[1],1,Ut);if(!E)return null;const M=s.parse(t[t.length-1],t.length-1,m);return M?E.type.kind!=="value"&&s.concat(1).checkSubtype(l,E.type)?null:new Xo(l,m,E,b,v,M):null}evaluate(t){const s=this.input.evaluate(t);return(ra(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class rn{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const m=[];for(let v=1;v<t.length-1;v+=2){const E=s.parse(t[v],v,Xt);if(!E)return null;const M=s.parse(t[v+1],v+1,l);if(!M)return null;m.push([E,M]),l=l||M.type}const b=s.parse(t[t.length-1],t.length-1,l);if(!b)return null;if(!l)throw new Error("Can't infer output type");return new rn(l,m,b)}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Qo{constructor(t,s,l,m){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=m}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Ut),m=s.parse(t[2],2,it);if(!l||!m)return null;if(!Ml(l.type,[lr(Ut),qt,Ut]))return s.error(`Expected first argument to be of type array or string, but found ${Yi(l.type)} instead`);if(t.length===4){const b=s.parse(t[3],3,it);return b?new Qo(l.type,l,m,b):null}return new Qo(l.type,l,m)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let m;if(this.endIndex&&(m=this.endIndex.evaluate(t)),ho(s,["string"]))return[...s].slice(l,m).join("");if(ho(s,["array"]))return s.slice(l,m);throw new Ji(`Expected first argument to be of type array or string, but found ${Yi(ra(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ko(o,t){const s=o.length-1;let l,m,b=0,v=s,E=0;for(;b<=v;)if(E=Math.floor((b+v)/2),l=o[E],m=o[E+1],l<=t){if(E===s||t<m)return E;b=E+1}else{if(!(l>t))throw new Ji("Input is not a number.");v=E-1}return 0}class yo{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[m,b]of l)this.labels.push(m),this.outputs.push(b)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,it);if(!l)return null;const m=[];let b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let v=1;v<t.length;v+=2){const E=v===1?-1/0:t[v],M=t[v+1],P=v,N=v+1;if(typeof E!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=E)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const B=s.parse(M,N,b);if(!B)return null;b=b||B.type,m.push([E,B])}return new yo(b,l,m)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const m=this.input.evaluate(t);if(m<=s[0])return l[0].evaluate(t);const b=s.length;return m>=s[b-1]?l[b-1].evaluate(t):l[Ko(s,m)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function sn(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var vc,Tc,Ed=function(){if(Tc)return vc;function o(t,s,l,m){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=l,this.p2y=m}return Tc=1,vc=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,m=0;m<8;m++){var b=this.sampleCurveX(l)-t;if(Math.abs(b)<s)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=b/v}var E=0,M=1;for(l=t,m=0;m<20&&(b=this.sampleCurveX(l),!(Math.abs(b-t)<s));m++)t>b?E=l:M=l,l=.5*(M-E)+E;return l},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},vc}(),wd=sn(Ed);class vn{constructor(t,s,l,m,b){this.type=t,this.operator=s,this.interpolation=l,this.input=m,this.labels=[],this.outputs=[];for(const[v,E]of b)this.labels.push(v),this.outputs.push(E)}static interpolationFactor(t,s,l,m){let b=0;if(t.name==="exponential")b=Pl(s,t.base,l,m);else if(t.name==="linear")b=Pl(s,1,l,m);else if(t.name==="cubic-bezier"){const v=t.controlPoints;b=new wd(v[0],v[1],v[2],v[3]).solve(Pl(s,1,l,m))}return b}static parse(t,s){let[l,m,b,...v]=t;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const P=m[1];if(typeof P!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(P.length!==4||P.some(N=>typeof N!="number"||N<0||N>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(b=s.parse(b,2,it),!b)return null;const E=[];let M=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||s.expectedType==as?s.expectedType&&s.expectedType.kind!=="value"&&(M=s.expectedType):M=Zi;for(let P=0;P<v.length;P+=2){const N=v[P],B=v[P+1],U=P+3,j=P+4;if(typeof N!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(E.length&&E[E.length-1][0]>=N)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const V=s.parse(B,j,M);if(!V)return null;M=M||V.type,E.push([N,V])}return $n(M,it)||$n(M,Wi)||$n(M,Zi)||$n(M,ur)||$n(M,Rs)||$n(M,as)||$n(M,Sa)||$n(M,lr(it))?new vn(M,l,m,b,E):s.error(`Type ${Yi(M)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const m=this.input.evaluate(t);if(m<=s[0])return l[0].evaluate(t);const b=s.length;if(m>=s[b-1])return l[b-1].evaluate(t);const v=Ko(s,m),E=vn.interpolationFactor(this.interpolation,m,s[v],s[v+1]),M=l[v].evaluate(t),P=l[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fn(M,P,E);case"color":return xi.interpolate(M,P,E);case"padding":return Ca.interpolate(M,P,E);case"colorArray":return Qa.interpolate(M,P,E);case"numberArray":return Ma.interpolate(M,P,E);case"variableAnchorOffsetCollection":return va.interpolate(M,P,E);case"array":return qo(M,P,E);case"projectionDefinition":return nn.interpolate(M,P,E)}case"interpolate-hcl":switch(this.type.kind){case"color":return xi.interpolate(M,P,E,"hcl");case"colorArray":return Qa.interpolate(M,P,E,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return xi.interpolate(M,P,E,"lab");case"colorArray":return Qa.interpolate(M,P,E,"lab")}}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Pl(o,t,s,l){const m=l-s,b=o-s;return m===0?0:t===1?b/m:(Math.pow(t,b)-1)/(Math.pow(t,m)-1)}const rs={color:xi.interpolate,number:fn,padding:Ca.interpolate,numberArray:Ma.interpolate,colorArray:Qa.interpolate,variableAnchorOffsetCollection:va.interpolate,array:qo};class Wo{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l=null;const m=s.expectedType;m&&m.kind!=="value"&&(l=m);const b=[];for(const E of t.slice(1)){const M=s.parse(E,1+b.length,l,void 0,{typeAnnotation:"omit"});if(!M)return null;l=l||M.type,b.push(M)}if(!l)throw new Error("No output type");const v=m&&b.some(E=>Yn(m,E.type));return new Wo(v?Ut:l,b)}evaluate(t){let s,l=null,m=0;for(const b of this.args)if(m++,l=b.evaluate(t),l&&l instanceof kn&&!l.available&&(s||(s=l.name),l=null,m===this.args.length&&(l=s)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Jo(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Cr(o,t,s,l){return l.compare(t,s)===0}function eu(o,t,s){const l=o!=="=="&&o!=="!=";return class X_{constructor(b,v,E){this.type=Xt,this.lhs=b,this.rhs=v,this.collator=E,this.hasUntypedArgument=b.type.kind==="value"||v.type.kind==="value"}static parse(b,v){if(b.length!==3&&b.length!==4)return v.error("Expected two or three arguments.");const E=b[0];let M=v.parse(b[1],1,Ut);if(!M)return null;if(!Jo(E,M.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Yi(M.type)}'.`);let P=v.parse(b[2],2,Ut);if(!P)return null;if(!Jo(E,P.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Yi(P.type)}'.`);if(M.type.kind!==P.type.kind&&M.type.kind!=="value"&&P.type.kind!=="value")return v.error(`Cannot compare types '${Yi(M.type)}' and '${Yi(P.type)}'.`);l&&(M.type.kind==="value"&&P.type.kind!=="value"?M=new oi(P.type,[M]):M.type.kind!=="value"&&P.type.kind==="value"&&(P=new oi(M.type,[P])));let N=null;if(b.length===4){if(M.type.kind!=="string"&&P.type.kind!=="string"&&M.type.kind!=="value"&&P.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(N=v.parse(b[3],3,Fo),!N)return null}return new X_(M,P,N)}evaluate(b){const v=this.lhs.evaluate(b),E=this.rhs.evaluate(b);if(l&&this.hasUntypedArgument){const M=ra(v),P=ra(E);if(M.kind!==P.kind||M.kind!=="string"&&M.kind!=="number")throw new Ji(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${P.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const M=ra(v),P=ra(E);if(M.kind!=="string"||P.kind!=="string")return t(b,v,E)}return this.collator?s(b,v,E,this.collator.evaluate(b)):t(b,v,E)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Ec=eu("==",function(o,t,s){return t===s},Cr),Ad=eu("!=",function(o,t,s){return t!==s},function(o,t,s,l){return!Cr(0,t,s,l)}),Ah=eu("<",function(o,t,s){return t<s},function(o,t,s,l){return l.compare(t,s)<0}),Hf=eu(">",function(o,t,s){return t>s},function(o,t,s,l){return l.compare(t,s)>0}),jf=eu("<=",function(o,t,s){return t<=s},function(o,t,s,l){return l.compare(t,s)<=0}),qf=eu(">=",function(o,t,s){return t>=s},function(o,t,s,l){return l.compare(t,s)>=0});class wc{constructor(t,s,l){this.type=Fo,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const m=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Xt);if(!m)return null;const b=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Xt);if(!b)return null;let v=null;return l.locale&&(v=s.parse(l.locale,1,qt),!v)?null:new wc(m,b,v)}evaluate(t){return new mo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Hu{constructor(t,s,l,m,b){this.type=qt,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const l=s.parse(t[1],1,it);if(!l)return null;const m=t[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=s.parse(m.locale,1,qt),!b))return null;let v=null;if(m.currency&&(v=s.parse(m.currency,1,qt),!v))return null;let E=null;if(m["min-fraction-digits"]&&(E=s.parse(m["min-fraction-digits"],1,it),!E))return null;let M=null;return m["max-fraction-digits"]&&(M=s.parse(m["max-fraction-digits"],1,it),!M)?null:new Hu(l,b,v,E,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ac{constructor(t){this.type=Ou,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const m=[];let b=!1;for(let v=1;v<=t.length-1;++v){const E=t[v];if(b&&typeof E=="object"&&!Array.isArray(E)){b=!1;let M=null;if(E["font-scale"]&&(M=s.parse(E["font-scale"],1,it),!M))return null;let P=null;if(E["text-font"]&&(P=s.parse(E["text-font"],1,lr(qt)),!P))return null;let N=null;if(E["text-color"]&&(N=s.parse(E["text-color"],1,Zi),!N))return null;let B=null;if(E["vertical-align"]){if(typeof E["vertical-align"]=="string"&&!Vo.includes(E["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${E["vertical-align"]}' instead.`);if(B=s.parse(E["vertical-align"],1,qt),!B)return null}const U=m[m.length-1];U.scale=M,U.font=P,U.textColor=N,U.verticalAlign=B}else{const M=s.parse(t[v],1,Ut);if(!M)return null;const P=M.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ac(m)}evaluate(t){return new Xa(this.sections.map(s=>{const l=s.content.evaluate(t);return ra(l)===lo?new go("",l,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(t):null):new go(mi(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null,s.verticalAlign?s.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor),s.verticalAlign&&t(s.verticalAlign)}outputDefined(){return!1}}class Sc{constructor(t){this.type=lo,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const l=s.parse(t[1],1,qt);return l?new Sc(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=kn.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Cc{constructor(t){this.type=it,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Yi(l.type)} instead.`):new Cc(l):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Ji(`Expected value to be of type string or array, but found ${Yi(ra(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Mr=8192;function ju(o,t){const s=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(s*m*Mr),Math.round(l*m*Mr)]}function Sh(o,t){const s=Math.pow(2,t.z);return[(m=(o[0]/Mr+t.x)/s,360*m-180),(l=(o[1]/Mr+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,m}function qu(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function Vu(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Sd(o,t,s){const l=o[0]-t[0],m=o[1]-t[1],b=o[0]-s[0],v=o[1]-s[1];return l*v-b*m==0&&l*b<=0&&m*v<=0}function Ll(o,t,s,l){return(m=[l[0]-s[0],l[1]-s[1]])[0]*(b=[t[0]-o[0],t[1]-o[1]])[1]-m[1]*b[0]!=0&&!(!Mh(o,t,s,l)||!Mh(s,l,o,t));var m,b}function Ch(o,t,s){for(const l of s)for(let m=0;m<l.length-1;++m)if(Ll(o,t,l[m],l[m+1]))return!0;return!1}function Ir(o,t,s=!1){let l=!1;for(const E of t)for(let M=0;M<E.length-1;M++){if(Sd(o,E[M],E[M+1]))return s;(b=E[M])[1]>(m=o)[1]!=(v=E[M+1])[1]>m[1]&&m[0]<(v[0]-b[0])*(m[1]-b[1])/(v[1]-b[1])+b[0]&&(l=!l)}var m,b,v;return l}function Cd(o,t){for(const s of t)if(Ir(o,s))return!0;return!1}function Md(o,t){for(const s of o)if(!Ir(s,t))return!1;for(let s=0;s<o.length-1;++s)if(Ch(o[s],o[s+1],t))return!1;return!0}function Vf(o,t){for(const s of t)if(Md(o,s))return!0;return!1}function Mh(o,t,s,l){const m=l[0]-s[0],b=l[1]-s[1],v=(o[0]-s[0])*b-m*(o[1]-s[1]),E=(t[0]-s[0])*b-m*(t[1]-s[1]);return v>0&&E<0||v<0&&E>0}function Gu(o,t,s){const l=[];for(let m=0;m<o.length;m++){const b=[];for(let v=0;v<o[m].length;v++){const E=ju(o[m][v],s);qu(t,E),b.push(E)}l.push(b)}return l}function Zu(o,t,s){const l=[];for(let m=0;m<o.length;m++){const b=Gu(o[m],t,s);l.push(b)}return l}function Yu(o,t,s,l){if(o[0]<s[0]||o[0]>s[2]){const m=.5*l;let b=o[0]-s[0]>m?-l:s[0]-o[0]>m?l:0;b===0&&(b=o[0]-s[2]>m?-l:s[2]-o[0]>m?l:0),o[0]+=b}qu(t,o)}function Id(o,t,s,l){const m=Math.pow(2,l.z)*Mr,b=[l.x*Mr,l.y*Mr],v=[];for(const E of o)for(const M of E){const P=[M.x+b[0],M.y+b[1]];Yu(P,t,s,m),v.push(P)}return v}function $u(o,t,s,l){const m=Math.pow(2,l.z)*Mr,b=[l.x*Mr,l.y*Mr],v=[];for(const M of o){const P=[];for(const N of M){const B=[N.x+b[0],N.y+b[1]];qu(t,B),P.push(B)}v.push(P)}if(t[2]-t[0]<=m/2){(E=t)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const M of v)for(const P of M)Yu(P,t,s,m)}var E;return v}class Ls{constructor(t,s){this.type=Xt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ni(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const m=[];for(const b of l.features){const{type:v,coordinates:E}=b.geometry;v==="Polygon"&&m.push(E),v==="MultiPolygon"&&m.push(...E)}if(m.length)return new Ls(l,{type:"MultiPolygon",coordinates:m})}else if(l.type==="Feature"){const m=l.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ls(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ls(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const E=Gu(l.coordinates,b,v),M=Id(s.geometry(),m,b,v);if(!Vu(m,b))return!1;for(const P of M)if(!Ir(P,E))return!1}if(l.type==="MultiPolygon"){const E=Zu(l.coordinates,b,v),M=Id(s.geometry(),m,b,v);if(!Vu(m,b))return!1;for(const P of M)if(!Cd(P,E))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const E=Gu(l.coordinates,b,v),M=$u(s.geometry(),m,b,v);if(!Vu(m,b))return!1;for(const P of M)if(!Md(P,E))return!1}if(l.type==="MultiPolygon"){const E=Zu(l.coordinates,b,v),M=$u(s.geometry(),m,b,v);if(!Vu(m,b))return!1;for(const P of M)if(!Vf(P,E))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ih=class{constructor(o=[],t=(s,l)=>s<l?-1:s>l?1:0){if(this.data=o,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:t,compare:s}=this,l=t[o];for(;o>0;){const m=o-1>>1,b=t[m];if(s(l,b)>=0)break;t[o]=b,o=m}t[o]=l}_down(o){const{data:t,compare:s}=this,l=this.length>>1,m=t[o];for(;o<l;){let b=1+(o<<1);const v=b+1;if(v<this.length&&s(t[v],t[b])<0&&(b=v),s(t[b],m)>=0)break;t[o]=t[b],o=b}t[o]=m}};function Mc(o,t,s=0,l=o.length-1,m=Dh){for(;l>s;){if(l-s>600){const M=l-s+1,P=t-s+1,N=Math.log(M),B=.5*Math.exp(2*N/3),U=.5*Math.sqrt(N*B*(M-B)/M)*(P-M/2<0?-1:1);Mc(o,t,Math.max(s,Math.floor(t-P*B/M+U)),Math.min(l,Math.floor(t+(M-P)*B/M+U)),m)}const b=o[t];let v=s,E=l;for(bo(o,s,t),m(o[l],b)>0&&bo(o,s,l);v<E;){for(bo(o,v,E),v++,E--;m(o[v],b)<0;)v++;for(;m(o[E],b)>0;)E--}m(o[s],b)===0?bo(o,s,E):(E++,bo(o,E,l)),E<=t&&(s=E+1),t<=E&&(l=E-1)}}function bo(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}function Dh(o,t){return o<t?-1:o>t?1:0}function Ol(o,t){if(o.length<=1)return[o];const s=[];let l,m;for(const b of o){const v=Gf(b);v!==0&&(b.area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(l&&s.push(l),l=[b]):l.push(b))}if(l&&s.push(l),t>1)for(let b=0;b<s.length;b++)s[b].length<=t||(Mc(s[b],t,1,s[b].length-1,Dd),s[b]=s[b].slice(0,t));return s}function Dd(o,t){return t.area-o.area}function Gf(o){let t=0;for(let s,l,m=0,b=o.length,v=b-1;m<b;v=m++)s=o[m],l=o[v],t+=(l.x-s.x)*(s.y+l.y);return t}const Rh=1/298.257223563,Rd=Rh*(2-Rh),Pd=Math.PI/180;class Ph{constructor(t){const s=6378.137*Pd*1e3,l=Math.cos(t*Pd),m=1/(1-Rd*(1-l*l)),b=Math.sqrt(m);this.kx=s*b*l,this.ky=s*b*m*(1-Rd)}distance(t,s){const l=this.wrap(t[0]-s[0])*this.kx,m=(t[1]-s[1])*this.ky;return Math.sqrt(l*l+m*m)}pointOnLine(t,s){let l,m,b,v,E=1/0;for(let M=0;M<t.length-1;M++){let P=t[M][0],N=t[M][1],B=this.wrap(t[M+1][0]-P)*this.kx,U=(t[M+1][1]-N)*this.ky,j=0;B===0&&U===0||(j=(this.wrap(s[0]-P)*this.kx*B+(s[1]-N)*this.ky*U)/(B*B+U*U),j>1?(P=t[M+1][0],N=t[M+1][1]):j>0&&(P+=B/this.kx*j,N+=U/this.ky*j)),B=this.wrap(s[0]-P)*this.kx,U=(s[1]-N)*this.ky;const V=B*B+U*U;V<E&&(E=V,l=P,m=N,b=M,v=j)}return{point:[l,m],index:b,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qn(o,t){return t[0]-o[0]}function gi(o){return o[1]-o[0]+1}function ss(o,t){return o[1]>=o[0]&&o[1]<t}function Ic(o,t){if(o[0]>o[1])return[null,null];const s=gi(o);if(t){if(s===2)return[o,null];const m=Math.floor(s/2);return[[o[0],o[0]+m],[o[0]+m,o[1]]]}if(s===1)return[o,null];const l=Math.floor(s/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}function Dc(o,t){if(!ss(t,o.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)qu(s,o[l]);return s}function Rc(o){const t=[1/0,1/0,-1/0,-1/0];for(const s of o)for(const l of s)qu(t,l);return t}function Pc(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Lh(o,t,s){if(!Pc(o)||!Pc(t))return NaN;let l=0,m=0;return o[2]<t[0]&&(l=t[0]-o[2]),o[0]>t[2]&&(l=o[0]-t[2]),o[1]>t[3]&&(m=o[1]-t[3]),o[3]<t[1]&&(m=t[1]-o[3]),s.distance([0,0],[l,m])}function Dr(o,t,s){const l=s.pointOnLine(t,o);return s.distance(o,l.point)}function Nl(o,t,s,l,m){const b=Math.min(Dr(o,[s,l],m),Dr(t,[s,l],m)),v=Math.min(Dr(s,[o,t],m),Dr(l,[o,t],m));return Math.min(b,v)}function kl(o,t,s,l,m){if(!ss(t,o.length)||!ss(l,s.length))return 1/0;let b=1/0;for(let v=t[0];v<t[1];++v){const E=o[v],M=o[v+1];for(let P=l[0];P<l[1];++P){const N=s[P],B=s[P+1];if(Ll(E,M,N,B))return 0;b=Math.min(b,Nl(E,M,N,B,m))}}return b}function Oh(o,t,s,l,m){if(!ss(t,o.length)||!ss(l,s.length))return NaN;let b=1/0;for(let v=t[0];v<=t[1];++v)for(let E=l[0];E<=l[1];++E)if(b=Math.min(b,m.distance(o[v],s[E])),b===0)return b;return b}function Ld(o,t,s){if(Ir(o,t,!0))return 0;let l=1/0;for(const m of t){const b=m[0],v=m[m.length-1];if(b!==v&&(l=Math.min(l,Dr(o,[v,b],s)),l===0))return l;const E=s.pointOnLine(m,o);if(l=Math.min(l,s.distance(o,E.point)),l===0)return l}return l}function tu(o,t,s,l){if(!ss(t,o.length))return NaN;for(let b=t[0];b<=t[1];++b)if(Ir(o[b],s,!0))return 0;let m=1/0;for(let b=t[0];b<t[1];++b){const v=o[b],E=o[b+1];for(const M of s)for(let P=0,N=M.length,B=N-1;P<N;B=P++){const U=M[B],j=M[P];if(Ll(v,E,U,j))return 0;m=Math.min(m,Nl(v,E,U,j,l))}}return m}function iu(o,t){for(const s of o)for(const l of s)if(Ir(l,t,!0))return!0;return!1}function Nh(o,t,s,l=1/0){const m=Rc(o),b=Rc(t);if(l!==1/0&&Lh(m,b,s)>=l)return l;if(Vu(m,b)){if(iu(o,t))return 0}else if(iu(t,o))return 0;let v=1/0;for(const E of o)for(let M=0,P=E.length,N=P-1;M<P;N=M++){const B=E[N],U=E[M];for(const j of t)for(let V=0,$=j.length,ee=$-1;V<$;ee=V++){const oe=j[ee],ve=j[V];if(Ll(B,U,oe,ve))return 0;v=Math.min(v,Nl(B,U,oe,ve,s))}}return v}function kh(o,t,s,l,m,b){if(!b)return;const v=Lh(Dc(l,b),m,s);v<t&&o.push([v,b,[0,0]])}function os(o,t,s,l,m,b,v){if(!b||!v)return;const E=Lh(Dc(l,b),Dc(m,v),s);E<t&&o.push([E,b,v])}function Bl(o,t,s,l,m=1/0){let b=Math.min(l.distance(o[0],s[0][0]),m);if(b===0)return b;const v=new Ih([[0,[0,o.length-1],[0,0]]],Qn),E=Rc(s);for(;v.length>0;){const M=v.pop();if(M[0]>=b)continue;const P=M[1],N=t?50:100;if(gi(P)<=N){if(!ss(P,o.length))return NaN;if(t){const B=tu(o,P,s,l);if(isNaN(B)||B===0)return B;b=Math.min(b,B)}else for(let B=P[0];B<=P[1];++B){const U=Ld(o[B],s,l);if(b=Math.min(b,U),b===0)return 0}}else{const B=Ic(P,t);kh(v,b,l,o,E,B[0]),kh(v,b,l,o,E,B[1])}}return b}function zl(o,t,s,l,m,b=1/0){let v=Math.min(b,m.distance(o[0],s[0]));if(v===0)return v;const E=new Ih([[0,[0,o.length-1],[0,s.length-1]]],Qn);for(;E.length>0;){const M=E.pop();if(M[0]>=v)continue;const P=M[1],N=M[2],B=t?50:100,U=l?50:100;if(gi(P)<=B&&gi(N)<=U){if(!ss(P,o.length)&&ss(N,s.length))return NaN;let j;if(t&&l)j=kl(o,P,s,N,m),v=Math.min(v,j);else if(t&&!l){const V=o.slice(P[0],P[1]+1);for(let $=N[0];$<=N[1];++$)if(j=Dr(s[$],V,m),v=Math.min(v,j),v===0)return v}else if(!t&&l){const V=s.slice(N[0],N[1]+1);for(let $=P[0];$<=P[1];++$)if(j=Dr(o[$],V,m),v=Math.min(v,j),v===0)return v}else j=Oh(o,P,s,N,m),v=Math.min(v,j)}else{const j=Ic(P,t),V=Ic(N,l);os(E,v,m,o,s,j[0],V[0]),os(E,v,m,o,s,j[0],V[1]),os(E,v,m,o,s,j[1],V[0]),os(E,v,m,o,s,j[1],V[1])}}return v}function Lc(o){return o.type==="MultiPolygon"?o.coordinates.map(t=>({type:"Polygon",coordinates:t})):o.type==="MultiLineString"?o.coordinates.map(t=>({type:"LineString",coordinates:t})):o.type==="MultiPoint"?o.coordinates.map(t=>({type:"Point",coordinates:t})):[o]}class au{constructor(t,s){this.type=it,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ni(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new au(l,l.features.map(m=>Lc(m.geometry)).flat());if(l.type==="Feature")return new au(l,Lc(l.geometry));if("type"in l&&"coordinates"in l)return new au(l,Lc(l))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const m=s.geometry(),b=m.flat().map(M=>Sh([M.x,M.y],s.canonical));if(m.length===0)return NaN;const v=new Ph(b[0][1]);let E=1/0;for(const M of l){switch(M.type){case"Point":E=Math.min(E,zl(b,!1,[M.coordinates],!1,v,E));break;case"LineString":E=Math.min(E,zl(b,!1,M.coordinates,!0,v,E));break;case"Polygon":E=Math.min(E,Bl(b,!1,M.coordinates,v,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const m=s.geometry(),b=m.flat().map(M=>Sh([M.x,M.y],s.canonical));if(m.length===0)return NaN;const v=new Ph(b[0][1]);let E=1/0;for(const M of l){switch(M.type){case"Point":E=Math.min(E,zl(b,!0,[M.coordinates],!1,v,E));break;case"LineString":E=Math.min(E,zl(b,!0,M.coordinates,!0,v,E));break;case"Polygon":E=Math.min(E,Bl(b,!0,M.coordinates,v,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,l){const m=s.geometry();if(m.length===0||m[0].length===0)return NaN;const b=Ol(m,0).map(M=>M.map(P=>P.map(N=>Sh([N.x,N.y],s.canonical)))),v=new Ph(b[0][0][0][1]);let E=1/0;for(const M of l)for(const P of b){switch(M.type){case"Point":E=Math.min(E,Bl([M.coordinates],!1,P,v,E));break;case"LineString":E=Math.min(E,Bl(M.coordinates,!0,P,v,E));break;case"Polygon":E=Math.min(E,Nh(P,M.coordinates,v,E))}if(E===0)return E}return E}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Oc{constructor(t){this.type=Ut,this.key=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=t[1];return l==null?s.error("Global state property must be defined."):typeof l!="string"?s.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Oc(l)}evaluate(t){var s;const l=(s=t.globals)===null||s===void 0?void 0:s.globalState;return l&&Object.keys(l).length!==0?Bu(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Xu={"==":Ec,"!=":Ad,">":Hf,"<":Ah,">=":qf,"<=":jf,array:oi,at:Yo,boolean:oi,case:rn,coalesce:Wo,collator:wc,format:Ac,image:Sc,in:$o,"index-of":Uu,interpolate:vn,"interpolate-hcl":vn,"interpolate-lab":vn,length:Cc,let:_o,literal:Qt,match:Xo,number:oi,"number-format":Hu,object:oi,slice:Qo,step:yo,string:oi,"to-boolean":Ia,"to-color":Ia,"to-number":Ia,"to-string":Ia,var:Zo,within:Ls,distance:au,"global-state":Oc};class hr{constructor(t,s,l,m){this.name=t,this.type=s,this._evaluate=l,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const l=t[0],m=hr.definitions[l];if(!m)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,v=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,E=v.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let M=null;for(const[P,N]of E){M=new Rl(s.registry,Bn,s.path,null,s.scope);const B=[];let U=!1;for(let j=1;j<t.length;j++){const V=t[j],$=Array.isArray(P)?P[j-1]:P.type,ee=M.parse(V,1+B.length,$);if(!ee){U=!0;break}B.push(ee)}if(!U)if(Array.isArray(P)&&P.length!==B.length)M.error(`Expected ${P.length} arguments, but found ${B.length} instead.`);else{for(let j=0;j<B.length;j++){const V=Array.isArray(P)?P[j]:P.type,$=B[j];M.concat(j+1).checkSubtype(V,$.type)}if(M.errors.length===0)return new hr(l,b,N,B)}}if(E.length===1)s.errors.push(...M.errors);else{const P=(E.length?E:v).map(([B])=>{return U=B,Array.isArray(U)?`(${U.map(Yi).join(", ")})`:`(${Yi(U.type)}...)`;var U}).join(" | "),N=[];for(let B=1;B<t.length;B++){const U=s.parse(t[B],1+N.length);if(!U)return null;N.push(Yi(U.type))}s.error(`Expected arguments of type ${P}, but found (${N.join(", ")}) instead.`)}return null}static register(t,s){hr.definitions=s;for(const l in s)t[l]=hr}}function Bh(o,[t,s,l,m]){t=t.evaluate(o),s=s.evaluate(o),l=l.evaluate(o);const b=m?m.evaluate(o):1,v=Sr(t,s,l,b);if(v)throw new Ji(v);return new xi(t/255,s/255,l/255,b,!1)}function Nc(o,t){return o in t}function dr(o,t){const s=t[o];return s===void 0?null:s}function xo(o){return{type:o}}function Bn(o){if(o instanceof Zo)return Bn(o.boundExpression);if(o instanceof hr&&o.name==="error"||o instanceof wc||o instanceof Ls||o instanceof au||o instanceof Oc)return!1;const t=o instanceof Ia||o instanceof oi;let s=!0;return o.eachChild(l=>{s=t?s&&Bn(l):s&&l instanceof Qt}),!!s&&zn(o)&&Qu(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zn(o){if(o instanceof hr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ls||o instanceof au)return!1;let t=!0;return o.eachChild(s=>{t&&!zn(s)&&(t=!1)}),t}function us(o){if(o instanceof hr&&o.name==="feature-state")return!1;let t=!0;return o.eachChild(s=>{t&&!us(s)&&(t=!1)}),t}function Qu(o,t){if(o instanceof hr&&t.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(l=>{s&&!Qu(l,t)&&(s=!1)}),s}function nu(o){return{result:"success",value:o}}function Os(o){return{result:"error",value:o}}function vo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function ru(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Fl(o){return!!o.expression&&o.expression.interpolated}function di(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Ns(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&ra(o)===$a}function kc(o){return o}function Fn(o,t){const s=o.stops&&typeof o.stops[0][0]=="object",l=s||!(s||o.property!==void 0),m=o.type||(Fl(t)?"exponential":"interval"),b=function(N){switch(N.type){case"color":return xi.parse;case"padding":return Ca.parse;case"numberArray":return Ma.parse;case"colorArray":return Qa.parse;default:return null}}(t);if(b&&((o=Ci({},o)).stops&&(o.stops=o.stops.map(N=>[N[0],b(N[1])])),o.default=b(o.default?o.default:t.default)),o.colorSpace&&(v=o.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var v;const E=function(N){switch(N){case"exponential":return Ul;case"interval":return Od;case"categorical":return ks;case"identity":return ou;default:throw new Error(`Unknown function type "${N}"`)}}(m);let M,P;if(m==="categorical"){M=Object.create(null);for(const N of o.stops)M[N[0]]=N[1];P=typeof o.stops[0][0]}if(s){const N={},B=[];for(let V=0;V<o.stops.length;V++){const $=o.stops[V],ee=$[0].zoom;N[ee]===void 0&&(N[ee]={zoom:ee,type:o.type,property:o.property,default:o.default,stops:[]},B.push(ee)),N[ee].stops.push([$[0].value,$[1]])}const U=[];for(const V of B)U.push([N[V].zoom,Fn(N[V],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:vn.interpolationFactor.bind(void 0,j),zoomStops:U.map(V=>V[0]),evaluate:({zoom:V},$)=>Ul({stops:U,base:o.base},t,V).evaluate(V,$)}}if(l){const N=m==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:vn.interpolationFactor.bind(void 0,N),zoomStops:o.stops.map(B=>B[0]),evaluate:({zoom:B})=>E(o,t,B,M,P)}}return{kind:"source",evaluate(N,B){const U=B&&B.properties?B.properties[o.property]:void 0;return U===void 0?su(o.default,t.default):E(o,t,U,M,P)}}}function su(o,t,s){return o!==void 0?o:t!==void 0?t:s!==void 0?s:void 0}function ks(o,t,s,l,m){return su(typeof s===m?l[s]:void 0,o.default,t.default)}function Od(o,t,s){if(di(s)!=="number")return su(o.default,t.default);const l=o.stops.length;if(l===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[l-1][0])return o.stops[l-1][1];const m=Ko(o.stops.map(b=>b[0]),s);return o.stops[m][1]}function Ul(o,t,s){const l=o.base!==void 0?o.base:1;if(di(s)!=="number")return su(o.default,t.default);const m=o.stops.length;if(m===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[m-1][0])return o.stops[m-1][1];const b=Ko(o.stops.map(N=>N[0]),s),v=function(N,B,U,j){const V=j-U,$=N-U;return V===0?0:B===1?$/V:(Math.pow(B,$)-1)/(Math.pow(B,V)-1)}(s,l,o.stops[b][0],o.stops[b+1][0]),E=o.stops[b][1],M=o.stops[b+1][1],P=rs[t.type]||kc;return typeof E.evaluate=="function"?{evaluate(...N){const B=E.evaluate.apply(void 0,N),U=M.evaluate.apply(void 0,N);if(B!==void 0&&U!==void 0)return P(B,U,v,o.colorSpace)}}:P(E,M,v,o.colorSpace)}function ou(o,t,s){switch(t.type){case"color":s=xi.parse(s);break;case"formatted":s=Xa.fromString(s.toString());break;case"resolvedImage":s=kn.fromString(s.toString());break;case"padding":s=Ca.parse(s);break;case"colorArray":s=Qa.parse(s);break;case"numberArray":s=Ma.parse(s);break;default:di(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return su(s,o.default,t.default)}hr.register(Xu,{error:[{kind:"error"},[qt],(o,[t])=>{throw new Ji(t.evaluate(o))}],typeof:[qt,[Ut],(o,[t])=>Yi(ra(t.evaluate(o)))],"to-rgba":[lr(it,4),[Zi],(o,[t])=>{const[s,l,m,b]=t.evaluate(o).rgb;return[255*s,255*l,255*m,b]}],rgb:[Zi,[it,it,it],Bh],rgba:[Zi,[it,it,it,it],Bh],has:{type:Xt,overloads:[[[qt],(o,[t])=>Nc(t.evaluate(o),o.properties())],[[qt,$a],(o,[t,s])=>Nc(t.evaluate(o),s.evaluate(o))]]},get:{type:Ut,overloads:[[[qt],(o,[t])=>dr(t.evaluate(o),o.properties())],[[qt,$a],(o,[t,s])=>dr(t.evaluate(o),s.evaluate(o))]]},"feature-state":[Ut,[qt],(o,[t])=>dr(t.evaluate(o),o.featureState||{})],properties:[$a,[],o=>o.properties()],"geometry-type":[qt,[],o=>o.geometryType()],id:[Ut,[],o=>o.id()],zoom:[it,[],o=>o.globals.zoom],"heatmap-density":[it,[],o=>o.globals.heatmapDensity||0],"line-progress":[it,[],o=>o.globals.lineProgress||0],accumulated:[Ut,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[it,xo(it),(o,t)=>{let s=0;for(const l of t)s+=l.evaluate(o);return s}],"*":[it,xo(it),(o,t)=>{let s=1;for(const l of t)s*=l.evaluate(o);return s}],"-":{type:it,overloads:[[[it,it],(o,[t,s])=>t.evaluate(o)-s.evaluate(o)],[[it],(o,[t])=>-t.evaluate(o)]]},"/":[it,[it,it],(o,[t,s])=>t.evaluate(o)/s.evaluate(o)],"%":[it,[it,it],(o,[t,s])=>t.evaluate(o)%s.evaluate(o)],ln2:[it,[],()=>Math.LN2],pi:[it,[],()=>Math.PI],e:[it,[],()=>Math.E],"^":[it,[it,it],(o,[t,s])=>Math.pow(t.evaluate(o),s.evaluate(o))],sqrt:[it,[it],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[it,[it],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[it,[it],(o,[t])=>Math.log(t.evaluate(o))],log2:[it,[it],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[it,[it],(o,[t])=>Math.sin(t.evaluate(o))],cos:[it,[it],(o,[t])=>Math.cos(t.evaluate(o))],tan:[it,[it],(o,[t])=>Math.tan(t.evaluate(o))],asin:[it,[it],(o,[t])=>Math.asin(t.evaluate(o))],acos:[it,[it],(o,[t])=>Math.acos(t.evaluate(o))],atan:[it,[it],(o,[t])=>Math.atan(t.evaluate(o))],min:[it,xo(it),(o,t)=>Math.min(...t.map(s=>s.evaluate(o)))],max:[it,xo(it),(o,t)=>Math.max(...t.map(s=>s.evaluate(o)))],abs:[it,[it],(o,[t])=>Math.abs(t.evaluate(o))],round:[it,[it],(o,[t])=>{const s=t.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[it,[it],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[it,[it],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[Xt,[qt,Ut],(o,[t,s])=>o.properties()[t.value]===s.value],"filter-id-==":[Xt,[Ut],(o,[t])=>o.id()===t.value],"filter-type-==":[Xt,[qt],(o,[t])=>o.geometryType()===t.value],"filter-<":[Xt,[qt,Ut],(o,[t,s])=>{const l=o.properties()[t.value],m=s.value;return typeof l==typeof m&&l<m}],"filter-id-<":[Xt,[Ut],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[Xt,[qt,Ut],(o,[t,s])=>{const l=o.properties()[t.value],m=s.value;return typeof l==typeof m&&l>m}],"filter-id->":[Xt,[Ut],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[Xt,[qt,Ut],(o,[t,s])=>{const l=o.properties()[t.value],m=s.value;return typeof l==typeof m&&l<=m}],"filter-id-<=":[Xt,[Ut],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[Xt,[qt,Ut],(o,[t,s])=>{const l=o.properties()[t.value],m=s.value;return typeof l==typeof m&&l>=m}],"filter-id->=":[Xt,[Ut],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[Xt,[Ut],(o,[t])=>t.value in o.properties()],"filter-has-id":[Xt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Xt,[lr(qt)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[Xt,[lr(Ut)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[Xt,[qt,lr(Ut)],(o,[t,s])=>s.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[Xt,[qt,lr(Ut)],(o,[t,s])=>function(l,m,b,v){for(;b<=v;){const E=b+v>>1;if(m[E]===l)return!0;m[E]>l?v=E-1:b=E+1}return!1}(o.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Xt,overloads:[[[Xt,Xt],(o,[t,s])=>t.evaluate(o)&&s.evaluate(o)],[xo(Xt),(o,t)=>{for(const s of t)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],(o,[t,s])=>t.evaluate(o)||s.evaluate(o)],[xo(Xt),(o,t)=>{for(const s of t)if(s.evaluate(o))return!0;return!1}]]},"!":[Xt,[Xt],(o,[t])=>!t.evaluate(o)],"is-supported-script":[Xt,[qt],(o,[t])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(t.evaluate(o))}],upcase:[qt,[qt],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[qt,[qt],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[qt,xo(Ut),(o,t)=>t.map(s=>mi(s.evaluate(o))).join("")],"resolved-locale":[qt,[Fo],(o,[t])=>t.evaluate(o).resolvedLocale()]});class Ku{constructor(t,s){this.expression=t,this._warningHistory={},this._evaluator=new Go,this._defaultValue=s?function(l){if(l.type==="color"&&Ns(l.default))return new xi(0,0,0,0);switch(l.type){case"color":return xi.parse(l.default)||null;case"padding":return Ca.parse(l.default)||null;case"numberArray":return Ma.parse(l.default)||null;case"colorArray":return Qa.parse(l.default)||null;case"variableAnchorOffsetCollection":return va.parse(l.default)||null;case"projectionDefinition":return nn.parse(l.default)||null;default:return l.default===void 0?null:l.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,l,m,b,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,m,b,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function uu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Xu}function Bs(o,t){const s=new Rl(Xu,Bn,[],t?function(m){const b={color:Zi,string:qt,number:it,enum:qt,boolean:Xt,formatted:Ou,padding:ur,numberArray:Rs,colorArray:as,projectionDefinition:Wi,resolvedImage:lo,variableAnchorOffsetCollection:Sa};return m.type==="array"?lr(b[m.value]||Ut,m.length):b[m.type]}(t):void 0),l=s.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?nu(new Ku(l,t)):Os(s.errors)}class To{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!us(s.expression)}evaluateWithoutErrorHandling(t,s,l,m,b,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,m,b,v)}evaluate(t,s,l,m,b,v){return this._styleExpression.evaluate(t,s,l,m,b,v)}}class lu{constructor(t,s,l,m){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!us(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,s,l,m,b,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,m,b,v)}evaluate(t,s,l,m,b,v){return this._styleExpression.evaluate(t,s,l,m,b,v)}interpolationFactor(t,s,l){return this.interpolationType?vn.interpolationFactor(this.interpolationType,t,s,l):0}}function Wu(o,t){const s=Bs(o,t);if(s.result==="error")return s;const l=s.value.expression,m=zn(l);if(!m&&!vo(t))return Os([new bi("","data expressions not supported")]);const b=Qu(l,["zoom"]);if(!b&&!ru(t))return Os([new bi("","zoom expressions not supported")]);const v=En(l);return v||b?v instanceof bi?Os([v]):v instanceof vn&&!Fl(t)?Os([new bi("",'"interpolate" expressions cannot be used with this property')]):nu(v?new lu(m?"camera":"composite",s.value,v.labels,v instanceof vn?v.interpolation:void 0):new To(m?"constant":"source",s.value)):Os([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tn{constructor(t,s){this._parameters=t,this._specification=s,Ci(this,Fn(this._parameters,this._specification))}static deserialize(t){return new Tn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function En(o){let t=null;if(o instanceof _o)t=En(o.result);else if(o instanceof Wo){for(const s of o.args)if(t=En(s),t)break}else(o instanceof yo||o instanceof vn)&&o.input instanceof hr&&o.input.name==="zoom"&&(t=o);return t instanceof bi||o.eachChild(s=>{const l=En(s);l instanceof bi?t=l:!t&&l?t=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Fr(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!Fr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ur={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fr(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Fr(o)||(o=Ju(o));const t=Bs(o,Ur);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,l,m)=>t.value.evaluate(s,l,{},m),needGeometry:zh(o)}}function ls(o,t){return o<t?-1:o>t?1:0}function zh(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let t=1;t<o.length;t++)if(zh(o[t]))return!0;return!1}function Ju(o){if(!o)return!0;const t=o[0];return o.length<=1?t!=="any":t==="=="?Hl(o[1],o[2],"=="):t==="!="?Ii(Hl(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Hl(o[1],o[2],t):t==="any"?(s=o.slice(1),["any"].concat(s.map(Ju))):t==="all"?["all"].concat(o.slice(1).map(Ju)):t==="none"?["all"].concat(o.slice(1).map(Ju).map(Ii)):t==="in"?wn(o[1],o.slice(2)):t==="!in"?Ii(wn(o[1],o.slice(2))):t==="has"?Ta(o[1]):t!=="!has"||Ii(Ta(o[1]));var s}function Hl(o,t,s){switch(o){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,o,t]}}function wn(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",o,["literal",t.sort(ls)]]:["filter-in-small",o,["literal",t]]}}function Ta(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ii(o){return["!",o]}function cs(o){const t=typeof o;if(t==="number"||t==="boolean"||t==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let m="[";for(const b of o)m+=`${cs(b)},`;return`${m}]`}const s=Object.keys(o).sort();let l="{";for(let m=0;m<s.length;m++)l+=`${JSON.stringify(s[m])}:${cs(o[s[m]])},`;return`${l}}`}function Hr(o){let t="";for(const s of Ne)t+=`/${cs(o[s])}`;return t}function cu(o){const t=o.value;return t?[new Ye(o.key,t,"constants have been deprecated as of v8")]:[]}function $i(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function zs(o){if(Array.isArray(o))return o.map(zs);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const s in o)t[s]=zs(o[s]);return t}return $i(o)}function Kn(o){const t=o.key,s=o.value,l=o.valueSpec||{},m=o.objectElementValidators||{},b=o.style,v=o.styleSpec,E=o.validateSpec;let M=[];const P=di(s);if(P!=="object")return[new Ye(t,s,`object expected, ${P} found`)];for(const N in s){const B=N.split(".")[0],U=Bu(l,B)||l["*"];let j;if(Bu(m,B))j=m[B];else if(Bu(l,B))j=E;else if(m["*"])j=m["*"];else{if(!l["*"]){M.push(new Ye(t,s[N],`unknown property "${N}"`));continue}j=E}M=M.concat(j({key:(t&&`${t}.`)+N,value:s[N],valueSpec:U,style:b,styleSpec:v,object:s,objectKey:N,validateSpec:E},s))}for(const N in l)m[N]||l[N].required&&l[N].default===void 0&&s[N]===void 0&&M.push(new Ye(t,s,`missing required property "${N}"`));return M}function hu(o){const t=o.value,s=o.valueSpec,l=o.style,m=o.styleSpec,b=o.key,v=o.arrayElementValidator||o.validateSpec;if(di(t)!=="array")return[new Ye(b,t,`array expected, ${di(t)} found`)];if(s.length&&t.length!==s.length)return[new Ye(b,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ye(b,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let E={type:s.value,values:s.values};m.$version<7&&(E.function=s.function),di(s.value)==="object"&&(E=s.value);let M=[];for(let P=0;P<t.length;P++)M=M.concat(v({array:t,arrayIndex:P,value:t[P],valueSpec:E,validateSpec:o.validateSpec,style:l,styleSpec:m,key:`${b}[${P}]`}));return M}function Fs(o){const t=o.key,s=o.value,l=o.valueSpec;let m=di(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new Ye(t,s,`number expected, ${m} found`)]:"minimum"in l&&s<l.minimum?[new Ye(t,s,`${s} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&s>l.maximum?[new Ye(t,s,`${s} is greater than the maximum value ${l.maximum}`)]:[]}function Bc(o){const t=o.valueSpec,s=$i(o.value.type);let l,m,b,v={};const E=s!=="categorical"&&o.value.property===void 0,M=!E,P=di(o.value.stops)==="array"&&di(o.value.stops[0])==="array"&&di(o.value.stops[0][0])==="object",N=Kn({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new Ye(j.key,j.value,'identity function may not have a "stops" property')];let V=[];const $=j.value;return V=V.concat(hu({key:j.key,value:$,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:B})),di($)==="array"&&$.length===0&&V.push(new Ye(j.key,$,"array must have at least one stop")),V},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&E&&N.push(new Ye(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||N.push(new Ye(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!Fl(o.valueSpec)&&N.push(new Ye(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!vo(o.valueSpec)?N.push(new Ye(o.key,o.value,"property functions not supported")):E&&!ru(o.valueSpec)&&N.push(new Ye(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!P||o.value.property!==void 0||N.push(new Ye(o.key,o.value,'"property" property is required')),N;function B(j){let V=[];const $=j.value,ee=j.key;if(di($)!=="array")return[new Ye(ee,$,`array expected, ${di($)} found`)];if($.length!==2)return[new Ye(ee,$,`array length 2 expected, length ${$.length} found`)];if(P){if(di($[0])!=="object")return[new Ye(ee,$,`object expected, ${di($[0])} found`)];if($[0].zoom===void 0)return[new Ye(ee,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Ye(ee,$,"object stop key must have value")];if(b&&b>$i($[0].zoom))return[new Ye(ee,$[0].zoom,"stop zoom values must appear in ascending order")];$i($[0].zoom)!==b&&(b=$i($[0].zoom),m=void 0,v={}),V=V.concat(Kn({key:`${ee}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Fs,value:U}}))}else V=V.concat(U({key:`${ee}[0]`,value:$[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},$));return uu(zs($[1]))?V.concat([new Ye(`${ee}[1]`,$[1],"expressions are not allowed in function stops.")]):V.concat(j.validateSpec({key:`${ee}[1]`,value:$[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function U(j,V){const $=di(j.value),ee=$i(j.value),oe=j.value!==null?j.value:V;if(l){if($!==l)return[new Ye(j.key,oe,`${$} stop domain type must match previous stop domain type ${l}`)]}else l=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Ye(j.key,oe,"stop domain value must be a number, string, or boolean")];if($!=="number"&&s!=="categorical"){let ve=`number expected, ${$} found`;return vo(t)&&s===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(j.key,oe,ve)]}return s!=="categorical"||$!=="number"||isFinite(ee)&&Math.floor(ee)===ee?s!=="categorical"&&$==="number"&&m!==void 0&&ee<m?[new Ye(j.key,oe,"stop domain values must appear in ascending order")]:(m=ee,s==="categorical"&&ee in v?[new Ye(j.key,oe,"stop domain values must be unique")]:(v[ee]=!0,[])):[new Ye(j.key,oe,`integer expected, found ${ee}`)]}}function Wn(o){const t=(o.expressionContext==="property"?Wu:Bs)(zs(o.value),o.valueSpec);if(t.result==="error")return t.value.map(l=>new Ye(`${o.key}${l.key}`,o.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new Ye(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!us(s))return[new Ye(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!us(s))return[new Ye(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Qu(s,["zoom","feature-state"]))return[new Ye(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!zn(s))return[new Ye(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jl(o){const t=o.key,s=o.value,l=di(s);return l!=="string"?[new Ye(t,s,`color expected, ${l} found`)]:xi.parse(String(s))?[]:[new Ye(t,s,`color expected, "${s}" found`)]}function jr(o){const t=o.key,s=o.value,l=o.valueSpec,m=[];return Array.isArray(l.values)?l.values.indexOf($i(s))===-1&&m.push(new Ye(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(l.values).indexOf($i(s))===-1&&m.push(new Ye(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function qr(o){return Fr(zs(o.value))?Wn(Ci({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Us(o)}function Us(o){const t=o.value,s=o.key;if(di(t)!=="array")return[new Ye(s,t,`array expected, ${di(t)} found`)];const l=o.styleSpec;let m,b=[];if(t.length<1)return[new Ye(s,t,"filter array must have at least 1 element")];switch(b=b.concat(jr({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:o.style,styleSpec:o.styleSpec})),$i(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&$i(t[1])==="$type"&&b.push(new Ye(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&b.push(new Ye(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=di(t[1]),m!=="string"&&b.push(new Ye(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let v=2;v<t.length;v++)m=di(t[v]),$i(t[1])==="$type"?b=b.concat(jr({key:`${s}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:o.style,styleSpec:o.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new Ye(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)b=b.concat(Us({key:`${s}[${v}]`,value:t[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":m=di(t[1]),t.length!==2?b.push(new Ye(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new Ye(`${s}[1]`,t[1],`string expected, ${m} found`))}return b}function hs(o,t){const s=o.key,l=o.validateSpec,m=o.style,b=o.styleSpec,v=o.value,E=o.objectKey,M=b[`${t}_${o.layerType}`];if(!M)return[];const P=E.match(/^(.*)-transition$/);if(t==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return l({key:s,value:v,valueSpec:b.transition,style:m,styleSpec:b});const N=o.valueSpec||M[E];if(!N)return[new Ye(s,v,`unknown property "${E}"`)];let B;if(di(v)==="string"&&vo(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(v)))return[new Ye(s,v,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const U=[];return o.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&U.push(new Ye(s,v,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Ns(zs(v))&&$i(v.type)==="identity"&&U.push(new Ye(s,v,'"text-font" does not support identity functions'))),U.concat(l({key:o.key,value:v,valueSpec:N,style:m,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:E}))}function zc(o){return hs(o,"paint")}function Eo(o){return hs(o,"layout")}function ds(o){let t=[];const s=o.value,l=o.key,m=o.style,b=o.styleSpec;if(di(s)!=="object")return[new Ye(l,s,`object expected, ${di(s)} found`)];s.type||s.ref||t.push(new Ye(l,s,'either "type" or "ref" is required'));let v=$i(s.type);const E=$i(s.ref);if(s.id){const M=$i(s.id);for(let P=0;P<o.arrayIndex;P++){const N=m.layers[P];$i(N.id)===M&&t.push(new Ye(l,s.id,`duplicate layer id "${s.id}", previously used at line ${N.id.__line__}`))}}if("ref"in s){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in s&&t.push(new Ye(l,s[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{$i(P.id)===E&&(M=P)}),M?M.ref?t.push(new Ye(l,s.ref,"ref cannot reference another ref layer")):v=$i(M.type):t.push(new Ye(l,s.ref,`ref layer "${E}" not found`))}else if(v!=="background")if(s.source){const M=m.sources&&m.sources[s.source],P=M&&$i(M.type);M?P==="vector"&&v==="raster"?t.push(new Ye(l,s.source,`layer "${s.id}" requires a raster source`)):P!=="raster-dem"&&v==="hillshade"?t.push(new Ye(l,s.source,`layer "${s.id}" requires a raster-dem source`)):P==="raster"&&v!=="raster"?t.push(new Ye(l,s.source,`layer "${s.id}" requires a vector source`)):P!=="vector"||s["source-layer"]?P==="raster-dem"&&v!=="hillshade"?t.push(new Ye(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||P==="geojson"&&M.lineMetrics||t.push(new Ye(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ye(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ye(l,s.source,`source "${s.source}" not found`))}else t.push(new Ye(l,s,'missing required property "source"'));return t=t.concat(Kn({key:l,value:s,valueSpec:b.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${l}.type`,value:s.type,valueSpec:b.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:s,objectKey:"type"}),filter:qr,layout:M=>Kn({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":P=>Eo(Ci({layerType:v},P))}}),paint:M=>Kn({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":P=>zc(Ci({layerType:v},P))}})}})),t}function Da(o){const t=o.value,s=o.key,l=di(t);return l!=="string"?[new Ye(s,t,`string expected, ${l} found`)]:[]}const Rr={promoteId:function({key:o,value:t}){if(di(t)==="string")return Da({key:o,value:t});{const s=[];for(const l in t)s.push(...Da({key:`${o}.${l}`,value:t[l]}));return s}}};function on(o){const t=o.value,s=o.key,l=o.styleSpec,m=o.style,b=o.validateSpec;if(!t.type)return[new Ye(s,t,'"type" is required')];const v=$i(t.type);let E;switch(v){case"vector":case"raster":return E=Kn({key:s,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:o.style,styleSpec:l,objectElementValidators:Rr,validateSpec:b}),E;case"raster-dem":return E=function(M){var P;const N=(P=M.sourceName)!==null&&P!==void 0?P:"",B=M.value,U=M.styleSpec,j=U.source_raster_dem,V=M.style;let $=[];const ee=di(B);if(B===void 0)return $;if(ee!=="object")return $.push(new Ye("source_raster_dem",B,`object expected, ${ee} found`)),$;const oe=$i(B.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],ue=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const H in B)!oe&&ve.includes(H)?$.push(new Ye(H,B[H],`In "${N}": "${H}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):j[H]?$=$.concat(M.validateSpec({key:H,value:B[H],valueSpec:j[H],validateSpec:M.validateSpec,style:V,styleSpec:U})):$.push(new Ye(H,B[H],`unknown property "${H}"`));return $}({sourceName:s,value:t,style:o.style,styleSpec:l,validateSpec:b}),E;case"geojson":if(E=Kn({key:s,value:t,valueSpec:l.source_geojson,style:m,styleSpec:l,validateSpec:b,objectElementValidators:Rr}),t.cluster)for(const M in t.clusterProperties){const[P,N]=t.clusterProperties[M],B=typeof P=="string"?[P,["accumulated"],["get",M]]:P;E.push(...Wn({key:`${s}.${M}.map`,value:N,expressionContext:"cluster-map"})),E.push(...Wn({key:`${s}.${M}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return E;case"video":return Kn({key:s,value:t,valueSpec:l.source_video,style:m,validateSpec:b,styleSpec:l});case"image":return Kn({key:s,value:t,valueSpec:l.source_image,style:m,validateSpec:b,styleSpec:l});case"canvas":return[new Ye(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jr({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ql(o){const t=o.value,s=o.styleSpec,l=s.light,m=o.style;let b=[];const v=di(t);if(t===void 0)return b;if(v!=="object")return b=b.concat([new Ye("light",t,`object expected, ${v} found`)]),b;for(const E in t){const M=E.match(/^(.*)-transition$/);b=b.concat(M&&l[M[1]]&&l[M[1]].transition?o.validateSpec({key:E,value:t[E],valueSpec:s.transition,validateSpec:o.validateSpec,style:m,styleSpec:s}):l[E]?o.validateSpec({key:E,value:t[E],valueSpec:l[E],validateSpec:o.validateSpec,style:m,styleSpec:s}):[new Ye(E,t[E],`unknown property "${E}"`)])}return b}function Fh(o){const t=o.value,s=o.styleSpec,l=s.sky,m=o.style,b=di(t);if(t===void 0)return[];if(b!=="object")return[new Ye("sky",t,`object expected, ${b} found`)];let v=[];for(const E in t)v=v.concat(l[E]?o.validateSpec({key:E,value:t[E],valueSpec:l[E],style:m,styleSpec:s}):[new Ye(E,t[E],`unknown property "${E}"`)]);return v}function el(o){const t=o.value,s=o.styleSpec,l=s.terrain,m=o.style;let b=[];const v=di(t);if(t===void 0)return b;if(v!=="object")return b=b.concat([new Ye("terrain",t,`object expected, ${v} found`)]),b;for(const E in t)b=b.concat(l[E]?o.validateSpec({key:E,value:t[E],valueSpec:l[E],validateSpec:o.validateSpec,style:m,styleSpec:s}):[new Ye(E,t[E],`unknown property "${E}"`)]);return b}function Uh(o){let t=[];const s=o.value,l=o.key;if(Array.isArray(s)){const m=[],b=[];for(const v in s)s[v].id&&m.includes(s[v].id)&&t.push(new Ye(l,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),m.push(s[v].id),s[v].url&&b.includes(s[v].url)&&t.push(new Ye(l,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),b.push(s[v].url),t=t.concat(Kn({key:`${l}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return t}return Da({key:l,value:s})}function Fc(o){return t=o.value,t&&t.constructor===Object?[]:[new Ye(o.key,o.value,`object expected, ${di(o.value)} found`)];var t}const Ga={"*":()=>[],array:hu,boolean:function(o){const t=o.value,s=o.key,l=di(t);return l!=="boolean"?[new Ye(s,t,`boolean expected, ${l} found`)]:[]},number:Fs,color:jl,constants:cu,enum:jr,filter:qr,function:Bc,layer:ds,object:Kn,source:on,light:ql,sky:Fh,terrain:el,projection:function(o){const t=o.value,s=o.styleSpec,l=s.projection,m=o.style,b=di(t);if(t===void 0)return[];if(b!=="object")return[new Ye("projection",t,`object expected, ${b} found`)];let v=[];for(const E in t)v=v.concat(l[E]?o.validateSpec({key:E,value:t[E],valueSpec:l[E],style:m,styleSpec:s}):[new Ye(E,t[E],`unknown property "${E}"`)]);return v},projectionDefinition:function(o){const t=o.key;let s=o.value;s=s instanceof String?s.valueOf():s;const l=di(s);return l!=="array"||function(m){return Array.isArray(m)&&m.length===3&&typeof m[0]=="string"&&typeof m[1]=="string"&&typeof m[2]=="number"}(s)||function(m){return!!["interpolate","step","literal"].includes(m[0])}(s)?["array","string"].includes(l)?[]:[new Ye(t,s,`projection expected, invalid type "${l}" found`)]:[new Ye(t,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:Da,formatted:function(o){return Da(o).length===0?[]:Wn(o)},resolvedImage:function(o){return Da(o).length===0?[]:Wn(o)},padding:function(o){const t=o.key,s=o.value;if(di(s)==="array"){if(s.length<1||s.length>4)return[new Ye(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const l={type:"number"};let m=[];for(let b=0;b<s.length;b++)m=m.concat(o.validateSpec({key:`${t}[${b}]`,value:s[b],validateSpec:o.validateSpec,valueSpec:l}));return m}return Fs({key:t,value:s,valueSpec:{}})},numberArray:function(o){const t=o.key,s=o.value;if(di(s)==="array"){const l={type:"number"};if(s.length<1)return[new Ye(t,s,"array length at least 1 expected, length 0 found")];let m=[];for(let b=0;b<s.length;b++)m=m.concat(o.validateSpec({key:`${t}[${b}]`,value:s[b],validateSpec:o.validateSpec,valueSpec:l}));return m}return Fs({key:t,value:s,valueSpec:{}})},colorArray:function(o){const t=o.key,s=o.value;if(di(s)==="array"){if(s.length<1)return[new Ye(t,s,"array length at least 1 expected, length 0 found")];let l=[];for(let m=0;m<s.length;m++)l=l.concat(jl({key:`${t}[${m}]`,value:s[m]}));return l}return jl({key:t,value:s})},variableAnchorOffsetCollection:function(o){const t=o.key,s=o.value,l=di(s),m=o.styleSpec;if(l!=="array"||s.length<1||s.length%2!=0)return[new Ye(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let v=0;v<s.length;v+=2)b=b.concat(jr({key:`${t}[${v}]`,value:s[v],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(hu({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:m}));return b},sprite:Uh,state:Fc};function wo(o){const t=o.value,s=o.valueSpec,l=o.styleSpec;return o.validateSpec=wo,s.expression&&Ns($i(t))?Bc(o):s.expression&&uu(zs(t))?Wn(o):s.type&&Ga[s.type]?Ga[s.type](o):Kn(Ci({},o,{valueSpec:s.type?l[s.type]:s}))}function tl(o){const t=o.value,s=o.key,l=Da(o);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Ye(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Ye(s,t,'"glyphs" url must include a "{range}" token'))),l}function Za(o,t=te){let s=[];return s=s.concat(wo({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,validateSpec:wo,objectElementValidators:{glyphs:tl,"*":()=>[]}})),o.constants&&(s=s.concat(cu({key:"constants",value:o.constants}))),Vr(s)}function pr(o){return function(t){return o({...t,validateSpec:wo})}}function Vr(o){return[].concat(o).sort((t,s)=>t.line-s.line)}function An(o){return function(...t){return Vr(o.apply(this,t))}}Za.source=An(pr(on)),Za.sprite=An(pr(Uh)),Za.glyphs=An(pr(tl)),Za.light=An(pr(ql)),Za.sky=An(pr(Fh)),Za.terrain=An(pr(el)),Za.state=An(pr(Fc)),Za.layer=An(pr(ds)),Za.filter=An(pr(qr)),Za.paintProperty=An(pr(zc)),Za.layoutProperty=An(pr(Eo));const il=Za,Vl=il.light,Zf=il.sky,Uc=il.paintProperty,fs=il.layoutProperty;function Gl(o,t){let s=!1;if(t&&t.length)for(const l of t)o.fire(new de(new Error(l.message))),s=!0;return s}class Hs{constructor(t,s,l){const m=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(l=v[2]);for(let M=0;M<this.d*this.d;M++){const P=v[3+M],N=v[3+M+1];m.push(P===N?null:v.subarray(P,N))}const E=v[3+m.length+1];this.keys=v.subarray(v[3+m.length],E),this.bboxes=v.subarray(E),this.insert=this._insertReadonly}else{this.d=s+2*l;for(let v=0;v<this.d*this.d;v++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=l,this.scale=s/t,this.uid=0;const b=l/s*t;this.min=-b,this.max=t+b}insert(t,s,l,m,b){this._forEachCell(s,l,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,l,m,b,v){this.cells[b].push(v)}query(t,s,l,m,b){const v=this.min,E=this.max;if(t<=v&&s<=v&&E<=l&&E<=m&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,s,l,m,this._queryCell,M,{},b),M}}_queryCell(t,s,l,m,b,v,E,M){const P=this.cells[b];if(P!==null){const N=this.keys,B=this.bboxes;for(let U=0;U<P.length;U++){const j=P[U];if(E[j]===void 0){const V=4*j;(M?M(B[V+0],B[V+1],B[V+2],B[V+3]):t<=B[V+2]&&s<=B[V+3]&&l>=B[V+0]&&m>=B[V+1])?(E[j]=!0,v.push(N[j])):E[j]=!1}}}}_forEachCell(t,s,l,m,b,v,E,M){const P=this._convertToCellCoord(t),N=this._convertToCellCoord(s),B=this._convertToCellCoord(l),U=this._convertToCellCoord(m);for(let j=P;j<=B;j++)for(let V=N;V<=U;V++){const $=this.d*V+j;if((!M||M(this._convertFromCellCoord(j),this._convertFromCellCoord(V),this._convertFromCellCoord(j+1),this._convertFromCellCoord(V+1)))&&b.call(this,t,s,l,m,$,v,E,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const m=new Int32Array(s+l+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=s;for(let v=0;v<t.length;v++){const E=t[v];m[3+v]=b,m.set(E,b),b+=E.length}return m[3+t.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+t.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(t,s){const l=t.toArrayBuffer();return s&&s.push(l),{buffer:l}}static deserialize(t){return new Hs(t.buffer)}}const Gr={};function wt(o,t,s={}){if(Gr[o])throw new Error(`${o} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:o,writeable:!1}),Gr[o]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}wt("Object",Object),wt("TransferableGridIndex",Hs),wt("Color",xi),wt("Error",Error),wt("AJAXError",Ar),wt("ResolvedImage",kn),wt("StylePropertyFunction",Tn),wt("StyleExpression",Ku,{omit:["_evaluator"]}),wt("ZoomDependentExpression",lu),wt("ZoomConstantExpression",To),wt("CompoundExpression",hr,{omit:["_evaluate"]});for(const o in Xu)Xu[o]._classRegistryKey||wt(`Expression_${o}`,Xu[o]);function Zl(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function du(o){return o.$name||o.constructor._classRegistryKey}function Hc(o){return!function(t){if(t===null||typeof t!="object")return!1;const s=du(t);return!(!s||s==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Zl(o)||ka(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function fu(o,t){if(Hc(o))return(Zl(o)||ka(o))&&t&&t.push(o),ArrayBuffer.isView(o)&&t&&t.push(o.buffer),o instanceof ImageData&&t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const b=[];for(const v of o)b.push(fu(v,t));return b}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const s=du(o);if(!s)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Gr[s])throw new Error(`${s} is not registered.`);const{klass:l}=Gr[s],m=l.serialize?l.serialize(o,t):{};if(l.serialize){if(t&&m===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in o){if(!o.hasOwnProperty(b)||Gr[s].omit.indexOf(b)>=0)continue;const v=o[b];m[b]=Gr[s].shallow.indexOf(b)>=0?v:fu(v,t)}o instanceof Error&&(m.message=o.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(m.$name=s),m}function Ao(o){if(Hc(o))return o;if(Array.isArray(o))return o.map(Ao);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const t=du(o)||"Object";if(!Gr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=Gr[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(o);const l=Object.create(s.prototype);for(const m of Object.keys(o)){if(m==="$name")continue;const b=o[m];l[m]=Gr[t].shallow.indexOf(m)>=0?b:Ao(b)}return l}class jc{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const ci={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Yl(o){for(const t of o)if(Zr(t.charCodeAt(0)))return!0;return!1}function Nd(o){for(const t of o)if(!Vc(t.charCodeAt(0)))return!1;return!0}function ps(o){const t=o.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const qc=ps(["Arab","Dupl","Mong","Ougr","Syrc"]);function Vc(o){return!qc.test(String.fromCodePoint(o))}const ms=ps(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Zr(o){return!(o!==746&&o!==747&&(o<4352||!(ci["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||ci["CJK Compatibility"](o)||ci["CJK Strokes"](o)||!(!ci["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||ci["Enclosed CJK Letters and Months"](o)||ci["Ideographic Description Characters"](o)||ci.Kanbun(o)||ci.Katakana(o)&&o!==12540||!(!ci["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!ci["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||ci["Vertical Forms"](o)||ci["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||ms.test(String.fromCodePoint(o)))))}function js(o){return!(Zr(o)||function(t){return!!(ci["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ci["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ci["Letterlike Symbols"](t)||ci["Number Forms"](t)||ci["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ci["Control Pictures"](t)&&t!==9251||ci["Optical Character Recognition"](t)||ci["Enclosed Alphanumerics"](t)||ci["Geometric Shapes"](t)||ci["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ci["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ci["CJK Symbols and Punctuation"](t)||ci.Katakana(t)||ci["Private Use Area"](t)||ci["CJK Compatibility Forms"](t)||ci["Small Form Variants"](t)||ci["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(o))}const Hh=ps(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function al(o){return Hh.test(String.fromCodePoint(o))}function $l(o,t){return!(!t&&al(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||ci.Khmer(o))}function Xl(o){for(const t of o)if(al(t.charCodeAt(0)))return!0;return!1}const gs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(gs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,t){return h(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const s=o.pluginURL,l=new Promise(b=>{this.loadScriptResolve=b});t(s);const m=new Promise(b=>setTimeout(()=>b(),this.TIMEOUT));if(yield Promise.race([l,m]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:s};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class ea{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jc,this.transition={})}isSupportedScript(t){return function(s,l){for(const m of s)if(!$l(m.charCodeAt(0),l))return!1;return!0}(t,gs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class _s{constructor(t,s){this.property=t,this.value=s,this.expression=function(l,m){if(Ns(l))return new Tn(l,m);if(uu(l)){const b=Wu(l,m);if(b.result==="error")throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=l;return m.type==="color"&&typeof l=="string"?b=xi.parse(l):m.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?m.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?m.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?b=va.parse(l):m.type==="projectionDefinition"&&typeof l=="string"&&(b=nn.parse(l)):b=Qa.parse(l):b=Ma.parse(l):b=Ca.parse(l),{kind:"constant",evaluate:()=>b}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class nl{constructor(t){this.property=t,this.value=new _s(t,void 0)}transitioned(t,s){return new Gc(this.property,this.value,s,si({},t.transition,this.transition),t.now)}untransitioned(){return new Gc(this.property,this.value,null,{},0)}}class jh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return bn(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nl(this._values[t].property)),this._values[t].value=new _s(this._values[t].property,s===null?void 0:bn(s))}getTransition(t){return bn(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nl(this._values[t].property)),this._values[t].transition=bn(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l);const m=this.getTransition(s);m!==void 0&&(t[`${s}-transition`]=m)}return t}transitioned(t,s){const l=new Zc(this._properties);for(const m of Object.keys(this._values))l._values[m]=this._values[m].transitioned(t,s._values[m]);return l}untransitioned(){const t=new Zc(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Gc{constructor(t,s,l,m,b){this.property=t,this.value=s,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,t.specification.transition&&(m.delay||m.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const m=t.now||0,b=this.value.possiblyEvaluate(t,s,l),v=this.prior;if(v){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return v.possiblyEvaluate(t,s,l);{const E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,l),b,Et(E))}}return b}}class Zc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const m=new ki(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(t,s,l);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class So{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return bn(this._values[t].value)}setValue(t,s){this._values[t]=new _s(this._values[t].property,s===null?void 0:bn(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const m=new ki(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(t,s,l);return m}}class $t{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,l,m){return this.property.evaluate(this.value,this.parameters,t,s,l,m)}}class ki{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class vt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,l){const m=rs[this.specification.type];return m?m(t,s,l):t}}class Ht{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,m){return new $t(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},l,m)}:t.expression,s)}interpolate(t,s,l){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new $t(this,{kind:"constant",value:void 0},t.parameters);const m=rs[this.specification.type];if(m){const b=m(t.value.value,s.value.value,l);return new $t(this,{kind:"constant",value:b},t.parameters)}return t}evaluate(t,s,l,m,b,v){return t.kind==="constant"?t.value:t.evaluate(s,l,m,b,v)}}class ys extends Ht{possiblyEvaluate(t,s,l,m){if(t.value===void 0)return new $t(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const b=t.expression.evaluate(s,null,{},l,m),v=t.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,E=this._calculate(v,v,v,s);return new $t(this,{kind:"constant",value:E},s)}if(t.expression.kind==="camera"){const b=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new $t(this,{kind:"constant",value:b},s)}return new $t(this,t.expression,s)}evaluate(t,s,l,m,b,v){if(t.kind==="source"){const E=t.evaluate(s,l,m,b,v);return this._calculate(E,E,E,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,m),t.evaluate({zoom:Math.floor(s.zoom)},l,m),t.evaluate({zoom:Math.floor(s.zoom)+1},l,m),s):t.value}_calculate(t,s,l,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class qs{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,m){if(t.value!==void 0){if(t.expression.kind==="constant"){const b=t.expression.evaluate(s,null,{},l,m);return this._calculate(b,b,b,s)}return this._calculate(t.expression.evaluate(new ea(Math.floor(s.zoom-1),s)),t.expression.evaluate(new ea(Math.floor(s.zoom),s)),t.expression.evaluate(new ea(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class rl{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,m){return!!t.expression.evaluate(s,null,{},l,m)}interpolate(){return!1}}class ma{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const m=this.defaultPropertyValues[s]=new _s(l,void 0),b=this.defaultTransitionablePropertyValues[s]=new nl(l);this.defaultTransitioningPropertyValues[s]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}}}wt("DataDrivenProperty",Ht),wt("DataConstantProperty",vt),wt("CrossFadedDataDrivenProperty",ys),wt("CrossFadedProperty",qs),wt("ColorRampProperty",rl);const Co="-transition";class Pr extends Te{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new So(s.layout)),s.paint)){this._transitionablePaint=new jh(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ki(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){s!=null&&this._validate(fs,`layers.${this.id}.layout.${t}`,t,s,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Co)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(s!=null&&this._validate(Uc,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(t.endsWith(Co))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const m=this._transitionablePaint._values[t],b=m.property.specification["property-type"]==="cross-faded-data-driven",v=m.value.isDataDriven(),E=m.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||v||b||this._handleOverridablePaintPropertyUpdate(t,E,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),es(t,(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}_validate(t,s,l,m,b={}){return(!b||b.validate!==!1)&&Gl(this,t.call(il,{key:s,layerType:this.type,objectKey:l,value:m,styleSpec:te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof $t&&vo(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Ra={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vs{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class la{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ca(o,t=1){let s=0,l=0;return{members:o.map(m=>{const b=Ra[m.type].BYTES_PER_ELEMENT,v=s=pu(s,Math.max(t,b)),E=m.components||1;return l=Math.max(l,b),s+=b*E,{name:m.name,type:m.type,components:E,offset:v}}),size:pu(s,Math.max(l,t)),alignment:t}}function pu(o,t){return Math.ceil(o/t)*t}class Ql extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const m=2*t;return this.int16[m+0]=s,this.int16[m+1]=l,t}}Ql.prototype.bytesPerElement=4,wt("StructArrayLayout2i4",Ql);class mu extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l)}emplace(t,s,l,m){const b=3*t;return this.int16[b+0]=s,this.int16[b+1]=l,this.int16[b+2]=m,t}}mu.prototype.bytesPerElement=6,wt("StructArrayLayout3i6",mu);class Gs extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,l,m)}emplace(t,s,l,m,b){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=l,this.int16[v+2]=m,this.int16[v+3]=b,t}}Gs.prototype.bytesPerElement=8,wt("StructArrayLayout4i8",Gs);class Kl extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,m,b,v)}emplace(t,s,l,m,b,v,E){const M=6*t;return this.int16[M+0]=s,this.int16[M+1]=l,this.int16[M+2]=m,this.int16[M+3]=b,this.int16[M+4]=v,this.int16[M+5]=E,t}}Kl.prototype.bytesPerElement=12,wt("StructArrayLayout2i4i12",Kl);class Sn extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,m,b,v)}emplace(t,s,l,m,b,v,E){const M=4*t,P=8*t;return this.int16[M+0]=s,this.int16[M+1]=l,this.uint8[P+4]=m,this.uint8[P+5]=b,this.uint8[P+6]=v,this.uint8[P+7]=E,t}}Sn.prototype.bytesPerElement=8,wt("StructArrayLayout2i4ub8",Sn);class ha extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const m=2*t;return this.float32[m+0]=s,this.float32[m+1]=l,t}}ha.prototype.bytesPerElement=8,wt("StructArrayLayout2f8",ha);class Wl extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v,E,M,P,N){const B=this.length;return this.resize(B+1),this.emplace(B,t,s,l,m,b,v,E,M,P,N)}emplace(t,s,l,m,b,v,E,M,P,N,B){const U=10*t;return this.uint16[U+0]=s,this.uint16[U+1]=l,this.uint16[U+2]=m,this.uint16[U+3]=b,this.uint16[U+4]=v,this.uint16[U+5]=E,this.uint16[U+6]=M,this.uint16[U+7]=P,this.uint16[U+8]=N,this.uint16[U+9]=B,t}}Wl.prototype.bytesPerElement=20,wt("StructArrayLayout10ui20",Wl);class g extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v,E,M,P,N,B,U){const j=this.length;return this.resize(j+1),this.emplace(j,t,s,l,m,b,v,E,M,P,N,B,U)}emplace(t,s,l,m,b,v,E,M,P,N,B,U,j){const V=12*t;return this.int16[V+0]=s,this.int16[V+1]=l,this.int16[V+2]=m,this.int16[V+3]=b,this.uint16[V+4]=v,this.uint16[V+5]=E,this.uint16[V+6]=M,this.uint16[V+7]=P,this.int16[V+8]=N,this.int16[V+9]=B,this.int16[V+10]=U,this.int16[V+11]=j,t}}g.prototype.bytesPerElement=24,wt("StructArrayLayout4i4ui4i24",g);class e extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l)}emplace(t,s,l,m){const b=3*t;return this.float32[b+0]=s,this.float32[b+1]=l,this.float32[b+2]=m,t}}e.prototype.bytesPerElement=12,wt("StructArrayLayout3f12",e);class r extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}r.prototype.bytesPerElement=4,wt("StructArrayLayout1ul4",r);class c extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v,E,M,P){const N=this.length;return this.resize(N+1),this.emplace(N,t,s,l,m,b,v,E,M,P)}emplace(t,s,l,m,b,v,E,M,P,N){const B=10*t,U=5*t;return this.int16[B+0]=s,this.int16[B+1]=l,this.int16[B+2]=m,this.int16[B+3]=b,this.int16[B+4]=v,this.int16[B+5]=E,this.uint32[U+3]=M,this.uint16[B+8]=P,this.uint16[B+9]=N,t}}c.prototype.bytesPerElement=20,wt("StructArrayLayout6i1ul2ui20",c);class p extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,m,b,v)}emplace(t,s,l,m,b,v,E){const M=6*t;return this.int16[M+0]=s,this.int16[M+1]=l,this.int16[M+2]=m,this.int16[M+3]=b,this.int16[M+4]=v,this.int16[M+5]=E,t}}p.prototype.bytesPerElement=12,wt("StructArrayLayout2i2i2i12",p);class y extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,l,m,b)}emplace(t,s,l,m,b,v){const E=4*t,M=8*t;return this.float32[E+0]=s,this.float32[E+1]=l,this.float32[E+2]=m,this.int16[M+6]=b,this.int16[M+7]=v,t}}y.prototype.bytesPerElement=16,wt("StructArrayLayout2f1f2i16",y);class T extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,m,b,v)}emplace(t,s,l,m,b,v,E){const M=16*t,P=4*t,N=8*t;return this.uint8[M+0]=s,this.uint8[M+1]=l,this.float32[P+1]=m,this.float32[P+2]=b,this.int16[N+6]=v,this.int16[N+7]=E,t}}T.prototype.bytesPerElement=16,wt("StructArrayLayout2ub2f2i16",T);class C extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l)}emplace(t,s,l,m){const b=3*t;return this.uint16[b+0]=s,this.uint16[b+1]=l,this.uint16[b+2]=m,t}}C.prototype.bytesPerElement=6,wt("StructArrayLayout3ui6",C);class I extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe){const ve=this.length;return this.resize(ve+1),this.emplace(ve,t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe)}emplace(t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe,ve){const ue=24*t,H=12*t,J=48*t;return this.int16[ue+0]=s,this.int16[ue+1]=l,this.uint16[ue+2]=m,this.uint16[ue+3]=b,this.uint32[H+2]=v,this.uint32[H+3]=E,this.uint32[H+4]=M,this.uint16[ue+10]=P,this.uint16[ue+11]=N,this.uint16[ue+12]=B,this.float32[H+7]=U,this.float32[H+8]=j,this.uint8[J+36]=V,this.uint8[J+37]=$,this.uint8[J+38]=ee,this.uint32[H+10]=oe,this.int16[ue+22]=ve,t}}I.prototype.bytesPerElement=48,wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",I);class O extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe,ve,ue,H,J,fe,Be,st,je,Qe,ht,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe,ve,ue,H,J,fe,Be,st,je,Qe,ht,ut)}emplace(t,s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe,ve,ue,H,J,fe,Be,st,je,Qe,ht,ut,ft){const We=32*t,It=16*t;return this.int16[We+0]=s,this.int16[We+1]=l,this.int16[We+2]=m,this.int16[We+3]=b,this.int16[We+4]=v,this.int16[We+5]=E,this.int16[We+6]=M,this.int16[We+7]=P,this.uint16[We+8]=N,this.uint16[We+9]=B,this.uint16[We+10]=U,this.uint16[We+11]=j,this.uint16[We+12]=V,this.uint16[We+13]=$,this.uint16[We+14]=ee,this.uint16[We+15]=oe,this.uint16[We+16]=ve,this.uint16[We+17]=ue,this.uint16[We+18]=H,this.uint16[We+19]=J,this.uint16[We+20]=fe,this.uint16[We+21]=Be,this.uint16[We+22]=st,this.uint32[It+12]=je,this.float32[It+13]=Qe,this.float32[It+14]=ht,this.uint16[We+30]=ut,this.uint16[We+31]=ft,t}}O.prototype.bytesPerElement=64,wt("StructArrayLayout8i15ui1ul2f2ui64",O);class k extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}k.prototype.bytesPerElement=4,wt("StructArrayLayout1f4",k);class F extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l)}emplace(t,s,l,m){const b=3*t;return this.uint16[6*t+0]=s,this.float32[b+1]=l,this.float32[b+2]=m,t}}F.prototype.bytesPerElement=12,wt("StructArrayLayout1ui2f12",F);class z extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l)}emplace(t,s,l,m){const b=4*t;return this.uint32[2*t+0]=s,this.uint16[b+2]=l,this.uint16[b+3]=m,t}}z.prototype.bytesPerElement=8,wt("StructArrayLayout1ul2ui8",z);class G extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const m=2*t;return this.uint16[m+0]=s,this.uint16[m+1]=l,t}}G.prototype.bytesPerElement=4,wt("StructArrayLayout2ui4",G);class Y extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Y.prototype.bytesPerElement=2,wt("StructArrayLayout1ui2",Y);class ne extends la{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,m){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,l,m)}emplace(t,s,l,m,b){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=m,this.float32[v+3]=b,t}}ne.prototype.bytesPerElement=16,wt("StructArrayLayout4f16",ne);class ae extends Vs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ve(this.anchorPointX,this.anchorPointY)}}ae.prototype.size=20;class re extends c{get(t){return new ae(this,t)}}wt("CollisionBoxArray",re);class le extends Vs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}le.prototype.size=48;class me extends I{get(t){return new le(this,t)}}wt("PlacedSymbolArray",me);class pe extends Vs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pe.prototype.size=64;class be extends O{get(t){return new pe(this,t)}}wt("SymbolInstanceArray",be);class we extends k{getoffsetX(t){return this.float32[1*t+0]}}wt("GlyphOffsetArray",we);class xe extends mu{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}wt("SymbolLineVertexArray",xe);class ke extends Vs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ke.prototype.size=12;class Ke extends F{get(t){return new ke(this,t)}}wt("TextAnchorOffsetArray",Ke);class Ge extends Vs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ge.prototype.size=8;class qe extends z{get(t){return new Ge(this,t)}}wt("FeatureIndexArray",qe);class $e extends Ql{}class _t extends Ql{}class mt extends Ql{}class rt extends Kl{}class Rt extends Sn{}class ui extends ha{}class _i extends Wl{}class da extends g{}class ji extends e{}class fa extends r{}class sa extends p{}class Xi extends T{}class Di extends C{}class za extends G{}const Ka=ca([{name:"a_pos",components:2,type:"Int16"}],4),{members:un}=Ka;class Li{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,s,l,m){const b=this.segments[this.segments.length-1];return t>Li.MAX_VERTEX_ARRAY_LENGTH&&hn(`Max vertices per segment is ${Li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Li.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+t>Li.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m?this.createNewSegment(s,l,m):b}createNewSegment(t,s,l){const m={vertexOffset:t.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(m.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(m),m}getOrCreateLatestSegment(t,s,l){return this.prepareSegment(0,t,s,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,m){return new Li([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:m,vaos:{},sortKey:0}])}}function bs(o,t){return 256*(o=Wt(Math.floor(o),0,255))+Wt(Math.floor(t),0,255)}Li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt("SegmentVector",Li);const Yr=ca([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Zs,Ys,sl,$s={exports:{}},gu={exports:{}},mr={exports:{}},Xs=function(){if(sl)return $s.exports;sl=1;var o=(Zs||(Zs=1,gu.exports=function(s,l){var m,b,v,E,M,P,N,B;for(b=s.length-(m=3&s.length),v=l,M=3432918353,P=461845907,B=0;B<b;)N=255&s.charCodeAt(B)|(255&s.charCodeAt(++B))<<8|(255&s.charCodeAt(++B))<<16|(255&s.charCodeAt(++B))<<24,++B,v=27492+(65535&(E=5*(65535&(v=(v^=N=(65535&(N=(N=(65535&N)*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*P+(((N>>>16)*P&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(N=0,m){case 3:N^=(255&s.charCodeAt(B+2))<<16;case 2:N^=(255&s.charCodeAt(B+1))<<8;case 1:v^=N=(65535&(N=(N=(65535&(N^=255&s.charCodeAt(B)))*M+(((N>>>16)*M&65535)<<16)&4294967295)<<15|N>>>17))*P+(((N>>>16)*P&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),gu.exports),t=(Ys||(Ys=1,mr.exports=function(s,l){for(var m,b=s.length,v=l^b,E=0;b>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24))+((1540483477*(m>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),b-=4,++E;switch(b){case 3:v^=(255&s.charCodeAt(E+2))<<16;case 2:v^=(255&s.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),mr.exports);return $s.exports=o,$s.exports.murmur3=o,$s.exports.murmur2=t,$s.exports}(),gr=Z(Xs);class xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,m){this.ids.push(Ea(t)),this.positions.push(s,l,m)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Ea(t);let l=0,m=this.ids.length-1;for(;l<m;){const v=l+m>>1;this.ids[v]>=s?m=v:l=v+1}const b=[];for(;this.ids[l]===s;)b.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return b}static serialize(t,s){const l=new Float64Array(t.ids),m=new Uint32Array(t.positions);return Fa(l,m,0,l.length-1),s&&s.push(l.buffer,m.buffer),{ids:l,positions:m}}static deserialize(t){const s=new xs;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function Ea(o){const t=+o;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:gr(String(o))}function Fa(o,t,s,l){for(;s<l;){const m=o[s+l>>1];let b=s-1,v=l+1;for(;;){do b++;while(o[b]<m);do v--;while(o[v]>m);if(b>=v)break;Cn(o,b,v),Cn(t,3*b,3*v),Cn(t,3*b+1,3*v+1),Cn(t,3*b+2,3*v+2)}v-s<l-v?(Fa(o,t,s,v),s=v+1):(Fa(o,t,v+1,l),l=v)}}function Cn(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}wt("FeaturePositionMap",xs);class qi{constructor(t,s){this.gl=t.gl,this.location=s}}class Jl extends qi{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class qh extends qi{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class kd extends qi{constructor(t,s){super(t,s),this.current=xi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ol=new Float32Array(16);function _u(o){return[bs(255*o.r,255*o.g),bs(255*o.b,255*o.a)]}class Mo{constructor(t,s,l){this.value=t,this.uniformNames=s.map(m=>`u_${m}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return this.type==="color"?new kd(t,s):new Jl(t,s)}}class Mn{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,l,m){const b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&t.set(b)}getBinding(t,s,l){return l.substr(0,9)==="u_pattern"?new qh(t,s):new Jl(t,s)}}class _r{constructor(t,s,l,m){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,s,l,m,b){const v=this.paintVertexArray.length,E=this.expression.evaluate(new ea(0),s,{},m,[],b);this.paintVertexArray.resize(t),this._setPaintValue(v,t,E)}updatePaintArray(t,s,l,m){const b=this.expression.evaluate({zoom:0},l,m);this._setPaintValue(t,s,b)}_setPaintValue(t,s,l){if(this.type==="color"){const m=_u(l);for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yr{constructor(t,s,l,m,b,v){this.expression=t,this.uniformNames=s.map(E=>`u_${E}_t`),this.type=l,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=s.map(E=>({name:`a_${E}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,l,m,b){const v=this.expression.evaluate(new ea(this.zoom),s,{},m,[],b),E=this.expression.evaluate(new ea(this.zoom+1),s,{},m,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,v,E)}updatePaintArray(t,s,l,m){const b=this.expression.evaluate({zoom:this.zoom},l,m),v=this.expression.evaluate({zoom:this.zoom+1},l,m);this._setPaintValue(t,s,b,v)}_setPaintValue(t,s,l,m){if(this.type==="color"){const b=_u(l),v=_u(m);for(let E=t;E<s;E++)this.paintVertexArray.emplace(E,b[0],b[1],v[0],v[1])}else{for(let b=t;b<s;b++)this.paintVertexArray.emplace(b,l,m);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Wt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(m)}getBinding(t,s,l){return new Jl(t,s)}}class vs{constructor(t,s,l,m,b,v){this.expression=t,this.type=s,this.useIntegerZoom=l,this.zoom=m,this.layerId=v,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(t,s,l){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(m,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,m,b){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],b)}_setPaintValues(t,s,l,m){if(!m||!l)return;const{min:b,mid:v,max:E}=l,M=m[b],P=m[v],N=m[E];if(M&&P&&N)for(let B=t;B<s;B++)this.zoomInPaintVertexArray.emplace(B,P.tl[0],P.tl[1],P.br[0],P.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],P.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,P.tl[0],P.tl[1],P.br[0],P.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],P.pixelRatio,N.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Yr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Yr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Qs{constructor(t,s,l){this.binders={},this._buffers=[];const m=[];for(const b in t.paint._values){if(!l(b))continue;const v=t.paint.get(b);if(!(v instanceof $t&&vo(v.property.specification)))continue;const E=Jn(b,t.type),M=v.value,P=v.property.specification.type,N=v.property.useIntegerZoom,B=v.property.specification["property-type"],U=B==="cross-faded"||B==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=U?new Mn(M.value,E):new Mo(M.value,E,P),m.push(`/u_${b}`);else if(M.kind==="source"||U){const j=Ws(b,P,"source");this.binders[b]=U?new vs(M,P,N,s,j,t.id):new _r(M,E,P,j),m.push(`/a_${b}`)}else{const j=Ws(b,P,"composite");this.binders[b]=new yr(M,E,P,N,s,j),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof _r||s instanceof yr?s.maxValue:0}populatePaintArrays(t,s,l,m,b){for(const v in this.binders){const E=this.binders[v];(E instanceof _r||E instanceof yr||E instanceof vs)&&E.populatePaintArray(t,s,l,m,b)}}setConstantPatternPositions(t,s){for(const l in this.binders){const m=this.binders[l];m instanceof Mn&&m.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,m,b){let v=!1;for(const E in t){const M=s.getPositions(E);for(const P of M){const N=l.feature(P.index);for(const B in this.binders){const U=this.binders[B];if((U instanceof _r||U instanceof yr||U instanceof vs)&&U.expression.isStateDependent===!0){const j=m.paint.get(B);U.expression=j.value,U.updatePaintArray(P.start,P.end,N,t[E],b),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Mo||l instanceof Mn)&&t.push(...l.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof _r||l instanceof yr)for(let m=0;m<l.paintVertexAttributes.length;m++)t.push(l.paintVertexAttributes[m].name);else if(l instanceof vs)for(let m=0;m<Yr.members.length;m++)t.push(Yr.members[m].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Mo||l instanceof Mn||l instanceof yr)for(const m of l.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof Mo||b instanceof Mn||b instanceof yr){for(const v of b.uniformNames)if(s[v]){const E=b.getBinding(t,s[v],v);l.push({name:v,property:m,binding:E})}}}return l}setUniforms(t,s,l,m){for(const{name:b,property:v,binding:E}of s)this.binders[v].setUniform(E,m,l.get(v),b)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof vs){const m=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(l instanceof _r||l instanceof yr)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof _r||l instanceof yr||l instanceof vs)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof _r||s instanceof yr||s instanceof vs)&&s.destroy()}}}class Ks{constructor(t,s,l=()=>!0){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new Qs(m,s,l);this.needsUpload=!1,this._featureMap=new xs,this._bufferOffset=0}populatePaintArrays(t,s,l,m,b,v){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,s,m,b,v);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,m){for(const b of l)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(t,this._featureMap,s,b,m)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Jn(o,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}function Ws(o,t,s){const l={color:{source:ha,composite:ne},number:{source:k,composite:ha}},m=function(b){return{"line-pattern":{source:_i,composite:_i},"fill-pattern":{source:_i,composite:_i},"fill-extrusion-pattern":{source:_i,composite:_i}}[b]}(o);return m&&m[s]||l[t][s]}wt("ConstantBinder",Mo),wt("CrossFadedConstantBinder",Mn),wt("SourceExpressionBinder",_r),wt("CrossFadedCompositeBinder",vs),wt("CompositeExpressionBinder",yr),wt("ProgramConfiguration",Qs,{omit:["_buffers"]}),wt("ProgramConfigurationSet",Ks);const Io=Math.pow(2,14)-1,Yf=-Io-1;function Lr(o){const t=At/o.extent,s=o.loadGeometry();for(let l=0;l<s.length;l++){const m=s[l];for(let b=0;b<m.length;b++){const v=m[b],E=Math.round(v.x*t),M=Math.round(v.y*t);v.x=Wt(E,Yf,Io),v.y=Wt(M,Yf,Io),(E<v.x||E>v.x+1||M<v.y||M>v.y+1)&&hn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function br(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?Lr(o):[]}}const ln=-32768;function Bd(o,t,s,l,m){o.emplaceBack(ln+8*t+l,ln+8*s+m)}class Vh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _t,this.indexArray=new Di,this.segments=new Li,this.programConfigurations=new Ks(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){const m=this.layers[0],b=[];let v=null,E=!1,M=m.type==="heatmap";if(m.type==="circle"){const N=m;v=N.layout.get("circle-sort-key"),E=!v.isConstant(),M=M||N.paint.get("circle-pitch-alignment")==="map"}const P=M?s.subdivisionGranularity.circle:1;for(const{feature:N,id:B,index:U,sourceLayerIndex:j}of t){const V=this.layers[0]._featureFilter.needGeometry,$=br(N,V);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),$,l))continue;const ee=E?v.evaluate($,{},l):void 0,oe={id:B,properties:N.properties,type:N.type,sourceLayerIndex:j,index:U,geometry:V?$.geometry:Lr(N),patterns:{},sortKey:ee};b.push(oe)}E&&b.sort((N,B)=>N.sortKey-B.sortKey);for(const N of b){const{geometry:B,index:U,sourceLayerIndex:j}=N,V=t[U].feature;this.addFeature(N,B,U,l,P),s.featureIndex.insert(V,B,U,j,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,un),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,m,b=1){let v;switch(b){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const E=v.length;for(const M of s)for(const P of M){const N=P.x,B=P.y;if(N<0||N>=At||B<0||B>=At)continue;const U=this.segments.prepareSegment(E*E,this.layoutVertexArray,this.indexArray,t.sortKey),j=U.vertexLength;for(let V=0;V<E;V++)for(let $=0;$<E;$++)Bd(this.layoutVertexArray,N,B,v[$],v[V]);for(let V=0;V<E-1;V++)for(let $=0;$<E-1;$++){const ee=j+V*E+$,oe=j+(V+1)*E+$;this.indexArray.emplaceBack(ee,oe+1,ee+1),this.indexArray.emplaceBack(ee,oe,oe+1)}U.vertexLength+=E*E,U.primitiveLength+=(E-1)*(E-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},m)}}function zd(o,t){for(let s=0;s<o.length;s++)if(ul(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(ul(o,t[s]))return!0;return!!Yc(o,t)}function rp(o,t,s){return!!ul(o,t)||!!Fd(t,o,s)}function $f(o,t){if(o.length===1)return Gh(t,o[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let m=0;m<l.length;m++)if(ul(o,l[m]))return!0}for(let s=0;s<o.length;s++)if(Gh(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(Yc(o,t[s]))return!0;return!1}function ec(o,t,s){if(o.length>1){if(Yc(o,t))return!0;for(let l=0;l<t.length;l++)if(Fd(t[l],o,s))return!0}for(let l=0;l<o.length;l++)if(Fd(o[l],t,s))return!0;return!1}function Yc(o,t){if(o.length===0||t.length===0)return!1;for(let s=0;s<o.length-1;s++){const l=o[s],m=o[s+1];for(let b=0;b<t.length-1;b++)if(sp(l,m,t[b],t[b+1]))return!0}return!1}function sp(o,t,s,l){return Hi(o,s,l)!==Hi(t,s,l)&&Hi(o,t,s)!==Hi(o,t,l)}function Fd(o,t,s){const l=s*s;if(t.length===1)return o.distSqr(t[0])<l;for(let m=1;m<t.length;m++)if(Xf(o,t[m-1],t[m])<l)return!0;return!1}function Xf(o,t,s){const l=t.distSqr(s);if(l===0)return o.distSqr(t);const m=((o.x-t.x)*(s.x-t.x)+(o.y-t.y)*(s.y-t.y))/l;return o.distSqr(m<0?t:m>1?s:s.sub(t)._mult(m)._add(t))}function Gh(o,t){for(let s=0;s<o.length;s++)if(ul(o[s],t))return!0;return!1}function ul(o,t){let s=!1;for(let l=0,m=o.length-1;l<o.length;m=l++){const b=o[l],v=o[m];b.y>t.y!=v.y>t.y&&t.x<(v.x-b.x)*(t.y-b.y)/(v.y-b.y)+b.x&&(s=!s)}return s}function Qf(o,t,s){const l=s[0],m=s[2];if(o.x<l.x&&t.x<l.x||o.x>m.x&&t.x>m.x||o.y<l.y&&t.y<l.y||o.y>m.y&&t.y>m.y)return!1;const b=Hi(o,t,s[0]);return b!==Hi(o,t,s[1])||b!==Hi(o,t,s[2])||b!==Hi(o,t,s[3])}function $c(o,t,s){const l=t.paint.get(o).value;return l.kind==="constant"?l.value:s.programConfigurations.get(t.id).getMaxValue(o)}function Zh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ud(o,t,s,l,m){if(!t[0]&&!t[1])return o;const b=Ve.convert(t)._mult(m);s==="viewport"&&b._rotate(-l);const v=[];for(let E=0;E<o.length;E++)v.push(o[E].sub(b));return v}let Kf,mn;wt("CircleBucket",Vh,{omit:["layers"]});var Un={get paint(){return mn=mn||new ma({"circle-radius":new Ht(te.paint_circle["circle-radius"]),"circle-color":new Ht(te.paint_circle["circle-color"]),"circle-blur":new Ht(te.paint_circle["circle-blur"]),"circle-opacity":new Ht(te.paint_circle["circle-opacity"]),"circle-translate":new vt(te.paint_circle["circle-translate"]),"circle-translate-anchor":new vt(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vt(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vt(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(te.paint_circle["circle-stroke-opacity"])})},get layout(){return Kf=Kf||new ma({"circle-sort-key":new Ht(te.layout_circle["circle-sort-key"])})}};class op extends Pr{constructor(t){super(t,Un)}createBucket(t){return new Vh(t)}queryRadius(t){const s=t;return $c("circle-radius",this,s)+$c("circle-stroke-width",this,s)+Zh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:m,transform:b,pixelsToTileUnits:v,unwrappedTileID:E,getElevation:M}){const P=Ud(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,v),N=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l),B=this.paint.get("circle-pitch-alignment")==="map",U=B?P:function(V,$,ee,oe){return V.map(ve=>Wf(ve,$,ee,oe))}(P,b,E,M),j=B?N*v:N;for(const V of m)for(const $ of V){const ee=B?$:Wf($,b,E,M);let oe=j;const ve=b.projectTileCoordinates($.x,$.y,E,M).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=ve/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=b.cameraToCenterDistance/ve),rp(U,ee,oe))return!0}return!1}}function Wf(o,t,s,l){const m=t.projectTileCoordinates(o.x,o.y,s,l).point;return new Ve((.5*m.x+.5)*t.width,(.5*-m.y+.5)*t.height)}class Jf extends Vh{}let e0;wt("HeatmapBucket",Jf,{omit:["layers"]});var up={get paint(){return e0=e0||new ma({"heatmap-radius":new Ht(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vt(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rl(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vt(te.paint_heatmap["heatmap-opacity"])})}};function Xc(o,{width:t,height:s},l,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*s*l)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${t*s*l}`)}else m=new Uint8Array(t*s*l);return o.width=t,o.height=s,o.data=m,o}function Hd(o,{width:t,height:s},l){if(t===o.width&&s===o.height)return;const m=Xc({},{width:t,height:s},l);jd(o,m,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,t),height:Math.min(o.height,s)},l),o.width=t,o.height=s,o.data=m.data}function jd(o,t,s,l,m,b){if(m.width===0||m.height===0)return t;if(m.width>o.width||m.height>o.height||s.x>o.width-m.width||s.y>o.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||l.x>t.width-m.width||l.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,E=t.data;if(v===E)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<m.height;M++){const P=((s.y+M)*o.width+s.x)*b,N=((l.y+M)*t.width+l.x)*b;for(let B=0;B<m.width*b;B++)E[N+B]=v[P+B]}return t}class Qc{constructor(t,s){Xc(this,t,1,s)}resize(t){Hd(this,t,1)}clone(){return new Qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,m,b){jd(t,s,l,m,b,1)}}class Or{constructor(t,s){Xc(this,t,4,s)}resize(t){Hd(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,m,b){jd(t,s,l,m,b,4)}}function qd(o){const t={},s=o.resolution||256,l=o.clips?o.clips.length:1,m=o.image||new Or({width:s,height:l});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const b=(v,E,M)=>{t[o.evaluationKey]=M;const P=o.expression.evaluate(t);m.data[v+E+0]=Math.floor(255*P.r/P.a),m.data[v+E+1]=Math.floor(255*P.g/P.a),m.data[v+E+2]=Math.floor(255*P.b/P.a),m.data[v+E+3]=Math.floor(255*P.a)};if(o.clips)for(let v=0,E=0;v<l;++v,E+=4*s)for(let M=0,P=0;M<s;M++,P+=4){const N=M/(s-1),{start:B,end:U}=o.clips[v];b(E,P,B*(1-N)+U*N)}else for(let v=0,E=0;v<s;v++,E+=4)b(0,E,v/(s-1));return m}wt("AlphaImage",Qc),wt("RGBAImage",Or);const Yh="big-fb";class t0 extends Pr{createBucket(t){return new Jf(t)}constructor(t){super(t,up),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Yh)&&this.heatmapFbos.delete(Yh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let i0;var a0={get paint(){return i0=i0||new ma({"hillshade-illumination-direction":new vt(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new vt(te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new vt(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vt(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vt(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vt(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vt(te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new vt(te.paint_hillshade["hillshade-method"])})}};class Vd extends Pr{constructor(t){super(t,a0),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,m=this.paint.get("hillshade-shadow-color").values;const b=Math.max(t.length,s.length,l.length,m.length);t=t.concat(Array(b-t.length).fill(t.at(-1))),s=s.concat(Array(b-s.length).fill(s.at(-1))),l=l.concat(Array(b-l.length).fill(l.at(-1))),m=m.concat(Array(b-m.length).fill(m.at(-1)));const v=s.map(oo);return{directionRadians:t.map(oo),altitudeRadians:v,shadowColor:m,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const n0=ca([{name:"a_pos",components:2,type:"Int16"}],4),{members:lp}=n0;function $h(o,t,s){const l=s.patternDependencies;let m=!1;for(const b of t){const v=b.paint.get(`${o}-pattern`);v.isConstant()||(m=!0);const E=v.constantOr(null);E&&(m=!0,l[E.to]=!0,l[E.from]=!0)}return m}function Gd(o,t,s,l,m){const b=m.patternDependencies;for(const v of t){const E=v.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let M=E.evaluate({zoom:l-1},s,{},m.availableImages),P=E.evaluate({zoom:l},s,{},m.availableImages),N=E.evaluate({zoom:l+1},s,{},m.availableImages);M=M&&M.name?M.name:M,P=P&&P.name?P.name:P,N=N&&N.name?N.name:N,b[M]=!0,b[P]=!0,b[N]=!0,s.patterns[v.id]={min:M,mid:P,max:N}}}return s}function Do(o,t,s,l,m){let b;if(m===function(v,E,M,P){let N=0;for(let B=E,U=M-P;B<M;B+=P)N+=(v[U]-v[B])*(v[B+1]+v[U+1]),U=B;return N}(o,t,s,l)>0)for(let v=t;v<s;v+=l)b=$d(v/l|0,o[v],o[v+1],b);else for(let v=s-l;v>=t;v-=l)b=$d(v/l|0,o[v],o[v+1],b);return b&&Ro(b,b.next)&&(ll(b),b=b.next),b}function yu(o,t){if(!o)return o;t||(t=o);let s,l=o;do if(s=!1,l.steiner||!Ro(l,l.next)&&Pa(l.prev,l,l.next)!==0)l=l.next;else{if(ll(l),l=t=l.prev,l===l.next)break;s=!0}while(s||l!==t);return t}function Xh(o,t,s,l,m,b,v){if(!o)return;!v&&b&&function(M,P,N,B){let U=M;do U.z===0&&(U.z=r0(U.x,U.y,P,N,B)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==M);U.prevZ.nextZ=null,U.prevZ=null,function(j){let V,$=1;do{let ee,oe=j;j=null;let ve=null;for(V=0;oe;){V++;let ue=oe,H=0;for(let fe=0;fe<$&&(H++,ue=ue.nextZ,ue);fe++);let J=$;for(;H>0||J>0&&ue;)H!==0&&(J===0||!ue||oe.z<=ue.z)?(ee=oe,oe=oe.nextZ,H--):(ee=ue,ue=ue.nextZ,J--),ve?ve.nextZ=ee:j=ee,ee.prevZ=ve,ve=ee;oe=ue}ve.nextZ=null,$*=2}while(V>1)}(U)}(o,l,m,b);let E=o;for(;o.prev!==o.next;){const M=o.prev,P=o.next;if(b?bu(o,l,m,b):cp(o))t.push(M.i,o.i,P.i),ll(o),o=P.next,E=P.next;else if((o=P)===E){v?v===1?Xh(o=hp(yu(o),t),t,s,l,m,b,2):v===2&&Zd(o,t,s,l,m,b):Xh(yu(o),t,s,l,m,b,1);break}}}function cp(o){const t=o.prev,s=o,l=o.next;if(Pa(t,s,l)>=0)return!1;const m=t.x,b=s.x,v=l.x,E=t.y,M=s.y,P=l.y,N=Math.min(m,b,v),B=Math.min(E,M,P),U=Math.max(m,b,v),j=Math.max(E,M,P);let V=l.next;for(;V!==t;){if(V.x>=N&&V.x<=U&&V.y>=B&&V.y<=j&&Ts(m,E,b,M,v,P,V.x,V.y)&&Pa(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function bu(o,t,s,l){const m=o.prev,b=o,v=o.next;if(Pa(m,b,v)>=0)return!1;const E=m.x,M=b.x,P=v.x,N=m.y,B=b.y,U=v.y,j=Math.min(E,M,P),V=Math.min(N,B,U),$=Math.max(E,M,P),ee=Math.max(N,B,U),oe=r0(j,V,t,s,l),ve=r0($,ee,t,s,l);let ue=o.prevZ,H=o.nextZ;for(;ue&&ue.z>=oe&&H&&H.z<=ve;){if(ue.x>=j&&ue.x<=$&&ue.y>=V&&ue.y<=ee&&ue!==m&&ue!==v&&Ts(E,N,M,B,P,U,ue.x,ue.y)&&Pa(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,H.x>=j&&H.x<=$&&H.y>=V&&H.y<=ee&&H!==m&&H!==v&&Ts(E,N,M,B,P,U,H.x,H.y)&&Pa(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;ue&&ue.z>=oe;){if(ue.x>=j&&ue.x<=$&&ue.y>=V&&ue.y<=ee&&ue!==m&&ue!==v&&Ts(E,N,M,B,P,U,ue.x,ue.y)&&Pa(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;H&&H.z<=ve;){if(H.x>=j&&H.x<=$&&H.y>=V&&H.y<=ee&&H!==m&&H!==v&&Ts(E,N,M,B,P,U,H.x,H.y)&&Pa(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function hp(o,t){let s=o;do{const l=s.prev,m=s.next.next;!Ro(l,m)&&Js(l,s,s.next,m)&&Jc(l,m)&&Jc(m,l)&&(t.push(l.i,s.i,m.i),ll(s),ll(s.next),s=o=m),s=s.next}while(s!==o);return yu(s)}function Zd(o,t,s,l,m,b){let v=o;do{let E=v.next.next;for(;E!==v.prev;){if(v.i!==E.i&&fp(v,E)){let M=Yd(v,E);return v=yu(v,v.next),M=yu(M,M.next),Xh(v,t,s,l,m,b,0),void Xh(M,t,s,l,m,b,0)}E=E.next}v=v.next}while(v!==o)}function Qh(o,t){let s=o.x-t.x;return s===0&&(s=o.y-t.y,s===0)&&(s=(o.next.y-o.y)/(o.next.x-o.x)-(t.next.y-t.y)/(t.next.x-t.x)),s}function Ua(o,t){const s=function(m,b){let v=b;const E=m.x,M=m.y;let P,N=-1/0;if(Ro(m,v))return v;do{if(Ro(m,v.next))return v.next;if(M<=v.y&&M>=v.next.y&&v.next.y!==v.y){const $=v.x+(M-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if($<=E&&$>N&&(N=$,P=v.x<v.next.x?v:v.next,$===E))return P}v=v.next}while(v!==b);if(!P)return null;const B=P,U=P.x,j=P.y;let V=1/0;v=P;do{if(E>=v.x&&v.x>=U&&E!==v.x&&Kc(M<j?E:N,M,U,j,M<j?N:E,M,v.x,v.y)){const $=Math.abs(M-v.y)/(E-v.x);Jc(v,m)&&($<V||$===V&&(v.x>P.x||v.x===P.x&&ym(P,v)))&&(P=v,V=$)}v=v.next}while(v!==B);return P}(o,t);if(!s)return t;const l=Yd(s,o);return yu(l,l.next),yu(s,s.next)}function ym(o,t){return Pa(o.prev,o,t.prev)<0&&Pa(t.next,o,o.next)<0}function r0(o,t,s,l,m){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function dp(o){let t=o,s=o;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==o);return s}function Kc(o,t,s,l,m,b,v,E){return(m-v)*(t-E)>=(o-v)*(b-E)&&(o-v)*(l-E)>=(s-v)*(t-E)&&(s-v)*(b-E)>=(m-v)*(l-E)}function Ts(o,t,s,l,m,b,v,E){return!(o===v&&t===E)&&Kc(o,t,s,l,m,b,v,E)}function fp(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(s,l){let m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==l.i&&m.next.i!==l.i&&Js(m,m.next,s,l))return!0;m=m.next}while(m!==s);return!1}(o,t)&&(Jc(o,t)&&Jc(t,o)&&function(s,l){let m=s,b=!1;const v=(s.x+l.x)/2,E=(s.y+l.y)/2;do m.y>E!=m.next.y>E&&m.next.y!==m.y&&v<(m.next.x-m.x)*(E-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==s);return b}(o,t)&&(Pa(o.prev,o,t.prev)||Pa(o,t.prev,t))||Ro(o,t)&&Pa(o.prev,o,o.next)>0&&Pa(t.prev,t,t.next)>0)}function Pa(o,t,s){return(t.y-o.y)*(s.x-t.x)-(t.x-o.x)*(s.y-t.y)}function Ro(o,t){return o.x===t.x&&o.y===t.y}function Js(o,t,s,l){const m=Wc(Pa(o,t,s)),b=Wc(Pa(o,t,l)),v=Wc(Pa(s,l,o)),E=Wc(Pa(s,l,t));return m!==b&&v!==E||!(m!==0||!Kh(o,s,t))||!(b!==0||!Kh(o,l,t))||!(v!==0||!Kh(s,o,l))||!(E!==0||!Kh(s,t,l))}function Kh(o,t,s){return t.x<=Math.max(o.x,s.x)&&t.x>=Math.min(o.x,s.x)&&t.y<=Math.max(o.y,s.y)&&t.y>=Math.min(o.y,s.y)}function Wc(o){return o>0?1:o<0?-1:0}function Jc(o,t){return Pa(o.prev,o,o.next)<0?Pa(o,t,o.next)>=0&&Pa(o,o.prev,t)>=0:Pa(o,t,o.prev)<0||Pa(o,o.next,t)<0}function Yd(o,t){const s=Xd(o.i,o.x,o.y),l=Xd(t.i,t.x,t.y),m=o.next,b=t.prev;return o.next=t,t.prev=o,s.next=m,m.prev=s,l.next=s,s.prev=l,b.next=l,l.prev=b,l}function $d(o,t,s,l){const m=Xd(o,t,s);return l?(m.next=l.next,m.prev=l,l.next.prev=m,l.next=m):(m.prev=m,m.next=m),m}function ll(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Xd(o,t,s){return{i:o,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Nr{constructor(t,s){if(s>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=s}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class La{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}La.noSubdivision=new La({fill:new Nr(0,0),line:new Nr(0,0),tile:new Nr(0,0),stencil:new Nr(0,0),circle:1}),wt("SubdivisionGranularityExpression",Nr),wt("SubdivisionGranularitySetting",La);const cl=-32768,eh=32767;class In{constructor(t,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=At/t,this._canonical=s}_getKey(t,s){return(t+=32768)<<16|(s+=32768)<<0}_vertexToIndex(t,s){if(t<-32768||s<-32768||t>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),m=0|Math.round(s),b=this._getKey(l,m);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,v),this._vertexBuffer.push(l,m),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(m,b){const v=[];for(let E=0;E<b.length;E+=3){const M=b[E],P=b[E+1],N=b[E+2],B=m[2*M],U=m[2*M+1];(m[2*P]-B)*(m[2*N+1]-U)-(m[2*P+1]-U)*(m[2*N]-B)>0?(v.push(M),v.push(N),v.push(P)):(v.push(M),v.push(P),v.push(N))}return v}(this._vertexBuffer,t);const s=[],l=t.length;for(let m=0;m<l;m+=3){const b=[t[m+0],t[m+1],t[m+2]],v=[this._vertexBuffer[2*t[m+0]+0],this._vertexBuffer[2*t[m+0]+1],this._vertexBuffer[2*t[m+1]+0],this._vertexBuffer[2*t[m+1]+1],this._vertexBuffer[2*t[m+2]+0],this._vertexBuffer[2*t[m+2]+1]];let E=1/0,M=1/0,P=-1/0,N=-1/0;for(let $=0;$<3;$++){const ee=v[2*$],oe=v[2*$+1];E=Math.min(E,ee),P=Math.max(P,ee),M=Math.min(M,oe),N=Math.max(N,oe)}if(E===P||M===N)continue;const B=Math.floor(E/this._granularityCellSize),U=Math.ceil(P/this._granularityCellSize),j=Math.floor(M/this._granularityCellSize),V=Math.ceil(N/this._granularityCellSize);if(B!==U||j!==V)for(let $=j;$<V;$++){const ee=this._scanlineGenerateVertexRingForCellRow($,v,b);mp(this._vertexBuffer,ee,s)}else s.push(...b)}return s}_scanlineGenerateVertexRingForCellRow(t,s,l){const m=t*this._granularityCellSize,b=m+this._granularityCellSize,v=[];for(let E=0;E<3;E++){const M=s[2*E],P=s[2*E+1],N=s[2*(E+1)%6],B=s[(2*(E+1)+1)%6],U=s[2*(E+2)%6],j=s[(2*(E+2)+1)%6],V=N-M,$=B-P,ee=V===0,oe=$===0,ve=(m-P)/$,ue=(b-P)/$,H=Math.min(ve,ue),J=Math.max(ve,ue);if(!oe&&(H>=1||J<=0)||oe&&(P<m||P>b)){B>=m&&B<=b&&v.push(l[(E+1)%3]);continue}!oe&&H>0&&v.push(this._vertexToIndex(M+V*H,P+$*H));const fe=M+V*Math.max(H,0),Be=M+V*Math.min(J,1);ee||this._generateIntraEdgeVertices(v,M,P,N,B,fe,Be),!oe&&J<1&&v.push(this._vertexToIndex(M+V*J,P+$*J)),(oe||B>=m&&B<=b)&&v.push(l[(E+1)%3]),!oe&&(B<=m||B>=b)&&this._generateInterEdgeVertices(v,M,P,N,B,U,j,Be,m,b)}return v}_generateIntraEdgeVertices(t,s,l,m,b,v,E){const M=m-s,P=b-l,N=P===0,B=N?Math.min(s,m):Math.min(v,E),U=N?Math.max(s,m):Math.max(v,E),j=Math.floor(B/this._granularityCellSize)+1,V=Math.ceil(U/this._granularityCellSize)-1;if(N?s<m:v<E)for(let $=j;$<=V;$++){const ee=$*this._granularityCellSize;t.push(this._vertexToIndex(ee,l+P*(ee-s)/M))}else for(let $=V;$>=j;$--){const ee=$*this._granularityCellSize;t.push(this._vertexToIndex(ee,l+P*(ee-s)/M))}}_generateInterEdgeVertices(t,s,l,m,b,v,E,M,P,N){const B=b-l,U=v-m,j=E-b,V=(P-b)/j,$=(N-b)/j,ee=Math.min(V,$),oe=Math.max(V,$),ve=m+U*ee;let ue=Math.floor(Math.min(ve,M)/this._granularityCellSize)+1,H=Math.ceil(Math.max(ve,M)/this._granularityCellSize)-1,J=M<ve;const fe=j===0;if(fe&&(E===P||E===N))return;if(fe||ee>=1||oe<=0){const st=l-E,je=v+(s-v)*Math.min((P-E)/st,(N-E)/st);ue=Math.floor(Math.min(je,M)/this._granularityCellSize)+1,H=Math.ceil(Math.max(je,M)/this._granularityCellSize)-1,J=M<je}const Be=B>0?N:P;if(J)for(let st=ue;st<=H;st++)t.push(this._vertexToIndex(st*this._granularityCellSize,Be));else for(let st=H;st>=ue;st--)t.push(this._vertexToIndex(st*this._granularityCellSize,Be))}_generateOutline(t){const s=[];for(const l of t){const m=hl(l,this._granularity,!0),b=this._pointArrayToIndices(m),v=[];for(let E=1;E<b.length;E++)v.push(b[E-1]),v.push(b[E]);s.push(v)}return s}_handlePoles(t){let s=!1,l=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(s||l)&&this._fillPoles(t,s,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let s=0;s<t.length;s+=2){const l=t[s+1];l===cl&&(t[s+1]=-32767),l===eh&&(t[s+1]=32766)}}_generatePoleQuad(t,s,l,m,b,v){m>b!=(v===cl)?(t.push(s),t.push(l),t.push(this._vertexToIndex(m,v)),t.push(l),t.push(this._vertexToIndex(b,v)),t.push(this._vertexToIndex(m,v))):(t.push(l),t.push(s),t.push(this._vertexToIndex(m,v)),t.push(this._vertexToIndex(b,v)),t.push(l),t.push(this._vertexToIndex(m,v)))}_fillPoles(t,s,l){const m=this._vertexBuffer,b=At,v=t.length;for(let E=2;E<v;E+=3){const M=t[E-2],P=t[E-1],N=t[E],B=m[2*M],U=m[2*M+1],j=m[2*P],V=m[2*P+1],$=m[2*N],ee=m[2*N+1];s&&(U===0&&V===0&&this._generatePoleQuad(t,M,P,B,j,cl),V===0&&ee===0&&this._generatePoleQuad(t,P,N,j,$,cl),ee===0&&U===0&&this._generatePoleQuad(t,N,M,$,B,cl)),l&&(U===b&&V===b&&this._generatePoleQuad(t,M,P,B,j,eh),V===b&&ee===b&&this._generatePoleQuad(t,P,N,j,$,eh),ee===b&&U===b&&this._generatePoleQuad(t,N,M,$,B,eh))}}_initializeVertices(t){for(let s=0;s<t.length;s+=2)this._vertexToIndex(t[s],t[s+1])}subdividePolygonInternal(t,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:m}=function(E){const M=[],P=[];for(const N of E)if(N.length!==0){N!==E[0]&&M.push(P.length/2);for(let B=0;B<N.length;B++)P.push(N[B].x),P.push(N[B].y)}return{flattened:P,holeIndices:M}}(t);let b;this._initializeVertices(l);try{const E=function(P,N,B=2){const U=N&&N.length,j=U?N[0]*B:P.length;let V=Do(P,0,j,B,!0);const $=[];if(!V||V.next===V.prev)return $;let ee,oe,ve;if(U&&(V=function(ue,H,J,fe){const Be=[];for(let st=0,je=H.length;st<je;st++){const Qe=Do(ue,H[st]*fe,st<je-1?H[st+1]*fe:ue.length,fe,!1);Qe===Qe.next&&(Qe.steiner=!0),Be.push(dp(Qe))}Be.sort(Qh);for(let st=0;st<Be.length;st++)J=Ua(Be[st],J);return J}(P,N,V,B)),P.length>80*B){ee=1/0,oe=1/0;let ue=-1/0,H=-1/0;for(let J=B;J<j;J+=B){const fe=P[J],Be=P[J+1];fe<ee&&(ee=fe),Be<oe&&(oe=Be),fe>ue&&(ue=fe),Be>H&&(H=Be)}ve=Math.max(ue-ee,H-oe),ve=ve!==0?32767/ve:0}return Xh(V,$,B,ee,oe,ve,0),$}(l,m),M=this._convertIndices(l,E);b=this._subdivideTrianglesScanline(M)}catch(E){console.error(E)}let v=[];return s&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:v}}_convertIndices(t,s){const l=[];for(let m=0;m<s.length;m++)l.push(this._vertexToIndex(t[2*s[m]],t[2*s[m]+1]));return l}_pointArrayToIndices(t){const s=[];for(let l=0;l<t.length;l++){const m=t[l];s.push(this._vertexToIndex(m.x,m.y))}return s}}function pp(o,t,s,l=!0){return new In(s,t).subdividePolygonInternal(o,l)}function hl(o,t,s=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const l=o[0],m=o[o.length-1],b=s&&(l.x!==m.x||l.y!==m.y);if(t<2)return b?[...o,o[0]]:[...o];const v=Math.floor(At/t),E=[];E.push(new Ve(o[0].x,o[0].y));const M=o.length,P=b?M:M-1;for(let N=0;N<P;N++){const B=o[N],U=N<M-1?o[N+1]:o[0],j=B.x,V=B.y,$=U.x,ee=U.y,oe=j!==$,ve=V!==ee;if(!oe&&!ve)continue;const ue=$-j,H=ee-V,J=Math.abs(ue),fe=Math.abs(H);let Be=j,st=V;for(;;){const Qe=ue>0?(Math.floor(Be/v)+1)*v:(Math.ceil(Be/v)-1)*v,ht=H>0?(Math.floor(st/v)+1)*v:(Math.ceil(st/v)-1)*v,ut=Math.abs(Be-Qe),ft=Math.abs(st-ht),We=Math.abs(Be-$),It=Math.abs(st-ee),Bt=oe?ut/J:Number.POSITIVE_INFINITY,kt=ve?ft/fe:Number.POSITIVE_INFINITY;if((We<=ut||!oe)&&(It<=ft||!ve))break;if(Bt<kt&&oe||!ve){Be=Qe,st+=H*Bt;const Pt=new Ve(Be,Math.round(st));E[E.length-1].x===Pt.x&&E[E.length-1].y===Pt.y||E.push(Pt)}else{Be+=ue*kt,st=ht;const Pt=new Ve(Math.round(Be),st);E[E.length-1].x===Pt.x&&E[E.length-1].y===Pt.y||E.push(Pt)}}const je=new Ve($,ee);E[E.length-1].x===je.x&&E[E.length-1].y===je.y||E.push(je)}return E}function mp(o,t,s){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,m=o[2*t[0]];for(let M=1;M<t.length;M++){const P=o[2*t[M]];P<m&&(m=P,l=M)}const b=t.length;let v=l,E=(v+1)%b;for(;;){const M=v-1>=0?v-1:b-1,P=(E+1)%b,N=o[2*t[M]],B=o[2*t[P]],U=o[2*t[v]],j=o[2*t[v]+1],V=o[2*t[E]+1];let $=!1;if(N<B)$=!0;else if(N>B)$=!1;else{const ee=V-j,oe=-(o[2*t[E]]-U),ve=j<V?1:-1;((N-U)*ee+(o[2*t[M]+1]-j)*oe)*ve>((B-U)*ee+(o[2*t[P]+1]-j)*oe)*ve&&($=!0)}if($){const ee=t[M],oe=t[v],ve=t[E];ee!==oe&&ee!==ve&&oe!==ve&&s.push(ve,oe,ee),v--,v<0&&(v=b-1)}else{const ee=t[P],oe=t[v],ve=t[E];ee!==oe&&ee!==ve&&oe!==ve&&s.push(ve,oe,ee),E++,E>=b&&(E=0)}if(M===P)break}}function wa(o,t,s,l,m,b,v,E,M){const P=m.length/2,N=v&&E&&M;if(P<Li.MAX_VERTEX_ARRAY_LENGTH){const B=t.prepareSegment(P,s,l),U=B.vertexLength;for(let $=0;$<b.length;$+=3)l.emplaceBack(U+b[$],U+b[$+1],U+b[$+2]);let j,V;B.vertexLength+=P,B.primitiveLength+=b.length/3,N&&(V=v.prepareSegment(P,s,E),j=V.vertexLength,V.vertexLength+=P);for(let $=0;$<m.length;$+=2)o(m[$],m[$+1]);if(N)for(let $=0;$<M.length;$++){const ee=M[$];for(let oe=1;oe<ee.length;oe+=2)E.emplaceBack(j+ee[oe-1],j+ee[oe]);V.primitiveLength+=ee.length/2}}else(function(B,U,j,V,$,ee){const oe=[];for(let fe=0;fe<V.length/2;fe++)oe.push(-1);const ve={count:0};let ue=0,H=B.getOrCreateLatestSegment(U,j),J=H.vertexLength;for(let fe=2;fe<$.length;fe+=3){const Be=$[fe-2],st=$[fe-1],je=$[fe];let Qe=oe[Be]<ue,ht=oe[st]<ue,ut=oe[je]<ue;H.vertexLength+((Qe?1:0)+(ht?1:0)+(ut?1:0))>Li.MAX_VERTEX_ARRAY_LENGTH&&(H=B.createNewSegment(U,j),ue=ve.count,Qe=!0,ht=!0,ut=!0,J=0);const ft=Dn(oe,V,ee,ve,Be,Qe,H),We=Dn(oe,V,ee,ve,st,ht,H),It=Dn(oe,V,ee,ve,je,ut,H);j.emplaceBack(J+ft-ue,J+We-ue,J+It-ue),H.primitiveLength++}})(t,s,l,m,b,o),N&&function(B,U,j,V,$,ee){const oe=[];for(let fe=0;fe<V.length/2;fe++)oe.push(-1);const ve={count:0};let ue=0,H=B.getOrCreateLatestSegment(U,j),J=H.vertexLength;for(let fe=0;fe<$.length;fe++){const Be=$[fe];for(let st=1;st<$[fe].length;st+=2){const je=Be[st-1],Qe=Be[st];let ht=oe[je]<ue,ut=oe[Qe]<ue;H.vertexLength+((ht?1:0)+(ut?1:0))>Li.MAX_VERTEX_ARRAY_LENGTH&&(H=B.createNewSegment(U,j),ue=ve.count,ht=!0,ut=!0,J=0);const ft=Dn(oe,V,ee,ve,je,ht,H),We=Dn(oe,V,ee,ve,Qe,ut,H);j.emplaceBack(J+ft-ue,J+We-ue),H.primitiveLength++}}}(v,s,E,m,M,o),t.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function Dn(o,t,s,l,m,b,v){if(b){const E=l.count;return s(t[2*m],t[2*m+1]),o[m]=l.count,l.count++,v.vertexLength++,E}return o[m]}class eo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mt,this.indexArray=new Di,this.indexArray2=new za,this.programConfigurations=new Ks(t.layers,t.zoom),this.segments=new Li,this.segments2=new Li,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=$h("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),v=[];for(const{feature:E,id:M,index:P,sourceLayerIndex:N}of t){const B=this.layers[0]._featureFilter.needGeometry,U=br(E,B);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),U,l))continue;const j=b?m.evaluate(U,{},l,s.availableImages):void 0,V={id:M,properties:E.properties,type:E.type,sourceLayerIndex:N,index:P,geometry:B?U.geometry:Lr(E),patterns:{},sortKey:j};v.push(V)}b&&v.sort((E,M)=>E.sortKey-M.sortKey);for(const E of v){const{geometry:M,index:P,sourceLayerIndex:N}=E;if(this.hasPattern){const B=Gd("fill",this.layers,E,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(E,M,P,l,{},s.subdivisionGranularity);s.featureIndex.insert(t[P].feature,M,P,N,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,m,b,v){for(const E of Ol(s,500)){const M=pp(E,m,v.fill.getGranularityForZoomLevel(m.z)),P=this.layoutVertexArray;wa((N,B)=>{P.emplaceBack(N,B)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,b,m)}}let s0,o0;wt("FillBucket",eo,{omit:["layers","patternFeatures"]});var bm={get paint(){return o0=o0||new ma({"fill-antialias":new vt(te.paint_fill["fill-antialias"]),"fill-opacity":new Ht(te.paint_fill["fill-opacity"]),"fill-color":new Ht(te.paint_fill["fill-color"]),"fill-outline-color":new Ht(te.paint_fill["fill-outline-color"]),"fill-translate":new vt(te.paint_fill["fill-translate"]),"fill-translate-anchor":new vt(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ys(te.paint_fill["fill-pattern"])})},get layout(){return s0=s0||new ma({"fill-sort-key":new Ht(te.layout_fill["fill-sort-key"])})}};class u0 extends Pr{constructor(t){super(t,bm)}recalculate(t,s){super.recalculate(t,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new eo(t)}queryRadius(){return Zh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:s,transform:l,pixelsToTileUnits:m}){return $f(Ud(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,m),s)}isTileClipped(){return!0}}const $r=ca([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),to=ca([{name:"a_centroid",components:2,type:"Int16"}],4),{members:gp}=$r;var xr,l0,Po,dl,Lo,Qd,Kd,Xr={};function c0(){if(l0)return xr;l0=1;var o=Me();function t(m,b,v,E,M){this.properties={},this.extent=v,this.type=0,this._pbf=m,this._geometry=-1,this._keys=E,this._values=M,m.readFields(s,this,b)}function s(m,b,v){m==1?b.id=v.readVarint():m==2?function(E,M){for(var P=E.readVarint()+E.pos;E.pos<P;){var N=M._keys[E.readVarint()],B=M._values[E.readVarint()];M.properties[N]=B}}(v,b):m==3?b.type=v.readVarint():m==4&&(b._geometry=v.pos)}function l(m){for(var b,v,E=0,M=0,P=m.length,N=P-1;M<P;N=M++)E+=((v=m[N]).x-(b=m[M]).x)*(b.y+v.y);return E}return xr=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var b,v=m.readVarint()+m.pos,E=1,M=0,P=0,N=0,B=[];m.pos<v;){if(M<=0){var U=m.readVarint();E=7&U,M=U>>3}if(M--,E===1||E===2)P+=m.readSVarint(),N+=m.readSVarint(),E===1&&(b&&B.push(b),b=[]),b.push(new o(P,N));else{if(E!==7)throw new Error("unknown command "+E);b&&b.push(b[0].clone())}}return b&&B.push(b),B},t.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var b=m.readVarint()+m.pos,v=1,E=0,M=0,P=0,N=1/0,B=-1/0,U=1/0,j=-1/0;m.pos<b;){if(E<=0){var V=m.readVarint();v=7&V,E=V>>3}if(E--,v===1||v===2)(M+=m.readSVarint())<N&&(N=M),M>B&&(B=M),(P+=m.readSVarint())<U&&(U=P),P>j&&(j=P);else if(v!==7)throw new Error("unknown command "+v)}return[N,U,B,j]},t.prototype.toGeoJSON=function(m,b,v){var E,M,P=this.extent*Math.pow(2,v),N=this.extent*m,B=this.extent*b,U=this.loadGeometry(),j=t.types[this.type];function V(oe){for(var ve=0;ve<oe.length;ve++){var ue=oe[ve];oe[ve]=[360*(ue.x+N)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+B)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(E=0;E<U.length;E++)$[E]=U[E][0];V(U=$);break;case 2:for(E=0;E<U.length;E++)V(U[E]);break;case 3:for(U=function(oe){var ve=oe.length;if(ve<=1)return[oe];for(var ue,H,J=[],fe=0;fe<ve;fe++){var Be=l(oe[fe]);Be!==0&&(H===void 0&&(H=Be<0),H===Be<0?(ue&&J.push(ue),ue=[oe[fe]]):ue.push(oe[fe]))}return ue&&J.push(ue),J}(U),E=0;E<U.length;E++)for(M=0;M<U[E].length;M++)V(U[E][M])}U.length===1?U=U[0]:j="Multi"+j;var ee={type:"Feature",geometry:{type:j,coordinates:U},properties:this.properties};return"id"in this&&(ee.id=this.id),ee},xr}function tc(){if(dl)return Po;dl=1;var o=c0();function t(l,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(s,this,m),this.length=this._features.length}function s(l,m,b){l===15?m.version=b.readVarint():l===1?m.name=b.readString():l===5?m.extent=b.readVarint():l===2?m._features.push(b.pos):l===3?m._keys.push(b.readString()):l===4&&m._values.push(function(v){for(var E=null,M=v.readVarint()+v.pos;v.pos<M;){var P=v.readVarint()>>3;E=P===1?v.readString():P===2?v.readFloat():P===3?v.readDouble():P===4?v.readVarint64():P===5?v.readVarint():P===6?v.readSVarint():P===7?v.readBoolean():null}return E}(b))}return Po=t,t.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var m=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,m,this.extent,this._keys,this._values)},Po}function th(){return Kd||(Kd=1,Xr.VectorTile=function(){if(Qd)return Lo;Qd=1;var o=tc();function t(s,l,m){if(s===3){var b=new o(m,m.readVarint()+m.pos);b.length&&(l[b.name]=b)}}return Lo=function(s,l){this.layers=s.readFields(t,{},l)},Lo}(),Xr.VectorTileFeature=c0(),Xr.VectorTileLayer=tc()),Xr}var xu=Z(th());const ih=xu.VectorTileFeature.types,Wd=Math.pow(2,13);function ah(o,t,s,l,m,b,v,E){o.emplaceBack(t,s,2*Math.floor(l*Wd)+v,m*Wd*2,b*Wd*2,Math.round(E))}class ic{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new rt,this.centroidVertexArray=new $e,this.indexArray=new Di,this.programConfigurations=new Ks(t.layers,t.zoom),this.segments=new Li,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.features=[],this.hasPattern=$h("fill-extrusion",this.layers,s);for(const{feature:m,id:b,index:v,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,P=br(m,M);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),P,l))continue;const N={id:b,sourceLayerIndex:E,index:v,geometry:M?P.geometry:Lr(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Gd("fill-extrusion",this.layers,N,this.zoom,s)):this.addFeature(N,N.geometry,v,l,{},s.subdivisionGranularity),s.featureIndex.insert(m,N.geometry,v,E,this.index,!0)}}addFeatures(t,s,l){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,s,l,t.subdivisionGranularity)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,to.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,l,m,b,v){for(const E of Ol(s,500)){const M={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(M,m,t,E,v);const N=this.layoutVertexArray.length-P,B=Math.floor(M.x/M.sampleCount),U=Math.floor(M.y/M.sampleCount);for(let j=0;j<N;j++)this.centroidVertexArray.emplaceBack(B,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,b,m)}processPolygon(t,s,l,m,b){if(m.length<1||h0(m[0]))return;for(const B of m)B.length!==0&&_p(t,B);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},E=b.fill.getGranularityForZoomLevel(s.z),M=ih[l.type]==="Polygon";for(const B of m){if(B.length===0||h0(B))continue;const U=hl(B,E,M);this._generateSideFaces(U,v)}if(!M)return;const P=pp(m,s,E,!1),N=this.layoutVertexArray;wa((B,U)=>{ah(N,B,U,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(t,s){let l=0;for(let m=1;m<t.length;m++){const b=t[m],v=t[m-1];if(Jd(b,v))continue;s.segment.vertexLength+4>Li.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const E=b.sub(v)._perp()._unit(),M=v.dist(b);l+M>32768&&(l=0),ah(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,0,l),ah(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,1,l),l+=M,ah(this.layoutVertexArray,v.x,v.y,E.x,E.y,0,0,l),ah(this.layoutVertexArray,v.x,v.y,E.x,E.y,0,1,l);const P=s.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function _p(o,t){for(let s=0;s<t.length;s++){const l=t[s];s===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(o.x+=l.x,o.y+=l.y,o.sampleCount++)}}function Jd(o,t){return o.x===t.x&&(o.x<0||o.x>At)||o.y===t.y&&(o.y<0||o.y>At)}function h0(o){return o.every(t=>t.x<0)||o.every(t=>t.x>At)||o.every(t=>t.y<0)||o.every(t=>t.y>At)}let yp;wt("FillExtrusionBucket",ic,{omit:["layers","features"]});var xm={get paint(){return yp=yp||new ma({"fill-extrusion-opacity":new vt(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vt(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vt(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ys(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vt(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ta extends Pr{constructor(t){super(t,xm)}createBucket(t){return new ic(t)}queryRadius(){return Zh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:m,transform:b,pixelsToTileUnits:v,pixelPosMatrix:E}){const M=Ud(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,v),P=this.paint.get("fill-extrusion-height").evaluate(s,l),N=this.paint.get("fill-extrusion-base").evaluate(s,l),B=function(j,V,$){const ee=[];for(const oe of j){const ve=[oe.x,oe.y,0,1];zi(ve,ve,V),ee.push(new Ve(ve[0]/ve[3],ve[1]/ve[3]))}return ee}(M,E),U=function(j,V,$,ee){const oe=[],ve=[],ue=ee[8]*V,H=ee[9]*V,J=ee[10]*V,fe=ee[11]*V,Be=ee[8]*$,st=ee[9]*$,je=ee[10]*$,Qe=ee[11]*$;for(const ht of j){const ut=[],ft=[];for(const We of ht){const It=We.x,Bt=We.y,kt=ee[0]*It+ee[4]*Bt+ee[12],Pt=ee[1]*It+ee[5]*Bt+ee[13],pi=ee[2]*It+ee[6]*Bt+ee[14],Fi=ee[3]*It+ee[7]*Bt+ee[15],oa=pi+J,Aa=Fi+fe,jn=kt+Be,gn=Pt+st,ga=pi+je,_a=Fi+Qe,Wa=new Ve((kt+ue)/Aa,(Pt+H)/Aa);Wa.z=oa/Aa,ut.push(Wa);const ja=new Ve(jn/_a,gn/_a);ja.z=ga/_a,ft.push(ja)}oe.push(ut),ve.push(ft)}return[oe,ve]}(m,N,P,E);return function(j,V,$){let ee=1/0;$f($,V)&&(ee=wi($,V[0]));for(let oe=0;oe<V.length;oe++){const ve=V[oe],ue=j[oe];for(let H=0;H<ve.length-1;H++){const J=ve[H],fe=[J,ve[H+1],ue[H+1],ue[H],J];zd($,fe)&&(ee=Math.min(ee,wi($,fe)))}}return ee!==1/0&&ee}(U[0],U[1],B)}}function Qi(o,t){return o.x*t.x+o.y*t.y}function wi(o,t){if(o.length===1){let s=0;const l=t[s++];let m;for(;!m||l.equals(m);)if(m=t[s++],!m)return 1/0;for(;s<t.length;s++){const b=t[s],v=o[0],E=m.sub(l),M=b.sub(l),P=v.sub(l),N=Qi(E,E),B=Qi(E,M),U=Qi(M,M),j=Qi(P,E),V=Qi(P,M),$=N*U-B*B,ee=(U*j-B*V)/$,oe=(N*V-B*j)/$,ve=l.z*(1-ee-oe)+m.z*ee+b.z*oe;if(isFinite(ve))return ve}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}const Oi=ca([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ia}=Oi,Qr=ca([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:fl}=Qr,nh=xu.VectorTileFeature.types,d0=Math.cos(Math.PI/180*37.5),Oo=Math.pow(2,14)/.5;class Oa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Rt,this.layoutVertexArray2=new ui,this.indexArray=new Di,this.programConfigurations=new Ks(t.layers,t.zoom),this.segments=new Li,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=$h("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),v=[];for(const{feature:E,id:M,index:P,sourceLayerIndex:N}of t){const B=this.layers[0]._featureFilter.needGeometry,U=br(E,B);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),U,l))continue;const j=b?m.evaluate(U,{},l):void 0,V={id:M,properties:E.properties,type:E.type,sourceLayerIndex:N,index:P,geometry:B?U.geometry:Lr(E),patterns:{},sortKey:j};v.push(V)}b&&v.sort((E,M)=>E.sortKey-M.sortKey);for(const E of v){const{geometry:M,index:P,sourceLayerIndex:N}=E;if(this.hasPattern){const B=Gd("line",this.layers,E,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(E,M,P,l,{},s.subdivisionGranularity);s.featureIndex.insert(t[P].feature,M,P,N,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,fl)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ia),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,m,b,v){const E=this.layers[0].layout,M=E.get("line-join").evaluate(t,{}),P=E.get("line-cap"),N=E.get("line-miter-limit"),B=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const U of s)this.addLine(U,t,M,P,N,B,m,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,b,m)}addLine(t,s,l,m,b,v,E,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=hl(t,E?M.line.getGranularityForZoomLevel(E.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<t.length-1;ue++)this.totalDistance+=t[ue].dist(t[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=nh[s.type]==="Polygon";let N=t.length;for(;N>=2&&t[N-1].equals(t[N-2]);)N--;let B=0;for(;B<N-1&&t[B].equals(t[B+1]);)B++;if(N<(P?3:2))return;l==="bevel"&&(b=1.05);const U=this.overscaling<=16?15*At/(512*this.overscaling):0,j=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let V,$,ee,oe,ve;this.e1=this.e2=-1,P&&(V=t[N-2],ve=t[B].sub(V)._unit()._perp());for(let ue=B;ue<N;ue++){if(ee=ue===N-1?P?t[B+1]:void 0:t[ue+1],ee&&t[ue].equals(ee))continue;ve&&(oe=ve),V&&($=V),V=t[ue],ve=ee?ee.sub(V)._unit()._perp():oe,oe=oe||ve;let H=oe.add(ve);H.x===0&&H.y===0||H._unit();const J=oe.x*ve.x+oe.y*ve.y,fe=H.x*ve.x+H.y*ve.y,Be=fe!==0?1/fe:1/0,st=2*Math.sqrt(2-2*fe),je=fe<d0&&$&&ee,Qe=oe.x*ve.y-oe.y*ve.x>0;if(je&&ue>B){const ft=V.dist($);if(ft>2*U){const We=V.sub(V.sub($)._mult(U/ft)._round());this.updateDistance($,We),this.addCurrentVertex(We,oe,0,0,j),$=We}}const ht=$&&ee;let ut=ht?l:P?"butt":m;if(ht&&ut==="round"&&(Be<v?ut="miter":Be<=2&&(ut="fakeround")),ut==="miter"&&Be>b&&(ut="bevel"),ut==="bevel"&&(Be>2&&(ut="flipbevel"),Be<b&&(ut="miter")),$&&this.updateDistance($,V),ut==="miter")H._mult(Be),this.addCurrentVertex(V,H,0,0,j);else if(ut==="flipbevel"){if(Be>100)H=ve.mult(-1);else{const ft=Be*oe.add(ve).mag()/oe.sub(ve).mag();H._perp()._mult(ft*(Qe?-1:1))}this.addCurrentVertex(V,H,0,0,j),this.addCurrentVertex(V,H.mult(-1),0,0,j)}else if(ut==="bevel"||ut==="fakeround"){const ft=-Math.sqrt(Be*Be-1),We=Qe?ft:0,It=Qe?0:ft;if($&&this.addCurrentVertex(V,oe,We,It,j),ut==="fakeround"){const Bt=Math.round(180*st/Math.PI/20);for(let kt=1;kt<Bt;kt++){let Pt=kt/Bt;if(Pt!==.5){const Fi=Pt-.5;Pt+=Pt*Fi*(Pt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Fi*Fi+(.848013+J*(.215638*J-1.06021)))}const pi=ve.sub(oe)._mult(Pt)._add(oe)._unit()._mult(Qe?-1:1);this.addHalfVertex(V,pi.x,pi.y,!1,Qe,0,j)}}ee&&this.addCurrentVertex(V,ve,-We,-It,j)}else if(ut==="butt")this.addCurrentVertex(V,H,0,0,j);else if(ut==="square"){const ft=$?1:-1;this.addCurrentVertex(V,H,ft,ft,j)}else ut==="round"&&($&&(this.addCurrentVertex(V,oe,0,0,j),this.addCurrentVertex(V,oe,1,1,j,!0)),ee&&(this.addCurrentVertex(V,ve,-1,-1,j,!0),this.addCurrentVertex(V,ve,0,0,j)));if(je&&ue<N-1){const ft=V.dist(ee);if(ft>2*U){const We=V.add(ee.sub(V)._mult(U/ft)._round());this.updateDistance(V,We),this.addCurrentVertex(We,ve,0,0,j),V=We}}}}addCurrentVertex(t,s,l,m,b,v=!1){const E=s.y*m-s.x,M=-s.y-s.x*m;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,v,!1,l,b),this.addHalfVertex(t,E,M,v,!0,-m,b),this.distance>Oo/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,l,m,b,v))}addHalfVertex({x:t,y:s},l,m,b,v,E,M){const P=.5*(this.lineClips?this.scaledDistance*(Oo-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(b?1:0),(s<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*m)+128,1+(E===0?0:E<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),M.primitiveLength++),v?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let vu,pl;wt("LineBucket",Oa,{omit:["layers","patternFeatures"]});var ef={get paint(){return pl=pl||new ma({"line-opacity":new Ht(te.paint_line["line-opacity"]),"line-color":new Ht(te.paint_line["line-color"]),"line-translate":new vt(te.paint_line["line-translate"]),"line-translate-anchor":new vt(te.paint_line["line-translate-anchor"]),"line-width":new Ht(te.paint_line["line-width"]),"line-gap-width":new Ht(te.paint_line["line-gap-width"]),"line-offset":new Ht(te.paint_line["line-offset"]),"line-blur":new Ht(te.paint_line["line-blur"]),"line-dasharray":new qs(te.paint_line["line-dasharray"]),"line-pattern":new ys(te.paint_line["line-pattern"]),"line-gradient":new rl(te.paint_line["line-gradient"])})},get layout(){return vu=vu||new ma({"line-cap":new vt(te.layout_line["line-cap"]),"line-join":new Ht(te.layout_line["line-join"]),"line-miter-limit":new vt(te.layout_line["line-miter-limit"]),"line-round-limit":new vt(te.layout_line["line-round-limit"]),"line-sort-key":new Ht(te.layout_line["line-sort-key"])})}};class Es extends Ht{possiblyEvaluate(t,s){return s=new ea(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,l,m){return s=si({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,l,m)}}let Tu;class Wh extends Pr{constructor(t){super(t,ef),this.gradientVersion=0,Tu||(Tu=new Es(ef.paint.properties["line-width"].specification),Tu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=Tu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Oa(t)}queryRadius(t){const s=t,l=vr($c("line-width",this,s),$c("line-gap-width",this,s)),m=$c("line-offset",this,s);return l/2+Math.abs(m)+Zh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:m,transform:b,pixelsToTileUnits:v}){const E=Ud(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,v),M=v/2*vr(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),P=this.paint.get("line-offset").evaluate(s,l);return P&&(m=function(N,B){const U=[];for(let j=0;j<N.length;j++){const V=N[j],$=[];for(let ee=0;ee<V.length;ee++){const oe=V[ee-1],ve=V[ee],ue=V[ee+1],H=ee===0?new Ve(0,0):ve.sub(oe)._unit()._perp(),J=ee===V.length-1?new Ve(0,0):ue.sub(ve)._unit()._perp(),fe=H._add(J)._unit(),Be=fe.x*J.x+fe.y*J.y;Be!==0&&fe._mult(1/Be),$.push(fe._mult(B)._add(ve))}U.push($)}return U}(m,P*v)),function(N,B,U){for(let j=0;j<B.length;j++){const V=B[j];if(N.length>=3){for(let $=0;$<V.length;$++)if(ul(N,V[$]))return!0}if(ec(N,V,U))return!0}return!1}(E,m,M)}isTileClipped(){return!0}}function vr(o,t){return t>0?t+2*o:o}const f0=ca([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p0=ca([{name:"a_projected_pos",components:3,type:"Float32"}],4);ca([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tf=ca([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ca([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jh=ca([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ml=ca([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hn(o,t,s){return o.sections.forEach(l=>{l.text=function(m,b,v){const E=b.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?m=m.toLocaleUpperCase():E==="lowercase"&&(m=m.toLocaleLowerCase()),gs.applyArabicShaping&&(m=gs.applyArabicShaping(m)),m}(l.text,t,s)}),o}ca([{name:"triangle",components:3,type:"Uint16"}]),ca([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ca([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ca([{type:"Float32",name:"offsetX"}]),ca([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ca([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ws={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ac,gl,af,Ha=24,nf={};function ed(){return ac||(ac=1,nf.read=function(o,t,s,l,m){var b,v,E=8*m-l-1,M=(1<<E)-1,P=M>>1,N=-7,B=s?m-1:0,U=s?-1:1,j=o[t+B];for(B+=U,b=j&(1<<-N)-1,j>>=-N,N+=E;N>0;b=256*b+o[t+B],B+=U,N-=8);for(v=b&(1<<-N)-1,b>>=-N,N+=l;N>0;v=256*v+o[t+B],B+=U,N-=8);if(b===0)b=1-P;else{if(b===M)return v?NaN:1/0*(j?-1:1);v+=Math.pow(2,l),b-=P}return(j?-1:1)*v*Math.pow(2,b-l)},nf.write=function(o,t,s,l,m,b){var v,E,M,P=8*b-m-1,N=(1<<P)-1,B=N>>1,U=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=l?0:b-1,V=l?1:-1,$=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(E=isNaN(t)?1:0,v=N):(v=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-v))<1&&(v--,M*=2),(t+=v+B>=1?U/M:U*Math.pow(2,1-B))*M>=2&&(v++,M/=2),v+B>=N?(E=0,v=N):v+B>=1?(E=(t*M-1)*Math.pow(2,m),v+=B):(E=t*Math.pow(2,B-1)*Math.pow(2,m),v=0));m>=8;o[s+j]=255&E,j+=V,E/=256,m-=8);for(v=v<<m|E,P+=m;P>0;o[s+j]=255&v,j+=V,v/=256,P-=8);o[s+j-V]|=128*$}),nf}function rf(){if(af)return gl;af=1,gl=t;var o=ed();function t(H){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(H)?H:new Uint8Array(H||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var s=4294967296,l=1/s,m=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function b(H){return H.type===t.Bytes?H.readVarint()+H.pos:H.pos+1}function v(H,J,fe){return fe?4294967296*J+(H>>>0):4294967296*(J>>>0)+(H>>>0)}function E(H,J,fe){var Be=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));fe.realloc(Be);for(var st=fe.pos-1;st>=H;st--)fe.buf[st+Be]=fe.buf[st]}function M(H,J){for(var fe=0;fe<H.length;fe++)J.writeVarint(H[fe])}function P(H,J){for(var fe=0;fe<H.length;fe++)J.writeSVarint(H[fe])}function N(H,J){for(var fe=0;fe<H.length;fe++)J.writeFloat(H[fe])}function B(H,J){for(var fe=0;fe<H.length;fe++)J.writeDouble(H[fe])}function U(H,J){for(var fe=0;fe<H.length;fe++)J.writeBoolean(H[fe])}function j(H,J){for(var fe=0;fe<H.length;fe++)J.writeFixed32(H[fe])}function V(H,J){for(var fe=0;fe<H.length;fe++)J.writeSFixed32(H[fe])}function $(H,J){for(var fe=0;fe<H.length;fe++)J.writeFixed64(H[fe])}function ee(H,J){for(var fe=0;fe<H.length;fe++)J.writeSFixed64(H[fe])}function oe(H,J){return(H[J]|H[J+1]<<8|H[J+2]<<16)+16777216*H[J+3]}function ve(H,J,fe){H[fe]=J,H[fe+1]=J>>>8,H[fe+2]=J>>>16,H[fe+3]=J>>>24}function ue(H,J){return(H[J]|H[J+1]<<8|H[J+2]<<16)+(H[J+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(H,J,fe){for(fe=fe||this.length;this.pos<fe;){var Be=this.readVarint(),st=Be>>3,je=this.pos;this.type=7&Be,H(st,J,this),this.pos===je&&this.skip(Be)}return J},readMessage:function(H,J){return this.readFields(H,J,this.readVarint()+this.pos)},readFixed32:function(){var H=oe(this.buf,this.pos);return this.pos+=4,H},readSFixed32:function(){var H=ue(this.buf,this.pos);return this.pos+=4,H},readFixed64:function(){var H=oe(this.buf,this.pos)+oe(this.buf,this.pos+4)*s;return this.pos+=8,H},readSFixed64:function(){var H=oe(this.buf,this.pos)+ue(this.buf,this.pos+4)*s;return this.pos+=8,H},readFloat:function(){var H=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,H},readDouble:function(){var H=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,H},readVarint:function(H){var J,fe,Be=this.buf;return J=127&(fe=Be[this.pos++]),fe<128?J:(J|=(127&(fe=Be[this.pos++]))<<7,fe<128?J:(J|=(127&(fe=Be[this.pos++]))<<14,fe<128?J:(J|=(127&(fe=Be[this.pos++]))<<21,fe<128?J:function(st,je,Qe){var ht,ut,ft=Qe.buf;if(ht=(112&(ut=ft[Qe.pos++]))>>4,ut<128||(ht|=(127&(ut=ft[Qe.pos++]))<<3,ut<128)||(ht|=(127&(ut=ft[Qe.pos++]))<<10,ut<128)||(ht|=(127&(ut=ft[Qe.pos++]))<<17,ut<128)||(ht|=(127&(ut=ft[Qe.pos++]))<<24,ut<128)||(ht|=(1&(ut=ft[Qe.pos++]))<<31,ut<128))return v(st,ht,je);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(fe=Be[this.pos]))<<28,H,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var H=this.readVarint();return H%2==1?(H+1)/-2:H/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var H=this.readVarint()+this.pos,J=this.pos;return this.pos=H,H-J>=12&&m?function(fe,Be,st){return m.decode(fe.subarray(Be,st))}(this.buf,J,H):function(fe,Be,st){for(var je="",Qe=Be;Qe<st;){var ht,ut,ft,We=fe[Qe],It=null,Bt=We>239?4:We>223?3:We>191?2:1;if(Qe+Bt>st)break;Bt===1?We<128&&(It=We):Bt===2?(192&(ht=fe[Qe+1]))==128&&(It=(31&We)<<6|63&ht)<=127&&(It=null):Bt===3?(ut=fe[Qe+2],(192&(ht=fe[Qe+1]))==128&&(192&ut)==128&&((It=(15&We)<<12|(63&ht)<<6|63&ut)<=2047||It>=55296&&It<=57343)&&(It=null)):Bt===4&&(ut=fe[Qe+2],ft=fe[Qe+3],(192&(ht=fe[Qe+1]))==128&&(192&ut)==128&&(192&ft)==128&&((It=(15&We)<<18|(63&ht)<<12|(63&ut)<<6|63&ft)<=65535||It>=1114112)&&(It=null)),It===null?(It=65533,Bt=1):It>65535&&(It-=65536,je+=String.fromCharCode(It>>>10&1023|55296),It=56320|1023&It),je+=String.fromCharCode(It),Qe+=Bt}return je}(this.buf,J,H)},readBytes:function(){var H=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,H);return this.pos=H,J},readPackedVarint:function(H,J){if(this.type!==t.Bytes)return H.push(this.readVarint(J));var fe=b(this);for(H=H||[];this.pos<fe;)H.push(this.readVarint(J));return H},readPackedSVarint:function(H){if(this.type!==t.Bytes)return H.push(this.readSVarint());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readSVarint());return H},readPackedBoolean:function(H){if(this.type!==t.Bytes)return H.push(this.readBoolean());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readBoolean());return H},readPackedFloat:function(H){if(this.type!==t.Bytes)return H.push(this.readFloat());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readFloat());return H},readPackedDouble:function(H){if(this.type!==t.Bytes)return H.push(this.readDouble());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readDouble());return H},readPackedFixed32:function(H){if(this.type!==t.Bytes)return H.push(this.readFixed32());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readFixed32());return H},readPackedSFixed32:function(H){if(this.type!==t.Bytes)return H.push(this.readSFixed32());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readSFixed32());return H},readPackedFixed64:function(H){if(this.type!==t.Bytes)return H.push(this.readFixed64());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readFixed64());return H},readPackedSFixed64:function(H){if(this.type!==t.Bytes)return H.push(this.readSFixed64());var J=b(this);for(H=H||[];this.pos<J;)H.push(this.readSFixed64());return H},skip:function(H){var J=7&H;if(J===t.Varint)for(;this.buf[this.pos++]>127;);else if(J===t.Bytes)this.pos=this.readVarint()+this.pos;else if(J===t.Fixed32)this.pos+=4;else{if(J!==t.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(H,J){this.writeVarint(H<<3|J)},realloc:function(H){for(var J=this.length||16;J<this.pos+H;)J*=2;if(J!==this.length){var fe=new Uint8Array(J);fe.set(this.buf),this.buf=fe,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(H){this.realloc(4),ve(this.buf,H,this.pos),this.pos+=4},writeSFixed32:function(H){this.realloc(4),ve(this.buf,H,this.pos),this.pos+=4},writeFixed64:function(H){this.realloc(8),ve(this.buf,-1&H,this.pos),ve(this.buf,Math.floor(H*l),this.pos+4),this.pos+=8},writeSFixed64:function(H){this.realloc(8),ve(this.buf,-1&H,this.pos),ve(this.buf,Math.floor(H*l),this.pos+4),this.pos+=8},writeVarint:function(H){(H=+H||0)>268435455||H<0?function(J,fe){var Be,st;if(J>=0?(Be=J%4294967296|0,st=J/4294967296|0):(st=~(-J/4294967296),4294967295^(Be=~(-J%4294967296))?Be=Be+1|0:(Be=0,st=st+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");fe.realloc(10),function(je,Qe,ht){ht.buf[ht.pos++]=127&je|128,je>>>=7,ht.buf[ht.pos++]=127&je|128,je>>>=7,ht.buf[ht.pos++]=127&je|128,je>>>=7,ht.buf[ht.pos++]=127&je|128,ht.buf[ht.pos]=127&(je>>>=7)}(Be,0,fe),function(je,Qe){var ht=(7&je)<<4;Qe.buf[Qe.pos++]|=ht|((je>>>=3)?128:0),je&&(Qe.buf[Qe.pos++]=127&je|((je>>>=7)?128:0),je&&(Qe.buf[Qe.pos++]=127&je|((je>>>=7)?128:0),je&&(Qe.buf[Qe.pos++]=127&je|((je>>>=7)?128:0),je&&(Qe.buf[Qe.pos++]=127&je|((je>>>=7)?128:0),je&&(Qe.buf[Qe.pos++]=127&je)))))}(st,fe)}(H,this):(this.realloc(4),this.buf[this.pos++]=127&H|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=H>>>7&127))))},writeSVarint:function(H){this.writeVarint(H<0?2*-H-1:2*H)},writeBoolean:function(H){this.writeVarint(!!H)},writeString:function(H){H=String(H),this.realloc(4*H.length),this.pos++;var J=this.pos;this.pos=function(Be,st,je){for(var Qe,ht,ut=0;ut<st.length;ut++){if((Qe=st.charCodeAt(ut))>55295&&Qe<57344){if(!ht){Qe>56319||ut+1===st.length?(Be[je++]=239,Be[je++]=191,Be[je++]=189):ht=Qe;continue}if(Qe<56320){Be[je++]=239,Be[je++]=191,Be[je++]=189,ht=Qe;continue}Qe=ht-55296<<10|Qe-56320|65536,ht=null}else ht&&(Be[je++]=239,Be[je++]=191,Be[je++]=189,ht=null);Qe<128?Be[je++]=Qe:(Qe<2048?Be[je++]=Qe>>6|192:(Qe<65536?Be[je++]=Qe>>12|224:(Be[je++]=Qe>>18|240,Be[je++]=Qe>>12&63|128),Be[je++]=Qe>>6&63|128),Be[je++]=63&Qe|128)}return je}(this.buf,H,this.pos);var fe=this.pos-J;fe>=128&&E(J,fe,this),this.pos=J-1,this.writeVarint(fe),this.pos+=fe},writeFloat:function(H){this.realloc(4),o.write(this.buf,H,this.pos,!0,23,4),this.pos+=4},writeDouble:function(H){this.realloc(8),o.write(this.buf,H,this.pos,!0,52,8),this.pos+=8},writeBytes:function(H){var J=H.length;this.writeVarint(J),this.realloc(J);for(var fe=0;fe<J;fe++)this.buf[this.pos++]=H[fe]},writeRawMessage:function(H,J){this.pos++;var fe=this.pos;H(J,this);var Be=this.pos-fe;Be>=128&&E(fe,Be,this),this.pos=fe-1,this.writeVarint(Be),this.pos+=Be},writeMessage:function(H,J,fe){this.writeTag(H,t.Bytes),this.writeRawMessage(J,fe)},writePackedVarint:function(H,J){J.length&&this.writeMessage(H,M,J)},writePackedSVarint:function(H,J){J.length&&this.writeMessage(H,P,J)},writePackedBoolean:function(H,J){J.length&&this.writeMessage(H,U,J)},writePackedFloat:function(H,J){J.length&&this.writeMessage(H,N,J)},writePackedDouble:function(H,J){J.length&&this.writeMessage(H,B,J)},writePackedFixed32:function(H,J){J.length&&this.writeMessage(H,j,J)},writePackedSFixed32:function(H,J){J.length&&this.writeMessage(H,V,J)},writePackedFixed64:function(H,J){J.length&&this.writeMessage(H,$,J)},writePackedSFixed64:function(H,J){J.length&&this.writeMessage(H,ee,J)},writeBytesField:function(H,J){this.writeTag(H,t.Bytes),this.writeBytes(J)},writeFixed32Field:function(H,J){this.writeTag(H,t.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(H,J){this.writeTag(H,t.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(H,J){this.writeTag(H,t.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(H,J){this.writeTag(H,t.Fixed64),this.writeSFixed64(J)},writeVarintField:function(H,J){this.writeTag(H,t.Varint),this.writeVarint(J)},writeSVarintField:function(H,J){this.writeTag(H,t.Varint),this.writeSVarint(J)},writeStringField:function(H,J){this.writeTag(H,t.Bytes),this.writeString(J)},writeFloatField:function(H,J){this.writeTag(H,t.Fixed32),this.writeFloat(J)},writeDoubleField:function(H,J){this.writeTag(H,t.Fixed64),this.writeDouble(J)},writeBooleanField:function(H,J){this.writeVarintField(H,!!J)}},gl}var Tr=Z(rf());const sf=3;function Kr(o,t,s){o===1&&s.readMessage(bp,t)}function bp(o,t,s){if(o===3){const{id:l,bitmap:m,width:b,height:v,left:E,top:M,advance:P}=s.readMessage(xp,{});t.push({id:l,bitmap:new Qc({width:b+2*sf,height:v+2*sf},m),metrics:{width:b,height:v,left:E,top:M,advance:P}})}}function xp(o,t,s){o===1?t.id=s.readVarint():o===2?t.bitmap=s.readBytes():o===3?t.width=s.readVarint():o===4?t.height=s.readVarint():o===5?t.left=s.readSVarint():o===6?t.top=s.readSVarint():o===7&&(t.advance=s.readVarint())}const vm=sf;function Eu(o){let t=0,s=0;for(const v of o)t+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,E)=>E.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let m=0,b=0;for(const v of o)for(let E=l.length-1;E>=0;E--){const M=l[E];if(!(v.w>M.w||v.h>M.h)){if(v.x=M.x,v.y=M.y,b=Math.max(b,v.y+v.h),m=Math.max(m,v.x+v.w),v.w===M.w&&v.h===M.h){const P=l.pop();E<l.length&&(l[E]=P)}else v.h===M.h?(M.x+=v.w,M.w-=v.w):v.w===M.w?(M.y+=v.h,M.h-=v.h):(l.push({x:M.x+v.w,y:M.y,w:M.w-v.w,h:v.h}),M.y+=v.h,M.h-=v.h);break}}return{w:m,h:b,fill:t/(m*b)||0}}const Rn=1;class td{constructor(t,{pixelRatio:s,version:l,stretchX:m,stretchY:b,content:v,textFitWidth:E,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=b,this.content=v,this.version=l,this.textFitWidth=E,this.textFitHeight=M}get tl(){return[this.paddedRect.x+Rn,this.paddedRect.y+Rn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Rn,this.paddedRect.y+this.paddedRect.h-Rn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Rn)/this.pixelRatio,(this.paddedRect.h-2*Rn)/this.pixelRatio]}}class nc{constructor(t,s){const l={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(t,l,b),this.addImages(s,m,b);const{w:v,h:E}=Eu(b),M=new Or({width:v||1,height:E||1});for(const P in t){const N=t[P],B=l[P].paddedRect;Or.copy(N.data,M,{x:0,y:0},{x:B.x+Rn,y:B.y+Rn},N.data)}for(const P in s){const N=s[P],B=m[P].paddedRect,U=B.x+Rn,j=B.y+Rn,V=N.data.width,$=N.data.height;Or.copy(N.data,M,{x:0,y:0},{x:U,y:j},N.data),Or.copy(N.data,M,{x:0,y:$-1},{x:U,y:j-1},{width:V,height:1}),Or.copy(N.data,M,{x:0,y:0},{x:U,y:j+$},{width:V,height:1}),Or.copy(N.data,M,{x:V-1,y:0},{x:U-1,y:j},{width:1,height:$}),Or.copy(N.data,M,{x:0,y:0},{x:U+V,y:j},{width:1,height:$})}this.image=M,this.iconPositions=l,this.patternPositions=m}addImages(t,s,l){for(const m in t){const b=t[m],v={x:0,y:0,w:b.data.width+2*Rn,h:b.data.height+2*Rn};l.push(v),s[m]=new td(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[m,b]=t.tl;l.update(s.data,void 0,{x:m,y:b})}}var wu;wt("ImagePosition",td),wt("ImageAtlas",nc),S.al=void 0,(wu=S.al||(S.al={}))[wu.none=0]="none",wu[wu.horizontal=1]="horizontal",wu[wu.vertical=2]="vertical",wu[wu.horizontalOnly=3]="horizontalOnly";const id=-17;class rh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,s,l){const m=new rh;return m.scale=t||1,m.fontStack=s,m.verticalAlign=l||"bottom",m}static forImage(t,s){const l=new rh;return l.imageName=t,l.verticalAlign=s||"bottom",l}}class _l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new _l;for(let m=0;m<t.sections.length;m++){const b=t.sections[m];b.image?l.addImageSection(b):l.addTextSection(b,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let l=0;l<t.length;l++){const m=t.charCodeAt(l+1)||null,b=t.charCodeAt(l-1)||null;s+=m&&js(m)&&!ws[t[l+1]]||b&&js(b)&&!ws[t[l-1]]||!ws[t[l]]?t[l]:ws[t[l]]}return s}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&of[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&of[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new _l;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}getMaxImageSize(t){let s=0,l=0;for(let m=0;m<this.length();m++){const b=this.getSection(m);if(b.imageName){const v=t[b.imageName];if(!v)continue;const E=v.displaySize;s=Math.max(s,E[0]),l=Math.max(l,E[1])}}return{maxImageWidth:s,maxImageHeight:l}}addTextSection(t,s){this.text+=t.text,this.sections.push(rh.forText(t.scale,t.fontStack||s,t.verticalAlign));const l=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void hn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(rh.forImage(s,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):hn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sh(o,t,s,l,m,b,v,E,M,P,N,B,U,j,V){const $=_l.fromFeature(o,m);let ee;B===S.al.vertical&&$.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:ve}=gs;if(oe&&$.sections.length===1){ee=[];const J=oe($.toString(),uf($,P,b,t,l,j));for(const fe of J){const Be=new _l;Be.text=fe,Be.sections=$.sections;for(let st=0;st<fe.length;st++)Be.sectionIndex.push(0);ee.push(Be)}}else if(ve){ee=[];const J=ve($.text,$.sectionIndex,uf($,P,b,t,l,j));for(const fe of J){const Be=new _l;Be.text=fe[0],Be.sectionIndex=fe[1],Be.sections=$.sections,ee.push(Be)}}else ee=function(J,fe){const Be=[],st=J.text;let je=0;for(const Qe of fe)Be.push(J.substring(je,Qe)),je=Qe;return je<st.length&&Be.push(J.substring(je,st.length)),Be}($,uf($,P,b,t,l,j));const ue=[],H={positionedLines:ue,text:$.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(J,fe,Be,st,je,Qe,ht,ut,ft,We,It,Bt){let kt=0,Pt=0,pi=0,Fi=0;const oa=ut==="right"?1:ut==="left"?0:.5,Aa=Ha/Bt;let jn=0;for(const _a of je){_a.trim();const Wa=_a.getMaxScale(),ja={positionedGlyphs:[],lineOffset:0};J.positionedLines[jn]=ja;const _n=ja.positionedGlyphs;let qn=0;if(!_a.length()){Pt+=Qe,++jn;continue}const tr=vp(st,_a,Aa);for(let Er=0;Er<_a.length();Er++){const Na=_a.getSection(Er),qa=_a.getSectionIndex(Er),en=_a.getCharCode(Er),ya=Tp(ft,It,en);let Ki;if(Na.imageName){if(J.iconsInText=!0,Na.scale=Na.scale*Aa,Ki=Ep(Na,ya,Wa,tr,st),!Ki)continue;qn=Math.max(qn,Ki.imageOffset)}else if(Ki=cf(Na,en,ya,tr,fe,Be),!Ki)continue;const{rect:kr,metrics:dc,baselineOffset:ao}=Ki;_n.push({glyph:en,imageName:Na.imageName,x:kt,y:Pt+ao+id,vertical:ya,scale:Na.scale,fontStack:Na.fontStack,sectionIndex:qa,metrics:dc,rect:kr}),ya?(J.verticalizable=!0,kt+=(Na.imageName?dc.advance:Ha)*Na.scale+We):kt+=dc.advance*Na.scale+We}_n.length!==0&&(pi=Math.max(kt-We,pi),wp(_n,0,_n.length-1,oa)),kt=0,ja.lineOffset=Math.max(qn,(Wa-1)*Ha);const Ja=Qe*Wa+qn;Pt+=Ja,Fi=Math.max(Ja,Fi),++jn}const{horizontalAlign:gn,verticalAlign:ga}=lf(ht);(function(_a,Wa,ja,_n,qn,tr,Ja,Er,Na){const qa=(Wa-ja)*qn;let en=0;en=tr!==Ja?-Er*_n-id:-_n*Na*Ja+.5*Ja;for(const ya of _a)for(const Ki of ya.positionedGlyphs)Ki.x+=qa,Ki.y+=en})(J.positionedLines,oa,gn,ga,pi,Fi,Qe,Pt,je.length),J.top+=-ga*Pt,J.bottom=J.top+Pt,J.left+=-gn*pi,J.right=J.left+pi}(H,t,s,l,ee,v,E,M,B,P,U,V),!function(J){for(const fe of J)if(fe.positionedGlyphs.length!==0)return!1;return!0}(ue)&&H}const of={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Em={40:!0};function m0(o,t,s,l,m,b){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*Ha/b+m:0}{const v=s[t.fontStack],E=v&&v[o];return E?E.metrics.advance*t.scale+m:0}}function g0(o,t,s,l){const m=Math.pow(o-t,2);return l?o<t?m/2:2*m:m+Math.abs(s)*s}function oh(o,t,s){let l=0;return o===10&&(l-=1e4),s&&(l+=150),o!==40&&o!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function ad(o,t,s,l,m,b){let v=null,E=g0(t,s,m,b);for(const M of l){const P=g0(t-M.x,s,m,b)+M.badness;P<=E&&(v=M,E=P)}return{index:o,x:t,priorBreak:v,badness:E}}function _0(o){return o?_0(o.priorBreak).concat(o.index):[]}function uf(o,t,s,l,m,b){if(!o)return[];const v=[],E=function(B,U,j,V,$,ee){let oe=0;for(let ve=0;ve<B.length();ve++){const ue=B.getSection(ve);oe+=m0(B.getCharCode(ve),ue,V,$,U,ee)}return oe/Math.max(1,Math.ceil(oe/j))}(o,t,s,l,m,b),M=o.text.indexOf("")>=0;let P=0;for(let B=0;B<o.length();B++){const U=o.getSection(B),j=o.getCharCode(B);if(of[j]||(P+=m0(j,U,l,m,t,b)),B<o.length()-1){const V=!((N=j)<11904)&&(!!ci["CJK Compatibility Forms"](N)||!!ci["CJK Compatibility"](N)||!!ci["CJK Strokes"](N)||!!ci["CJK Symbols and Punctuation"](N)||!!ci["Enclosed CJK Letters and Months"](N)||!!ci["Halfwidth and Fullwidth Forms"](N)||!!ci["Ideographic Description Characters"](N)||!!ci["Vertical Forms"](N)||ms.test(String.fromCodePoint(N)));(Tm[j]||V||U.imageName||B!==o.length()-2&&Em[o.getCharCode(B+1)])&&v.push(ad(B+1,P,E,v,oh(j,o.getCharCode(B+1),V&&M),!1))}}var N;return _0(ad(o.length(),P,E,v,0,!0))}function lf(o){let t=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function vp(o,t,s){const l=t.getMaxScale()*Ha,{maxImageWidth:m,maxImageHeight:b}=t.getMaxImageSize(o),v=Math.max(l,b*s);return{verticalLineContentWidth:Math.max(l,m*s),horizontalLineContentHeight:v}}function y0(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function Tp(o,t,s){return!(o===S.al.horizontal||!t&&!Zr(s)||t&&(of[s]||(l=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function cf(o,t,s,l,m,b){const v=b[o.fontStack],E=function(P,N,B,U){if(P&&P.rect)return P;const j=N[B.fontStack],V=j&&j[U];return V?{rect:null,metrics:V.metrics}:null}(v&&v[t],m,o,t);if(E===null)return null;let M;if(s)M=l.verticalLineContentWidth-o.scale*Ha;else{const P=y0(o.verticalAlign);M=(l.horizontalLineContentHeight-o.scale*Ha)*P}return{rect:E.rect,metrics:E.metrics,baselineOffset:M}}function Ep(o,t,s,l,m){const b=m[o.imageName];if(!b)return null;const v=b.paddedRect,E=b.displaySize,M={width:E[0],height:E[1],left:Rn,top:-3,advance:t?E[1]:E[0]};let P;if(t)P=l.verticalLineContentWidth-E[1]*o.scale;else{const N=y0(o.verticalAlign);P=(l.horizontalLineContentHeight-E[1]*o.scale)*N}return{rect:v,metrics:M,baselineOffset:P,imageOffset:(t?E[0]:E[1])*o.scale-Ha*s}}function wp(o,t,s,l){if(l===0)return;const m=o[s],b=(o[s].x+m.metrics.advance*m.scale)*l;for(let v=t;v<=s;v++)o[v].x-=b}function pa(o,t,s){const{horizontalAlign:l,verticalAlign:m}=lf(s),b=t[0]-o.displaySize[0]*l,v=t[1]-o.displaySize[1]*m;return{image:o,top:v,bottom:v+o.displaySize[1],left:b,right:b+o.displaySize[0]}}function hf(o){var t,s;let l=o.left,m=o.top,b=o.right-l,v=o.bottom-m;const E=(t=o.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(s=o.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",P=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(M==="proportional"){if(E==="stretchOnly"&&b/v<P||E==="proportional"){const N=Math.ceil(v*P);l*=N/b,b=N}}else if(E==="proportional"&&M==="stretchOnly"&&P!==0&&b/v>P){const N=Math.ceil(b/P);m*=N/v,v=N}return{x1:l,y1:m,x2:l+b,y2:m+v}}function Ap(o,t,s,l,m,b){const v=o.image;let E;if(v.content){const ee=v.content,oe=v.pixelRatio||1;E=[ee[0]/oe,ee[1]/oe,v.displaySize[0]-ee[2]/oe,v.displaySize[1]-ee[3]/oe]}const M=t.left*b,P=t.right*b;let N,B,U,j;s==="width"||s==="both"?(j=m[0]+M-l[3],B=m[0]+P+l[1]):(j=m[0]+(M+P-v.displaySize[0])/2,B=j+v.displaySize[0]);const V=t.top*b,$=t.bottom*b;return s==="height"||s==="both"?(N=m[1]+V-l[0],U=m[1]+$+l[2]):(N=m[1]+(V+$-v.displaySize[1])/2,U=N+v.displaySize[1]),{image:v,top:N,right:B,bottom:U,left:j,collisionPadding:E}}const uh=255,No=128,yl=uh*No;function Sp(o,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new ea(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:m}=s;let b=0;for(;b<l.length&&l[b]<=o;)b++;b=Math.max(0,b-1);let v=b;for(;v<l.length&&l[v]<o+1;)v++;v=Math.min(l.length-1,v);const E=l[b],M=l[v];return s.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:M,minSize:s.evaluate(new ea(E)),maxSize:s.evaluate(new ea(M)),interpolationType:m}}}function lh(o,t,s){let l="never";const m=o.get(t);return m?l=m:o.get(s)&&(l="always"),l}const ch=xu.VectorTileFeature.types,b0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rc(o,t,s,l,m,b,v,E,M,P,N,B,U){const j=E?Math.min(yl,Math.round(E[0])):0,V=E?Math.min(yl,Math.round(E[1])):0;o.emplaceBack(t,s,Math.round(32*l),Math.round(32*m),b,v,(j<<1)+(M?1:0),V,16*P,16*N,256*B,256*U)}function nd(o,t,s){o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s)}function sc(o){for(const t of o.sections)if(Xl(t.text))return!0;return!1}class As{constructor(t){this.layoutVertexArray=new da,this.indexArray=new Di,this.programConfigurations=t,this.segments=new Li,this.dynamicLayoutVertexArray=new ji,this.opacityVertexArray=new fa,this.hasVisibleVertices=!1,this.placedSymbolArray=new me}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,l,m){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,f0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,p0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,b0,!0),this.opacityVertexBuffer.itemSize=1),(l||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wt("SymbolBuffers",As);class oc{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Li,this.collisionVertexArray=new Xi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,tf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wt("CollisionBuffers",oc);class hh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sp(this.zoom,s["text-size"]),this.iconSizeData=Sp(this.zoom,s["icon-size"]);const l=this.layers[0].layout,m=l.get("symbol-sort-key"),b=l.get("symbol-z-order");this.canOverlap=lh(l,"text-overlap","text-allow-overlap")!=="never"||lh(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>S.al[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new As(new Ks(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new As(new Ks(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new we,this.lineVertexArray=new xe,this.symbolInstances=new be,this.textAnchorOffsets=new Ke}calculateGlyphDependencies(t,s,l,m,b){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(l||m)&&b){const E=ws[t.charAt(v)];E&&(s[E.charCodeAt(0)]=!0)}}populate(t,s,l){const m=this.layers[0],b=m.layout,v=b.get("text-font"),E=b.get("text-field"),M=b.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof Xa&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),N=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,B=b.get("symbol-sort-key");if(this.features=[],!P&&!N)return;const U=s.iconDependencies,j=s.glyphDependencies,V=s.availableImages,$=new ea(this.zoom);for(const{feature:ee,id:oe,index:ve,sourceLayerIndex:ue}of t){const H=m._featureFilter.needGeometry,J=br(ee,H);if(!m._featureFilter.filter($,J,l))continue;let fe,Be;if(H||(J.geometry=Lr(ee)),P){const je=m.getValueAndResolveTokens("text-field",J,l,V),Qe=Xa.factory(je),ht=this.hasRTLText=this.hasRTLText||sc(Qe);(!ht||gs.getRTLTextPluginStatus()==="unavailable"||ht&&gs.isParsed())&&(fe=Hn(Qe,m,J))}if(N){const je=m.getValueAndResolveTokens("icon-image",J,l,V);Be=je instanceof kn?je:kn.fromString(je)}if(!fe&&!Be)continue;const st=this.sortFeaturesByKey?B.evaluate(J,{},l):void 0;if(this.features.push({id:oe,text:fe,icon:Be,index:ve,sourceLayerIndex:ue,geometry:J.geometry,properties:ee.properties,type:ch[ee.type],sortKey:st}),Be&&(U[Be.name]=!0),fe){const je=v.evaluate(J,{},l).join(","),Qe=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.al.vertical)>=0;for(const ht of fe.sections)if(ht.image)U[ht.image.name]=!0;else{const ut=Yl(fe.toString()),ft=ht.fontStack||je,We=j[ft]=j[ft]||{};this.calculateGlyphDependencies(ht.text,We,Qe,this.allowVerticalPlacement,ut)}}}b.get("symbol-placement")==="line"&&(this.features=function(ee){const oe={},ve={},ue=[];let H=0;function J(je){ue.push(ee[je]),H++}function fe(je,Qe,ht){const ut=ve[je];return delete ve[je],ve[Qe]=ut,ue[ut].geometry[0].pop(),ue[ut].geometry[0]=ue[ut].geometry[0].concat(ht[0]),ut}function Be(je,Qe,ht){const ut=oe[Qe];return delete oe[Qe],oe[je]=ut,ue[ut].geometry[0].shift(),ue[ut].geometry[0]=ht[0].concat(ue[ut].geometry[0]),ut}function st(je,Qe,ht){const ut=ht?Qe[0][Qe[0].length-1]:Qe[0][0];return`${je}:${ut.x}:${ut.y}`}for(let je=0;je<ee.length;je++){const Qe=ee[je],ht=Qe.geometry,ut=Qe.text?Qe.text.toString():null;if(!ut){J(je);continue}const ft=st(ut,ht),We=st(ut,ht,!0);if(ft in ve&&We in oe&&ve[ft]!==oe[We]){const It=Be(ft,We,ht),Bt=fe(ft,We,ue[It].geometry);delete oe[ft],delete ve[We],ve[st(ut,ue[Bt].geometry,!0)]=Bt,ue[It].geometry=null}else ft in ve?fe(ft,We,ht):We in oe?Be(ft,We,ht):(J(je),oe[ft]=H-1,ve[We]=H-1)}return ue.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,oe)=>ee.sortKey-oe.sortKey)}update(t,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length;if(t.segment!==void 0){let m=t.dist(s[t.segment+1]),b=t.dist(s[t.segment]);const v={};for(let E=t.segment+1;E<s.length;E++)v[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:m},E<s.length-1&&(m+=s[E+1].dist(s[E]));for(let E=t.segment||0;E>=0;E--)v[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:b},E>0&&(b+=s[E-1].dist(s[E]));for(let E=0;E<s.length;E++){const M=v[E];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,m,b,v,E,M,P,N,B,U){const j=t.indexArray,V=t.layoutVertexArray,$=t.segments.prepareSegment(4*s.length,V,j,this.canOverlap?v.sortKey:void 0),ee=this.glyphOffsetArray.length,oe=$.vertexLength,ve=this.allowVerticalPlacement&&E===S.al.vertical?Math.PI/2:0,ue=v.text&&v.text.sections;for(let H=0;H<s.length;H++){const{tl:J,tr:fe,bl:Be,br:st,tex:je,pixelOffsetTL:Qe,pixelOffsetBR:ht,minFontScaleX:ut,minFontScaleY:ft,glyphOffset:We,isSDF:It,sectionIndex:Bt}=s[H],kt=$.vertexLength,Pt=We[1];rc(V,M.x,M.y,J.x,Pt+J.y,je.x,je.y,l,It,Qe.x,Qe.y,ut,ft),rc(V,M.x,M.y,fe.x,Pt+fe.y,je.x+je.w,je.y,l,It,ht.x,Qe.y,ut,ft),rc(V,M.x,M.y,Be.x,Pt+Be.y,je.x,je.y+je.h,l,It,Qe.x,ht.y,ut,ft),rc(V,M.x,M.y,st.x,Pt+st.y,je.x+je.w,je.y+je.h,l,It,ht.x,ht.y,ut,ft),nd(t.dynamicLayoutVertexArray,M,ve),j.emplaceBack(kt,kt+2,kt+1),j.emplaceBack(kt+1,kt+2,kt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),H!==s.length-1&&Bt===s[H+1].sectionIndex||t.programConfigurations.populatePaintArrays(V.length,v,v.index,{},U,ue&&ue[Bt])}t.placedSymbolArray.emplaceBack(M.x,M.y,ee,this.glyphOffsetArray.length-ee,oe,P,N,M.segment,l?l[0]:0,l?l[1]:0,m[0],m[1],E,0,!1,0,B)}_addCollisionDebugVertex(t,s,l,m,b,v){return s.emplaceBack(0,0),t.emplaceBack(l.x,l.y,m,b,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,l,m,b,v,E){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),P=M.vertexLength,N=b.layoutVertexArray,B=b.collisionVertexArray,U=E.anchorX,j=E.anchorY;this._addCollisionDebugVertex(N,B,v,U,j,new Ve(t,s)),this._addCollisionDebugVertex(N,B,v,U,j,new Ve(l,s)),this._addCollisionDebugVertex(N,B,v,U,j,new Ve(l,m)),this._addCollisionDebugVertex(N,B,v,U,j,new Ve(t,m)),M.vertexLength+=4;const V=b.indexArray;V.emplaceBack(P,P+1),V.emplaceBack(P+1,P+2),V.emplaceBack(P+2,P+3),V.emplaceBack(P+3,P),M.primitiveLength+=4}addDebugCollisionBoxes(t,s,l,m){for(let b=t;b<s;b++){const v=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,m?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oc(sa,Jh.members,za),this.iconCollisionBox=new oc(sa,Jh.members,za);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,l,m,b,v,E,M,P){const N={};for(let B=s;B<l;B++){const U=t.get(B);N.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.textFeatureIndex=U.featureIndex;break}for(let B=m;B<b;B++){const U=t.get(B);N.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.verticalTextFeatureIndex=U.featureIndex;break}for(let B=v;B<E;B++){const U=t.get(B);N.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.iconFeatureIndex=U.featureIndex;break}for(let B=M;B<P;B++){const U=t.get(B);N.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.verticalIconFeatureIndex=U.featureIndex;break}return N}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),m=l.vertexStartIndex+4*l.numGlyphs;for(let b=l.vertexStartIndex;b<m;b+=4)t.indexArray.emplaceBack(b,b+2,b+1),t.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),m=[],b=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);const M=this.symbolInstances.get(E);m.push(0|Math.round(s*M.anchorX+l*M.anchorY)),b.push(M.featureIndex)}return v.sort((E,M)=>m[E]-m[M]||b[M]-b[E]),v}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((m,b,v)=>{m>=0&&v.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let x0,v0;wt("SymbolBucket",hh,{omit:["layers","collisionBoxArray","features","compareText"]}),hh.MAX_GLYPHS=65535,hh.addDynamicAttributes=nd;var df={get paint(){return v0=v0||new ma({"icon-opacity":new Ht(te.paint_symbol["icon-opacity"]),"icon-color":new Ht(te.paint_symbol["icon-color"]),"icon-halo-color":new Ht(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(te.paint_symbol["icon-halo-blur"]),"icon-translate":new vt(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new vt(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(te.paint_symbol["text-opacity"]),"text-color":new Ht(te.paint_symbol["text-color"],{runtimeType:Zi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Ht(te.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(te.paint_symbol["text-halo-blur"]),"text-translate":new vt(te.paint_symbol["text-translate"]),"text-translate-anchor":new vt(te.paint_symbol["text-translate-anchor"])})},get layout(){return x0=x0||new ma({"symbol-placement":new vt(te.layout_symbol["symbol-placement"]),"symbol-spacing":new vt(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vt(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vt(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vt(te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vt(te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vt(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new vt(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vt(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(te.layout_symbol["icon-size"]),"icon-text-fit":new vt(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vt(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(te.layout_symbol["icon-image"]),"icon-rotate":new Ht(te.layout_symbol["icon-rotate"]),"icon-padding":new Ht(te.layout_symbol["icon-padding"]),"icon-keep-upright":new vt(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(te.layout_symbol["icon-offset"]),"icon-anchor":new Ht(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vt(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vt(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vt(te.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(te.layout_symbol["text-field"]),"text-font":new Ht(te.layout_symbol["text-font"]),"text-size":new Ht(te.layout_symbol["text-size"]),"text-max-width":new Ht(te.layout_symbol["text-max-width"]),"text-line-height":new vt(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(te.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(te.layout_symbol["text-justify"]),"text-radial-offset":new Ht(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vt(te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(te.layout_symbol["text-anchor"]),"text-max-angle":new vt(te.layout_symbol["text-max-angle"]),"text-writing-mode":new vt(te.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(te.layout_symbol["text-rotate"]),"text-padding":new vt(te.layout_symbol["text-padding"]),"text-keep-upright":new vt(te.layout_symbol["text-keep-upright"]),"text-transform":new Ht(te.layout_symbol["text-transform"]),"text-offset":new Ht(te.layout_symbol["text-offset"]),"text-allow-overlap":new vt(te.layout_symbol["text-allow-overlap"]),"text-overlap":new vt(te.layout_symbol["text-overlap"]),"text-ignore-placement":new vt(te.layout_symbol["text-ignore-placement"]),"text-optional":new vt(te.layout_symbol["text-optional"])})}};class T0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Yt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt("FormatSectionOverride",T0,{omit:["defaultValue"]});class ff extends Pr{constructor(t){super(t,df)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const m=[];for(const b of l)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,m){const b=this.layout.get(t).evaluate(s,{},l,m),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||uu(v.value)||!b?b:function(E,M){return M.replace(/{([^{}]+)}/g,(P,N)=>E&&N in E?String(E[N]):"")}(s.properties,b)}createBucket(t){return new hh(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of df.paint.overridableProperties){if(!ff.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new T0(s),m=new Ku(l,s.property.specification);let b=null;b=s.value.kind==="constant"||s.value.kind==="source"?new To("source",m):new lu("composite",m,s.value.zoomStops),this.paint._values[t]=new $t(s.property,b,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&ff.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),m=df.paint.properties[s];let b=!1;const v=E=>{for(const M of E)if(m.overrides&&m.overrides.hasOverride(M))return void(b=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Xa)v(l.value.value.sections);else if(l.value.kind==="source"){const E=P=>{b||(P instanceof Qt&&ra(P.value)===Ou?v(P.value.sections):P instanceof Ac?v(P.sections):P.eachChild(E))},M=l.value;M._styleExpression&&E(M._styleExpression.expression)}return b}}let pf;var Cp={get paint(){return pf=pf||new ma({"background-color":new vt(te.paint_background["background-color"]),"background-pattern":new qs(te.paint_background["background-pattern"]),"background-opacity":new vt(te.paint_background["background-opacity"])})}};class Mp extends Pr{constructor(t){super(t,Cp)}}let Ip;var E0={get paint(){return Ip=Ip||new ma({"raster-opacity":new vt(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new vt(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vt(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vt(te.paint_raster["raster-brightness-max"]),"raster-saturation":new vt(te.paint_raster["raster-saturation"]),"raster-contrast":new vt(te.paint_raster["raster-contrast"]),"raster-resampling":new vt(te.paint_raster["raster-resampling"]),"raster-fade-duration":new vt(te.paint_raster["raster-fade-duration"])})}};class w0 extends Pr{constructor(t){super(t,E0)}}class wm extends Pr{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Am{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const rd={once:!0},A0=63710088e-1;class Au{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Au(Zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,m=t.lat*s,b=Math.sin(l)*Math.sin(m)+Math.cos(l)*Math.cos(m)*Math.cos((t.lng-this.lng)*s);return A0*Math.acos(Math.min(b,1))}static convert(t){if(t instanceof Au)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Au(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Au(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ai=2*Math.PI*A0;function mf(o){return Ai*Math.cos(o*Math.PI/180)}function sd(o){return(180+o)/360}function gf(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function S0(o,t){return o/mf(t)}function od(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function dh(o,t){return o*mf(od(t))}class bl{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=Au.convert(t);return new bl(sd(l.lng),gf(l.lat),S0(s,l.lat))}toLngLat(){return new Au(360*this.x-180,od(this.y))}toAltitude(){return dh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ai*(t=od(this.y),1/Math.cos(t*Math.PI/180));var t}}function uc(o,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[o*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class _f{constructor(t,s,l){if(!function(m,b,v){return!(m<0||m>25||v<0||v>=Math.pow(2,m)||b<0||b>=Math.pow(2,m))}(t,s,l))throw new Error(`x=${s}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=l,this.key=lc(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,l){const m=(v=this.y,E=this.z,M=uc(256*(b=this.x),256*(v=Math.pow(2,E)-v-1),E),P=uc(256*(b+1),256*(v+1),E),M[0]+","+M[1]+","+P[0]+","+P[1]);var b,v,E,M,P;const N=function(B,U,j){let V,$="";for(let ee=B;ee>0;ee--)V=1<<ee-1,$+=(U&V?1:0)+(j&V?2:0);return $}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,m)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new Ve((t.x*s-this.x)*At,(t.y*s-this.y)*At)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dp{constructor(t,s){this.wrap=t,this.canonical=s,this.key=lc(t,s.z,s.z,s.x,s.y)}}class Wr{constructor(t,s,l,m,b){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=s,this.canonical=new _f(l,+m,+b),this.key=lc(s,t,l,m,b)}clone(){return new Wr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Wr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?lc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):lc(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,m=2*this.canonical.y;return[new Wr(s,this.wrap,s,l,m),new Wr(s,this.wrap,s,l+1,m),new Wr(s,this.wrap,s,l,m+1),new Wr(s,this.wrap,s,l+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Wr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new bl(t.x-this.wrap,t.y))}}function lc(o,t,s,l,m){(o*=2)<0&&(o=-1*o-1);const b=1<<s;return(b*b*o+b*m+l).toString(36)+s.toString(36)+t.toString(36)}wt("CanonicalTileID",_f),wt("OverscaledTileID",Wr,{omit:["terrainRttPosMatrix32f"]});class C0{constructor(t,s,l,m=1,b=1,v=1,E=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void hn(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const M=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=v,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<M;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(M,P)]=this.data[this._idx(M-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,M)]=this.data[this._idx(P,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<M;P++)for(let N=0;N<M;N++){const B=this.get(P,N);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(t,s){const l=new Uint8Array(this.data.buffer),m=4*this._idx(t,s);return this.unpack(l[m],l[m+1],l[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,l){return t*this.redFactor+s*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new Or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,b=s*this.dim+this.dim,v=l*this.dim,E=l*this.dim+this.dim;switch(s){case-1:m=b-1;break;case 1:b=m+1}switch(l){case-1:v=E-1;break;case 1:E=v+1}const M=-s*this.dim,P=-l*this.dim;for(let N=v;N<E;N++)for(let B=m;B<b;B++)this.data[this._idx(B,N)]=t.data[this._idx(B+M,N+P)]}}wt("DEMData",C0);class ud{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class aa{constructor(t,s,l,m,b){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=l,t._y=m,this.properties=t.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class yf{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Hs(At,16,0),this.grid3D=new Hs(At,16,0),this.featureIndexArray=new qe,this.promoteId=s}insert(t,s,l,m,b,v){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,m,b);const M=v?this.grid3D:this.grid;for(let P=0;P<s.length;P++){const N=s[P],B=[1/0,1/0,-1/0,-1/0];for(let U=0;U<N.length;U++){const j=N[U];B[0]=Math.min(B[0],j.x),B[1]=Math.min(B[1],j.y),B[2]=Math.max(B[2],j.x),B[3]=Math.max(B[3],j.y)}B[0]<At&&B[1]<At&&B[2]>=0&&B[3]>=0&&M.insert(E,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xu.VectorTile(new Tr(this.rawTileData)).layers,this.sourceLayerCoder=new ud(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,l,m){this.loadVTLayers();const b=t.params,v=At/t.tileSize/t.scale,E=fr(b.filter),M=t.queryGeometry,P=t.queryPadding*v,N=Rp(M),B=this.grid.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P),U=Rp(t.cameraQueryGeometry),j=this.grid3D.query(U.minX-P,U.minY-P,U.maxX+P,U.maxY+P,(ee,oe,ve,ue)=>function(H,J,fe,Be,st){for(const Qe of H)if(J<=Qe.x&&fe<=Qe.y&&Be>=Qe.x&&st>=Qe.y)return!0;const je=[new Ve(J,fe),new Ve(J,st),new Ve(Be,st),new Ve(Be,fe)];if(H.length>2){for(const Qe of je)if(ul(H,Qe))return!0}for(let Qe=0;Qe<H.length-1;Qe++)if(Qf(H[Qe],H[Qe+1],je))return!0;return!1}(t.cameraQueryGeometry,ee-P,oe-P,ve+P,ue+P));for(const ee of j)B.push(ee);B.sort(M0);const V={};let $;for(let ee=0;ee<B.length;ee++){const oe=B[ee];if(oe===$)continue;$=oe;const ve=this.featureIndexArray.get(oe);let ue=null;this.loadMatchingFeature(V,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,E,b.layers,b.availableImages,s,l,m,(H,J,fe)=>(ue||(ue=Lr(H)),J.queryIntersectsFeature({queryGeometry:M,feature:H,featureState:fe,geometry:ue,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return V}loadMatchingFeature(t,s,l,m,b,v,E,M,P,N,B){const U=this.bucketLayerIDs[s];if(v&&!U.some(ee=>v.has(ee)))return;const j=this.sourceLayerCoder.decode(l),V=this.vtLayers[j].feature(m);if(b.needGeometry){const ee=br(V,!0);if(!b.filter(new ea(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!b.filter(new ea(this.tileID.overscaledZ),V))return;const $=this.getId(V,j);for(let ee=0;ee<U.length;ee++){const oe=U[ee];if(v&&!v.has(oe))continue;const ve=M[oe];if(!ve)continue;let ue={};$&&N&&(ue=N.getState(ve.sourceLayer||"_geojsonTileLayer",$));const H=si({},P[oe]);H.paint=Pn(H.paint,ve.paint,V,ue,E),H.layout=Pn(H.layout,ve.layout,V,ue,E);const J=!B||B(V,ve,ue);if(!J)continue;const fe=new aa(V,this.z,this.x,this.y,$);fe.layer=H;let Be=t[oe];Be===void 0&&(Be=t[oe]=[]),Be.push({featureIndex:m,feature:fe,intersectionZ:J})}}lookupSymbolFeatures(t,s,l,m,b,v,E,M){const P={};this.loadVTLayers();const N=fr(b);for(const B of t)this.loadMatchingFeature(P,l,m,B,N,v,E,M,s);return P}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){var l;let m=t.id;return this.promoteId&&(m=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof m=="boolean"&&(m=Number(m)),m===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(m=Number(t.properties.cluster_id))),m}}function Pn(o,t,s,l,m){return Va(o,(b,v)=>{const E=t instanceof ki?t.get(v):null;return E&&E.evaluate?E.evaluate(s,l,m):E})}function Rp(o){let t=1/0,s=1/0,l=-1/0,m=-1/0;for(const b of o)t=Math.min(t,b.x),s=Math.min(s,b.y),l=Math.max(l,b.x),m=Math.max(m,b.y);return{minX:t,minY:s,maxX:l,maxY:m}}function M0(o,t){return t-o}function bf(o,t,s,l,m){const b=[];for(let v=0;v<o.length;v++){const E=o[v];let M;for(let P=0;P<E.length-1;P++){let N=E[P],B=E[P+1];N.x<t&&B.x<t||(N.x<t?N=new Ve(t,N.y+(t-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x<t&&(B=new Ve(t,N.y+(t-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y<s&&B.y<s||(N.y<s?N=new Ve(N.x+(s-N.y)/(B.y-N.y)*(B.x-N.x),s)._round():B.y<s&&(B=new Ve(N.x+(s-N.y)/(B.y-N.y)*(B.x-N.x),s)._round()),N.x>=l&&B.x>=l||(N.x>=l?N=new Ve(l,N.y+(l-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x>=l&&(B=new Ve(l,N.y+(l-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y>=m&&B.y>=m||(N.y>=m?N=new Ve(N.x+(m-N.y)/(B.y-N.y)*(B.x-N.x),m)._round():B.y>=m&&(B=new Ve(N.x+(m-N.y)/(B.y-N.y)*(B.x-N.x),m)._round()),M&&N.equals(M[M.length-1])||(M=[N],b.push(M)),M.push(B)))))}}return b}wt("FeatureIndex",yf,{omit:["rawTileData","sourceLayerCoder"]});class io extends Ve{constructor(t,s,l,m){super(t,s),this.angle=l,m!==void 0&&(this.segment=m)}clone(){return new io(this.x,this.y,this.angle,this.segment)}}function I0(o,t,s,l,m){if(t.segment===void 0||s===0)return!0;let b=t,v=t.segment+1,E=0;for(;E>-s/2;){if(v--,v<0)return!1;E-=o[v].dist(b),b=o[v]}E+=o[v].dist(o[v+1]),v++;const M=[];let P=0;for(;E<s/2;){const N=o[v],B=o[v+1];if(!B)return!1;let U=o[v-1].angleTo(N)-N.angleTo(B);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:E,angleDelta:U}),P+=U;E-M[0].distance>l;)P-=M.shift().angleDelta;if(P>m)return!1;v++,E+=N.dist(B)}return!0}function D0(o){let t=0;for(let s=0;s<o.length-1;s++)t+=o[s].dist(o[s+1]);return t}function xf(o,t,s){return o?.6*t*s:0}function vf(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function Sm(o,t,s,l,m,b){const v=xf(s,m,b),E=vf(s,l)*b;let M=0;const P=D0(o)/2;for(let N=0;N<o.length-1;N++){const B=o[N],U=o[N+1],j=B.dist(U);if(M+j>P){const V=(P-M)/j,$=rs.number(B.x,U.x,V),ee=rs.number(B.y,U.y,V),oe=new io($,ee,U.angleTo(B),N);return oe._round(),!v||I0(o,oe,E,v,t)?oe:void 0}M+=j}}function Pp(o,t,s,l,m,b,v,E,M){const P=xf(l,b,v),N=vf(l,m),B=N*v,U=o[0].x===0||o[0].x===M||o[0].y===0||o[0].y===M;return t-B<t/4&&(t=B+t/4),Lp(o,U?t/2*E%t:(N/2+2*b)*v*E%t,t,P,s,B,U,!1,M)}function Lp(o,t,s,l,m,b,v,E,M){const P=b/2,N=D0(o);let B=0,U=t-s,j=[];for(let V=0;V<o.length-1;V++){const $=o[V],ee=o[V+1],oe=$.dist(ee),ve=ee.angleTo($);for(;U+s<B+oe;){U+=s;const ue=(U-B)/oe,H=rs.number($.x,ee.x,ue),J=rs.number($.y,ee.y,ue);if(H>=0&&H<M&&J>=0&&J<M&&U-P>=0&&U+P<=N){const fe=new io(H,J,ve,V);fe._round(),l&&!I0(o,fe,b,l,m)||j.push(fe)}}B+=oe}return E||j.length||v||(j=Lp(o,B/2,s,l,m,b,v,!0,M)),j}wt("Anchor",io);const fh=Rn;function Op(o,t,s,l){const m=[],b=o.image,v=b.pixelRatio,E=b.paddedRect.w-2*fh,M=b.paddedRect.h-2*fh;let P={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const N=b.stretchX||[[0,E]],B=b.stretchY||[[0,M]],U=(We,It)=>We+It[1]-It[0],j=N.reduce(U,0),V=B.reduce(U,0),$=E-j,ee=M-V;let oe=0,ve=j,ue=0,H=V,J=0,fe=$,Be=0,st=ee;if(b.content&&l){const We=b.content,It=We[2]-We[0],Bt=We[3]-We[1];(b.textFitWidth||b.textFitHeight)&&(P=hf(o)),oe=Tf(N,0,We[0]),ue=Tf(B,0,We[1]),ve=Tf(N,We[0],We[2]),H=Tf(B,We[1],We[3]),J=We[0]-oe,Be=We[1]-ue,fe=It-ve,st=Bt-H}const je=P.x1,Qe=P.y1,ht=P.x2-je,ut=P.y2-Qe,ft=(We,It,Bt,kt)=>{const Pt=ld(We.stretch-oe,ve,ht,je),pi=ph(We.fixed-J,fe,We.stretch,j),Fi=ld(It.stretch-ue,H,ut,Qe),oa=ph(It.fixed-Be,st,It.stretch,V),Aa=ld(Bt.stretch-oe,ve,ht,je),jn=ph(Bt.fixed-J,fe,Bt.stretch,j),gn=ld(kt.stretch-ue,H,ut,Qe),ga=ph(kt.fixed-Be,st,kt.stretch,V),_a=new Ve(Pt,Fi),Wa=new Ve(Aa,Fi),ja=new Ve(Aa,gn),_n=new Ve(Pt,gn),qn=new Ve(pi/v,oa/v),tr=new Ve(jn/v,ga/v),Ja=t*Math.PI/180;if(Ja){const qa=Math.sin(Ja),en=Math.cos(Ja),ya=[en,-qa,qa,en];_a._matMult(ya),Wa._matMult(ya),_n._matMult(ya),ja._matMult(ya)}const Er=We.stretch+We.fixed,Na=It.stretch+It.fixed;return{tl:_a,tr:Wa,bl:_n,br:ja,tex:{x:b.paddedRect.x+fh+Er,y:b.paddedRect.y+fh+Na,w:Bt.stretch+Bt.fixed-Er,h:kt.stretch+kt.fixed-Na},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qn,pixelOffsetBR:tr,minFontScaleX:fe/v/ht,minFontScaleY:st/v/ut,isSDF:s}};if(l&&(b.stretchX||b.stretchY)){const We=Su(N,$,j),It=Su(B,ee,V);for(let Bt=0;Bt<We.length-1;Bt++){const kt=We[Bt],Pt=We[Bt+1];for(let pi=0;pi<It.length-1;pi++)m.push(ft(kt,It[pi],Pt,It[pi+1]))}}else m.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:M+1}));return m}function Tf(o,t,s){let l=0;for(const m of o)l+=Math.max(t,Math.min(s,m[1]))-Math.max(t,Math.min(s,m[0]));return l}function Su(o,t,s){const l=[{fixed:-1,stretch:0}];for(const[m,b]of o){const v=l[l.length-1];l.push({fixed:m-v.stretch,stretch:v.stretch}),l.push({fixed:m-v.stretch,stretch:v.stretch+(b-m)})}return l.push({fixed:t+fh,stretch:s}),l}function ld(o,t,s,l){return o/t*s+l}function ph(o,t,s,l){return o-t*s/l}class Ef{constructor(t,s,l,m,b,v,E,M,P,N){var B;if(this.boxStartIndex=t.length,P){let U=v.top,j=v.bottom;const V=v.collisionPadding;V&&(U-=V[1],j+=V[3]);let $=j-U;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{const U=!((B=v.image)===null||B===void 0)&&B.content&&(v.image.textFitWidth||v.image.textFitHeight)?hf(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};U.y1=U.y1*E-M[0],U.y2=U.y2*E+M[2],U.x1=U.x1*E-M[3],U.x2=U.x2*E+M[1];const j=v.collisionPadding;if(j&&(U.x1-=j[0]*E,U.y1-=j[1]*E,U.x2+=j[2]*E,U.y2+=j[3]*E),N){const V=new Ve(U.x1,U.y1),$=new Ve(U.x2,U.y1),ee=new Ve(U.x1,U.y2),oe=new Ve(U.x2,U.y2),ve=N*Math.PI/180;V._rotate(ve),$._rotate(ve),ee._rotate(ve),oe._rotate(ve),U.x1=Math.min(V.x,$.x,ee.x,oe.x),U.x2=Math.max(V.x,$.x,ee.x,oe.x),U.y1=Math.min(V.y,$.y,ee.y,oe.y),U.y2=Math.max(V.y,$.y,ee.y,oe.y)}t.emplaceBack(s.x,s.y,U.x1,U.y1,U.x2,U.y2,l,m,b)}this.boxEndIndex=t.length}}class Cm{constructor(t=[],s=(l,m)=>l<m?-1:l>m?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,m=s[t];for(;t>0;){const b=t-1>>1,v=s[b];if(l(m,v)>=0)break;s[t]=v,t=b}s[t]=m}_down(t){const{data:s,compare:l}=this,m=this.length>>1,b=s[t];for(;t<m;){let v=1+(t<<1);const E=v+1;if(E<this.length&&l(s[E],s[v])<0&&(v=E),l(s[v],b)>=0)break;s[t]=s[v],t=v}s[t]=b}}function R0(o,t=1,s=!1){let l=1/0,m=1/0,b=-1/0,v=-1/0;const E=o[0];for(let j=0;j<E.length;j++){const V=E[j];(!j||V.x<l)&&(l=V.x),(!j||V.y<m)&&(m=V.y),(!j||V.x>b)&&(b=V.x),(!j||V.y>v)&&(v=V.y)}const M=Math.min(b-l,v-m);let P=M/2;const N=new Cm([],Mm);if(M===0)return new Ve(l,m);for(let j=l;j<b;j+=M)for(let V=m;V<v;V+=M)N.push(new er(j+P,V+P,P,o));let B=function(j){let V=0,$=0,ee=0;const oe=j[0];for(let ve=0,ue=oe.length,H=ue-1;ve<ue;H=ve++){const J=oe[ve],fe=oe[H],Be=J.x*fe.y-fe.x*J.y;$+=(J.x+fe.x)*Be,ee+=(J.y+fe.y)*Be,V+=3*Be}return new er($/V,ee/V,0,j)}(o),U=N.length;for(;N.length;){const j=N.pop();(j.d>B.d||!B.d)&&(B=j,s&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,U)),j.max-B.d<=t||(P=j.h/2,N.push(new er(j.p.x-P,j.p.y-P,P,o)),N.push(new er(j.p.x+P,j.p.y-P,P,o)),N.push(new er(j.p.x-P,j.p.y+P,P,o)),N.push(new er(j.p.x+P,j.p.y+P,P,o)),U+=4)}return s&&(console.log(`num probes: ${U}`),console.log(`best distance: ${B.d}`)),B.p}function Mm(o,t){return t.max-o.max}function er(o,t,s,l){this.p=new Ve(o,t),this.h=s,this.d=function(m,b){let v=!1,E=1/0;for(let M=0;M<b.length;M++){const P=b[M];for(let N=0,B=P.length,U=B-1;N<B;U=N++){const j=P[N],V=P[U];j.y>m.y!=V.y>m.y&&m.x<(V.x-j.x)*(m.y-j.y)/(V.y-j.y)+j.x&&(v=!v),E=Math.min(E,Xf(m,j,V))}}return(v?1:-1)*Math.sqrt(E)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var cn;S.aB=void 0,(cn=S.aB||(S.aB={}))[cn.center=1]="center",cn[cn.left=2]="left",cn[cn.right=3]="right",cn[cn.top=4]="top",cn[cn.bottom=5]="bottom",cn[cn["top-left"]=6]="top-left",cn[cn["top-right"]=7]="top-right",cn[cn["bottom-left"]=8]="bottom-left",cn[cn["bottom-right"]=9]="bottom-right";const Cu=7,wf=Number.POSITIVE_INFINITY;function mh(o,t){return t[1]!==wf?function(s,l,m){let b=0,v=0;switch(l=Math.abs(l),m=Math.abs(m),s){case"top-right":case"top-left":case"top":v=m-Cu;break;case"bottom-right":case"bottom-left":case"bottom":v=-m+Cu}switch(s){case"top-right":case"bottom-right":case"right":b=-l;break;case"top-left":case"bottom-left":case"left":b=l}return[b,v]}(o,t[0],t[1]):function(s,l){let m=0,b=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(s){case"top-right":case"top-left":b=v-Cu;break;case"bottom-right":case"bottom-left":b=-v+Cu;break;case"bottom":b=-l+Cu;break;case"top":b=l-Cu}switch(s){case"top-right":case"bottom-right":m=-v;break;case"top-left":case"bottom-left":m=v;break;case"left":m=l;break;case"right":m=-l}return[m,b]}(o,t[0])}function Jr(o,t,s){var l;const m=o.layout,b=(l=m.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},s);if(b){const E=b.values,M=[];for(let P=0;P<E.length;P+=2){const N=M[P]=E[P],B=E[P+1].map(U=>U*Ha);N.startsWith("top")?B[1]-=Cu:N.startsWith("bottom")&&(B[1]+=Cu),M[P+1]=B}return new va(M)}const v=m.get("text-variable-anchor");if(v){let E;E=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(t,{},s)*Ha,wf]:m.get("text-offset").evaluate(t,{},s).map(P=>P*Ha);const M=[];for(const P of v)M.push(P,mh(P,E));return new va(M)}return null}function Af(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sf(o,t,s,l,m,b,v,E,M,P,N,B){let U=b.textMaxSize.evaluate(t,{});U===void 0&&(U=v);const j=o.layers[0].layout,V=j.get("icon-offset").evaluate(t,{},N),$=Np(s.horizontal),ee=v/24,oe=o.tilePixelRatio*ee,ve=o.tilePixelRatio*U/24,ue=o.tilePixelRatio*E,H=o.tilePixelRatio*j.get("symbol-spacing"),J=j.get("text-padding")*o.tilePixelRatio,fe=function(Bt,kt,Pt,pi=1){const Fi=Bt.get("icon-padding").evaluate(kt,{},Pt),oa=Fi&&Fi.values;return[oa[0]*pi,oa[1]*pi,oa[2]*pi,oa[3]*pi]}(j,t,N,o.tilePixelRatio),Be=j.get("text-max-angle")/180*Math.PI,st=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",je=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Qe=j.get("symbol-placement"),ht=H/2,ut=j.get("icon-text-fit");let ft;l&&ut!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(ft=Ap(l,s.vertical,ut,j.get("icon-text-fit-padding"),V,ee)),$&&(l=Ap(l,$,ut,j.get("icon-text-fit-padding"),V,ee)));const We=N?B.line.getGranularityForZoomLevel(N.z):1,It=(Bt,kt)=>{kt.x<0||kt.x>=At||kt.y<0||kt.y>=At||function(Pt,pi,Fi,oa,Aa,jn,gn,ga,_a,Wa,ja,_n,qn,tr,Ja,Er,Na,qa,en,ya,Ki,kr,dc,ao,Df){const a=Pt.addToLineVertexArray(pi,Fi);let u,d,_,w,D=0,q=0,W=0,_e=0,Ue=-1,nt=-1;const ot={};let Ze=gr("");if(Pt.allowVerticalPlacement&&oa.vertical){const Vn=ga.layout.get("text-rotate").evaluate(Ki,{},ao)+90;_=new Ef(_a,pi,Wa,ja,_n,oa.vertical,qn,tr,Ja,Vn),gn&&(w=new Ef(_a,pi,Wa,ja,_n,gn,Na,qa,Ja,Vn))}if(Aa){const Vn=ga.layout.get("icon-rotate").evaluate(Ki,{}),no=ga.layout.get("icon-text-fit")!=="none",hd=Op(Aa,Vn,dc,no),Mu=gn?Op(gn,Vn,dc,no):void 0;d=new Ef(_a,pi,Wa,ja,_n,Aa,Na,qa,!1,Vn),D=4*hd.length;const dd=Pt.iconSizeData;let Tl=null;dd.kind==="source"?(Tl=[No*ga.layout.get("icon-size").evaluate(Ki,{})],Tl[0]>yl&&hn(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${uh}. Reduce your "icon-size".`)):dd.kind==="composite"&&(Tl=[No*kr.compositeIconSizes[0].evaluate(Ki,{},ao),No*kr.compositeIconSizes[1].evaluate(Ki,{},ao)],(Tl[0]>yl||Tl[1]>yl)&&hn(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${uh}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,hd,Tl,ya,en,Ki,S.al.none,pi,a.lineStartIndex,a.lineLength,-1,ao),Ue=Pt.icon.placedSymbolArray.length-1,Mu&&(q=4*Mu.length,Pt.addSymbols(Pt.icon,Mu,Tl,ya,en,Ki,S.al.vertical,pi,a.lineStartIndex,a.lineLength,-1,ao),nt=Pt.icon.placedSymbolArray.length-1)}const Xe=Object.keys(oa.horizontal);for(const Vn of Xe){const no=oa.horizontal[Vn];if(!u){Ze=gr(no.text);const Mu=ga.layout.get("text-rotate").evaluate(Ki,{},ao);u=new Ef(_a,pi,Wa,ja,_n,no,qn,tr,Ja,Mu)}const hd=no.positionedLines.length===1;if(W+=ko(Pt,pi,no,jn,ga,Ja,Ki,Er,a,oa.vertical?S.al.horizontal:S.al.horizontalOnly,hd?Xe:[Vn],ot,Ue,kr,ao),hd)break}oa.vertical&&(_e+=ko(Pt,pi,oa.vertical,jn,ga,Ja,Ki,Er,a,S.al.vertical,["vertical"],ot,nt,kr,ao));const ni=u?u.boxStartIndex:Pt.collisionBoxArray.length,Jt=u?u.boxEndIndex:Pt.collisionBoxArray.length,ua=_?_.boxStartIndex:Pt.collisionBoxArray.length,Pe=_?_.boxEndIndex:Pt.collisionBoxArray.length,Ce=d?d.boxStartIndex:Pt.collisionBoxArray.length,ze=d?d.boxEndIndex:Pt.collisionBoxArray.length,lt=w?w.boxStartIndex:Pt.collisionBoxArray.length,zt=w?w.boxEndIndex:Pt.collisionBoxArray.length;let ri=-1;const Gt=(Vn,no)=>Vn&&Vn.circleDiameter?Math.max(Vn.circleDiameter,no):no;ri=Gt(u,ri),ri=Gt(_,ri),ri=Gt(d,ri),ri=Gt(w,ri);const ei=ri>-1?1:0;ei&&(ri*=Df/Ha),Pt.glyphOffsetArray.length>=hh.MAX_GLYPHS&&hn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ki.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,Ki.sortKey);const Ln=Jr(ga,Ki,ao),[Ui,vl]=function(Vn,no){const hd=Vn.length,Mu=no==null?void 0:no.values;if((Mu==null?void 0:Mu.length)>0)for(let dd=0;dd<Mu.length;dd+=2){const Tl=Mu[dd+1];Vn.emplaceBack(S.aB[Mu[dd]],Tl[0],Tl[1])}return[hd,Vn.length]}(Pt.textAnchorOffsets,Ln);Pt.symbolInstances.emplaceBack(pi.x,pi.y,ot.right>=0?ot.right:-1,ot.center>=0?ot.center:-1,ot.left>=0?ot.left:-1,ot.vertical||-1,Ue,nt,Ze,ni,Jt,ua,Pe,Ce,ze,lt,zt,Wa,W,_e,D,q,ei,0,qn,ri,Ui,vl)}(o,kt,Bt,s,l,m,ft,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,oe,[J,J,J,J],st,M,ue,fe,je,V,t,b,P,N,v)};if(Qe==="line")for(const Bt of bf(t.geometry,0,0,At,At)){const kt=hl(Bt,We),Pt=Pp(kt,H,Be,s.vertical||$,l,24,ve,o.overscaling,At);for(const pi of Pt)$&&Im(o,$.text,ht,pi)||It(kt,pi)}else if(Qe==="line-center"){for(const Bt of t.geometry)if(Bt.length>1){const kt=hl(Bt,We),Pt=Sm(kt,Be,s.vertical||$,l,24,ve);Pt&&It(kt,Pt)}}else if(t.type==="Polygon")for(const Bt of Ol(t.geometry,0)){const kt=R0(Bt,16);It(hl(Bt[0],We,!0),new io(kt.x,kt.y,0))}else if(t.type==="LineString")for(const Bt of t.geometry){const kt=hl(Bt,We);It(kt,new io(kt[0].x,kt[0].y,0))}else if(t.type==="Point")for(const Bt of t.geometry)for(const kt of Bt)It([kt],new io(kt.x,kt.y,0))}function ko(o,t,s,l,m,b,v,E,M,P,N,B,U,j,V){const $=function(ve,ue,H,J,fe,Be,st,je){const Qe=J.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,ht=[];for(const ut of ue.positionedLines)for(const ft of ut.positionedGlyphs){if(!ft.rect)continue;const We=ft.rect||{};let It=vm+1,Bt=!0,kt=1,Pt=0;const pi=(fe||je)&&ft.vertical,Fi=ft.metrics.advance*ft.scale/2;if(je&&ue.verticalizable&&(Pt=ut.lineOffset/2-(ft.imageName?-(Ha-ft.metrics.width*ft.scale)/2:(ft.scale-1)*Ha)),ft.imageName){const qa=st[ft.imageName];Bt=qa.sdf,kt=qa.pixelRatio,It=Rn/kt}const oa=fe?[ft.x+Fi,ft.y]:[0,0];let Aa=fe?[0,0]:[ft.x+Fi+H[0],ft.y+H[1]-Pt],jn=[0,0];pi&&(jn=Aa,Aa=[0,0]);const gn=ft.metrics.isDoubleResolution?2:1,ga=(ft.metrics.left-It)*ft.scale-Fi+Aa[0],_a=(-ft.metrics.top-It)*ft.scale+Aa[1],Wa=ga+We.w/gn*ft.scale/kt,ja=_a+We.h/gn*ft.scale/kt,_n=new Ve(ga,_a),qn=new Ve(Wa,_a),tr=new Ve(ga,ja),Ja=new Ve(Wa,ja);if(pi){const qa=new Ve(-Fi,Fi-id),en=-Math.PI/2,ya=Ha/2-Fi,Ki=new Ve(5-id-ya,-(ft.imageName?ya:0)),kr=new Ve(...jn);_n._rotateAround(en,qa)._add(Ki)._add(kr),qn._rotateAround(en,qa)._add(Ki)._add(kr),tr._rotateAround(en,qa)._add(Ki)._add(kr),Ja._rotateAround(en,qa)._add(Ki)._add(kr)}if(Qe){const qa=Math.sin(Qe),en=Math.cos(Qe),ya=[en,-qa,qa,en];_n._matMult(ya),qn._matMult(ya),tr._matMult(ya),Ja._matMult(ya)}const Er=new Ve(0,0),Na=new Ve(0,0);ht.push({tl:_n,tr:qn,bl:tr,br:Ja,tex:We,writingMode:ue.writingMode,glyphOffset:oa,sectionIndex:ft.sectionIndex,isSDF:Bt,pixelOffsetTL:Er,pixelOffsetBR:Na,minFontScaleX:0,minFontScaleY:0})}return ht}(0,s,E,m,b,v,l,o.allowVerticalPlacement),ee=o.textSizeData;let oe=null;ee.kind==="source"?(oe=[No*m.layout.get("text-size").evaluate(v,{})],oe[0]>yl&&hn(`${o.layerIds[0]}: Value for "text-size" is >= ${uh}. Reduce your "text-size".`)):ee.kind==="composite"&&(oe=[No*j.compositeTextSizes[0].evaluate(v,{},V),No*j.compositeTextSizes[1].evaluate(v,{},V)],(oe[0]>yl||oe[1]>yl)&&hn(`${o.layerIds[0]}: Value for "text-size" is >= ${uh}. Reduce your "text-size".`)),o.addSymbols(o.text,$,oe,E,b,v,P,t,M.lineStartIndex,M.lineLength,U,V);for(const ve of N)B[ve]=o.text.placedSymbolArray.length-1;return 4*$.length}function Np(o){for(const t in o)return o[t];return null}function Im(o,t,s,l){const m=o.compareText;if(t in m){const b=m[t];for(let v=b.length-1;v>=0;v--)if(l.dist(b[v])<s)return!0}else m[t]=[];return m[t].push(l),!1}const cc=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=l>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=cc[15&l];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[E]=new Uint32Array(t,4,1);return new Cf(E,v,b,t)}constructor(t,s=64,l=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const b=cc.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,E=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-E%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${l}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=s,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return P0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,l,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:E}=this,M=[0,b.length-1,0],P=[];for(;M.length;){const N=M.pop()||0,B=M.pop()||0,U=M.pop()||0;if(B-U<=E){for(let ee=U;ee<=B;ee++){const oe=v[2*ee],ve=v[2*ee+1];oe>=t&&oe<=l&&ve>=s&&ve<=m&&P.push(b[ee])}continue}const j=U+B>>1,V=v[2*j],$=v[2*j+1];V>=t&&V<=l&&$>=s&&$<=m&&P.push(b[j]),(N===0?t<=V:s<=$)&&(M.push(U),M.push(j-1),M.push(1-N)),(N===0?l>=V:m>=$)&&(M.push(j+1),M.push(B),M.push(1-N))}return P}within(t,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:v}=this,E=[0,m.length-1,0],M=[],P=l*l;for(;E.length;){const N=E.pop()||0,B=E.pop()||0,U=E.pop()||0;if(B-U<=v){for(let ee=U;ee<=B;ee++)Bp(b[2*ee],b[2*ee+1],t,s)<=P&&M.push(m[ee]);continue}const j=U+B>>1,V=b[2*j],$=b[2*j+1];Bp(V,$,t,s)<=P&&M.push(m[j]),(N===0?t-l<=V:s-l<=$)&&(E.push(U),E.push(j-1),E.push(1-N)),(N===0?t+l>=V:s+l>=$)&&(E.push(j+1),E.push(B),E.push(1-N))}return M}}function P0(o,t,s,l,m,b){if(m-l<=s)return;const v=l+m>>1;kp(o,t,v,l,m,b),P0(o,t,s,l,v-1,1-b),P0(o,t,s,v+1,m,1-b)}function kp(o,t,s,l,m,b){for(;m>l;){if(m-l>600){const P=m-l+1,N=s-l+1,B=Math.log(P),U=.5*Math.exp(2*B/3),j=.5*Math.sqrt(B*U*(P-U)/P)*(N-P/2<0?-1:1);kp(o,t,s,Math.max(l,Math.floor(s-N*U/P+j)),Math.min(m,Math.floor(s+(P-N)*U/P+j)),b)}const v=t[2*s+b];let E=l,M=m;for(cd(o,t,l,s),t[2*m+b]>v&&cd(o,t,l,m);E<M;){for(cd(o,t,E,M),E++,M--;t[2*E+b]<v;)E++;for(;t[2*M+b]>v;)M--}t[2*l+b]===v?cd(o,t,l,M):(M++,cd(o,t,M,m)),M<=s&&(l=M+1),s<=M&&(m=M-1)}}function cd(o,t,s,l){L0(o,s,l),L0(t,2*s,2*l),L0(t,2*s+1,2*l+1)}function L0(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}function Bp(o,t,s,l){const m=o-s,b=t-l;return m*m+b*b}var O0;S.co=void 0,(O0=S.co||(S.co={})).create="create",O0.load="load",O0.fullLoad="fullLoad";let Mf=null,gh=[];const xl=1e3/60,hc="loadTime",If="fullLoadTime",Dm={mark(o){performance.mark(o)},frame(o){const t=o;Mf!=null&&gh.push(t-Mf),Mf=t},clearMetrics(){Mf=null,gh=[],performance.clearMeasures(hc),performance.clearMeasures(If);for(const o in S.co)performance.clearMarks(S.co[o])},getPerformanceMetrics(){performance.measure(hc,S.co.create,S.co.load),performance.measure(If,S.co.create,S.co.fullLoad);const o=performance.getEntriesByName(hc)[0].duration,t=performance.getEntriesByName(If)[0].duration,s=gh.length,l=1/(gh.reduce((b,v)=>b+v,0)/s/1e3),m=gh.filter(b=>b>xl).reduce((b,v)=>b+(v-xl)/xl,0);return{loadTime:o,fullLoadTime:t,fps:l,percentDroppedFrames:m/(s+m)*100,totalFrames:s}}};S.$=bl,S.A=Oe,S.B=rs,S.C=ea,S.D=vt,S.E=Te,S.F=Zf,S.G=function(o){if(so==null){const t=o.navigator?o.navigator.userAgent:null;so=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return so},S.H=class{constructor(o,t){this.target=o,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Am(()=>this.process()),this.subscription=zo(this.target,"message",s=>this.receive(s),!1),this.globalScope=ts(self)?o:window}registerMessageHandler(o,t){this.messageHandlers[o]=t}sendAsync(o,t){return new Promise((s,l)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=t?zo(t.signal,"abort",()=>{b==null||b.unsubscribe(),delete this.resolveRejects[m];const M={id:m,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},rd):null;this.resolveRejects[m]={resolve:M=>{b==null||b.unsubscribe(),s(M)},reject:M=>{b==null||b.unsubscribe(),l(M)}};const v=[],E=Object.assign(Object.assign({},o),{id:m,sourceMapId:this.mapId,origin:location.origin,data:fu(o.data,v)});this.target.postMessage(E,{transfer:v})})}receive(o){const t=o.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const l=this.abortControllers[s];return delete this.abortControllers[s],void(l&&l.abort())}if(ts(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),t=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(o,t)}processTask(o,t){return h(this,void 0,void 0,function*(){if(t.type==="<response>"){const m=this.resolveRejects[o];return delete this.resolveRejects[o],m?void(t.error?m.reject(Ao(t.error)):m.resolve(Ao(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Ao(t.data),l=new AbortController;this.abortControllers[o]=l;try{const m=yield this.messageHandlers[t.type](t.sourceMapId,s,l);this.completeTask(o,null,m)}catch(m){this.completeTask(o,m)}})}completeTask(o,t,s){const l=[];delete this.abortControllers[o];const m={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?fu(t):null,data:fu(s,l)};this.target.postMessage(m,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.I=td,S.J=Lu,S.K=function(){var o=new Oe(16);return Oe!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},S.L=function(o,t,s){var l,m,b,v,E,M,P,N,B,U,j,V,$=s[0],ee=s[1],oe=s[2];return t===o?(o[12]=t[0]*$+t[4]*ee+t[8]*oe+t[12],o[13]=t[1]*$+t[5]*ee+t[9]*oe+t[13],o[14]=t[2]*$+t[6]*ee+t[10]*oe+t[14],o[15]=t[3]*$+t[7]*ee+t[11]*oe+t[15]):(m=t[1],b=t[2],v=t[3],E=t[4],M=t[5],P=t[6],N=t[7],B=t[8],U=t[9],j=t[10],V=t[11],o[0]=l=t[0],o[1]=m,o[2]=b,o[3]=v,o[4]=E,o[5]=M,o[6]=P,o[7]=N,o[8]=B,o[9]=U,o[10]=j,o[11]=V,o[12]=l*$+E*ee+B*oe+t[12],o[13]=m*$+M*ee+U*oe+t[13],o[14]=b*$+P*ee+j*oe+t[14],o[15]=v*$+N*ee+V*oe+t[15]),o},S.M=function(o,t,s){var l=s[0],m=s[1],b=s[2];return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o[3]=t[3]*l,o[4]=t[4]*m,o[5]=t[5]*m,o[6]=t[6]*m,o[7]=t[7]*m,o[8]=t[8]*b,o[9]=t[9]*b,o[10]=t[10]*b,o[11]=t[11]*b,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},S.N=function(o,t,s){var l=t[0],m=t[1],b=t[2],v=t[3],E=t[4],M=t[5],P=t[6],N=t[7],B=t[8],U=t[9],j=t[10],V=t[11],$=t[12],ee=t[13],oe=t[14],ve=t[15],ue=s[0],H=s[1],J=s[2],fe=s[3];return o[0]=ue*l+H*E+J*B+fe*$,o[1]=ue*m+H*M+J*U+fe*ee,o[2]=ue*b+H*P+J*j+fe*oe,o[3]=ue*v+H*N+J*V+fe*ve,o[4]=(ue=s[4])*l+(H=s[5])*E+(J=s[6])*B+(fe=s[7])*$,o[5]=ue*m+H*M+J*U+fe*ee,o[6]=ue*b+H*P+J*j+fe*oe,o[7]=ue*v+H*N+J*V+fe*ve,o[8]=(ue=s[8])*l+(H=s[9])*E+(J=s[10])*B+(fe=s[11])*$,o[9]=ue*m+H*M+J*U+fe*ee,o[10]=ue*b+H*P+J*j+fe*oe,o[11]=ue*v+H*N+J*V+fe*ve,o[12]=(ue=s[12])*l+(H=s[13])*E+(J=s[14])*B+(fe=s[15])*$,o[13]=ue*m+H*M+J*U+fe*ee,o[14]=ue*b+H*P+J*j+fe*oe,o[15]=ue*v+H*N+J*V+fe*ve,o},S.O=function(o,t){const s={};for(let l=0;l<t.length;l++){const m=t[l];m in o&&(s[m]=o[m])}return s},S.P=Ve,S.Q=Au,S.R=Or,S.S=gf,S.T=jh,S.U=sd,S.V=jt,S.W=et,S.X=Ru,S.Y=Wr,S.Z=At,S._=h,S.a=Ba,S.a$=function(o,t,s){var l=Math.sin(s),m=Math.cos(s),b=t[4],v=t[5],E=t[6],M=t[7],P=t[8],N=t[9],B=t[10],U=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=b*m+P*l,o[5]=v*m+N*l,o[6]=E*m+B*l,o[7]=M*m+U*l,o[8]=P*m-b*l,o[9]=N*m-v*l,o[10]=B*m-E*l,o[11]=U*m-M*l,o},S.a0=25,S.a1=_f,S.a2=o=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const l of o){const m=window.document.createElement("source");De(l)||(t.crossOrigin="Anonymous"),m.src=l,t.appendChild(m)}})},S.a3=Ye,S.a4=function(){return yi++},S.a5=re,S.a6=hh,S.a7=fr,S.a8=br,S.a9=aa,S.aA=function(o,t,s,l,m=!1){if(!s[0]&&!s[1])return[0,0];const b=m?l==="map"?-o.bearingInRadians:0:l==="viewport"?o.bearingInRadians:0;if(b){const v=Math.sin(b),E=Math.cos(b);s=[s[0]*E-s[1]*v,s[0]*v+s[1]*E]}return[m?s[0]:Ei(t,s[0],o.zoom),m?s[1]:Ei(t,s[1],o.zoom)]},S.aC=lh,S.aD=Af,S.aE=lf,S.aF=Cf,S.aG=ca,S.aH=La,S.aI=$e,S.aJ=Li,S.aK=Di,S.aL=Zt,S.aM=Ds,S.aN=dh,S.aO=function(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o[2]=t[2]*s,o},S.aP=function(o,t,s){return o[0]=t[0]+s[0],o[1]=t[1]+s[1],o[2]=t[2]+s[2],o},S.aQ=function(o){var t=new Oe(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t},S.aR=function(o,t,s){return o[0]=t[0]*s[0],o[1]=t[1]*s[1],o[2]=t[2]*s[2],o[3]=t[3]*s[3],o},S.aS=function(o,t,s){return o[0]=t[0]-s[0],o[1]=t[1]-s[1],o[2]=t[2]-s[2],o},S.aT=function(o,t){var s=t[0],l=t[1],m=t[2],b=s*s+l*l+m*m;return b>0&&(b=1/Math.sqrt(b)),o[0]=t[0]*b,o[1]=t[1]*b,o[2]=t[2]*b,o},S.aU=function(o,t,s){var l=t[0],m=t[1],b=t[2],v=s[0],E=s[1],M=s[2];return o[0]=m*M-b*E,o[1]=b*v-l*M,o[2]=l*E-m*v,o},S.aV=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]},S.aW=Dp,S.aX=lc,S.aY=function(o,t,s,l,m){var b,v=1/Math.tan(t/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,m!=null&&m!==1/0?(o[10]=(m+l)*(b=1/(l-m)),o[14]=2*m*l*b):(o[10]=-1,o[14]=-2*l),o},S.aZ=function(o){var t=new Oe(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},S.a_=function(o,t,s){var l=Math.sin(s),m=Math.cos(s),b=t[0],v=t[1],E=t[2],M=t[3],P=t[4],N=t[5],B=t[6],U=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=b*m+P*l,o[1]=v*m+N*l,o[2]=E*m+B*l,o[3]=M*m+U*l,o[4]=P*m-b*l,o[5]=N*m-v*l,o[6]=B*m-E*l,o[7]=U*m-M*l,o},S.aa=function(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,m,b)=>{const v=m||b;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},S.ab=oo,S.ac=function(o){return Math.pow(2,o)},S.ad=xt,S.ae=Wt,S.af=85.051129,S.ag=S0,S.ah=function(o){return Math.log(o)/Math.LN2},S.ai=function(o){var t=o[0],s=o[1];return t*t+s*s},S.aj=function(o,t){const s=[];for(const l in o)l in t||s.push(l);return s},S.ak=function(o,t){let s=0,l=0;if(o.kind==="constant")l=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:v}=o,E=m?Wt(vn.interpolationFactor(m,t,b,v),0,1):0;o.kind==="camera"?l=rs.number(o.minSize,o.maxSize,E):s=E}return{uSizeT:s,uSize:l}},S.am=function(o,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:m}){return o.kind==="source"?l/No:o.kind==="composite"?rs.number(l/No,m/No,s):t},S.an=function(o,t){var s=t[0],l=t[1],m=t[2],b=t[3],v=t[4],E=t[5],M=t[6],P=t[7],N=t[8],B=t[9],U=t[10],j=t[11],V=t[12],$=t[13],ee=t[14],oe=t[15],ve=s*E-l*v,ue=s*M-m*v,H=s*P-b*v,J=l*M-m*E,fe=l*P-b*E,Be=m*P-b*M,st=N*$-B*V,je=N*ee-U*V,Qe=N*oe-j*V,ht=B*ee-U*$,ut=B*oe-j*$,ft=U*oe-j*ee,We=ve*ft-ue*ut+H*ht+J*Qe-fe*je+Be*st;return We?(o[0]=(E*ft-M*ut+P*ht)*(We=1/We),o[1]=(m*ut-l*ft-b*ht)*We,o[2]=($*Be-ee*fe+oe*J)*We,o[3]=(U*fe-B*Be-j*J)*We,o[4]=(M*Qe-v*ft-P*je)*We,o[5]=(s*ft-m*Qe+b*je)*We,o[6]=(ee*H-V*Be-oe*ue)*We,o[7]=(N*Be-U*H+j*ue)*We,o[8]=(v*ut-E*Qe+P*st)*We,o[9]=(l*Qe-s*ut-b*st)*We,o[10]=(V*fe-$*H+oe*ve)*We,o[11]=(B*H-N*fe-j*ve)*We,o[12]=(E*je-v*ht-M*st)*We,o[13]=(s*ht-l*je+m*st)*We,o[14]=($*ue-V*J-ee*ve)*We,o[15]=(N*J-B*ue+U*ve)*We,o):null},S.ao=Je,S.ap=function(o){return Math.hypot(o[0],o[1])},S.aq=function(o){return o[0]=0,o[1]=0,o},S.ar=function(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o},S.as=nd,S.at=zi,S.au=function(o,t,s,l){const m=t.y-o.y,b=t.x-o.x,v=l.y-s.y,E=l.x-s.x,M=v*b-E*m;if(M===0)return null;const P=(E*(o.y-s.y)-v*(o.x-s.x))/M;return new Ve(o.x+P*b,o.y+P*m)},S.av=bf,S.aw=zd,S.ax=function(o){let t=1/0,s=1/0,l=-1/0,m=-1/0;for(const b of o)t=Math.min(t,b.x),s=Math.min(s,b.y),l=Math.max(l,b.x),m=Math.max(m,b.y);return[t,s,l,m]},S.ay=Ha,S.az=Ei,S.b=ka,S.b$=class extends Y{},S.b0=function(){const o=new Float32Array(16);return xt(o),o},S.b1=function(){const o=new Float64Array(16);return xt(o),o},S.b2=function(){return new Float64Array(16)},S.b3=function(o,t,s){const l=new Float64Array(4);return function(m,b,v,E){var M=.5*Math.PI/180;b*=M,v*=M,E*=M;var P=Math.sin(b),N=Math.cos(b),B=Math.sin(v),U=Math.cos(v),j=Math.sin(E),V=Math.cos(E);m[0]=P*U*V-N*B*j,m[1]=N*B*V+P*U*j,m[2]=N*U*j-P*B*V,m[3]=N*U*V+P*B*j}(l,o,t-90,s),l},S.b4=function(o,t,s,l){var m,b,v,E,M,P=t[0],N=t[1],B=t[2],U=t[3],j=s[0],V=s[1],$=s[2],ee=s[3];return(b=P*j+N*V+B*$+U*ee)<0&&(b=-b,j=-j,V=-V,$=-$,ee=-ee),1-b>Ie?(m=Math.acos(b),v=Math.sin(m),E=Math.sin((1-l)*m)/v,M=Math.sin(l*m)/v):(E=1-l,M=l),o[0]=E*P+M*j,o[1]=E*N+M*V,o[2]=E*B+M*$,o[3]=E*U+M*ee,o},S.b5=function(o){const t=new Float64Array(9);var s,l,m,b,v,E,M,P,N,B,U,j,V,$,ee,oe,ve,ue;B=(m=(l=o)[0])*(M=m+m),U=(b=l[1])*M,V=(v=l[2])*M,$=v*(P=b+b),oe=(E=l[3])*M,ve=E*P,ue=E*(N=v+v),(s=t)[0]=1-(j=b*P)-(ee=v*N),s[3]=U-ue,s[6]=V+ve,s[1]=U+ue,s[4]=1-B-ee,s[7]=$-oe,s[2]=V-ve,s[5]=$+oe,s[8]=1-B-j;const H=Ds(-Math.asin(Wt(t[2],-1,1)));let J,fe;return Math.hypot(t[5],t[8])<.001?(J=0,fe=-Ds(Math.atan2(t[3],t[4]))):(J=Ds(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),fe=Ds(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:J,pitch:H+90,bearing:fe}},S.b6=function(o,t){return o.roll==t.roll&&o.pitch==t.pitch&&o.bearing==t.bearing},S.b7=xi,S.b8=Jl,S.b9=cl,S.bA=function(o){if(o.type==="custom")return new wm(o);switch(o.type){case"background":return new Mp(o);case"circle":return new op(o);case"fill":return new u0(o);case"fill-extrusion":return new ta(o);case"heatmap":return new t0(o);case"hillshade":return new Vd(o);case"line":return new Wh(o);case"raster":return new w0(o);case"symbol":return new ff(o)}},S.bB=bn,S.bC=function(o,t){if(!o)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Le(o.version,t.version))return[{command:"setStyle",args:[t]}];Le(o.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Le(o.state,t.state)||s.push({command:"setGlobalState",args:[t.state]}),Le(o.centerAltitude,t.centerAltitude)||s.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Le(o.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Le(o.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Le(o.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Le(o.roll,t.roll)||s.push({command:"setRoll",args:[t.roll]}),Le(o.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Le(o.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Le(o.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Le(o.light,t.light)||s.push({command:"setLight",args:[t.light]}),Le(o.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Le(o.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),Le(o.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const l={},m=[];(function(v,E,M,P){let N;for(N in E=E||{},v=v||{})Object.prototype.hasOwnProperty.call(v,N)&&(Object.prototype.hasOwnProperty.call(E,N)||at(N,M,P));for(N in E)Object.prototype.hasOwnProperty.call(E,N)&&(Object.prototype.hasOwnProperty.call(v,N)?Le(v[N],E[N])||(v[N].type==="geojson"&&E[N].type==="geojson"&&Tt(v,E,N)?He(M,{command:"setGeoJSONSourceData",args:[N,E[N].data]}):yt(N,E,M,P)):Re(N,E,M))})(o.sources,t.sources,m,l);const b=[];o.layers&&o.layers.forEach(v=>{"source"in v&&l[v.source]?s.push({command:"removeLayer",args:[v.id]}):b.push(v)}),s=s.concat(m),function(v,E,M){E=E||[];const P=(v=v||[]).map(Ft),N=E.map(Ft),B=v.reduce(Ot,{}),U=E.reduce(Ot,{}),j=P.slice(),V=Object.create(null);let $,ee,oe,ve,ue;for(let H=0,J=0;H<P.length;H++)$=P[H],Object.prototype.hasOwnProperty.call(U,$)?J++:(He(M,{command:"removeLayer",args:[$]}),j.splice(j.indexOf($,J),1));for(let H=0,J=0;H<N.length;H++)$=N[N.length-1-H],j[j.length-1-H]!==$&&(Object.prototype.hasOwnProperty.call(B,$)?(He(M,{command:"removeLayer",args:[$]}),j.splice(j.lastIndexOf($,j.length-J),1)):J++,ve=j[j.length-H],He(M,{command:"addLayer",args:[U[$],ve]}),j.splice(j.length-H,0,$),V[$]=!0);for(let H=0;H<N.length;H++)if($=N[H],ee=B[$],oe=U[$],!V[$]&&!Le(ee,oe))if(Le(ee.source,oe.source)&&Le(ee["source-layer"],oe["source-layer"])&&Le(ee.type,oe.type)){for(ue in Lt(ee.layout,oe.layout,M,$,null,"setLayoutProperty"),Lt(ee.paint,oe.paint,M,$,null,"setPaintProperty"),Le(ee.filter,oe.filter)||He(M,{command:"setFilter",args:[$,oe.filter]}),Le(ee.minzoom,oe.minzoom)&&Le(ee.maxzoom,oe.maxzoom)||He(M,{command:"setLayerZoomRange",args:[$,oe.minzoom,oe.maxzoom]}),ee)Object.prototype.hasOwnProperty.call(ee,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Lt(ee[ue],oe[ue],M,$,ue.slice(6),"setPaintProperty"):Le(ee[ue],oe[ue])||He(M,{command:"setLayerProperty",args:[$,ue,oe[ue]]}));for(ue in oe)Object.prototype.hasOwnProperty.call(oe,ue)&&!Object.prototype.hasOwnProperty.call(ee,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Lt(ee[ue],oe[ue],M,$,ue.slice(6),"setPaintProperty"):Le(ee[ue],oe[ue])||He(M,{command:"setLayerProperty",args:[$,ue,oe[ue]]}))}else He(M,{command:"removeLayer",args:[$]}),ve=j[j.lastIndexOf($)+1],He(M,{command:"addLayer",args:[oe,ve]})}(b,t.layers,s)}catch(l){console.warn("Unable to compute style diff:",l),s=[{command:"setStyle",args:[t]}]}return s},S.bD=function(o){const t=[],s=o.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},S.bE=function o(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let l=0;l<t.length;l++)if(!o(t[l],s[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(!o(t[l],s[l]))return!1;return!0}return t===s},S.bF=Va,S.bG=es,S.bH=class extends qi{constructor(o,t){super(o,t),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},S.bI=kd,S.bJ=class extends qi{constructor(o,t){super(o,t),this.current=ol}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let t=1;t<16;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},S.bK=qh,S.bL=class extends qi{constructor(o,t){super(o,t),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},S.bM=class extends qi{constructor(o,t){super(o,t),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},S.bN=pt,S.bO=function(o,t){var s=Math.sin(t),l=Math.cos(t);return o[0]=l,o[1]=s,o[2]=0,o[3]=-s,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},S.bP=function(o,t,s){var l=t[0],m=t[1],b=t[2];return o[0]=l*s[0]+m*s[3]+b*s[6],o[1]=l*s[1]+m*s[4]+b*s[7],o[2]=l*s[2]+m*s[5]+b*s[8],o},S.bQ=function(o,t,s,l,m,b,v){var E=1/(t-s),M=1/(l-m),P=1/(b-v);return o[0]=-2*E,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(t+s)*E,o[13]=(m+l)*M,o[14]=(v+b)*P,o[15]=1,o},S.bR=class extends qi{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;const t=new Float32Array(4*o.length);for(let s=0;s<o.length;s++)t[4*s]=o[s].r,t[4*s+1]=o[s].g,t[4*s+2]=o[s].b,t[4*s+3]=o[s].a;this.gl.uniform4fv(this.location,t)}}},S.bS=class extends qi{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;const t=new Float32Array(o);this.gl.uniform1fv(this.location,t)}}},S.bT=class extends y{},S.bU=ml,S.bV=class extends C{},S.bW=Yh,S.bX=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},S.bY=qd,S.bZ=function(o,t,s){var l=t[0],m=t[1],b=t[2],v=s[3]*l+s[7]*m+s[11]*b+s[15];return o[0]=(s[0]*l+s[4]*m+s[8]*b+s[12])/(v=v||1),o[1]=(s[1]*l+s[5]*m+s[9]*b+s[13])/v,o[2]=(s[2]*l+s[6]*m+s[10]*b+s[14])/v,o},S.b_=class extends Gs{},S.ba=eh,S.bb=Nr,S.bc=ct,S.bd=Et,S.be=nn,S.bf=function(o,t,s,l,m){return ct(l,m,Wt((o-t)/(s-t),0,1))},S.bg=Ee,S.bh=function(){return new Float64Array(3)},S.bi=function(o,t,s,l){return o[0]=t[0]+s[0]*l,o[1]=t[1]+s[1]*l,o[2]=t[2]+s[2]*l,o},S.bj=Gi,S.bk=function(){return new Float64Array(4)},S.bl=function(o,t,s,l){var m=[],b=[];return m[0]=t[0]-s[0],m[1]=t[1]-s[1],m[2]=t[2]-s[2],b[0]=m[0]*Math.cos(l)-m[1]*Math.sin(l),b[1]=m[0]*Math.sin(l)+m[1]*Math.cos(l),b[2]=m[2],o[0]=b[0]+s[0],o[1]=b[1]+s[1],o[2]=b[2]+s[2],o},S.bm=function(o,t,s,l){var m=[],b=[];return m[0]=t[0]-s[0],m[1]=t[1]-s[1],m[2]=t[2]-s[2],b[0]=m[0],b[1]=m[1]*Math.cos(l)-m[2]*Math.sin(l),b[2]=m[1]*Math.sin(l)+m[2]*Math.cos(l),o[0]=b[0]+s[0],o[1]=b[1]+s[1],o[2]=b[2]+s[2],o},S.bn=function(o,t,s,l){var m=[],b=[];return m[0]=t[0]-s[0],m[1]=t[1]-s[1],m[2]=t[2]-s[2],b[0]=m[2]*Math.sin(l)+m[0]*Math.cos(l),b[1]=m[1],b[2]=m[2]*Math.cos(l)-m[0]*Math.sin(l),o[0]=b[0]+s[0],o[1]=b[1]+s[1],o[2]=b[2]+s[2],o},S.bo=Kt,S.bp=function(o,t,s){var l=Math.sin(s),m=Math.cos(s),b=t[0],v=t[1],E=t[2],M=t[3],P=t[8],N=t[9],B=t[10],U=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=b*m-P*l,o[1]=v*m-N*l,o[2]=E*m-B*l,o[3]=M*m-U*l,o[8]=b*l+P*m,o[9]=v*l+N*m,o[10]=E*l+B*m,o[11]=M*l+U*m,o},S.bq=function(o,t){const s=Ee(o,360),l=Ee(t,360),m=l-s,b=l>s?m-360:m+360;return Math.abs(m)<Math.abs(b)?m:b},S.br=function(o){return o[0]=0,o[1]=0,o[2]=0,o},S.bs=function(o,t,s,l){const m=Math.sqrt(o*o+t*t),b=Math.sqrt(s*s+l*l);o/=m,t/=m,s/=b,l/=b;const v=Math.acos(o*s+t*l);return-t*s+o*l>0?v:-v},S.bt=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]},S.bu=A0,S.bv=function(o,t){const s=Ee(o,2*Math.PI),l=Ee(t,2*Math.PI);return Math.min(Math.abs(s-l),Math.abs(s-l+2*Math.PI),Math.abs(s-l-2*Math.PI))},S.bw=function(){const o={},t=te.$version;for(const s in te.$root){const l=te.$root[s];if(l.required){let m=null;m=s==="version"?t:l.type==="array"?[]:{},m!=null&&(o[s]=m)}}return o},S.bx=jc,S.by=dn,S.bz=function(o){o=o.slice();const t=Object.create(null);for(let s=0;s<o.length;s++)t[o[s].id]=o[s];for(let s=0;s<o.length;s++)"ref"in o[s]&&(o[s]=Se(o[s],t[o[s].ref]));return o},S.c=xn,S.c0=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]&&o[9]===t[9]&&o[10]===t[10]&&o[11]===t[11]&&o[12]===t[12]&&o[13]===t[13]&&o[14]===t[14]&&o[15]===t[15]},S.c1=function(o,t){var s=o[0],l=o[1],m=o[2],b=o[3],v=o[4],E=o[5],M=o[6],P=o[7],N=o[8],B=o[9],U=o[10],j=o[11],V=o[12],$=o[13],ee=o[14],oe=o[15],ve=t[0],ue=t[1],H=t[2],J=t[3],fe=t[4],Be=t[5],st=t[6],je=t[7],Qe=t[8],ht=t[9],ut=t[10],ft=t[11],We=t[12],It=t[13],Bt=t[14],kt=t[15];return Math.abs(s-ve)<=Ie*Math.max(1,Math.abs(s),Math.abs(ve))&&Math.abs(l-ue)<=Ie*Math.max(1,Math.abs(l),Math.abs(ue))&&Math.abs(m-H)<=Ie*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(b-J)<=Ie*Math.max(1,Math.abs(b),Math.abs(J))&&Math.abs(v-fe)<=Ie*Math.max(1,Math.abs(v),Math.abs(fe))&&Math.abs(E-Be)<=Ie*Math.max(1,Math.abs(E),Math.abs(Be))&&Math.abs(M-st)<=Ie*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(P-je)<=Ie*Math.max(1,Math.abs(P),Math.abs(je))&&Math.abs(N-Qe)<=Ie*Math.max(1,Math.abs(N),Math.abs(Qe))&&Math.abs(B-ht)<=Ie*Math.max(1,Math.abs(B),Math.abs(ht))&&Math.abs(U-ut)<=Ie*Math.max(1,Math.abs(U),Math.abs(ut))&&Math.abs(j-ft)<=Ie*Math.max(1,Math.abs(j),Math.abs(ft))&&Math.abs(V-We)<=Ie*Math.max(1,Math.abs(V),Math.abs(We))&&Math.abs($-It)<=Ie*Math.max(1,Math.abs($),Math.abs(It))&&Math.abs(ee-Bt)<=Ie*Math.max(1,Math.abs(ee),Math.abs(Bt))&&Math.abs(oe-kt)<=Ie*Math.max(1,Math.abs(oe),Math.abs(kt))},S.c2=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},S.c3=o=>o.type==="symbol",S.c4=o=>o.type==="circle",S.c5=o=>o.type==="heatmap",S.c6=o=>o.type==="line",S.c7=o=>o.type==="fill",S.c8=o=>o.type==="fill-extrusion",S.c9=o=>o.type==="hillshade",S.cA=eo,S.cB=ic,S.cC=xu,S.cD=Tr,S.cE=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},S.cF=function(o,t,s,l,m){return h(this,void 0,void 0,function*(){if(et())try{return yield Ru(o,t,s,l,m)}catch{}return function(b,v,E,M,P){const N=b.width,B=b.height;Zn&&sr||(Zn=new OffscreenCanvas(N,B),sr=Zn.getContext("2d",{willReadFrequently:!0})),Zn.width=N,Zn.height=B,sr.drawImage(b,0,0,N,B);const U=sr.getImageData(v,E,M,P);return sr.clearRect(0,0,N,B),U.data}(o,t,s,l,m)})},S.cG=C0,S.cH=Z,S.cI=Me,S.cJ=th,S.cK=rf,S.cL=Bs,S.cM=gs,S.ca=o=>o.type==="raster",S.cb=o=>o.type==="background",S.cc=o=>o.type==="custom",S.cd=Mt,S.ce=function(o,t,s){const l=St(t.x-s.x,t.y-s.y),m=St(o.x-s.x,o.y-s.y);var b,v;return Ds(Math.atan2(l[0]*m[1]-l[1]*m[0],(b=l)[0]*(v=m)[0]+b[1]*v[1]))},S.cf=Nt,S.cg=function(o,t){return is[t]&&(o instanceof MouseEvent||o instanceof WheelEvent)},S.ch=function(o,t){return Pu[t]&&"touches"in o},S.ci=function(o){return Pu[o]||is[o]},S.cj=function(o,t,s){var l=t[0],m=t[1];return o[0]=s[0]*l+s[4]*m+s[12],o[1]=s[1]*l+s[5]*m+s[13],o},S.ck=function(o,t){const{x:s,y:l}=bl.fromLngLat(t);return!(o<0||o>25||l<0||l>=1||s<0||s>=1)},S.cl=function(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},S.cm=class extends mu{},S.cn=Dm,S.cp=function(o){return o.message===an},S.cq=Ar,S.cr=function(o,t){Ba.REGISTERED_PROTOCOLS[o]=t},S.cs=function(o){delete Ba.REGISTERED_PROTOCOLS[o]},S.ct=function(o,t){const s={};for(let m=0;m<o.length;m++){const b=t&&t[o[m].id]||Hr(o[m]);t&&(t[o[m].id]=b);let v=s[b];v||(v=s[b]=[]),v.push(o[m])}const l=[];for(const m in s)l.push(s[m]);return l},S.cu=wt,S.cv=ud,S.cw=yf,S.cx=nc,S.cy=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=At/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const t=o.bucket.layers[0],s=t.layout,l=t._unevaluatedLayout._values,m={layoutIconSize:l["icon-size"].possiblyEvaluate(new ea(o.bucket.zoom+1),o.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new ea(o.bucket.zoom+1),o.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new ea(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=o.bucket.textSizeData;m.compositeTextSizes=[l["text-size"].possiblyEvaluate(new ea(P),o.canonical),l["text-size"].possiblyEvaluate(new ea(N),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=o.bucket.iconSizeData;m.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new ea(P),o.canonical),l["icon-size"].possiblyEvaluate(new ea(N),o.canonical)]}const b=s.get("text-line-height")*Ha,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",E=s.get("text-keep-upright"),M=s.get("text-size");for(const P of o.bucket.features){const N=s.get("text-font").evaluate(P,{},o.canonical).join(","),B=M.evaluate(P,{},o.canonical),U=m.layoutTextSize.evaluate(P,{},o.canonical),j=m.layoutIconSize.evaluate(P,{},o.canonical),V={horizontal:{},vertical:void 0},$=P.text;let ee,oe=[0,0];if($){const H=$.toString(),J=s.get("text-letter-spacing").evaluate(P,{},o.canonical)*Ha,fe=Nd(H)?J:0,Be=s.get("text-anchor").evaluate(P,{},o.canonical),st=Jr(t,P,o.canonical);if(!st){const ut=s.get("text-radial-offset").evaluate(P,{},o.canonical);oe=ut?mh(Be,[ut*Ha,wf]):s.get("text-offset").evaluate(P,{},o.canonical).map(ft=>ft*Ha)}let je=v?"center":s.get("text-justify").evaluate(P,{},o.canonical);const Qe=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(P,{},o.canonical)*Ha:1/0,ht=()=>{o.bucket.allowVerticalPlacement&&Yl(H)&&(V.vertical=sh($,o.glyphMap,o.glyphPositions,o.imagePositions,N,Qe,b,Be,"left",fe,oe,S.al.vertical,!0,U,B))};if(!v&&st){const ut=new Set;if(je==="auto")for(let We=0;We<st.values.length;We+=2)ut.add(Af(st.values[We]));else ut.add(je);let ft=!1;for(const We of ut)if(!V.horizontal[We])if(ft)V.horizontal[We]=V.horizontal[0];else{const It=sh($,o.glyphMap,o.glyphPositions,o.imagePositions,N,Qe,b,"center",We,fe,oe,S.al.horizontal,!1,U,B);It&&(V.horizontal[We]=It,ft=It.positionedLines.length===1)}ht()}else{je==="auto"&&(je=Af(Be));const ut=sh($,o.glyphMap,o.glyphPositions,o.imagePositions,N,Qe,b,Be,je,fe,oe,S.al.horizontal,!1,U,B);ut&&(V.horizontal[je]=ut),ht(),Yl(H)&&v&&E&&(V.vertical=sh($,o.glyphMap,o.glyphPositions,o.imagePositions,N,Qe,b,Be,je,fe,oe,S.al.vertical,!1,U,B))}}let ve=!1;if(P.icon&&P.icon.name){const H=o.imageMap[P.icon.name];H&&(ee=pa(o.imagePositions[P.icon.name],s.get("icon-offset").evaluate(P,{},o.canonical),s.get("icon-anchor").evaluate(P,{},o.canonical)),ve=!!H.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=ve:o.bucket.sdfIcons!==ve&&hn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(H.pixelRatio!==o.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const ue=Np(V.horizontal)||V.vertical;o.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||ee)&&Sf(o.bucket,P,V,ee,o.imageMap,m,U,j,oe,ve,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},S.cz=Oa,S.d=De,S.e=si,S.f=o=>h(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.g=uo,S.h=o=>new Promise((t,s)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Cl})},l.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(o)],{type:"image/png"});l.src=o.byteLength?URL.createObjectURL(m):Cl}),S.i=ts,S.j=(o,t)=>or(si(o,{type:"json"}),t),S.k=de,S.l=ie,S.m=or,S.n=(o,t)=>or(si(o,{type:"arrayBuffer"}),t),S.o=function(o){return new Tr(o).readFields(Kr,[])},S.p=Eu,S.q=Qc,S.r=ma,S.s=zo,S.t=Vl,S.u=ci,S.v=te,S.w=hn,S.x=Gl,S.y=il,S.z=function([o,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:o*Math.cos(t)*Math.sin(s),y:o*Math.sin(t)*Math.sin(s),z:o*Math.cos(s)}}}),A("worker",["./shared"],function(S){class h{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,K){for(const de of X){this._layerConfigs[de.id]=de;const Te=this._layers[de.id]=S.bA(de);Te._featureFilter=S.a7(Te.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of K)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ie=S.ct(Object.values(this._layerConfigs),this.keyCache);for(const de of ie){const Te=de.map(Re=>this._layers[Re.id]),te=Te[0];if(te.visibility==="none")continue;const Ne=te.source||"";let Se=this.familiesBySource[Ne];Se||(Se=this.familiesBySource[Ne]={});const Le=te.sourceLayer||"_geojsonTileLayer";let He=Se[Le];He||(He=Se[Le]=[]),He.push(Te)}}}class Z{constructor(X){const K={},ie=[];for(const Ne in X){const Se=X[Ne],Le=K[Ne]={};for(const He in Se){const Re=Se[+He];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const at={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};ie.push(at),Le[He]={rect:at,metrics:Re.metrics}}}const{w:de,h:Te}=S.p(ie),te=new S.q({width:de||1,height:Te||1});for(const Ne in X){const Se=X[Ne];for(const Le in Se){const He=Se[+Le];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Re=K[Ne][Le].rect;S.q.copy(He.bitmap,te,{x:0,y:0},{x:Re.x+1,y:Re.y+1},He.bitmap)}}this.image=te,this.positions=K}}S.cu("GlyphAtlas",Z);class Q{constructor(X){this.tileID=new S.Y(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[]}parse(X,K,ie,de,Te){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=X,this.collisionBoxArray=new S.a5;const te=new S.cv(Object.keys(X.layers).sort()),Ne=new S.cw(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];const Se={},Le={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie,subdivisionGranularity:Te},He=K.familiesBySource[this.source];for(const Yt in He){const it=X.layers[Yt];if(!it)continue;it.version===1&&S.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qt=te.encode(Yt),Xt=[];for(let Zi=0;Zi<it.length;Zi++){const Wi=it.feature(Zi),$a=Ne.getId(Wi,Yt);Xt.push({feature:Wi,id:$a,index:Zi,sourceLayerIndex:qt})}for(const Zi of He[Yt]){const Wi=Zi[0];Wi.source!==this.source&&S.w(`layer.source = ${Wi.source} does not equal this.source = ${this.source}`),Wi.minzoom&&this.zoom<Math.floor(Wi.minzoom)||Wi.maxzoom&&this.zoom>=Wi.maxzoom||Wi.visibility!=="none"&&(ge(Zi,this.zoom,ie),(Se[Wi.id]=Wi.createBucket({index:Ne.bucketLayerIDs.length,layers:Zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qt,sourceID:this.source})).populate(Xt,Le,this.tileID.canonical),Ne.bucketLayerIDs.push(Zi.map($a=>$a.id)))}}const Re=S.bF(Le.glyphDependencies,Yt=>Object.keys(Yt).map(Number));this.inFlightDependencies.forEach(Yt=>Yt==null?void 0:Yt.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(Re).length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),at=de.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},Yt)}const yt=Object.keys(Le.iconDependencies);let Tt=Promise.resolve({});if(yt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Tt=de.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"icons"}},Yt)}const Lt=Object.keys(Le.patternDependencies);let Ft=Promise.resolve({});if(Lt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Ft=de.sendAsync({type:"GI",data:{icons:Lt,source:this.source,tileID:this.tileID,type:"patterns"}},Yt)}const[Ot,Ye,Ci]=yield Promise.all([at,Tt,Ft]),bi=new Z(Ot),Mi=new S.cx(Ye,Ci);for(const Yt in Se){const it=Se[Yt];it instanceof S.a6?(ge(it.layers,this.zoom,ie),S.cy({bucket:it,glyphMap:Ot,glyphPositions:bi.positions,imageMap:Ye,imagePositions:Mi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Le.subdivisionGranularity})):it.hasPattern&&(it instanceof S.cz||it instanceof S.cA||it instanceof S.cB)&&(ge(it.layers,this.zoom,ie),it.addFeatures(Le,this.tileID.canonical,Mi.patternPositions))}return this.status="done",{buckets:Object.values(Se).filter(Yt=>!Yt.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,imageAtlas:Mi,glyphMap:this.returnDependencies?Ot:null,iconMap:this.returnDependencies?Ye:null,glyphPositions:this.returnDependencies?bi.positions:null}})}}function ge(De,X,K){const ie=new S.C(X);for(const de of De)de.recalculate(ie,K)}class Me{constructor(X,K,ie){this.actor=X,this.layerIndex=K,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(X,K){return S._(this,void 0,void 0,function*(){const ie=yield S.n(X.request,K);try{return{vectorTile:new S.cC.VectorTile(new S.cD(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(de){const Te=new Uint8Array(ie.data);let te=`Unable to parse the tile at ${X.request.url}, `;throw te+=Te[0]===31&&Te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.message}`,new Error(te)}})}loadTile(X){return S._(this,void 0,void 0,function*(){const K=X.uid,ie=!!(X&&X.request&&X.request.collectResourceTiming)&&new S.cE(X.request),de=new Q(X);this.loading[K]=de;const Te=new AbortController;de.abort=Te;try{const te=yield this.loadVectorTile(X,Te);if(delete this.loading[K],!te)return null;const Ne=te.rawData,Se={};te.expires&&(Se.expires=te.expires),te.cacheControl&&(Se.cacheControl=te.cacheControl);const Le={};if(ie){const Re=ie.finish();Re&&(Le.resourceTiming=JSON.parse(JSON.stringify(Re)))}de.vectorTile=te.vectorTile;const He=de.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);this.loaded[K]=de,this.fetching[K]={rawTileData:Ne,cacheControl:Se,resourceTiming:Le};try{const Re=yield He;return S.e({rawTileData:Ne.slice(0)},Re,Se,Le)}finally{delete this.fetching[K]}}catch(te){throw delete this.loading[K],de.status="done",this.loaded[K]=de,te}})}reloadTile(X){return S._(this,void 0,void 0,function*(){const K=X.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[K];if(ie.showCollisionBoxes=X.showCollisionBoxes,ie.status==="parsing"){const de=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);let Te;if(this.fetching[K]){const{rawTileData:te,cacheControl:Ne,resourceTiming:Se}=this.fetching[K];delete this.fetching[K],Te=S.e({rawTileData:te.slice(0)},de,Ne,Se)}else Te=de;return Te}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity)})}abortTile(X){return S._(this,void 0,void 0,function*(){const K=this.loading,ie=X.uid;K&&K[ie]&&K[ie].abort&&(K[ie].abort.abort(),delete K[ie])})}removeTile(X){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[X.uid]&&delete this.loaded[X.uid]})}}class Ae{constructor(){this.loaded={}}loadTile(X){return S._(this,void 0,void 0,function*(){const{uid:K,encoding:ie,rawImageData:de,redFactor:Te,greenFactor:te,blueFactor:Ne,baseShift:Se}=X,Le=de.width+2,He=de.height+2,Re=S.b(de)?new S.R({width:Le,height:He},yield S.cF(de,-1,-1,Le,He)):de,at=new S.cG(K,Re,ie,Te,te,Ne,Se);return this.loaded=this.loaded||{},this.loaded[K]=at,at})}removeTile(X){const K=this.loaded,ie=X.uid;K&&K[ie]&&delete K[ie]}}var he,Ve,Vt=function(){if(Ve)return he;function De(K,ie){if(K.length!==0){X(K[0],ie);for(var de=1;de<K.length;de++)X(K[de],!ie)}}function X(K,ie){for(var de=0,Te=0,te=0,Ne=K.length,Se=Ne-1;te<Ne;Se=te++){var Le=(K[te][0]-K[Se][0])*(K[Se][1]+K[te][1]),He=de+Le;Te+=Math.abs(de)>=Math.abs(Le)?de-He+Le:Le-He+de,de=He}de+Te>=0!=!!ie&&K.reverse()}return Ve=1,he=function K(ie,de){var Te,te=ie&&ie.type;if(te==="FeatureCollection")for(Te=0;Te<ie.features.length;Te++)K(ie.features[Te],de);else if(te==="GeometryCollection")for(Te=0;Te<ie.geometries.length;Te++)K(ie.geometries[Te],de);else if(te==="Feature")K(ie.geometry,de);else if(te==="Polygon")De(ie.coordinates,de);else if(te==="MultiPolygon")for(Te=0;Te<ie.coordinates.length;Te++)De(ie.coordinates[Te],de);return ie}}(),li=S.cH(Vt);const Pi=S.cC.VectorTileFeature.prototype.toGeoJSON;class Bi{constructor(X){this._feature=X,this.extent=S.Z,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const K of this._feature.geometry)X.push([new S.P(K[0],K[1])]);return X}{const X=[];for(const K of this._feature.geometry){const ie=[];for(const de of K)ie.push(new S.P(de[0],de[1]));X.push(ie)}return X}}toGeoJSON(X,K,ie){return Pi.call(this,X,K,ie)}}class jt{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.Z,this.length=X.length,this._features=X}feature(X){return new Bi(this._features[X])}}var et,Ie,Oe,pt={exports:{}},xt=function(){if(Oe)return pt.exports;Oe=1;var De=S.cK(),X=function(){if(Ie)return et;Ie=1;var He=S.cI(),Re=S.cJ().VectorTileFeature;function at(Tt,Lt){this.options=Lt||{},this.features=Tt,this.length=Tt.length}function yt(Tt,Lt){this.id=typeof Tt.id=="number"?Tt.id:void 0,this.type=Tt.type,this.rawGeometry=Tt.type===1?[Tt.geometry]:Tt.geometry,this.properties=Tt.tags,this.extent=Lt||4096}return et=at,at.prototype.feature=function(Tt){return new yt(this.features[Tt],this.options.extent)},yt.prototype.loadGeometry=function(){var Tt=this.rawGeometry;this.geometry=[];for(var Lt=0;Lt<Tt.length;Lt++){for(var Ft=Tt[Lt],Ot=[],Ye=0;Ye<Ft.length;Ye++)Ot.push(new He(Ft[Ye][0],Ft[Ye][1]));this.geometry.push(Ot)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Tt=this.geometry,Lt=1/0,Ft=-1/0,Ot=1/0,Ye=-1/0,Ci=0;Ci<Tt.length;Ci++)for(var bi=Tt[Ci],Mi=0;Mi<bi.length;Mi++){var Yt=bi[Mi];Lt=Math.min(Lt,Yt.x),Ft=Math.max(Ft,Yt.x),Ot=Math.min(Ot,Yt.y),Ye=Math.max(Ye,Yt.y)}return[Lt,Ot,Ft,Ye]},yt.prototype.toGeoJSON=Re.prototype.toGeoJSON,et}();function K(He){var Re=new De;return function(at,yt){for(var Tt in at.layers)yt.writeMessage(3,ie,at.layers[Tt])}(He,Re),Re.finish()}function ie(He,Re){var at;Re.writeVarintField(15,He.version||1),Re.writeStringField(1,He.name||""),Re.writeVarintField(5,He.extent||4096);var yt={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<He.length;at++)yt.feature=He.feature(at),Re.writeMessage(2,de,yt);var Tt=yt.keys;for(at=0;at<Tt.length;at++)Re.writeStringField(3,Tt[at]);var Lt=yt.values;for(at=0;at<Lt.length;at++)Re.writeMessage(4,Le,Lt[at])}function de(He,Re){var at=He.feature;at.id!==void 0&&Re.writeVarintField(1,at.id),Re.writeMessage(2,Te,He),Re.writeVarintField(3,at.type),Re.writeMessage(4,Se,at)}function Te(He,Re){var at=He.feature,yt=He.keys,Tt=He.values,Lt=He.keycache,Ft=He.valuecache;for(var Ot in at.properties){var Ye=at.properties[Ot],Ci=Lt[Ot];if(Ye!==null){Ci===void 0&&(yt.push(Ot),Lt[Ot]=Ci=yt.length-1),Re.writeVarint(Ci);var bi=typeof Ye;bi!=="string"&&bi!=="boolean"&&bi!=="number"&&(Ye=JSON.stringify(Ye));var Mi=bi+":"+Ye,Yt=Ft[Mi];Yt===void 0&&(Tt.push(Ye),Ft[Mi]=Yt=Tt.length-1),Re.writeVarint(Yt)}}}function te(He,Re){return(Re<<3)+(7&He)}function Ne(He){return He<<1^He>>31}function Se(He,Re){for(var at=He.loadGeometry(),yt=He.type,Tt=0,Lt=0,Ft=at.length,Ot=0;Ot<Ft;Ot++){var Ye=at[Ot],Ci=1;yt===1&&(Ci=Ye.length),Re.writeVarint(te(1,Ci));for(var bi=yt===3?Ye.length-1:Ye.length,Mi=0;Mi<bi;Mi++){Mi===1&&yt!==1&&Re.writeVarint(te(2,bi-1));var Yt=Ye[Mi].x-Tt,it=Ye[Mi].y-Lt;Re.writeVarint(Ne(Yt)),Re.writeVarint(Ne(it)),Tt+=Yt,Lt+=it}yt===3&&Re.writeVarint(te(7,1))}}function Le(He,Re){var at=typeof He;at==="string"?Re.writeStringField(1,He):at==="boolean"?Re.writeBooleanField(7,He):at==="number"&&(He%1!=0?Re.writeDoubleField(3,He):He<0?Re.writeSVarintField(6,He):Re.writeVarintField(5,He))}return pt.exports=K,pt.exports.fromVectorTileJs=K,pt.exports.fromGeojsonVt=function(He,Re){Re=Re||{};var at={};for(var yt in He)at[yt]=new X(He[yt].features,Re),at[yt].name=yt,at[yt].version=Re.version,at[yt].extent=Re.extent;return K({layers:at})},pt.exports.GeoJSONWrapper=X,pt.exports}(),ai=S.cH(xt);const Kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},Si=Math.fround||(hi=new Float32Array(1),De=>(hi[0]=+De,hi[0]));var hi;const Gi=3,zi=5,xa=6;class Je{constructor(X){this.options=Object.assign(Object.create(Kt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:K,minZoom:ie,maxZoom:de}=this.options;K&&console.time("total time");const Te=`prepare ${X.length} points`;K&&console.time(Te),this.points=X;const te=[];for(let Se=0;Se<X.length;Se++){const Le=X[Se];if(!Le.geometry)continue;const[He,Re]=Le.geometry.coordinates,at=Si(Ei(He)),yt=Si(Ee(Re));te.push(at,yt,1/0,Se,-1,1),this.options.reduce&&te.push(0)}let Ne=this.trees[de+1]=this._createTree(te);K&&console.timeEnd(Te);for(let Se=de;Se>=ie;Se--){const Le=+Date.now();Ne=this.trees[Se]=this._createTree(this._cluster(Ne,Se)),K&&console.log("z%d: %d clusters in %dms",Se,Ne.numItems,+Date.now()-Le)}return K&&console.timeEnd("total time"),this}getClusters(X,K){let ie=((X[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,X[1]));let Te=X[2]===180?180:((X[2]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ie=-180,Te=180;else if(ie>Te){const Re=this.getClusters([ie,de,180,te],K),at=this.getClusters([-180,de,Te,te],K);return Re.concat(at)}const Ne=this.trees[this._limitZoom(K)],Se=Ne.range(Ei(ie),Ee(te),Ei(Te),Ee(de)),Le=Ne.data,He=[];for(const Re of Se){const at=this.stride*Re;He.push(Le[at+zi]>1?St(Le,at,this.clusterProps):this.points[Le[at+Gi]])}return He}getChildren(X){const K=this._getOriginId(X),ie=this._getOriginZoom(X),de="No cluster with the specified id.",Te=this.trees[ie];if(!Te)throw new Error(de);const te=Te.data;if(K*this.stride>=te.length)throw new Error(de);const Ne=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Se=Te.within(te[K*this.stride],te[K*this.stride+1],Ne),Le=[];for(const He of Se){const Re=He*this.stride;te[Re+4]===X&&Le.push(te[Re+zi]>1?St(te,Re,this.clusterProps):this.points[te[Re+Gi]])}if(Le.length===0)throw new Error(de);return Le}getLeaves(X,K,ie){const de=[];return this._appendLeaves(de,X,K=K||10,ie=ie||0,0),de}getTile(X,K,ie){const de=this.trees[this._limitZoom(X)],Te=Math.pow(2,X),{extent:te,radius:Ne}=this.options,Se=Ne/te,Le=(ie-Se)/Te,He=(ie+1+Se)/Te,Re={features:[]};return this._addTileFeatures(de.range((K-Se)/Te,Le,(K+1+Se)/Te,He),de.data,K,ie,Te,Re),K===0&&this._addTileFeatures(de.range(1-Se/Te,Le,1,He),de.data,Te,ie,Te,Re),K===Te-1&&this._addTileFeatures(de.range(0,Le,Se/Te,He),de.data,-1,ie,Te,Re),Re.features.length?Re:null}getClusterExpansionZoom(X){let K=this._getOriginZoom(X)-1;for(;K<=this.options.maxZoom;){const ie=this.getChildren(X);if(K++,ie.length!==1)break;X=ie[0].properties.cluster_id}return K}_appendLeaves(X,K,ie,de,Te){const te=this.getChildren(K);for(const Ne of te){const Se=Ne.properties;if(Se&&Se.cluster?Te+Se.point_count<=de?Te+=Se.point_count:Te=this._appendLeaves(X,Se.cluster_id,ie,de,Te):Te<de?Te++:X.push(Ne),X.length===ie)break}return Te}_createTree(X){const K=new S.aF(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<X.length;ie+=this.stride)K.add(X[ie],X[ie+1]);return K.finish(),K.data=X,K}_addTileFeatures(X,K,ie,de,Te,te){for(const Ne of X){const Se=Ne*this.stride,Le=K[Se+zi]>1;let He,Re,at;if(Le)He=At(K,Se,this.clusterProps),Re=K[Se],at=K[Se+1];else{const Lt=this.points[K[Se+Gi]];He=Lt.properties;const[Ft,Ot]=Lt.geometry.coordinates;Re=Ei(Ft),at=Ee(Ot)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Re*Te-ie)),Math.round(this.options.extent*(at*Te-de))]],tags:He};let Tt;Tt=Le||this.options.generateId?K[Se+Gi]:this.points[K[Se+Gi]].id,Tt!==void 0&&(yt.id=Tt),te.features.push(yt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,K){const{radius:ie,extent:de,reduce:Te,minPoints:te}=this.options,Ne=ie/(de*Math.pow(2,K)),Se=X.data,Le=[],He=this.stride;for(let Re=0;Re<Se.length;Re+=He){if(Se[Re+2]<=K)continue;Se[Re+2]=K;const at=Se[Re],yt=Se[Re+1],Tt=X.within(Se[Re],Se[Re+1],Ne),Lt=Se[Re+zi];let Ft=Lt;for(const Ot of Tt){const Ye=Ot*He;Se[Ye+2]>K&&(Ft+=Se[Ye+zi])}if(Ft>Lt&&Ft>=te){let Ot,Ye=at*Lt,Ci=yt*Lt,bi=-1;const Mi=((Re/He|0)<<5)+(K+1)+this.points.length;for(const Yt of Tt){const it=Yt*He;if(Se[it+2]<=K)continue;Se[it+2]=K;const qt=Se[it+zi];Ye+=Se[it]*qt,Ci+=Se[it+1]*qt,Se[it+4]=Mi,Te&&(Ot||(Ot=this._map(Se,Re,!0),bi=this.clusterProps.length,this.clusterProps.push(Ot)),Te(Ot,this._map(Se,it)))}Se[Re+4]=Mi,Le.push(Ye/Ft,Ci/Ft,1/0,Mi,-1,Ft),Te&&Le.push(bi)}else{for(let Ot=0;Ot<He;Ot++)Le.push(Se[Re+Ot]);if(Ft>1)for(const Ot of Tt){const Ye=Ot*He;if(!(Se[Ye+2]<=K)){Se[Ye+2]=K;for(let Ci=0;Ci<He;Ci++)Le.push(Se[Ye+Ci])}}}}return Le}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,K,ie){if(X[K+zi]>1){const te=this.clusterProps[X[K+xa]];return ie?Object.assign({},te):te}const de=this.points[X[K+Gi]].properties,Te=this.options.map(de);return ie&&Te===de?Object.assign({},Te):Te}}function St(De,X,K){return{type:"Feature",id:De[X+Gi],properties:At(De,X,K),geometry:{type:"Point",coordinates:[(ie=De[X],360*(ie-.5)),ct(De[X+1])]}};var ie}function At(De,X,K){const ie=De[X+zi],de=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Te=De[X+xa],te=Te===-1?{}:Object.assign({},K[Te]);return Object.assign(te,{cluster:!0,cluster_id:De[X+Gi],point_count:ie,point_count_abbreviated:de})}function Ei(De){return De/360+.5}function Ee(De){const X=Math.sin(De*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function ct(De){const X=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Et(De,X,K,ie){let de=ie;const Te=X+(K-X>>1);let te,Ne=K-X;const Se=De[X],Le=De[X+1],He=De[K],Re=De[K+1];for(let at=X+3;at<K;at+=3){const yt=Mt(De[at],De[at+1],Se,Le,He,Re);if(yt>de)te=at,de=yt;else if(yt===de){const Tt=Math.abs(at-Te);Tt<Ne&&(te=at,Ne=Tt)}}de>ie&&(te-X>3&&Et(De,X,te,ie),De[te+2]=de,K-te>3&&Et(De,te,K,ie))}function Mt(De,X,K,ie,de,Te){let te=de-K,Ne=Te-ie;if(te!==0||Ne!==0){const Se=((De-K)*te+(X-ie)*Ne)/(te*te+Ne*Ne);Se>1?(K=de,ie=Te):Se>0&&(K+=te*Se,ie+=Ne*Se)}return te=De-K,Ne=X-ie,te*te+Ne*Ne}function Nt(De,X,K,ie){const de={id:De??null,type:X,geometry:K,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")Wt(de,K);else if(X==="Polygon")Wt(de,K[0]);else if(X==="MultiLineString")for(const Te of K)Wt(de,Te);else if(X==="MultiPolygon")for(const Te of K)Wt(de,Te[0]);return de}function Wt(De,X){for(let K=0;K<X.length;K+=3)De.minX=Math.min(De.minX,X[K]),De.minY=Math.min(De.minY,X[K+1]),De.maxX=Math.max(De.maxX,X[K]),De.maxY=Math.max(De.maxY,X[K+1])}function Zt(De,X,K,ie){if(!X.geometry)return;const de=X.geometry.coordinates;if(de&&de.length===0)return;const Te=X.geometry.type,te=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ne=[],Se=X.id;if(K.promoteId?Se=X.properties[K.promoteId]:K.generateId&&(Se=ie||0),Te==="Point")si(de,Ne);else if(Te==="MultiPoint")for(const Le of de)si(Le,Ne);else if(Te==="LineString")yi(de,Ne,te,!1);else if(Te==="MultiLineString"){if(K.lineMetrics){for(const Le of de)Ne=[],yi(Le,Ne,te,!1),De.push(Nt(Se,"LineString",Ne,X.properties));return}Va(de,Ne,te,!1)}else if(Te==="Polygon")Va(de,Ne,te,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(const Le of X.geometry.geometries)Zt(De,{id:Se,geometry:Le,properties:X.properties},K,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of de){const He=[];Va(Le,He,te,!0),Ne.push(He)}}De.push(Nt(Se,Te,Ne,X.properties))}function si(De,X){X.push(es(De[0]),bn(De[1]),0)}function yi(De,X,K,ie){let de,Te,te=0;for(let Se=0;Se<De.length;Se++){const Le=es(De[Se][0]),He=bn(De[Se][1]);X.push(Le,He,0),Se>0&&(te+=ie?(de*He-Le*Te)/2:Math.sqrt(Math.pow(Le-de,2)+Math.pow(He-Te,2))),de=Le,Te=He}const Ne=X.length-3;X[2]=1,Et(X,0,Ne,K),X[Ne+2]=1,X.size=Math.abs(te),X.start=0,X.end=X.size}function Va(De,X,K,ie){for(let de=0;de<De.length;de++){const Te=[];yi(De[de],Te,K,ie),X.push(Te)}}function es(De){return De/360+.5}function bn(De){const X=Math.sin(De*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function On(De,X,K,ie,de,Te,te,Ne){if(ie/=X,Te>=(K/=X)&&te<ie)return De;if(te<K||Te>=ie)return null;const Se=[];for(const Le of De){const He=Le.geometry;let Re=Le.type;const at=de===0?Le.minX:Le.minY,yt=de===0?Le.maxX:Le.maxY;if(at>=K&&yt<ie){Se.push(Le);continue}if(yt<K||at>=ie)continue;let Tt=[];if(Re==="Point"||Re==="MultiPoint")hn(He,Tt,K,ie,de);else if(Re==="LineString")Hi(He,Tt,K,ie,de,!1,Ne.lineMetrics);else if(Re==="MultiLineString")so(He,Tt,K,ie,de,!1);else if(Re==="Polygon")so(He,Tt,K,ie,de,!0);else if(Re==="MultiPolygon")for(const Lt of He){const Ft=[];so(Lt,Ft,K,ie,de,!0),Ft.length&&Tt.push(Ft)}if(Tt.length){if(Ne.lineMetrics&&Re==="LineString"){for(const Lt of Tt)Se.push(Nt(Le.id,Re,Lt,Le.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(Tt.length===1?(Re="LineString",Tt=Tt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=Tt.length===3?"Point":"MultiPoint"),Se.push(Nt(Le.id,Re,Tt,Le.tags))}}return Se.length?Se:null}function hn(De,X,K,ie,de){for(let Te=0;Te<De.length;Te+=3){const te=De[Te+de];te>=K&&te<=ie&&ka(X,De[Te],De[Te+1],De[Te+2])}}function Hi(De,X,K,ie,de,Te,te){let Ne=ts(De);const Se=de===0?Cl:Ru;let Le,He,Re=De.start;for(let Ft=0;Ft<De.length-3;Ft+=3){const Ot=De[Ft],Ye=De[Ft+1],Ci=De[Ft+2],bi=De[Ft+3],Mi=De[Ft+4],Yt=de===0?Ot:Ye,it=de===0?bi:Mi;let qt=!1;te&&(Le=Math.sqrt(Math.pow(Ot-bi,2)+Math.pow(Ye-Mi,2))),Yt<K?it>K&&(He=Se(Ne,Ot,Ye,bi,Mi,K),te&&(Ne.start=Re+Le*He)):Yt>ie?it<ie&&(He=Se(Ne,Ot,Ye,bi,Mi,ie),te&&(Ne.start=Re+Le*He)):ka(Ne,Ot,Ye,Ci),it<K&&Yt>=K&&(He=Se(Ne,Ot,Ye,bi,Mi,K),qt=!0),it>ie&&Yt<=ie&&(He=Se(Ne,Ot,Ye,bi,Mi,ie),qt=!0),!Te&&qt&&(te&&(Ne.end=Re+Le*He),X.push(Ne),Ne=ts(De)),te&&(Re+=Le)}let at=De.length-3;const yt=De[at],Tt=De[at+1],Lt=de===0?yt:Tt;Lt>=K&&Lt<=ie&&ka(Ne,yt,Tt,De[at+2]),at=Ne.length-3,Te&&at>=3&&(Ne[at]!==Ne[0]||Ne[at+1]!==Ne[1])&&ka(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&X.push(Ne)}function ts(De){const X=[];return X.size=De.size,X.start=De.start,X.end=De.end,X}function so(De,X,K,ie,de,Te){for(const te of De)Hi(te,X,K,ie,de,Te,!1)}function ka(De,X,K,ie){De.push(X,K,ie)}function Cl(De,X,K,ie,de,Te){const te=(Te-X)/(ie-X);return ka(De,Te,K+(de-K)*te,1),te}function Ru(De,X,K,ie,de,Te){const te=(Te-K)/(de-K);return ka(De,X+(ie-X)*te,Te,1),te}function Zn(De,X){const K=[];for(let ie=0;ie<De.length;ie++){const de=De[ie],Te=de.type;let te;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")te=sr(de.geometry,X);else if(Te==="MultiLineString"||Te==="Polygon"){te=[];for(const Ne of de.geometry)te.push(sr(Ne,X))}else if(Te==="MultiPolygon"){te=[];for(const Ne of de.geometry){const Se=[];for(const Le of Ne)Se.push(sr(Le,X));te.push(Se)}}K.push(Nt(de.id,Te,te,de.tags))}return K}function sr(De,X){const K=[];K.size=De.size,De.start!==void 0&&(K.start=De.start,K.end=De.end);for(let ie=0;ie<De.length;ie+=3)K.push(De[ie]+X,De[ie+1],De[ie+2]);return K}function zo(De,X){if(De.transformed)return De;const K=1<<De.z,ie=De.x,de=De.y;for(const Te of De.features){const te=Te.geometry,Ne=Te.type;if(Te.geometry=[],Ne===1)for(let Se=0;Se<te.length;Se+=2)Te.geometry.push(oo(te[Se],te[Se+1],X,K,ie,de));else for(let Se=0;Se<te.length;Se++){const Le=[];for(let He=0;He<te[Se].length;He+=2)Le.push(oo(te[Se][He],te[Se][He+1],X,K,ie,de));Te.geometry.push(Le)}}return De.transformed=!0,De}function oo(De,X,K,ie,de,Te){return[Math.round(K*(De*ie-de)),Math.round(K*(X*ie-Te))]}function Ds(De,X,K,ie,de){const Te=X===de.maxZoom?0:de.tolerance/((1<<X)*de.extent),te={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:K,y:ie,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ne of De)Pu(te,Ne,Te,de);return te}function Pu(De,X,K,ie){const de=X.geometry,Te=X.type,te=[];if(De.minX=Math.min(De.minX,X.minX),De.minY=Math.min(De.minY,X.minY),De.maxX=Math.max(De.maxX,X.maxX),De.maxY=Math.max(De.maxY,X.maxY),Te==="Point"||Te==="MultiPoint")for(let Ne=0;Ne<de.length;Ne+=3)te.push(de[Ne],de[Ne+1]),De.numPoints++,De.numSimplified++;else if(Te==="LineString")is(te,de,De,K,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(let Ne=0;Ne<de.length;Ne++)is(te,de[Ne],De,K,Te==="Polygon",Ne===0);else if(Te==="MultiPolygon")for(let Ne=0;Ne<de.length;Ne++){const Se=de[Ne];for(let Le=0;Le<Se.length;Le++)is(te,Se[Le],De,K,!0,Le===0)}if(te.length){let Ne=X.tags||null;if(Te==="LineString"&&ie.lineMetrics){Ne={};for(const Le in X.tags)Ne[Le]=X.tags[Le];Ne.mapbox_clip_start=de.start/de.size,Ne.mapbox_clip_end=de.end/de.size}const Se={geometry:te,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:Ne};X.id!==null&&(Se.id=X.id),De.features.push(Se)}}function is(De,X,K,ie,de,Te){const te=ie*ie;if(ie>0&&X.size<(de?te:ie))return void(K.numPoints+=X.length/3);const Ne=[];for(let Se=0;Se<X.length;Se+=3)(ie===0||X[Se+2]>te)&&(K.numSimplified++,Ne.push(X[Se],X[Se+1])),K.numPoints++;de&&function(Se,Le){let He=0;for(let Re=0,at=Se.length,yt=at-2;Re<at;yt=Re,Re+=2)He+=(Se[Re]-Se[yt])*(Se[Re+1]+Se[yt+1]);if(He>0===Le)for(let Re=0,at=Se.length;Re<at/2;Re+=2){const yt=Se[Re],Tt=Se[Re+1];Se[Re]=Se[at-2-Re],Se[Re+1]=Se[at-1-Re],Se[at-2-Re]=yt,Se[at-1-Re]=Tt}}(Ne,Te),De.push(Ne)}const an={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xn{constructor(X,K){const ie=(K=this.options=function(Te,te){for(const Ne in te)Te[Ne]=te[Ne];return Te}(Object.create(an),K)).debug;if(ie&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(Te,te){const Ne=[];if(Te.type==="FeatureCollection")for(let Se=0;Se<Te.features.length;Se++)Zt(Ne,Te.features[Se],te,Se);else Zt(Ne,Te.type==="Feature"?Te:{geometry:Te},te);return Ne}(X,K);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(Te,te){const Ne=te.buffer/te.extent;let Se=Te;const Le=On(Te,1,-1-Ne,Ne,0,-1,2,te),He=On(Te,1,1-Ne,2+Ne,0,-1,2,te);return(Le||He)&&(Se=On(Te,1,-Ne,1+Ne,0,-1,2,te)||[],Le&&(Se=Zn(Le,1).concat(Se)),He&&(Se=Se.concat(Zn(He,-1)))),Se}(de,K),de.length&&this.splitTile(de,0,0,0),ie&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,K,ie,de,Te,te,Ne){const Se=[X,K,ie,de],Le=this.options,He=Le.debug;for(;Se.length;){de=Se.pop(),ie=Se.pop(),K=Se.pop(),X=Se.pop();const Re=1<<K,at=Ba(K,ie,de);let yt=this.tiles[at];if(!yt&&(He>1&&console.time("creation"),yt=this.tiles[at]=Ds(X,K,ie,de,Le),this.tileCoords.push({z:K,x:ie,y:de}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ie,de,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));const qt=`z${K}`;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(yt.source=X,Te==null){if(K===Le.indexMaxZoom||yt.numPoints<=Le.indexMaxPoints)continue}else{if(K===Le.maxZoom||K===Te)continue;if(Te!=null){const qt=Te-K;if(ie!==te>>qt||de!==Ne>>qt)continue}}if(yt.source=null,X.length===0)continue;He>1&&console.time("clipping");const Tt=.5*Le.buffer/Le.extent,Lt=.5-Tt,Ft=.5+Tt,Ot=1+Tt;let Ye=null,Ci=null,bi=null,Mi=null,Yt=On(X,Re,ie-Tt,ie+Ft,0,yt.minX,yt.maxX,Le),it=On(X,Re,ie+Lt,ie+Ot,0,yt.minX,yt.maxX,Le);X=null,Yt&&(Ye=On(Yt,Re,de-Tt,de+Ft,1,yt.minY,yt.maxY,Le),Ci=On(Yt,Re,de+Lt,de+Ot,1,yt.minY,yt.maxY,Le),Yt=null),it&&(bi=On(it,Re,de-Tt,de+Ft,1,yt.minY,yt.maxY,Le),Mi=On(it,Re,de+Lt,de+Ot,1,yt.minY,yt.maxY,Le),it=null),He>1&&console.timeEnd("clipping"),Se.push(Ye||[],K+1,2*ie,2*de),Se.push(Ci||[],K+1,2*ie,2*de+1),Se.push(bi||[],K+1,2*ie+1,2*de),Se.push(Mi||[],K+1,2*ie+1,2*de+1)}}getTile(X,K,ie){X=+X,K=+K,ie=+ie;const de=this.options,{extent:Te,debug:te}=de;if(X<0||X>24)return null;const Ne=1<<X,Se=Ba(X,K=K+Ne&Ne-1,ie);if(this.tiles[Se])return zo(this.tiles[Se],Te);te>1&&console.log("drilling down to z%d-%d-%d",X,K,ie);let Le,He=X,Re=K,at=ie;for(;!Le&&He>0;)He--,Re>>=1,at>>=1,Le=this.tiles[Ba(He,Re,at)];return Le&&Le.source?(te>1&&(console.log("found parent tile z%d-%d-%d",He,Re,at),console.time("drilling down")),this.splitTile(Le.source,He,Re,at,X,K,ie),te>1&&console.timeEnd("drilling down"),this.tiles[Se]?zo(this.tiles[Se],Te):null):null}}function Ba(De,X,K){return 32*((1<<De)*K+X)+De}function uo(De,X){return X?De.properties[X]:De.id}function Lu(De,X){if(De==null)return!0;if(De.type==="Feature")return uo(De,X)!=null;if(De.type==="FeatureCollection"){const K=new Set;for(const ie of De.features){const de=uo(ie,X);if(de==null||K.has(de))return!1;K.add(de)}return!0}return!1}function Ar(De,X){const K=new Map;if(De!=null)if(De.type==="Feature")K.set(uo(De,X),De);else for(const ie of De.features)K.set(uo(ie,X),ie);return K}class dn extends Me{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(X,K){return S._(this,void 0,void 0,function*(){const ie=X.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!de)return null;const Te=new jt(de.features);let te=ai(Te);return te.byteOffset===0&&te.byteLength===te.buffer.byteLength||(te=new Uint8Array(te)),{vectorTile:Te,rawData:te.buffer}})}loadData(X){return S._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ie=!!(X&&X.request&&X.request.collectResourceTiming)&&new S.cE(X.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(X,this._pendingRequest),this._geoJSONIndex=X.cluster?new Je(function({superclusterOptions:te,clusterProperties:Ne}){if(!Ne||!te)return te;const Se={},Le={},He={accumulated:null,zoom:0},Re={properties:null},at=Object.keys(Ne);for(const yt of at){const[Tt,Lt]=Ne[yt],Ft=S.cL(Lt),Ot=S.cL(typeof Tt=="string"?[Tt,["accumulated"],["get",yt]]:Tt);Se[yt]=Ft.value,Le[yt]=Ot.value}return te.map=yt=>{Re.properties=yt;const Tt={};for(const Lt of at)Tt[Lt]=Se[Lt].evaluate(He,Re);return Tt},te.reduce=(yt,Tt)=>{Re.properties=Tt;for(const Lt of at)He.accumulated=yt[Lt],yt[Lt]=Le[Lt].evaluate(He,Re)},te}(X)).load((yield this._pendingData).features):(de=yield this._pendingData,new xn(de,X.geojsonVtOptions)),this.loaded={};const Te={};if(ie){const te=ie.finish();te&&(Te.resourceTiming={},Te.resourceTiming[X.source]=JSON.parse(JSON.stringify(te)))}return Te}catch(Te){if(delete this._pendingRequest,S.cp(Te))return{abandoned:!0};throw Te}var de})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(X){const K=this.loaded;return K&&K[X.uid]?super.reloadTile(X):this.loadTile(X)}loadAndProcessGeoJSON(X,K){return S._(this,void 0,void 0,function*(){let ie=yield this.loadGeoJSON(X,K);if(delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(li(ie,!0),X.filter){const de=S.cL(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map(te=>`${te.key}: ${te.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(te=>de.value.evaluate({zoom:0},te))}}return ie})}loadGeoJSON(X,K){return S._(this,void 0,void 0,function*(){const{promoteId:ie}=X;if(X.request){const de=yield S.j(X.request,K);return this._dataUpdateable=Lu(de.data,ie)?Ar(de.data,ie):void 0,de.data}if(typeof X.data=="string")try{const de=JSON.parse(X.data);return this._dataUpdateable=Lu(de,ie)?Ar(de,ie):void 0,de}catch{throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`)}if(!X.dataDiff)throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X.source}`);return function(de,Te,te){var Ne,Se,Le,He;if(Te.removeAll&&de.clear(),Te.remove)for(const Re of Te.remove)de.delete(Re);if(Te.add)for(const Re of Te.add){const at=uo(Re,te);at!=null&&de.set(at,Re)}if(Te.update)for(const Re of Te.update){let at=de.get(Re.id);if(at==null)continue;const yt=!Re.removeAllProperties&&(((Ne=Re.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0||((Se=Re.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Re.newGeometry||Re.removeAllProperties||yt)&&(at=Object.assign({},at),de.set(Re.id,at),yt&&(at.properties=Object.assign({},at.properties))),Re.newGeometry&&(at.geometry=Re.newGeometry),Re.removeAllProperties)at.properties={};else if(((Le=Re.removeProperties)===null||Le===void 0?void 0:Le.length)>0)for(const Tt of Re.removeProperties)Object.prototype.hasOwnProperty.call(at.properties,Tt)&&delete at.properties[Tt];if(((He=Re.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0)for(const{key:Tt,value:Lt}of Re.addOrUpdateProperties)at.properties[Tt]=Lt}}(this._dataUpdateable,X.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(X){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(X){return this._geoJSONIndex.getClusterExpansionZoom(X.clusterId)}getClusterChildren(X){return this._geoJSONIndex.getChildren(X.clusterId)}getClusterLeaves(X){return this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset)}}class or{constructor(X){this.self=X,this.actor=new S.H(X),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,ie)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ie},this.self.addProtocol=S.cr,this.self.removeProtocol=S.cs,this.self.registerRTLTextPlugin=K=>{S.cM.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,ie)=>this._getDEMWorkerSource(K,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RDT",(K,ie)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("GCEZ",(K,ie)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("GCC",(K,ie)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("GCL",(K,ie)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("LD",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("GD",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).getData()),this.actor.registerMessageHandler("LT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("AT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("RMT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("RS",(K,ie)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][ie.type]||!this.workerSources[K][ie.type][ie.source])return;const de=this.workerSources[K][ie.type][ie.source];delete this.workerSources[K][ie.type][ie.source],de.removeSource!==void 0&&de.removeSource(ie)})),this.actor.registerMessageHandler("RM",K=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,ie)=>S._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("SRPS",(K,ie)=>this._syncRTLPluginState(K,ie)),this.actor.registerMessageHandler("IS",(K,ie)=>S._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("SI",(K,ie)=>this._setImages(K,ie)),this.actor.registerMessageHandler("UL",(K,ie)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("SL",(K,ie)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(ie)}))}_setImages(X,K){return S._(this,void 0,void 0,function*(){this.availableImages[X]=K;for(const ie in this.workerSources[X]){const de=this.workerSources[X][ie];for(const Te in de)de[Te].availableImages=K}})}_syncRTLPluginState(X,K){return S._(this,void 0,void 0,function*(){return yield S.cM.syncState(K,this.self.importScripts)})}_getAvailableImages(X){let K=this.availableImages[X];return K||(K=[]),K}_getLayerIndex(X){let K=this.layerIndexes[X];return K||(K=this.layerIndexes[X]=new h),K}_getWorkerSource(X,K,ie){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][K]||(this.workerSources[X][K]={}),!this.workerSources[X][K][ie]){const de={sendAsync:(Te,te)=>(Te.targetMapId=X,this.actor.sendAsync(Te,te))};switch(K){case"vector":this.workerSources[X][K][ie]=new Me(de,this._getLayerIndex(X),this._getAvailableImages(X));break;case"geojson":this.workerSources[X][K][ie]=new dn(de,this._getLayerIndex(X),this._getAvailableImages(X));break;default:this.workerSources[X][K][ie]=new this.externalWorkerSourceTypes[K](de,this._getLayerIndex(X),this._getAvailableImages(X))}}return this.workerSources[X][K][ie]}_getDEMWorkerSource(X,K){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][K]||(this.demWorkerSources[X][K]=new Ae),this.demWorkerSources[X][K]}}return S.i(self)&&(self.worker=new or(self)),or}),A("index",["exports","./shared"],function(S,h){var Z="5.5.0";function Q(){var g=new h.A(4);return h.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let ge,Me;const Ae={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,r){const c=requestAnimationFrame(y=>{p(),e(y)}),{unsubscribe:p}=h.s(g.signal,"abort",()=>{p(),cancelAnimationFrame(c),r(h.c())},!1)},frameAsync(g){return new Promise((e,r)=>{this.frame(g,e,r)})},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,r.drawImage(g,0,0,g.width,g.height),r},resolveURL:g=>(ge||(ge=document.createElement("a")),ge.href=g,ge.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Me==null&&(Me=matchMedia("(prefers-reduced-motion: reduce)")),Me.matches)}};class he{static testProp(e){if(!he.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in he.docStyle)return e[r];return e[0]}static create(e,r,c){const p=window.document.createElement(e);return r!==void 0&&(p.className=r),c&&c.appendChild(p),p}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(e,r){e.style[he.transformProp]=r}static addEventListener(e,r,c,p={}){e.addEventListener(r,c,"passive"in p?p:p.capture)}static removeEventListener(e,r,c,p={}){e.removeEventListener(r,c,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",he.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,c){const p=r.boundingClientRect;return new h.P((c.clientX-p.left)/r.x-e.clientLeft,(c.clientY-p.top)/r.y-e.clientTop)}static mousePos(e,r){const c=he.getScale(e);return he.getPoint(e,c,r)}static touchPos(e,r){const c=[],p=he.getScale(e);for(let y=0;y<r.length;y++)c.push(he.getPoint(e,p,r[y]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const p of c)p.remove();return he.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const c of r)he.removeAttributes(c),he.clean(c)}static removeAttributes(e){for(const{name:r,value:c}of e.attributes)he.isPossiblyDangerous(r,c)&&e.removeAttribute(r)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const Ve={supported:!1,testSupport:function(g){!Pi&&li&&(Bi?jt(g):Vt=g)}};let Vt,li,Pi=!1,Bi=!1;function jt(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,li),g.isContextLost())return;Ve.supported=!0}catch{}g.deleteTexture(e),Pi=!0}var et;typeof document<"u"&&(li=document.createElement("img"),li.onload=()=>{Vt&&jt(Vt),Vt=null,Bi=!0},li.onerror=()=>{Pi=!0,Vt=null},li.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let e,r,c,p;g.resetRequestQueue=()=>{e=[],r=0,c=0,p={}},g.addThrottleControl=I=>{const O=c++;return p[O]=I,O},g.removeThrottleControl=I=>{delete p[I],T()},g.getImage=(I,O,k=!0)=>new Promise((F,z)=>{Ve.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),h.e(I,{type:"image"}),e.push({abortController:O,requestParameters:I,supportImageRefresh:k,state:"queued",onError:G=>{z(G)},onSuccess:G=>{F(G)}}),T()});const y=I=>h._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:O,supportImageRefresh:k,onError:F,onSuccess:z,abortController:G}=I,Y=k===!1&&!h.i(self)&&!h.g(O.url)&&(!O.headers||Object.keys(O.headers).reduce((re,le)=>re&&le==="accept",!0));r++;const ne=Y?C(O,G):h.m(O,G);try{const re=yield ne;delete I.abortController,I.state="completed",re.data instanceof HTMLImageElement||h.b(re.data)?z(re):re.data&&z({data:yield(ae=re.data,typeof createImageBitmap=="function"?h.f(ae):h.h(ae)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete I.abortController,F(re)}finally{r--,T()}var ae}),T=()=>{const I=(()=>{for(const O of Object.keys(p))if(p[O]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let O=r;O<I&&e.length>0;O++){const k=e.shift();k.abortController.signal.aborted?O--:y(k)}},C=(I,O)=>new Promise((k,F)=>{const z=new Image,G=I.url,Y=I.credentials;Y&&Y==="include"?z.crossOrigin="use-credentials":(Y&&Y==="same-origin"||!h.d(G))&&(z.crossOrigin="anonymous"),O.signal.addEventListener("abort",()=>{z.src="",F(h.c())}),z.fetchPriority="high",z.onload=()=>{z.onerror=z.onload=null,k({data:z})},z.onerror=()=>{z.onerror=z.onload=null,O.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},z.src=G})}(et||(et={})),et.resetRequestQueue();class Ie{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Oe(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const r=[];for(const{id:c,url:p}of g){const y=`${c}${p}`;r.indexOf(y)===-1&&(r.push(y),e.push({id:c,url:p}))}}return e}function pt(g,e,r){try{const c=new URL(g);return c.pathname+=`${e}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class xt{constructor(e,r,c,p){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(r,p)}update(e,r,c){const{width:p,height:y}=e,T=!(this.size&&this.size[0]===p&&this.size[1]===y||c),{context:C}=this,{gl:I}=C;if(this.useMipmap=!!(r&&r.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!r||r.premultiply!==!1)),T)this.size=[p,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,p,y,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:O,y:k}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?I.texSubImage2D(I.TEXTURE_2D,0,O,k,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,O,k,p,y,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D),C.pixelStoreUnpackFlipY.setDefault(),C.pixelStoreUnpack.setDefault(),C.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,c){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),c!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,c||e),this.filter=e),r!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function ai(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class Kt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new h.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let c=!0;const p=r.data||r.spriteData;return this._validateStretch(r.stretchX,p&&p.width)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,p&&p.height)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,r){if(!e)return!0;let c=0;for(const p of e){if(p[0]<c||p[1]<p[0]||r<p[1])return!1;c=p[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const c=r.spriteData,p=c&&c.width||r.data.width,y=c&&c.height||r.data.height;return!(e[0]<0||p<e[0]||e[1]<0||y<e[1]||e[2]<0||p<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,c=!0){const p=this.getImage(e);if(c&&(p.data.width!==r.data.width||p.data.height!==r.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=p.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,c)=>{let p=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(p=!1);this.isLoaded()||p?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const c of e){let p=this.getImage(c);p||(this.fire(new h.l("styleimagemissing",{id:c})),p=this.getImage(c)),p?r[c]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:h.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],c=this.getImage(e);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},y=new h.I(p,c);this.patterns[e]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new xt(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:r,h:c}=h.p(e),p=this.atlasImage;p.resize({width:r||1,height:c||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],C=T.x+1,I=T.y+1,O=this.getImage(y).data,k=O.width,F=O.height;h.R.copy(O,p,{x:0,y:0},{x:C,y:I},{width:k,height:F}),h.R.copy(O,p,{x:0,y:F-1},{x:C,y:I-1},{width:k,height:1}),h.R.copy(O,p,{x:0,y:0},{x:C,y:I+F},{width:k,height:1}),h.R.copy(O,p,{x:k-1,y:0},{x:C-1,y:I},{width:1,height:F}),h.R.copy(O,p,{x:0,y:0},{x:C+k,y:I},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||h.w(`Image with ID: "${r}" was not found`),ai(c)&&this.updateImage(r,c)}}}const Si=1e20;function hi(g,e,r,c,p,y,T,C,I){for(let O=e;O<e+c;O++)Gi(g,r*y+O,y,p,T,C,I);for(let O=r;O<r+p;O++)Gi(g,O*y+e,1,c,T,C,I)}function Gi(g,e,r,c,p,y,T){y[0]=0,T[0]=-1e20,T[1]=Si,p[0]=g[e];for(let C=1,I=0,O=0;C<c;C++){p[C]=g[e+C*r];const k=C*C;do{const F=y[I];O=(p[C]-p[F]+k-F*F)/(C-F)/2}while(O<=T[I]&&--I>-1);I++,y[I]=C,T[I]=O,T[I+1]=Si}for(let C=0,I=0;C<c;C++){for(;T[I+1]<C;)I++;const O=y[I],k=C-O;g[e+C*r]=p[O]+k*k}}class zi{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,function*(){const r=[];for(const y in e)for(const T of e[y])r.push(this._getAndCacheGlyphsPromise(y,T));const c=yield Promise.all(r),p={};for(const{stack:y,id:T,glyph:C}of c)p[y]||(p[y]={}),p[y][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return p})}_getAndCacheGlyphsPromise(e,r){return h._(this,void 0,void 0,function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=c.glyphs[r];if(p!==void 0)return{stack:e,id:r,glyph:p};if(p=this._tinySDF(c,e,r),p)return c.glyphs[r]=p,{stack:e,id:r,glyph:p};const y=Math.floor(r/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[y])return{stack:e,id:r,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[y]){const C=zi.loadGlyphRange(e,y,this.url,this.requestManager);c.requests[y]=C}const T=yield c.requests[y];for(const C in T)this._doesCharSupportLocalGlyph(+C)||(c.glyphs[+C]=T[+C]);return c.ranges[y]=!0,{stack:e,id:r,glyph:T[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||h.u["CJK Unified Ideographs"](e)||h.u["Hangul Syllables"](e)||h.u.Hiragana(e)||h.u.Katakana(e)||h.u["CJK Symbols and Punctuation"](e)||h.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,c){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let y=e.tinySDF;if(!y){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),y=e.tinySDF=new zi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:C})}const T=y.draw(String.fromCharCode(c));return{id:c,bitmap:new h.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}zi.loadGlyphRange=function(g,e,r,c){return h._(this,void 0,void 0,function*(){const p=256*e,y=p+255,T=c.transformRequest(r.replace("{fontstack}",g).replace("{range}",`${p}-${y}`),"Glyphs"),C=yield h.n(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${y}`);const I={};for(const O of h.o(C.data))I[O.id]=O;return I})},zi.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=r;const C=this.size=g+4*e,I=this._createCanvas(C),O=this.ctx=I.getContext("2d",{willReadFrequently:!0});O.font=`${T} ${y} ${g}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),T=Math.ceil(r),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),I=Math.min(this.size-this.buffer,T+Math.ceil(c)),O=C+2*this.buffer,k=I+2*this.buffer,F=Math.max(O*k,0),z=new Uint8ClampedArray(F),G={data:z,width:O,height:k,glyphWidth:C,glyphHeight:I,glyphTop:T,glyphLeft:0,glyphAdvance:e};if(C===0||I===0)return G;const{ctx:Y,buffer:ne,gridInner:ae,gridOuter:re}=this;Y.clearRect(ne,ne,C,I),Y.fillText(g,ne,ne+T);const le=Y.getImageData(ne,ne,C,I);re.fill(Si,0,F),ae.fill(0,0,F);for(let me=0;me<I;me++)for(let pe=0;pe<C;pe++){const be=le.data[4*(me*C+pe)+3]/255;if(be===0)continue;const we=(me+ne)*O+pe+ne;if(be===1)re[we]=0,ae[we]=Si;else{const xe=.5-be;re[we]=xe>0?xe*xe:0,ae[we]=xe<0?xe*xe:0}}hi(re,0,0,O,k,O,this.f,this.v,this.z),hi(ae,ne,ne,C,I,O,this.f,this.v,this.z);for(let me=0;me<F;me++){const pe=Math.sqrt(re[me])-Math.sqrt(ae[me]);z[me]=Math.round(255-255*(pe/this.radius+this.cutoff))}return G}};class xa{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,r){return h.z(e.expression.evaluate(r))}interpolate(e,r,c){return{x:h.B.number(e.x,r.x,c),y:h.B.number(e.y,r.y,c),z:h.B.number(e.z,r.z,c)}}}let Je;class St extends h.E{constructor(e){super(),Je=Je||new h.r({anchor:new h.D(h.v.light.anchor),position:new xa,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Je),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(h.t,e,r))for(const c in e){const p=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),p):this._transitionable.setValue(c,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c){return(!c||c.validate!==!1)&&h.x(this,e.call(h.y,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const At=new h.r({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Ei extends h.E{constructor(e){super(),this._transitionable=new h.T(At),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.C(0))}setSky(e,r={}){if(!this._validate(h.F,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const p=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),p):this._transitionable.setValue(c,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c={}){return(c==null?void 0:c.validate)!==!1&&h.x(this,e.call(h.y,h.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ee{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const c=e.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,r)),this.dashEntry[c]}getDashRanges(e,r,c){const p=[];let y=e.length%2==1?-e[e.length-1]*c:0,T=e[0]*c,C=!0;p.push({left:y,right:T,isDash:C,zeroLength:e[0]===0});let I=e[0];for(let O=1;O<e.length;O++){C=!C;const k=e[O];y=I*c,I+=k,T=I*c,p.push({left:y,right:T,isDash:C,zeroLength:k===0})}return p}addRoundDash(e,r,c){const p=r/2;for(let y=-c;y<=c;y++){const T=this.width*(this.nextRow+c+y);let C=0,I=e[C];for(let O=0;O<this.width;O++){O/I.right>1&&(I=e[++C]);const k=Math.abs(O-I.left),F=Math.abs(O-I.right),z=Math.min(k,F);let G;const Y=y/c*(p+1);if(I.isDash){const ne=p-Math.abs(Y);G=Math.sqrt(z*z+ne*ne)}else G=p-Math.sqrt(z*z+Y*Y);this.data[T+O]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let C=e.length-1;C>=0;--C){const I=e[C],O=e[C+1];I.zeroLength?e.splice(C,1):O&&O.isDash===I.isDash&&(O.left=I.left,e.splice(C,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const p=this.width*this.nextRow;let y=0,T=e[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=e[++y]);const I=Math.abs(C-T.left),O=Math.abs(C-T.right),k=Math.min(I,O);this.data[p+C]=Math.max(0,Math.min(255,(T.isDash?k:-k)+128))}}addDash(e,r){const c=r?7:0,p=2*c+1;if(this.nextRow+p>this.height)return h.w("LineAtlas out of space"),null;let y=0;for(let C=0;C<e.length;C++)y+=e[C];if(y!==0){const C=this.width/y,I=this.getDashRanges(e,this.width,C);r?this.addRoundDash(I,C,c):this.addRegularDash(I)}const T={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:y};return this.nextRow+=p,this.dirty=!0,T}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ct="maplibre_preloaded_worker_pool";class Et{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ct]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(Ae.hardwareConcurrency/2);let Nt,Wt;function Zt(){return Nt||(Nt=new Et),Nt}Et.workerCount=h.G(globalThis)?Math.max(Math.min(Mt,3),1):1;class si{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let p=0;p<c.length;p++){const y=new h.H(c[p],r);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const c=[];for(const p of this.actors)c.push(p.sendAsync({type:e,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const c of this.actors)c.registerMessageHandler(e,r)}}function yi(){return Wt||(Wt=new si(Zt(),h.J),Wt.registerMessageHandler("GR",(g,e,r)=>h.m(e,r))),Wt}function Va(g,e){const r=h.K();return h.L(r,r,[1,1,0]),h.M(r,r,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?h.N(r,r,g.calculatePosMatrix(e.toUnwrapped())):r}function es(g,e,r,c,p,y,T){var C;const I=function(z,G,Y){if(z)for(const ne of z){const ae=G[ne];if(ae&&ae.source===Y&&ae.type==="fill-extrusion")return!0}else for(const ne in G){const ae=G[ne];if(ae.source===Y&&ae.type==="fill-extrusion")return!0}return!1}((C=p==null?void 0:p.layers)!==null&&C!==void 0?C:null,e,g.id),O=y.maxPitchScaleFactor(),k=g.tilesIn(c,O,I);k.sort(bn);const F=[];for(const z of k)F.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,r,g._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,p,y,O,Va(g.transform,z.tileID),T?(G,Y)=>T(z.tileID,G,Y):void 0)});return function(z,G){for(const Y in z)for(const ne of z[Y])On(ne,G);return z}(function(z){const G={},Y={};for(const ne of z){const ae=ne.queryResults,re=ne.wrappedTileID,le=Y[re]=Y[re]||{};for(const me in ae){const pe=ae[me],be=le[me]=le[me]||{},we=G[me]=G[me]||[];for(const xe of pe)be[xe.featureIndex]||(be[xe.featureIndex]=!0,we.push(xe))}}return G}(F),g)}function bn(g,e){const r=g.tileID,c=e.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function On(g,e){const r=g.feature,c=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function hn(g,e,r){return h._(this,void 0,void 0,function*(){let c=g;if(g.url?c=(yield h.j(e.transformRequest(g.url,"Source"),r)).data:yield Ae.frameAsync(r),!c)return null;const p=h.O(h.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(p.vectorLayerIds=c.vector_layers.map(y=>y.id)),p})}class Hi{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.Q?new h.Q(e.lng,e.lat):h.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.Q?new h.Q(e.lng,e.lat):h.Q.convert(e),this}extend(e){const r=this._sw,c=this._ne;let p,y;if(e instanceof h.Q)p=e,y=e;else{if(!(e instanceof Hi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Hi.convert(e)):this.extend(h.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.Q.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return r||c?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),c.lng=Math.max(y.lng,c.lng),c.lat=Math.max(y.lat,c.lat)):(this._sw=new h.Q(p.lng,p.lat),this._ne=new h.Q(y.lng,y.lat)),this}getCenter(){return new h.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.Q(this.getWest(),this.getNorth())}getSouthEast(){return new h.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:c}=h.Q.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){return e instanceof Hi?e:e&&new Hi(e)}static fromLngLat(e,r=0){const c=360*r/40075017,p=c/Math.cos(Math.PI/180*e.lat);return new Hi(new h.Q(e.lng-p,e.lat-c),new h.Q(e.lng+p,e.lat+c))}adjustAntiMeridian(){const e=new h.Q(this._sw.lng,this._sw.lat),r=new h.Q(this._ne.lng,this._ne.lat);return new Hi(e,e.lng>r.lng?new h.Q(r.lng+360,r.lat):r)}}class ts{constructor(e,r,c){this.bounds=Hi.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),c=Math.floor(h.U(this.bounds.getWest())*r),p=Math.floor(h.S(this.bounds.getNorth())*r),y=Math.ceil(h.U(this.bounds.getEast())*r),T=Math.ceil(h.S(this.bounds.getSouth())*r);return e.x>=c&&e.x<y&&e.y>=p&&e.y<T}}class so extends h.E{constructor(e,r,c,p){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.O(r,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new ts(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};c.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((y,T)=>{e.reloadPromise={resolve:y,reject:T}})}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:p,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ka extends h.E{constructor(e,r,c,p){super(),this.id=e,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},r),h.e(this,h.O(r,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(h.e(this,r),r.bounds&&(this.tileBounds=new ts(r.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new h.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield et.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const p=this.map.painter.context,y=p.gl,T=c.data;e.texture=this.map.painter.getTileTexture(T.width),e.texture?e.texture.update(T,{useMipmap:!0}):(e.texture=new xt(p,T,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Cl extends ka{constructor(e,r,c,p){super(e,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return h._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield et.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const T=h.b(y)&&h.V()?y:yield this.readImageNow(y),C={type:this.type,uid:e.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:C});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}})}readImageNow(e){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.W()){const r=e.width+2,c=e.height+2;try{return new h.R({width:r,height:c},yield h.X(e,-1,-1,r,c))}catch{}}return Ae.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,y=r.x===0?e.wrap-1:e.wrap,T=(r.x+1+c)%c,C=r.x+1===c?e.wrap+1:e.wrap,I={};return I[new h.Y(e.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},I[new h.Y(e.overscaledZ,C,r.z,T,r.y).key]={backfilled:!1},r.y>0&&(I[new h.Y(e.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},I[new h.Y(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new h.Y(e.overscaledZ,C,r.z,T,r.y-1).key]={backfilled:!1}),r.y+1<c&&(I[new h.Y(e.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},I[new h.Y(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new h.Y(e.overscaledZ,C,r.z,T,r.y+1).key]={backfilled:!1}),I}unloadTile(e){return h._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ru extends h.E{constructor(e,r,c,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=h.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:h.Z,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:h.Z,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(h.Z/this.tileSize)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(r=>r.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return h._(this,void 0,void 0,function*(){const e=new Hi,r=yield this.getData();let c;switch(r.type){case"FeatureCollection":c=r.features.map(p=>this.getCoordinatesFromGeometry(p.geometry)).flat(1/0);break;case"Feature":c=this.getCoordinatesFromGeometry(r.geometry);break;default:c=this.getCoordinatesFromGeometry(r)}if(c.length==0)return e;for(let p=0;p<c.length-1;p+=2)e.extend([c[p],c[p+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:c}})}_updateWorkerData(e){return h._(this,void 0,void 0,function*(){const r=h.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(Ae.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.l("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));let p=null;c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&h.e(y,{resourceTiming:p}),this.fire(new h.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(c))}})}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:r,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,r==="RT")})}abortTile(e){return h._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return h._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Zn extends h.E{constructor(e,r,c,p){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=r}load(e){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield et.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new h.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(h.$.fromLngLat);var c;return this.tileID=function(p){let y=1/0,T=1/0,C=-1/0,I=-1/0;for(const z of p)y=Math.min(y,z.x),T=Math.min(T,z.y),C=Math.max(C,z.x),I=Math.max(I,z.y);const O=Math.max(C-y,I-T),k=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),F=Math.pow(2,k);return new h.a1(k,Math.floor((y+C)/2*F),Math.floor((T+I)/2*F))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(p=>this.tileID.getTilePoint(p)._round()),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new xt(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,c=!0)}c&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let r=1/0,c=1/0,p=-1/0,y=-1/0;for(const C of e)r=Math.min(r,C.x),c=Math.min(c,C.y),p=Math.max(p,C.x),y=Math.max(y,C.y);const T={};for(let C=0;C<=h.a0;C++){const I=Math.pow(2,C),O=Math.floor(r*I),k=Math.floor(c*I),F=Math.floor(p*I),z=Math.floor(y*I);T[C]={minTileX:O,minTileY:k,maxTileX:F,maxTileY:z}}return T}}class sr extends Zn{constructor(e,r,c,p){super(e,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield h.a2(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new h.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new h.k(new h.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new xt(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,c=!0)}c&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class zo extends Zn{constructor(e,r,c,p){super(e,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new h.k(new h.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.a3(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new h.k(new h.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new xt(r,this.canvas,c.RGBA,{premultiply:!0});let p=!1;for(const y in this.tiles){const T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const oo={},Ds=g=>{switch(g){case"geojson":return Ru;case"image":return Zn;case"raster":return ka;case"raster-dem":return Cl;case"vector":return so;case"video":return sr;case"canvas":return zo}return oo[g]},Pu="RTLPluginLoaded";class is extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ae.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return h._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Pu))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let an=null;function xn(){return an||(an=new is),an}class Ba{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,y){const T={};if(!y)return T;for(const C of p){const I=C.layerIds.map(O=>y.getLayer(O)).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(O=>I.filter(k=>k.id===O)[0]));for(const O of I)T[O.id]=C}}return T}(e.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof h.a6){if(this.hasSymbolBuckets=!0,!c)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof h.a6&&y.hasRTLText){this.hasRTLText=!0,xn().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(p).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xt(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xt(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,c,p,y,T,C,I,O,k,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:k,transform:I,params:C,queryPadding:this.queryPadding*O,getElevation:F},e,r,c):{}}querySourceFeatures(e,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),y=r&&r.sourceLayer?r.sourceLayer:"",T=p._geojsonTileLayer||p[y];if(!T)return;const C=h.a7(r&&r.filter),{z:I,x:O,y:k}=this.tileID.canonical,F={z:I,x:O,y:k};for(let z=0;z<T.length;z++){const G=T.feature(z);if(C.needGeometry){const ae=h.a8(G,!0);if(!C.filter(new h.C(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!C.filter(new h.C(this.tileID.overscaledZ),G))continue;const Y=c.getId(G,y),ne=new h.a9(G,I,O,k,Y);ne.tile=F,e.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const c=h.aa(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const y=this.expirationTime-r;y?this.expirationTime=c+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!r.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",C=c[T],I=e[T];if(!C||!I||Object.keys(I).length===0)continue;y.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=r&&r.style&&r.style.getLayer(p);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ae.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ae.now()+e}setDependencies(e,r){const c={};for(const p of r)c[p]=!0;this.dependencies[e]=c}hasDependency(e,r){for(const c of e){const p=this.dependencies[c];if(p){for(const y of r)if(p[y])return!0}}return!1}}class uo{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,c){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:r,timeout:void 0};if(c!==void 0&&(y.timeout=setTimeout(()=>{this.remove(e,y)},c)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const c=e.wrapped().key,p=r===void 0?0:this.data[c].indexOf(r),y=this.data[c][p];return this.data[c].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(y.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const c in this.data)for(const p of this.data[c])e(p.value)||r.push(p);for(const c of r)this.remove(c.value.tileID,c)}}class Lu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,c){const p=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},h.e(this.stateChanges[e][p],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==p&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const y in this.state[e][p])c[y]||(this.deletedStates[e][p][y]=null)}else for(const y in c)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][y]===null&&delete this.deletedStates[e][p][y]}removeFeatureState(e,r,c){if(this.deletedStates[e]===null)return;const p=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&r!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][c]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(c in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][c]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,r){const c=String(r),p=h.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][r];if(y===null)return{};for(const T in y)delete p[T]}return p}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),h.e(this.state[p][T],this.stateChanges[p][T]),y[T]=this.state[p][T];c[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const T in this.state[p])y[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const C of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][C];y[T]=this.state[p][T]}c[p]=c[p]||{},h.e(c[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in e)e[p].setFeatureState(c,r)}}const Ar=89.25;function dn(g,e){const r=h.ae(e.lat,-85.051129,h.af);return new h.P(h.U(e.lng)*g,h.S(r)*g)}function or(g,e){return new h.$(e.x/g,e.y/g).toLngLat()}function De(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(h.ab(90-g.pitch)),Math.tan(h.ab(Ar-g.pitch)))}function X(g,e){const r=g.canonical,c=e/h.ac(r.z),p=r.x+Math.pow(2,r.z)*g.wrap,y=h.ad(new Float64Array(16));return h.L(y,y,[p*c,r.y*c,0]),h.M(y,y,[c/h.Z,c/h.Z,1]),y}function K(g,e,r,c,p){const y=h.$.fromLngLat(g,e),T=p*h.ag(1,g.lat),C=T*Math.cos(h.ab(r)),I=Math.sqrt(T*T-C*C),O=I*Math.sin(h.ab(-c)),k=I*Math.cos(h.ab(-c));return new h.$(y.x+O,y.y+k,y.z+C)}function ie(g,e,r){const c=e.intersectsFrustum(g);if(!r)return c;const p=e.intersectsPlane(r);return c===0||p===0?0:c===2&&p===2?2:1}function de(g,e,r){let c=0;const p=(r-e)/10;for(let y=0;y<10;y++)c+=p*Math.pow(Math.cos(e+(y+.5)/10*(r-e)),g);return c}function Te(g,e){return function(r,c,p,y,T){const C=2*((g-1)/h.ah(Math.cos(h.ab(Ar-T))/Math.cos(h.ab(Ar)))-1),I=Math.acos(p/y),O=2*de(C-1,0,h.ab(T/2)),k=Math.min(h.ab(Ar),I+h.ab(T/2)),F=de(C-1,Math.min(k,I-h.ab(T/2)),k),z=Math.atan(c/p),G=Math.hypot(c,p);let Y=r;return Y+=h.ah(y/G/Math.max(.5,Math.cos(h.ab(T/2)))),Y+=C*h.ah(Math.cos(z))/2,Y-=h.ah(Math.max(1,F/O/e))/2,Y}}const te=Te(9.314,3);function Ne(g,e){const r=(e.roundZoom?Math.round:Math.floor)(g.zoom+h.ah(g.tileSize/e.tileSize));return Math.max(0,r)}function Se(g,e){const r=g.getCameraFrustum(),c=g.getClippingPlane(),p=g.screenPointToMercatorCoordinate(g.getCameraPoint()),y=h.$.fromLngLat(g.center,g.elevation);p.z=y.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const T=g.getCoveringTilesDetailsProvider(),C=T.allowVariableZoom(g,e),I=Ne(g,e),O=e.minzoom||0,k=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,F=Math.min(Math.max(0,I),k),z=Math.pow(2,F),G=[z*p.x,z*p.y,0],Y=[z*y.x,z*y.y,0],ne=Math.hypot(y.x-p.x,y.y-p.y),ae=Math.abs(y.z-p.z),re=Math.hypot(ne,ae),le=be=>({zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),me=[],pe=[];if(g.renderWorldCopies&&T.allowWorldCopies())for(let be=1;be<=3;be++)me.push(le(-be)),me.push(le(be));for(me.push(le(0));me.length>0;){const be=me.pop(),we=be.x,xe=be.y;let ke=be.fullyVisible;const Ke={x:we,y:xe,z:be.zoom},Ge=T.getTileAABB(Ke,be.wrap,g.elevation,e);if(!ke){const mt=ie(r,Ge,c);if(mt===0)continue;ke=mt===2}const qe=T.distanceToTile2d(p.x,p.y,Ke,Ge);let $e=I;C&&($e=(e.calculateTileZoom||te)(g.zoom+h.ah(g.tileSize/e.tileSize),qe,ae,re,g.fov)),$e=(e.roundZoom?Math.round:Math.floor)($e),$e=Math.max(0,$e);const _t=Math.min($e,k);if(be.wrap=T.getWrap(y,Ke,be.wrap),be.zoom>=_t){if(be.zoom<O)continue;const mt=F-be.zoom,rt=G[0]-.5-(we<<mt),Rt=G[1]-.5-(xe<<mt),ui=e.reparseOverscaled?Math.max(be.zoom,$e):be.zoom;pe.push({tileID:new h.Y(be.zoom===k?ui:be.zoom,be.wrap,be.zoom,we,xe),distanceSq:h.ai([Y[0]-.5-we,Y[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(rt*rt+Rt*Rt)})}else for(let mt=0;mt<4;mt++)me.push({zoom:be.zoom+1,x:(we<<1)+mt%2,y:(xe<<1)+(mt>>1),wrap:be.wrap,fullyVisible:ke})}return pe.sort((be,we)=>be.distanceSq-we.distanceSq).map(be=>be.tileID)}class Le extends h.E{constructor(e,r,c){super(),this.id=e,this.dispatcher=c,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,y,T,C)=>{const I=new(Ds(y.type))(p,y,T,C);if(I.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${I.id}`);return I})(e,r,c,this),this._tiles={},this._cache=new uo(0,p=>this._unloadTile(p)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lu,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,c){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,c)}catch(p){e.state="errored",p.status!==404?this._source.fire(new h.k(p,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(He).map(e=>e.key)}getRenderableIds(e){const r=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&r.push(this._tiles[c]);return e?r.sort((c,p)=>{const y=c.tileID,T=p.tileID,C=new h.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),I=new h.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-T.overscaledZ||I.y-C.y||I.x-C.x}).map(c=>c.tileID.key):r.map(c=>c.tileID).sort(He).map(c=>c.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)(e||this._tiles[r].state!=="errored")&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return h._(this,void 0,void 0,function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,e,r))})}_tileLoaded(e,r,c){e.timeAdded=Ae.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const y=r[p];if(e.neighboringTiles&&e.neighboringTiles[y]){const T=this.getTileByID(y);c(e,T),c(T,e)}}function c(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-p.tileID.canonical.x;const C=y.tileID.canonical.y-p.tileID.canonical.y,I=Math.pow(2,p.tileID.canonical.z),O=y.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+I)===1?T+=I:Math.abs(T-I)===1&&(T-=I)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,T,C),p.neighboringTiles&&p.neighboringTiles[O]&&(p.neighboringTiles[O].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,c,p){for(const y in this._tiles){let T=this._tiles[y];if(p[y]||!T.hasData()||T.tileID.overscaledZ<=r||T.tileID.overscaledZ>c)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>r+1;){const O=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[O.key],T&&T.hasData()&&(C=O)}let I=C;for(;I.overscaledZ>r;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]||e[I.canonical.key]){p[C.key]=C;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=e.overscaledZ-1;c>=r;c--){const p=e.scaledTo(c),y=this._getLoadedTile(p);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const c={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+r),c[y.tileID.key]=y}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,r,c,p,y,T){const C={},I={},O=Object.keys(e),k=Ae.now();for(const F of O){const z=e[F],G=this._tiles[F];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=k)continue;const Y=this.findLoadedParent(z,r),ne=this.findLoadedSibling(z),ae=Y||ne||null;ae&&(this._addTile(ae.tileID),C[ae.tileID.key]=ae.tileID),I[F]=z}this._retainLoadedChildren(I,p,c,e);for(const F in C)e[F]||(this._coveredTiles[F]=!0,e[F]=C[F]);if(T){const F={},z={};for(const G of y)this._tiles[G.key].hasData()?F[G.key]=G:z[G.key]=G;for(const G in z){const Y=z[G].children(this._source.maxzoom);this._tiles[Y[0].key]&&this._tiles[Y[1].key]&&this._tiles[Y[2].key]&&this._tiles[Y[3].key]&&(F[Y[0].key]=e[Y[0].key]=Y[0],F[Y[1].key]=e[Y[1].key]=Y[1],F[Y[2].key]=e[Y[2].key]=Y[2],F[Y[3].key]=e[Y[3].key]=Y[3],delete z[G])}for(const G in z){const Y=z[G],ne=this.findLoadedParent(Y,this._source.minzoom),ae=this.findLoadedSibling(Y),re=ne||ae||null;if(re){F[re.tileID.key]=e[re.tileID.key]=re.tileID;for(const le in F)F[le].isChildOf(re.tileID)&&delete F[le]}}for(const G in this._tiles)F[G]||(this._coveredTiles[G]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new h.Y(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(c=Se(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter(k=>this._source.hasTile(k)))):c=[];const p=Ne(e,this._source),y=Math.max(p-Le.maxOverzooming,this._source.minzoom),T=Math.max(p+Le.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const F of c)if(F.canonical.z>this._source.minzoom){const z=F.scaledTo(F.canonical.z-1);k[z.key]=z;const G=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));k[G.key]=G}c=c.concat(Object.values(k))}const C=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(c,p);Re(this._source.type)&&this._updateCoveredAndRetainedTiles(I,y,T,p,c,r);for(const k in I)this._tiles[k].clearFadeHold();const O=h.aj(this._tiles,I);for(const k of O){const F=this._tiles[k];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var c;const p={},y={},T=Math.max(r-Le.maxOverzooming,this._source.minzoom),C=Math.max(r+Le.maxUnderzooming,this._source.minzoom),I={};for(const O of e){const k=this._addTile(O);p[O.key]=O,k.hasData()||r<this._source.maxzoom&&(I[O.key]=O)}this._retainLoadedChildren(I,r,C,p);for(const O of e){let k=this._tiles[O.key];if(k.hasData())continue;if(r+1>this._source.maxzoom){const z=O.children(this._source.maxzoom)[0],G=this.getTile(z);if(G&&G.hasData()){p[z.key]=z;continue}}else{const z=O.children(this._source.maxzoom);if(p[z[0].key]&&p[z[1].key]&&p[z[2].key]&&p[z[3].key])continue}let F=k.wasRequested();for(let z=O.overscaledZ-1;z>=T;--z){const G=O.scaledTo(z);if(y[G.key])break;if(y[G.key]=!0,k=this.getTile(G),!k&&F&&(k=this._addTile(G)),k){const Y=k.hasData();if((Y||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||F)&&(p[G.key]=G),F=k.wasRequested(),Y)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let c,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}r.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(y),c)break;p=y}for(const y of r)this._loadedParentTiles[y]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,c=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=c}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const c=r;return r||(r=new Ba(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,c||this._source.fire(new h.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=r.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}refreshTiles(e){for(const r in this._tiles)this._isIdRenderable(r)&&e.some(c=>c.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,c){const p=[],y=this.transform;if(!y)return p;const T=c?y.getCameraQueryGeometry(e):e,C=e.map(Y=>y.screenPointToMercatorCoordinate(Y,this.terrain)),I=T.map(Y=>y.screenPointToMercatorCoordinate(Y,this.terrain)),O=this.getIds();let k=1/0,F=1/0,z=-1/0,G=-1/0;for(const Y of I)k=Math.min(k,Y.x),F=Math.min(F,Y.y),z=Math.max(z,Y.x),G=Math.max(G,Y.y);for(let Y=0;Y<O.length;Y++){const ne=this._tiles[O[Y]];if(ne.holdingForFade())continue;const ae=y.getCoveringTilesDetailsProvider().allowWorldCopies()?ne.tileID:ne.tileID.unwrapTo(0),re=Math.pow(2,y.zoom-ne.tileID.overscaledZ),le=r*ne.queryPadding*h.Z/ne.tileSize/re,me=[ae.getTilePoint(new h.$(k,F)),ae.getTilePoint(new h.$(z,G))];if(me[0].x-le<h.Z&&me[0].y-le<h.Z&&me[1].x+le>=0&&me[1].y+le>=0){const pe=C.map(we=>ae.getTilePoint(we)),be=I.map(we=>ae.getTilePoint(we));p.push({tile:ne,tileID:ae,queryGeometry:pe,cameraQueryGeometry:be,scale:re})}}return p}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Re(this._source.type)){const e=Ae.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,c){this._state.updateState(e=e||"_geojsonTileLayer",r,c)}removeFeatureState(e,r,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,c)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,c){const p=this._tiles[e];p&&p.setDependencies(r,c)}reloadTilesForDependencies(e,r){for(const c in this._tiles)this._tiles[c].hasDependency(e,r)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(e,r))}}function He(g,e){const r=Math.abs(2*g.wrap)-+(g.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||c-r||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function Re(g){return g==="raster"||g==="image"||g==="video"}Le.maxOverzooming=10,Le.maxUnderzooming=3;class at{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ae(e,0,1);let r=1,c=this._distances[r];const p=e*this.paddedLength+this.padding;for(;c<p&&r<this._distances.length;)c=this._distances[++r];const y=r-1,T=this._distances[y],C=c-T,I=C>0?(p-T)/C:0;return this.points[y].mult(1-I).add(this.points[r].mult(I))}}function yt(g,e){let r=!0;return g==="always"||g!=="never"&&e!=="never"||(r=!1),r}class Tt{constructor(e,r,c){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(r/c);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,c,p,y){this._forEachCell(r,c,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(e,r,c,p){this._forEachCell(r-p,c-p,r+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(c),this.circles.push(p)}_insertBoxCell(e,r,c,p,y,T){this.boxCells[y].push(T)}_insertCircleCell(e,r,c,p,y,T){this.circleCells[y].push(T)}_query(e,r,c,p,y,T,C){if(c<0||e>this.width||p<0||r>this.height)return[];const I=[];if(e<=0&&r<=0&&this.width<=c&&this.height<=p){if(y)return[{key:null,x1:e,y1:r,x2:c,y2:p}];for(let O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const k=this.circles[3*O],F=this.circles[3*O+1],z=this.circles[3*O+2];I.push({key:this.circleKeys[O],x1:k-z,y1:F-z,x2:k+z,y2:F+z})}}else this._forEachCell(e,r,c,p,this._queryCell,I,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},C);return I}query(e,r,c,p){return this._query(e,r,c,p,!1,null)}hitTest(e,r,c,p,y,T){return this._query(e,r,c,p,!0,y,T).length>0}hitTestCircle(e,r,c,p,y){const T=e-c,C=e+c,I=r-c,O=r+c;if(C<0||T>this.width||O<0||I>this.height)return!1;const k=[];return this._forEachCell(T,I,C,O,this._queryCellCircle,k,{hitTest:!0,overlapMode:p,circle:{x:e,y:r,radius:c},seenUids:{box:{},circle:{}}},y),k.length>0}_queryCell(e,r,c,p,y,T,C,I){const{seenUids:O,hitTest:k,overlapMode:F}=C,z=this.boxCells[y];if(z!==null){const Y=this.bboxes;for(const ne of z)if(!O.box[ne]){O.box[ne]=!0;const ae=4*ne,re=this.boxKeys[ne];if(e<=Y[ae+2]&&r<=Y[ae+3]&&c>=Y[ae+0]&&p>=Y[ae+1]&&(!I||I(re))&&(!k||!yt(F,re.overlapMode))&&(T.push({key:re,x1:Y[ae],y1:Y[ae+1],x2:Y[ae+2],y2:Y[ae+3]}),k))return!0}}const G=this.circleCells[y];if(G!==null){const Y=this.circles;for(const ne of G)if(!O.circle[ne]){O.circle[ne]=!0;const ae=3*ne,re=this.circleKeys[ne];if(this._circleAndRectCollide(Y[ae],Y[ae+1],Y[ae+2],e,r,c,p)&&(!I||I(re))&&(!k||!yt(F,re.overlapMode))){const le=Y[ae],me=Y[ae+1],pe=Y[ae+2];if(T.push({key:re,x1:le-pe,y1:me-pe,x2:le+pe,y2:me+pe}),k)return!0}}}return!1}_queryCellCircle(e,r,c,p,y,T,C,I){const{circle:O,seenUids:k,overlapMode:F}=C,z=this.boxCells[y];if(z!==null){const Y=this.bboxes;for(const ne of z)if(!k.box[ne]){k.box[ne]=!0;const ae=4*ne,re=this.boxKeys[ne];if(this._circleAndRectCollide(O.x,O.y,O.radius,Y[ae+0],Y[ae+1],Y[ae+2],Y[ae+3])&&(!I||I(re))&&!yt(F,re.overlapMode))return T.push(!0),!0}}const G=this.circleCells[y];if(G!==null){const Y=this.circles;for(const ne of G)if(!k.circle[ne]){k.circle[ne]=!0;const ae=3*ne,re=this.circleKeys[ne];if(this._circlesCollide(Y[ae],Y[ae+1],Y[ae+2],O.x,O.y,O.radius)&&(!I||I(re))&&!yt(F,re.overlapMode))return T.push(!0),!0}}}_forEachCell(e,r,c,p,y,T,C,I){const O=this._convertToXCellCoord(e),k=this._convertToYCellCoord(r),F=this._convertToXCellCoord(c),z=this._convertToYCellCoord(p);for(let G=O;G<=F;G++)for(let Y=k;Y<=z;Y++)if(y.call(this,e,r,c,p,this.xCellCount*Y+G,T,C,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,c,p,y,T){const C=p-e,I=y-r,O=c+T;return O*O>C*C+I*I}_circleAndRectCollide(e,r,c,p,y,T,C){const I=(T-p)/2,O=Math.abs(e-(p+I));if(O>I+c)return!1;const k=(C-y)/2,F=Math.abs(r-(y+k));if(F>k+c)return!1;if(O<=I||F<=k)return!0;const z=O-I,G=F-k;return z*z+G*G<=c*c}}function Lt(g,e,r){const c=h.K();if(!g){const{vecSouth:F,vecEast:z}=Ot(e),G=Q();G[0]=z[0],G[1]=z[1],G[2]=F[0],G[3]=F[1],p=G,(k=(T=(y=G)[0])*(O=y[3])-(I=y[2])*(C=y[1]))&&(p[0]=O*(k=1/k),p[1]=-C*k,p[2]=-I*k,p[3]=T*k),c[0]=G[0],c[1]=G[1],c[4]=G[2],c[5]=G[3]}var p,y,T,C,I,O,k;return h.M(c,c,[1/r,1/r,1]),c}function Ft(g,e,r,c){if(g){const p=h.K();if(!e){const{vecSouth:y,vecEast:T}=Ot(r);p[0]=T[0],p[1]=T[1],p[4]=y[0],p[5]=y[1]}return h.M(p,p,[c,c,1]),p}return r.pixelsToClipSpaceMatrix}function Ot(g){const e=Math.cos(g.rollInRadians),r=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),p=Math.cos(g.bearingInRadians),y=Math.sin(g.bearingInRadians),T=h.ao();T[0]=-p*c*r-y*e,T[1]=-y*c*r+p*e;const C=h.ap(T);C<1e-9?h.aq(T):h.ar(T,T,1/C);const I=h.ao();I[0]=p*c*e-y*r,I[1]=y*c*e+p*r;const O=h.ap(I);return O<1e-9?h.aq(I):h.ar(I,I,1/O),{vecEast:I,vecSouth:T}}function Ye(g,e,r,c){let p;c?(p=[g,e,c(g,e),1],h.at(p,p,r)):(p=[g,e,0,1],lo(p,p,r));const y=p[3];return{point:new h.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Ci(g,e){return .5+g/e*.5}function bi(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function Mi(g,e,r,c,p,y,T,C,I,O,k,F,z){const G=r?g.textSizeData:g.iconSizeData,Y=h.ak(G,e.transform.zoom),ne=[256/e.width*2+1,256/e.height*2+1],ae=r?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ae.clear();const re=g.lineVertexArray,le=r?g.text.placedSymbolArray:g.icon.placedSymbolArray,me=e.transform.width/e.transform.height;let pe=!1;for(let be=0;be<le.length;be++){const we=le.get(be);if(we.hidden||we.writingMode===h.al.vertical&&!pe){Rs(we.numGlyphs,ae);continue}pe=!1;const xe=new h.P(we.anchorX,we.anchorY),ke={getElevation:z,pitchedLabelPlaneMatrix:c,lineVertexArray:re,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:xe,unwrappedTileID:I,width:O,height:k,translation:F},Ke=Ut(we.anchorX,we.anchorY,ke);if(!bi(Ke.point,ne)){Rs(we.numGlyphs,ae);continue}const Ge=Ci(e.transform.cameraToCenterDistance,Ke.signedDistanceFromCamera),qe=h.am(G,Y,we),$e=y?qe*e.transform.getPitchedTextCorrection(we.anchorX,we.anchorY,I)/Ge:qe*Ge,_t=qt({projectionContext:ke,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:$e,flip:!1,keepUpright:T,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:me,rotateToLine:C});pe=_t.useVertical,(_t.notEnoughRoom||pe||_t.needsFlipping&&qt({projectionContext:ke,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:$e,flip:!0,keepUpright:T,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:me,rotateToLine:C}).notEnoughRoom)&&Rs(we.numGlyphs,ae)}r?g.text.dynamicLayoutVertexBuffer.updateData(ae):g.icon.dynamicLayoutVertexBuffer.updateData(ae)}function Yt(g,e,r,c,p,y,T,C){const I=y.glyphStartIndex+y.numGlyphs,O=y.lineStartIndex,k=y.lineStartIndex+y.lineLength,F=e.getoffsetX(y.glyphStartIndex),z=e.getoffsetX(I-1),G=ur(g*F,r,c,p,y.segment,O,k,C,T);if(!G)return null;const Y=ur(g*z,r,c,p,y.segment,O,k,C,T);return Y?C.projectionCache.anyProjectionOccluded?null:{first:G,last:Y}:null}function it(g,e,r,c){return g===h.al.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*c?{useVertical:!0}:(g===h.al.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function qt(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:p,flip:y,keepUpright:T,glyphOffsetArray:C,dynamicLayoutVertexArray:I,aspectRatio:O,rotateToLine:k}=g,F=p/24,z=c.lineOffsetX*F,G=c.lineOffsetY*F;let Y;if(c.numGlyphs>1){const ne=c.glyphStartIndex+c.numGlyphs,ae=c.lineStartIndex,re=c.lineStartIndex+c.lineLength,le=Yt(F,C,z,G,y,c,k,e);if(!le)return{notEnoughRoom:!0};const me=$a(le.first.point.x,le.first.point.y,e,r),pe=$a(le.last.point.x,le.last.point.y,e,r);if(T&&!y){const be=it(c.writingMode,me,pe,O);if(be)return be}Y=[le.first];for(let be=c.glyphStartIndex+1;be<ne-1;be++)Y.push(ur(F*C.getoffsetX(be),z,G,y,c.segment,ae,re,e,k));Y.push(le.last)}else{if(T&&!y){const ae=Wi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,re=c.lineStartIndex+c.segment+1,le=new h.P(e.lineVertexArray.getx(re),e.lineVertexArray.gety(re)),me=Wi(le.x,le.y,e),pe=me.signedDistanceFromCamera>0?me.point:Xt(e.tileAnchorPoint,le,ae,1,e),be=$a(ae.x,ae.y,e,r),we=$a(pe.x,pe.y,e,r),xe=it(c.writingMode,be,we,O);if(xe)return xe}const ne=ur(F*C.getoffsetX(c.glyphStartIndex),z,G,y,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,k);if(!ne||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Y=[ne]}for(const ne of Y)h.as(I,ne.point,ne.angle);return{}}function Xt(g,e,r,c,p){const y=g.add(g.sub(e)._unit()),T=Wi(y.x,y.y,p).point,C=r.sub(T);return r.add(C._mult(c/C.mag()))}function Zi(g,e,r){const c=e.projectionCache;if(c.projections[g])return c.projections[g];const p=new h.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),y=Wi(p.x,p.y,e);if(y.signedDistanceFromCamera>0)return c.projections[g]=y.point,c.anyProjectionOccluded=c.anyProjectionOccluded||y.isOccluded,y.point;const T=g-r.direction;return Xt(r.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(T),e.lineVertexArray.gety(T)),p,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Wi(g,e,r){const c=g+r.translation[0],p=e+r.translation[1];let y;return r.pitchWithMap?(y=Ye(c,p,r.pitchedLabelPlaneMatrix,r.getElevation),y.isOccluded=!1):(y=r.transform.projectTileCoordinates(c,p,r.unwrappedTileID,r.getElevation),y.point.x=(.5*y.point.x+.5)*r.width,y.point.y=(.5*-y.point.y+.5)*r.height),y}function $a(g,e,r,c){if(r.pitchWithMap){const p=[g,e,0,1];return h.at(p,p,c),r.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],r.unwrappedTileID,r.getElevation).point}return{x:g/r.width*2-1,y:e/r.height*2-1}}function Ut(g,e,r){return r.transform.projectTileCoordinates(g,e,r.unwrappedTileID,r.getElevation)}function Fo(g,e,r){return g._unit()._perp()._mult(e*r)}function Ou(g,e,r,c,p,y,T,C,I){if(C.projectionCache.offsets[g])return C.projectionCache.offsets[g];const O=r.add(e);if(g+I.direction<c||g+I.direction>=p)return C.projectionCache.offsets[g]=O,O;const k=Zi(g+I.direction,C,I),F=Fo(k.sub(r),T,I.direction),z=r.add(F),G=k.add(F);return C.projectionCache.offsets[g]=h.au(y,O,z,G)||O,C.projectionCache.offsets[g]}function ur(g,e,r,c,p,y,T,C,I){const O=c?g-e:g+e;let k=O>0?1:-1,F=0;c&&(k*=-1,F=Math.PI),k<0&&(F+=Math.PI);let z,G=k>0?y+p:y+p+1;C.projectionCache.cachedAnchorPoint?z=C.projectionCache.cachedAnchorPoint:(z=Wi(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=z);let Y,ne,ae=z,re=z,le=0,me=0;const pe=Math.abs(O),be=[];let we;for(;le+me<=pe;){if(G+=k,G<y||G>=T)return null;le+=me,re=ae,ne=Y;const Ke={absOffsetX:pe,direction:k,distanceFromAnchor:le,previousVertex:re};if(ae=Zi(G,C,Ke),r===0)be.push(re),we=ae.sub(re);else{let Ge;const qe=ae.sub(re);Ge=qe.mag()===0?Fo(Zi(G+k,C,Ke).sub(ae),r,k):Fo(qe,r,k),ne||(ne=re.add(Ge)),Y=Ou(G,Ge,ae,y,T,ne,r,C,Ke),be.push(ne),we=Y.sub(ne)}me=we.mag()}const xe=we._mult((pe-le)/me)._add(ne||re),ke=F+Math.atan2(ae.y-re.y,ae.x-re.x);return be.push(xe),{point:xe,angle:I?ke:0,path:be}}const as=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Rs(g,e){for(let r=0;r<g;r++){const c=e.length;e.resize(c+4),e.float32.set(as,3*c)}}function lo(g,e,r){const c=e[0],p=e[1];return g[0]=r[0]*c+r[4]*p+r[12],g[1]=r[1]*c+r[5]*p+r[13],g[3]=r[3]*c+r[7]*p+r[15],g}const Sa=100;class lr{constructor(e,r=new Tt(e.width+200,e.height+200,25),c=new Tt(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Sa,this.screenBottomBoundary=e.height+Sa,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,c,p,y,T,C,I,O,k,F,z){const G=this.projectAndGetPerspectiveRatio(e.anchorPointX+I[0],e.anchorPointY+I[1],y,k,z),Y=c*G.perspectiveRatio;let ne;if(T||C)ne=this._projectCollisionBox(e,Y,p,y,T,C,I,G,k,F,z);else{const we=G.x+(F?F.x*Y:0),xe=G.y+(F?F.y*Y:0);ne={allPointsOccluded:!1,box:[we+e.x1*Y,xe+e.y1*Y,we+e.x2*Y,xe+e.y2*Y]}}const[ae,re,le,me]=ne.box,pe=T?ne.allPointsOccluded:G.isOccluded;let be=pe;return be||(be=G.perspectiveRatio<this.perspectiveRatioCutoff),be||(be=!this.isInsideGrid(ae,re,le,me)),be||r!=="always"&&this.grid.hitTest(ae,re,le,me,r,O)?{box:[ae,re,le,me],placeable:!1,offscreen:!1,occluded:pe}:{box:[ae,re,le,me],placeable:!0,offscreen:this.isOffscreen(ae,re,le,me),occluded:pe}}placeCollisionCircles(e,r,c,p,y,T,C,I,O,k,F,z,G,Y){const ne=[],ae=new h.P(r.anchorX,r.anchorY),re=this.getPerspectiveRatio(ae.x,ae.y,T,Y),le=(O?y*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,T)/re:y*re)/h.ay,me={getElevation:Y,pitchedLabelPlaneMatrix:C,lineVertexArray:c,pitchWithMap:O,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:G},pe=Yt(le,p,r.lineOffsetX*le,r.lineOffsetY*le,!1,r,!1,me);let be=!1,we=!1,xe=!0;if(pe){const ke=.5*F*re+z,Ke=new h.P(-100,-100),Ge=new h.P(this.screenRightBoundary,this.screenBottomBoundary),qe=new at,$e=pe.first,_t=pe.last;let mt=[];for(let ui=$e.path.length-1;ui>=1;ui--)mt.push($e.path[ui]);for(let ui=1;ui<_t.path.length;ui++)mt.push(_t.path[ui]);const rt=2.5*ke;if(O){const ui=this.projectPathToScreenSpace(mt,me);mt=ui.some(_i=>_i.signedDistanceFromCamera<=0)?[]:ui.map(_i=>_i.point)}let Rt=[];if(mt.length>0){const ui=mt[0].clone(),_i=mt[0].clone();for(let da=1;da<mt.length;da++)ui.x=Math.min(ui.x,mt[da].x),ui.y=Math.min(ui.y,mt[da].y),_i.x=Math.max(_i.x,mt[da].x),_i.y=Math.max(_i.y,mt[da].y);Rt=ui.x>=Ke.x&&_i.x<=Ge.x&&ui.y>=Ke.y&&_i.y<=Ge.y?[mt]:_i.x<Ke.x||ui.x>Ge.x||_i.y<Ke.y||ui.y>Ge.y?[]:h.av([mt],Ke.x,Ke.y,Ge.x,Ge.y)}for(const ui of Rt){qe.reset(ui,.25*ke);let _i=0;_i=qe.length<=.5*ke?1:Math.ceil(qe.paddedLength/rt)+1;for(let da=0;da<_i;da++){const ji=da/Math.max(_i-1,1),fa=qe.lerp(ji),sa=fa.x+Sa,Xi=fa.y+Sa;ne.push(sa,Xi,ke,0);const Di=sa-ke,za=Xi-ke,Ka=sa+ke,un=Xi+ke;if(xe=xe&&this.isOffscreen(Di,za,Ka,un),we=we||this.isInsideGrid(Di,za,Ka,un),e!=="always"&&this.grid.hitTestCircle(sa,Xi,ke,e,k)&&(be=!0,!I))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!I&&be||!we||re<this.perspectiveRatioCutoff?[]:ne,offscreen:xe,collisionDetected:be}}projectPathToScreenSpace(e,r){const c=function(p,y){const T=h.K();return h.an(T,y.pitchedLabelPlaneMatrix),p.map(C=>{const I=Ye(C.x,C.y,T,y.getElevation),O=y.transform.projectTileCoordinates(I.point.x,I.point.y,y.unwrappedTileID,y.getElevation);return O.point.x=(.5*O.point.x+.5)*y.width,O.point.y=(.5*-O.point.y+.5)*y.height,O})}(e,r);return function(p){let y=0,T=0,C=0,I=0;for(let O=0;O<p.length;O++)p[O].isOccluded?(C=O+1,I=0):(I++,I>T&&(T=I,y=C));return p.slice(y,y+T)}(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,p=1/0,y=-1/0,T=-1/0;for(const k of e){const F=new h.P(k.x+Sa,k.y+Sa);c=Math.min(c,F.x),p=Math.min(p,F.y),y=Math.max(y,F.x),T=Math.max(T,F.y),r.push(F)}const C=this.grid.query(c,p,y,T).concat(this.ignoredGrid.query(c,p,y,T)),I={},O={};for(const k of C){const F=k.key;if(I[F.bucketInstanceId]===void 0&&(I[F.bucketInstanceId]={}),I[F.bucketInstanceId][F.featureIndex])continue;const z=[new h.P(k.x1,k.y1),new h.P(k.x2,k.y1),new h.P(k.x2,k.y2),new h.P(k.x1,k.y2)];h.aw(r,z)&&(I[F.bucketInstanceId][F.featureIndex]=!0,O[F.bucketInstanceId]===void 0&&(O[F.bucketInstanceId]=[]),O[F.bucketInstanceId].push(F.featureIndex))}return O}insertCollisionBox(e,r,c,p,y,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,c,p,y,T){const C=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:r};for(let O=0;O<e.length;O+=4)C.insertCircle(I,e[O],e[O+1],e[O+2])}projectAndGetPerspectiveRatio(e,r,c,p,y){if(y){let T;p?(T=[e,r,p(e,r),1],h.at(T,T,y)):(T=[e,r,0,1],lo(T,T,y));const C=T[3];return{x:(T[0]/C+1)/2*this.transform.width+Sa,y:(-T[1]/C+1)/2*this.transform.height+Sa,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const T=this.transform.projectTileCoordinates(e,r,c,p);return{x:(T.point.x+1)/2*this.transform.width+Sa,y:(1-T.point.y)/2*this.transform.height+Sa,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,c,p){const y=this.transform.projectTileCoordinates(e,r,c,p);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,r,c,p){return c<Sa||e>=this.screenRightBoundary||p<Sa||r>this.screenBottomBoundary}isInsideGrid(e,r,c,p){return c>=0&&e<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=h.ad([]);return h.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,c,p,y,T,C,I,O,k,F){let z=1,G=0,Y=0,ne=1;const ae=e.anchorPointX+C[0],re=e.anchorPointY+C[1];if(T&&!y){const mt=this.projectAndGetPerspectiveRatio(ae+1,re,p,O,F),rt=mt.x-I.x,Rt=Math.atan((mt.y-I.y)/rt)+(rt<0?Math.PI:0),ui=Math.sin(Rt),_i=Math.cos(Rt);z=_i,G=ui,Y=-ui,ne=_i}else if(!T&&y){const mt=Ot(this.transform);z=mt.vecEast[0],G=mt.vecEast[1],Y=mt.vecSouth[0],ne=mt.vecSouth[1]}let le=I.x,me=I.y,pe=r;y&&(le=ae,me=re,pe=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),pe*=this.transform.getPitchedTextCorrection(ae,re,p),k||(pe*=h.ae(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),k&&(le+=z*k.x*pe+Y*k.y*pe,me+=G*k.x*pe+ne*k.y*pe);const be=e.x1*pe,we=e.x2*pe,xe=(be+we)/2,ke=e.y1*pe,Ke=e.y2*pe,Ge=(ke+Ke)/2,qe=[{offsetX:be,offsetY:ke},{offsetX:xe,offsetY:ke},{offsetX:we,offsetY:ke},{offsetX:we,offsetY:Ge},{offsetX:we,offsetY:Ke},{offsetX:xe,offsetY:Ke},{offsetX:be,offsetY:Ke},{offsetX:be,offsetY:Ge}];let $e=[];for(const{offsetX:mt,offsetY:rt}of qe)$e.push(new h.P(le+z*mt+Y*rt,me+G*mt+ne*rt));let _t=!1;if(y){const mt=$e.map(rt=>this.projectAndGetPerspectiveRatio(rt.x,rt.y,p,O,F));_t=mt.some(rt=>!rt.isOccluded),$e=mt.map(rt=>new h.P(rt.x,rt.y))}else _t=!0;return{box:h.ax($e),allPointsOccluded:!_t}}}class Yi{constructor(e,r,c,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class co{constructor(e,r,c,p,y){this.text=new Yi(e?e.text:null,r,c,y),this.icon=new Yi(e?e.icon:null,r,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yn{constructor(e,r,c){this.text=e,this.icon=r,this.skipFade=c}}class Ml{constructor(e,r,c,p,y){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=y}}class ho{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[e]}}function $n(g,e,r,c,p){const{horizontalAlign:y,verticalAlign:T}=h.aE(g);return new h.P(-(y-.5)*e+c[0]*p,-(T-.5)*r+c[1]*p)}class yc{constructor(e,r,c,p,y){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new lr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ho(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(c,p)=>r.getElevation(e,c,p):null}getBucketParts(e,r,c,p){const y=c.getBucket(r),T=c.latestFeatureIndex;if(!y||!T||r.id!==y.layerIds[0])return;const C=c.collisionBoxArray,I=y.layers[0].layout,O=y.layers[0].paint,k=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),F=c.tileSize/h.Z,z=c.tileID.toUnwrapped(),G=I.get("text-rotation-alignment")==="map",Y=h.az(c,1,this.transform.zoom),ne=h.aA(this.collisionIndex.transform,c,O.get("text-translate"),O.get("text-translate-anchor")),ae=h.aA(this.collisionIndex.transform,c,O.get("icon-translate"),O.get("icon-translate-anchor")),re=Lt(G,this.transform,Y);this.retainedQueryData[y.bucketInstanceId]=new Ml(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,c.tileID);const le={bucket:y,layout:I,translationText:ne,translationIcon:ae,unwrappedTileID:z,pitchedLabelPlaneMatrix:re,scale:k,textPixelRatio:F,holdingForFade:c.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:h.ak(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const me of y.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:be,symbolInstanceEnd:we}=me;e.push({sortKey:pe,symbolInstanceStart:be,symbolInstanceEnd:we,parameters:le})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:le})}attemptAnchorPlacement(e,r,c,p,y,T,C,I,O,k,F,z,G,Y,ne,ae,re,le,me,pe){const be=h.aB[e.textAnchor],we=[e.textOffset0,e.textOffset1],xe=$n(be,c,p,we,y),ke=this.collisionIndex.placeCollisionBox(r,z,I,O,k,C,T,ae,F.predicate,me,xe,pe);if((!le||this.collisionIndex.placeCollisionBox(le,z,I,O,k,C,T,re,F.predicate,me,xe,pe).placeable)&&ke.placeable){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:we,width:c,height:p,anchor:be,textBoxScale:y,prevAnchor:Ke},this.markUsedJustification(Y,be,G,ne),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,ne,G),this.placedOrientations[G.crossTileID]=ne),{shift:xe,placedGlyphBoxes:ke}}}placeLayerBucketPart(e,r,c){const{bucket:p,layout:y,translationText:T,translationIcon:C,unwrappedTileID:I,pitchedLabelPlaneMatrix:O,textPixelRatio:k,holdingForFade:F,collisionBoxArray:z,partiallyEvaluatedTextSize:G,collisionGroup:Y}=e.parameters,ne=y.get("text-optional"),ae=y.get("icon-optional"),re=h.aC(y,"text-overlap","text-allow-overlap"),le=re==="always",me=h.aC(y,"icon-overlap","icon-allow-overlap"),pe=me==="always",be=y.get("text-rotation-alignment")==="map",we=y.get("text-pitch-alignment")==="map",xe=y.get("icon-text-fit")!=="none",ke=y.get("symbol-z-order")==="viewport-y",Ke=le&&(pe||!p.hasIconData()||ae),Ge=pe&&(le||!p.hasTextData()||ne);!p.collisionArrays&&z&&p.deserializeCollisionBoxes(z);const qe=this.retainedQueryData[p.bucketInstanceId].tileID,$e=this._getTerrainElevationFunc(qe),_t=this.transform.getFastPathSimpleProjectionMatrix(qe),mt=(rt,Rt,ui)=>{var _i,da;if(r[rt.crossTileID])return;if(F)return void(this.placements[rt.crossTileID]=new Yn(!1,!1,!1));let ji=!1,fa=!1,sa=!0,Xi=null,Di={box:null,placeable:!1,offscreen:null,occluded:!1},za={placeable:!1},Ka=null,un=null,Li=null,bs=0,Yr=0,Zs=0;Rt.textFeatureIndex?bs=Rt.textFeatureIndex:rt.useRuntimeCollisionCircles&&(bs=rt.featureIndex),Rt.verticalTextFeatureIndex&&(Yr=Rt.verticalTextFeatureIndex);const Ys=Rt.textBox;if(Ys){const mr=Ea=>{let Fa=h.al.horizontal;if(p.allowVerticalPlacement&&!Ea&&this.prevPlacement){const Cn=this.prevPlacement.placedOrientations[rt.crossTileID];Cn&&(this.placedOrientations[rt.crossTileID]=Cn,Fa=Cn,this.markUsedOrientation(p,Fa,rt))}return Fa},Xs=(Ea,Fa)=>{if(p.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Cn of p.writingModes)if(Cn===h.al.vertical?(Di=Fa(),za=Di):Di=Ea(),Di&&Di.placeable)break}else Di=Ea()},gr=rt.textAnchorOffsetStartIndex,xs=rt.textAnchorOffsetEndIndex;if(xs===gr){const Ea=(Fa,Cn)=>{const qi=this.collisionIndex.placeCollisionBox(Fa,re,k,qe,I,we,be,T,Y.predicate,$e,void 0,_t);return qi&&qi.placeable&&(this.markUsedOrientation(p,Cn,rt),this.placedOrientations[rt.crossTileID]=Cn),qi};Xs(()=>Ea(Ys,h.al.horizontal),()=>{const Fa=Rt.verticalTextBox;return p.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&Fa?Ea(Fa,h.al.vertical):{box:null,offscreen:null}}),mr(Di&&Di.placeable)}else{let Ea=h.aB[(da=(_i=this.prevPlacement)===null||_i===void 0?void 0:_i.variableOffsets[rt.crossTileID])===null||da===void 0?void 0:da.anchor];const Fa=(qi,Jl,qh)=>{const kd=qi.x2-qi.x1,ol=qi.y2-qi.y1,_u=rt.textBoxScale,Mo=xe&&me==="never"?Jl:null;let Mn=null,_r=re==="never"?1:2,yr="never";Ea&&_r++;for(let vs=0;vs<_r;vs++){for(let Qs=gr;Qs<xs;Qs++){const Ks=p.textAnchorOffsets.get(Qs);if(Ea&&Ks.textAnchor!==Ea)continue;const Jn=this.attemptAnchorPlacement(Ks,qi,kd,ol,_u,be,we,k,qe,I,Y,yr,rt,p,qh,T,C,Mo,$e);if(Jn&&(Mn=Jn.placedGlyphBoxes,Mn&&Mn.placeable))return ji=!0,Xi=Jn.shift,Mn}Ea?Ea=null:yr=re}return c&&!Mn&&(Mn={box:this.collisionIndex.placeCollisionBox(Ys,"always",k,qe,I,we,be,T,Y.predicate,$e,void 0,_t).box,offscreen:!1,placeable:!1,occluded:!1}),Mn};Xs(()=>Fa(Ys,Rt.iconBox,h.al.horizontal),()=>{const qi=Rt.verticalTextBox;return p.allowVerticalPlacement&&(!Di||!Di.placeable)&&rt.numVerticalGlyphVertices>0&&qi?Fa(qi,Rt.verticalIconBox,h.al.vertical):{box:null,occluded:!0,offscreen:null}}),Di&&(ji=Di.placeable,sa=Di.offscreen);const Cn=mr(Di&&Di.placeable);if(!ji&&this.prevPlacement){const qi=this.prevPlacement.variableOffsets[rt.crossTileID];qi&&(this.variableOffsets[rt.crossTileID]=qi,this.markUsedJustification(p,qi.anchor,rt,Cn))}}}if(Ka=Di,ji=Ka&&Ka.placeable,sa=Ka&&Ka.offscreen,rt.useRuntimeCollisionCircles){const mr=p.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex),Xs=h.am(p.textSizeData,G,mr),gr=y.get("text-padding");un=this.collisionIndex.placeCollisionCircles(re,mr,p.lineVertexArray,p.glyphOffsetArray,Xs,I,O,c,we,Y.predicate,rt.collisionCircleDiameter,gr,T,$e),un.circles.length&&un.collisionDetected&&!c&&h.w("Collisions detected, but collision boxes are not shown"),ji=le||un.circles.length>0&&!un.collisionDetected,sa=sa&&un.offscreen}if(Rt.iconFeatureIndex&&(Zs=Rt.iconFeatureIndex),Rt.iconBox){const mr=Xs=>this.collisionIndex.placeCollisionBox(Xs,me,k,qe,I,we,be,C,Y.predicate,$e,xe&&Xi?Xi:void 0,_t);za&&za.placeable&&Rt.verticalIconBox?(Li=mr(Rt.verticalIconBox),fa=Li.placeable):(Li=mr(Rt.iconBox),fa=Li.placeable),sa=sa&&Li.offscreen}const sl=ne||rt.numHorizontalGlyphVertices===0&&rt.numVerticalGlyphVertices===0,$s=ae||rt.numIconVertices===0;sl||$s?$s?sl||(fa=fa&&ji):ji=fa&&ji:fa=ji=fa&&ji;const gu=fa&&Li.placeable;if(ji&&Ka.placeable&&this.collisionIndex.insertCollisionBox(Ka.box,re,y.get("text-ignore-placement"),p.bucketInstanceId,za&&za.placeable&&Yr?Yr:bs,Y.ID),gu&&this.collisionIndex.insertCollisionBox(Li.box,me,y.get("icon-ignore-placement"),p.bucketInstanceId,Zs,Y.ID),un&&ji&&this.collisionIndex.insertCollisionCircles(un.circles,re,y.get("text-ignore-placement"),p.bucketInstanceId,bs,Y.ID),c&&this.storeCollisionData(p.bucketInstanceId,ui,Rt,Ka,Li,un),rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[rt.crossTileID]=new Yn((ji||Ke)&&!(Ka!=null&&Ka.occluded),(fa||Ge)&&!(Li!=null&&Li.occluded),sa||p.justReloaded),r[rt.crossTileID]=!0};if(ke){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const rt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Rt=rt.length-1;Rt>=0;--Rt){const ui=rt[Rt];mt(p.symbolInstances.get(ui),p.collisionArrays[ui],ui)}}else for(let rt=e.symbolInstanceStart;rt<e.symbolInstanceEnd;rt++)mt(p.symbolInstances.get(rt),p.collisionArrays[rt],rt);p.justReloaded=!1}storeCollisionData(e,r,c,p,y,T){if(c.textBox||c.iconBox){let C,I;this.collisionBoxArrays.has(e)?C=this.collisionBoxArrays.get(e):(C=new Map,this.collisionBoxArrays.set(e,C)),C.has(r)?I=C.get(r):(I={text:null,icon:null},C.set(r,I)),c.textBox&&(I.text=p.box),c.iconBox&&(I.icon=y.box)}if(T){let C=this.collisionCircleArrays[e];C===void 0&&(C=this.collisionCircleArrays[e]=[]);for(let I=0;I<T.circles.length;I+=4)C.push(T.circles[I+0]-Sa),C.push(T.circles[I+1]-Sa),C.push(T.circles[I+2]),C.push(T.collisionDetected?1:0)}}markUsedJustification(e,r,c,p){let y;y=p===h.al.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[h.aD(r)];const T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(e.text.placedSymbolArray.get(C).crossTileID=y>=0&&C!==y?0:c.crossTileID)}markUsedOrientation(e,r,c){const p=r===h.al.horizontal||r===h.al.horizontalOnly?r:0,y=r===h.al.vertical?r:0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const C of T)e.text.placedSymbolArray.get(C).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(e):1,y=r?r.opacities:{},T=r?r.variableOffsets:{},C=r?r.placedOrientations:{};for(const I in this.placements){const O=this.placements[I],k=y[I];k?(this.opacities[I]=new co(k,p,O.text,O.icon),c=c||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[I]=new co(null,p,O.text,O.icon,O.skipFade),c=c||O.text||O.icon)}for(const I in y){const O=y[I];if(!this.opacities[I]){const k=new co(O,p,!1,!1);k.isHidden()||(this.opacities[I]=k,c=c||O.text.placed||O.icon.placed)}}for(const I in T)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=T[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const c={};for(const p of r){const y=p.getBucket(e);y&&p.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,c,p.collisionBoxArray)}}updateBucketOpacities(e,r,c,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],T=y.layout,C=new co(null,0,!1,!1,!0),I=T.get("text-allow-overlap"),O=T.get("icon-allow-overlap"),k=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=T.get("text-rotation-alignment")==="map",z=T.get("text-pitch-alignment")==="map",G=T.get("icon-text-fit")!=="none",Y=new co(null,0,I&&(O||!e.hasIconData()||T.get("icon-optional")),O&&(I||!e.hasTextData()||T.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const ne=(re,le,me)=>{for(let pe=0;pe<le/4;pe++)re.opacityVertexArray.emplaceBack(me);re.hasVisibleVertices=re.hasVisibleVertices||me!==Ho},ae=this.collisionBoxArrays.get(e.bucketInstanceId);for(let re=0;re<e.symbolInstances.length;re++){const le=e.symbolInstances.get(re),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:pe,crossTileID:be}=le;let we=this.opacities[be];c[be]?we=C:we||(we=Y,this.opacities[be]=we),c[be]=!0;const xe=le.numIconVertices>0,ke=this.placedOrientations[le.crossTileID],Ke=ke===h.al.vertical,Ge=ke===h.al.horizontal||ke===h.al.horizontalOnly;if(me>0||pe>0){const $e=Nu(we.text);ne(e.text,me,Ke?Ho:$e),ne(e.text,pe,Ge?Ho:$e);const _t=we.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(Rt=>{Rt>=0&&(e.text.placedSymbolArray.get(Rt).hidden=_t||Ke?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=_t||Ge?1:0);const mt=this.variableOffsets[le.crossTileID];mt&&this.markUsedJustification(e,mt.anchor,le,ke);const rt=this.placedOrientations[le.crossTileID];rt&&(this.markUsedJustification(e,"left",le,rt),this.markUsedOrientation(e,rt,le))}if(xe){const $e=Nu(we.icon),_t=!(G&&le.verticalPlacedIconSymbolIndex&&Ke);le.placedIconSymbolIndex>=0&&(ne(e.icon,le.numIconVertices,_t?$e:Ho),e.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=we.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(ne(e.icon,le.numVerticalIconVertices,_t?Ho:$e),e.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const qe=ae&&ae.has(re)?ae.get(re):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const $e=e.collisionArrays[re];if($e){let _t=new h.P(0,0);if($e.textBox||$e.verticalTextBox){let mt=!0;if(k){const rt=this.variableOffsets[be];rt?(_t=$n(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),F&&_t._rotate(z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):mt=!1}if($e.textBox||$e.verticalTextBox){let rt;$e.textBox&&(rt=Ke),$e.verticalTextBox&&(rt=Ge),Il(e.textCollisionBox.collisionVertexArray,we.text.placed,!mt||rt,qe.text,_t.x,_t.y)}}if($e.iconBox||$e.verticalIconBox){const mt=!!(!Ge&&$e.verticalIconBox);let rt;$e.iconBox&&(rt=mt),$e.verticalIconBox&&(rt=!mt),Il(e.iconCollisionBox.collisionVertexArray,we.icon.placed,rt,qe.icon,G?_t.x:0,G?_t.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function Il(g,e,r,c,p,y){c&&c.length!==0||(c=[0,0,0,0]);const T=c[0]-Sa,C=c[1]-Sa,I=c[2]-Sa,O=c[3]-Sa;g.emplaceBack(e?1:0,r?1:0,p||0,y||0,T,C),g.emplaceBack(e?1:0,r?1:0,p||0,y||0,I,C),g.emplaceBack(e?1:0,r?1:0,p||0,y||0,I,O),g.emplaceBack(e?1:0,r?1:0,p||0,y||0,T,O)}const vd=Math.pow(2,25),Uo=Math.pow(2,24),cr=Math.pow(2,17),Td=Math.pow(2,16),Uf=Math.pow(2,9),bc=Math.pow(2,8),wh=Math.pow(2,1);function Nu(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,r=Math.floor(127*g.opacity);return r*vd+e*Uo+r*cr+e*Td+r*Uf+e*bc+r*wh+e}const Ho=0;class Xn{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,c,p,y){const T=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(T,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<T.length;)if(r.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,y())return!0;return!1}}class xc{constructor(e,r,c,p,y,T,C,I){this.placement=new yc(e,r,T,C,I),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,r,c){const p=Ae.now(),y=()=>!this._forceFullPlacement&&Ae.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=r[e[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Xn(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const fo=512/h.Z/2;class Dl{constructor(e,r,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const p=new Map;for(let y=0;y<r.length;y++){const T=r.get(y),C=T.key,I=p.get(C);I?I.push(T):p.set(C,[T])}for(const[y,T]of p){const C={positions:T.map(I=>({x:Math.floor(I.anchorX*fo),y:Math.floor(I.anchorY*fo)})),crossTileIDs:T.map(I=>I.crossTileID)};if(C.positions.length>128){const I=new h.aF(C.positions.length,16,Uint16Array);for(const{x:O,y:k}of C.positions)I.add(O,k);I.finish(),delete C.positions,C.index=I}this._symbolsByKey[y]=C}}getScaledCoordinates(e,r){const{x:c,y:p,z:y}=this.tileID.canonical,{x:T,y:C,z:I}=r.canonical,O=fo/Math.pow(2,I-y),k=(C*h.Z+e.anchorY)*O,F=p*h.Z*fo;return{x:Math.floor((T*h.Z+e.anchorX)*O-c*h.Z*fo),y:Math.floor(k-F)}}findMatches(e,r,c){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let y=0;y<e.length;y++){const T=e.get(y);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const I=this.getScaledCoordinates(T,r);if(C.index){const O=C.index.range(I.x-p,I.y-p,I.x+p,I.y+p).sort();for(const k of O){const F=C.crossTileIDs[k];if(!c[F]){c[F]=!0,T.crossTileID=F;break}}}else if(C.positions)for(let O=0;O<C.positions.length;O++){const k=C.positions[O],F=C.crossTileIDs[O];if(Math.abs(k.x-I.x)<=p&&Math.abs(k.y-I.y)<=p&&!c[F]){c[F]=!0,T.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ku{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const c in this.indexes){const p=this.indexes[c],y={};for(const T in p){const C=p[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+r),y[C.tileID.key]=C}this.indexes[c]=y}this.lng=e}addBucket(e,r,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<r.symbolInstances.length;y++)r.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>e.overscaledZ)for(const C in T){const I=T[C];I.tileID.isChildOf(e)&&I.findMatches(r.symbolInstances,e,p)}else{const C=T[e.scaledTo(Number(y)).key];C&&C.findMatches(r.symbolInstances,e,p)}}for(let y=0;y<r.symbolInstances.length;y++){const T=r.symbolInstances.get(y);T.crossTileID||(T.crossTileID=c.generate(),p[T.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dl(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const c of r.getCrossTileIDsLists())for(const p of c)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let r=!1;for(const c in this.indexes){const p=this.indexes[c];for(const y in p)e[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[y]),delete p[y],r=!0)}return r}}class zu{constructor(){this.layerIndexes={},this.crossTileIDs=new ku,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,c){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new Bu);let y=!1;const T={};p.handleWrapJump(c);for(const C of r){const I=C.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(C.tileID,I,this.crossTileIDs)&&(y=!0),T[I.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(e){const r={};e.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var po="void main() {fragColor=vec4(1.0);}";const Nn={prelude:vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:vi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:vi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:vi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:vi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:vi(po,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:vi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:vi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:vi(po,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:vi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:vi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:vi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:vi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:vi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:vi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:vi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:vi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:vi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:vi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:vi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function vi(g,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(p):p,C={};return{fragmentSource:g=g.replace(r,(I,O,k,F,z)=>(C[z]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${k} ${F} ${z};
#else
uniform ${k} ${F} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${k} ${F} ${z} = u_${z};
#endif
`)),vertexSource:e=e.replace(r,(I,O,k,F,z)=>{const G=F==="float"?"vec2":"vec4",Y=z.match(/color/)?"color":G;return C[z]?O==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${k} ${G} a_${z};
out ${k} ${F} ${z};
#else
uniform ${k} ${F} u_${z};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${k} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${Y}(a_${z}, u_${z}_t);
#else
    ${k} ${F} ${z} = u_${z};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${k} ${G} a_${z};
#else
uniform ${k} ${F} u_${z};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${k} ${F} ${z} = a_${z};
#else
    ${k} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${k} ${F} ${z} = unpack_mix_${Y}(a_${z}, u_${z}_t);
#else
    ${k} ${F} ${z} = u_${z};
#endif
`}),staticAttributes:c,staticUniforms:T}}class jo{constructor(e,r,c){this.vertexBuffer=e,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var fn=h.aG([{name:"a_pos",type:"Int16",components:2}]);const qo="#define PROJECTION_MERCATOR",xi="mercator";class mo{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return xi}get shaderDefine(){return qo}get shaderPreludeCode(){return Nn.projectionMercator}get vertexShaderPreludeCode(){return Nn.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,c,p,y){if(this._cachedMesh)return this._cachedMesh;const T=new h.aI;T.emplaceBack(0,0),T.emplaceBack(h.Z,0),T.emplaceBack(0,h.Z),T.emplaceBack(h.Z,h.Z);const C=e.createVertexBuffer(T,fn.members),I=h.aJ.simpleSegment(0,0,4,2),O=new h.aK;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3);const k=e.createIndexBuffer(O);return this._cachedMesh=new jo(C,k,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Vo{constructor(e=0,r=0,c=0,p=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=c,this.right=p}interpolate(e,r,c){return r.top!=null&&e.top!=null&&(this.top=h.B.number(e.top,r.top,c)),r.bottom!=null&&e.bottom!=null&&(this.bottom=h.B.number(e.bottom,r.bottom,c)),r.left!=null&&e.left!=null&&(this.left=h.B.number(e.left,r.left,c)),r.right!=null&&e.right!=null&&(this.right=h.B.number(e.right,r.right,c)),this}getCenter(e,r){const c=h.ae((this.left+e-this.right)/2,0,e),p=h.ae((this.top+r-this.bottom)/2,0,r);return new h.P(c,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function go(g,e){if(!g.renderWorldCopies||g.lngRange)return;const r=e.lng-g.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Xa(g){return Math.max(0,Math.floor(g))}class Ca{constructor(e,r,c,p,y,T){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Xa(this._zoom),this._scale=h.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Vo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,c){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Xa(this._zoom),this._scale=h.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Vo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=h.aL(e,-180,180)*Math.PI/180;var c,p,y,T,C,I,O,k,F;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=Q(),c=this._rotationMatrix,y=-this._bearingInRadians,T=(p=this._rotationMatrix)[0],C=p[1],I=p[2],O=p[3],k=Math.sin(y),F=Math.cos(y),c[0]=T*F+I*k,c[1]=C*F+O*k,c[2]=T*-k+I*F,c[3]=C*-k+O*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=h.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aM(this._fovInRadians)}setFov(e){e=h.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=h.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=h.ac(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,c){this._unmodified=!1,this._edgeInsets.interpolate(e,r,c),this._constrain(),this._calcMatrices()}resize(e,r,c=!0){this._width=e,this._height=r,c&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Hi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,h.af])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{let c=e.x,p=e.y,y=e.x,T=e.y;for(const C of r)c=Math.min(c,C.x),p=Math.min(p,C.y),y=Math.max(y,C.x),T=Math.max(T,C.y);return[new h.P(c,p),new h.P(y,p),new h.P(y,T),new h.P(c,T),new h.P(c,p)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:c}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=h.ad(new Float64Array(16));h.M(e,e,[this._width/2,-this._height/2,1]),h.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=h.ad(new Float64Array(16)),h.M(e,e,[1,-1,1]),h.L(e,e,[-1,-1,0]),h.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,c,p){const y=c!==void 0?c:this.bearing,T=p=p!==void 0?p:this.pitch,C=h.$.fromLngLat(e,r),I=-Math.cos(h.ab(T)),O=Math.sin(h.ab(T)),k=O*Math.sin(h.ab(y)),F=-O*Math.cos(h.ab(y));let z=this.elevation;const G=r-z;let Y;I*G>=0||Math.abs(I)<.1?(Y=1e4,z=r+Y*I):Y=-G/I;let ne,ae,re=h.aN(1,C.y),le=0;do{if(le+=1,le>10)break;ae=Y/re,ne=new h.$(C.x+k*ae,C.y+F*ae),re=1/ne.meterInMercatorCoordinateUnits()}while(Math.abs(Y-ae*re)>1e-12);return{center:ne.toLngLat(),elevation:z,zoom:h.ah(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=h.ag(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,p=h.$.fromLngLat(this.center,this.elevation),y=K(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;const T=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),h.aN(y.z,p.y),this.bearing,this.pitch);this._elevation=T.elevation,this._center=T.center,this.setZoom(T.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=h.ag(1,this.center.lat)*this.worldSize;return K(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/h.Z,1/r/h.Z]}}class Ma{constructor(e,r){this.min=e,this.max=r,this.center=h.aO([],h.aP([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],c=h.aQ(this.min),p=h.aQ(this.max);for(let y=0;y<r.length;y++)c[y]=r[y]?this.min[y]:this.center[y],p[y]=r[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Ma(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let c=0;c<e.planes.length;c++){const p=this.intersectsPlane(e.planes[c]);if(p===0)return 0;p===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],c=e[3];for(let p=0;p<3;p++)e[p]>0?(r+=e[p]*this.min[p],c+=e[p]*this.max[p]):(c+=e[p]*this.min[p],r+=e[p]*this.max[p]);return r>=0?2:c<0?0:1}}class Qa{distanceToTile2d(e,r,c,p){const y=p.distanceX([e,r]),T=p.distanceY([e,r]);return Math.hypot(y,T)}getWrap(e,r,c){return c}getTileAABB(e,r,c,p){var y,T;let C=c,I=c;if(p.terrain){const k=new h.Y(e.z,r,e.z,e.x,e.y),F=p.terrain.getMinMaxElevation(k);C=(y=F.minElevation)!==null&&y!==void 0?y:c,I=(T=F.maxElevation)!==null&&T!==void 0?T:c}const O=1<<e.z;return new Ma([r+e.x/O,e.y/O,C],[r+(e.x+1)/O,(e.y+1)/O,I])}allowVariableZoom(e,r){const c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=h.ae(78.5-c/2,0,60);return!!r.terrain||e.pitch>p}allowWorldCopies(){return!0}recalculateCache(){}}class Ji{constructor(e,r,c){this.points=e,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(e,r=1,c=0){const p=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const k=1/(O=h.at([],O,e))[3]/r*p;return h.aR(O,O,[k,k,1/O[3],k])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const k=h.aS([],y[O[0]],y[O[1]]),F=h.aS([],y[O[2]],y[O[1]]),z=h.aT([],h.aU([],k,F)),G=-h.aV(z,y[O[1]]);return z.concat(G)}),C=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],I=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const O of y)for(let k=0;k<3;k++)C[k]=Math.min(C[k],O[k]),I[k]=Math.max(I[k],O[k]);return new Ji(y,T,new Ma(C,I))}}class ns{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,c,p,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ca({calcMatrices:()=>{this._calcMatrices()},getConstrained:(T,C)=>this.getConstrained(T,C)},e,r,c,p,y),this._coveringTilesDetailsProvider=new Qa}clone(){const e=new ns;return e.apply(this),e}apply(e,r,c){this._helper.apply(e,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new h.aW(0,e)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new h.P(0,0)),p=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),C=Math.floor(Math.min(c.x,p.x,y.x,T.x)),I=Math.floor(Math.max(c.x,p.x,y.x,T.x)),O=1;for(let k=C-O;k<=I+O;k++)k!==0&&r.push(new h.aW(k,e))}return r}getCameraFrustum(){return Ji.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,r){const c=h.ag(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(r,c),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),T=h.$.fromLngLat(e),C=new h.$(T.x-(p.x-y.x),T.y-(p.y-y.y));this.setCenter(C==null?void 0:C.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(h.$.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(h.$.fromLngLat(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const c=r||0,p=[e.x,e.y,0,1],y=[e.x,e.y,1,1];h.at(p,p,this._pixelMatrixInverse),h.at(y,y,this._pixelMatrixInverse);const T=p[3],C=y[3],I=p[1]/T,O=y[1]/C,k=p[2]/T,F=y[2]/C,z=k===F?0:(c-k)/(F-k);return new h.$(h.B.number(p[0]/T,y[0]/C,z)/this.worldSize,h.B.number(I,O,z)/this.worldSize,c)}coordinatePoint(e,r=0,c=this._pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,r,1];return h.at(p,p,c),new h.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this._helper._height/2-De(this));return new Hi().extend(this.screenPointToLocation(new h.P(0,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-De(this)}calculatePosMatrix(e,r=!1,c){var p;const y=(p=e.key)!==null&&p!==void 0?p:h.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),T=r?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(y)){const O=T.get(y);return c?O.f32:O.f64}const C=X(e,this.worldSize);h.N(C,r?this._alignedProjMatrix:this._viewProjMatrix,C);const I={f64:C,f32:new Float32Array(C)};return T.set(y,I),c?I.f32:I.f64}calculateFogMatrix(e){const r=e.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const p=X(e,this.worldSize);return h.N(p,this._fogMatrix,p),c.set(r,new Float32Array(p)),c.get(r)}getConstrained(e,r){r=h.ae(+r,this.minZoom,this.maxZoom);const c={center:new h.Q(e.lng,e.lat),zoom:r};let p=this._helper._lngRange;this._helper._renderWorldCopies||p!==null||(p=[-179.9999999999,180-1e-10]);const y=this.tileSize*h.ac(c.zoom);let T=0,C=y,I=0,O=y,k=0,F=0;const{x:z,y:G}=this.size;if(this._helper._latRange){const me=this._helper._latRange;T=h.S(me[1])*y,C=h.S(me[0])*y,C-T<G&&(k=G/(C-T))}p&&(I=h.aL(h.U(p[0])*y,0,y),O=h.aL(h.U(p[1])*y,0,y),O<I&&(O+=y),O-I<z&&(F=z/(O-I)));const{x:Y,y:ne}=dn(y,e);let ae,re;const le=Math.max(F||0,k||0);if(le){const me=new h.P(F?(O+I)/2:Y,k?(C+T)/2:ne);return c.center=or(y,me).wrap(),c.zoom+=h.ah(le),c}if(this._helper._latRange){const me=G/2;ne-me<T&&(re=T+me),ne+me>C&&(re=C-me)}if(p){const me=(I+O)/2;let pe=Y;this._helper._renderWorldCopies&&(pe=h.aL(Y,me-y/2,me+y/2));const be=z/2;pe-be<I&&(ae=I+be),pe+be>O&&(ae=O-be)}if(ae!==void 0||re!==void 0){const me=new h.P(ae??Y,re??ne);c.center=or(y,me).wrap()}return c}calculateCenterFromCameraLngLatAlt(e,r,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,p)}_calculateNearFarZIfNeeded(e,r,c){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=e-p*this._helper._pixelPerMeter/Math.cos(r),T=p<0?y:e,C=Math.PI/2+this.pitchInRadians,I=h.ab(this.fov)*(Math.abs(Math.cos(h.ab(this.roll)))*this.height+Math.abs(Math.sin(h.ab(this.roll)))*this.width)/this.height*(.5+c.y/this.height),O=Math.sin(I)*T/Math.sin(h.ae(Math.PI-C-I,.01,Math.PI-.01)),k=De(this),F=Math.atan(k/this._helper.cameraToCenterDistance),z=h.ab(.75),G=F>z?2*F*(.5+c.y/(2*k)):z,Y=Math.sin(G)*T/Math.sin(h.ae(Math.PI-C-G,.01,Math.PI-.01)),ne=Math.min(O,Y);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*ne+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=dn(this.worldSize,this.center),c=r.x,p=r.y;this._helper._pixelPerMeter=h.ag(1,this.center.lat)*this.worldSize;const y=h.ab(Math.min(this.pitch,Ar)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let C;this._calculateNearFarZIfNeeded(T,y,e),C=new Float64Array(16),h.aY(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.an(this._invProjMatrix,C),C[8]=2*-e.x/this._helper._width,C[9]=2*e.y/this._helper._height,this._projectionMatrix=h.aZ(C),h.M(C,C,[1,-1,1]),h.L(C,C,[0,0,-this._helper.cameraToCenterDistance]),h.a_(C,C,-this.rollInRadians),h.a$(C,C,this.pitchInRadians),h.a_(C,C,-this.bearingInRadians),h.L(C,C,[-c,-p,0]),this._mercatorMatrix=h.M([],C,[this.worldSize,this.worldSize,this.worldSize]),h.M(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),h.L(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=h.an([],C);const I=[0,0,-1,1];h.at(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),h.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,h.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.L(this._fogMatrix,this._fogMatrix,[-c,-p,0]),h.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const O=this._helper._width%2/2,k=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),z=Math.sin(-this.bearingInRadians),G=c-Math.round(c)+F*O+z*k,Y=p-Math.round(p)+F*k+z*O,ne=new Float64Array(C);if(h.L(ne,ne,[G>.5?G-1:G,Y>.5?Y-1:Y,0]),this._alignedProjMatrix=ne,C=h.an(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new h.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.at(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=h.ag(1,this.center.lat)*this.worldSize;return K(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const c=h.$.fromLngLat(e),p=[c.x*this.worldSize,c.y*this.worldSize,r,1];return h.at(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:p}=e,y=this._helper.getMercatorTileCoordinates(r),T=r?this.calculatePosMatrix(r,c,!0):null;let C;return C=r&&r.terrainRttPosMatrix32f&&p?r.terrainRttPosMatrix32f:T||h.b0(),{mainMatrix:C,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,c){return 1}transformLightDirection(e){return h.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,c,p){const y=this.calculatePosMatrix(c);let T;p?(T=[e,r,p(e,r),1],h.at(T,T,y)):(T=[e,r,0,1],lo(T,T,y));const C=T[3];return{point:new h.P(T[0]/C,T[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const c=h.$.fromLngLat(e,r),p=c.meterInMercatorCoordinateUnits(),y=h.b1();return h.L(y,y,[c.x,c.y,c.z]),h.a_(y,y,Math.PI),h.a$(y,y,Math.PI/2),h.M(y,y,[-p,p,p]),y}getProjectionDataForCustomLayer(e=!0){const r=new h.Y(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),p=X(r,this.worldSize);h.N(p,this._viewProjMatrix,p),c.tileMercatorCoords=[0,0,1,1];const y=[h.Z,h.Z,this.worldSize/this._helper.pixelsPerMeter],T=h.b2();return h.M(T,p,y),c.fallbackMatrix=T,c.mainMatrix=T,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function va(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function kn(g){if(g.useSlerp)if(g.k<1){const e=h.b3(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),r=h.b3(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);h.b4(c,e,r,g.k);const p=h.b5(c);g.tr.setRoll(p.roll),g.tr.setPitch(p.pitch),g.tr.setBearing(p.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(h.B.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(h.B.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(h.B.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function nn(g,e,r,c,p){const y=p.padding,T=dn(p.worldSize,r.getNorthWest()),C=dn(p.worldSize,r.getNorthEast()),I=dn(p.worldSize,r.getSouthEast()),O=dn(p.worldSize,r.getSouthWest()),k=h.ab(-c),F=T.rotate(k),z=C.rotate(k),G=I.rotate(k),Y=O.rotate(k),ne=new h.P(Math.max(F.x,z.x,Y.x,G.x),Math.max(F.y,z.y,Y.y,G.y)),ae=new h.P(Math.min(F.x,z.x,Y.x,G.x),Math.min(F.y,z.y,Y.y,G.y)),re=ne.sub(ae),le=(p.width-(y.left+y.right+e.left+e.right))/re.x,me=(p.height-(y.top+y.bottom+e.top+e.bottom))/re.y;if(me<0||le<0)return void va();const pe=Math.min(h.ah(p.scale*Math.min(le,me)),g.maxZoom),be=h.P.convert(g.offset),we=new h.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(h.ab(c)),xe=be.add(we).mult(p.scale/h.ac(pe));return{center:or(p.worldSize,T.add(I).div(2).sub(xe)),zoom:pe,bearing:c}}class Sr{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,c){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,r,c,p,y){return nn(e,r,c,p,y)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(h.Q.convert(r.center))}handleEaseTo(e,r){const c=e.zoom,p=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},C=r.zoom!==void 0,I=!e.isPaddingEqual(r.padding);let O=!1;const k=C?+r.zoom:e.zoom;let F=e.centerPoint.add(r.offsetAsPoint);const z=e.screenPointToLocation(F),{center:G,zoom:Y}=e.getConstrained(h.Q.convert(r.center||z),k??c);go(e,G);const ne=dn(e.worldSize,z),ae=dn(e.worldSize,G).sub(ne),re=h.ac(Y-c);return O=Y!==c,{easeFunc:le=>{if(O&&e.setZoom(h.B.number(c,Y,le)),h.b6(y,T)||kn({startEulerAngles:y,endEulerAngles:T,tr:e,k:le,useSlerp:y.roll!=T.roll}),I&&(e.interpolatePadding(p,r.padding,le),F=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const me=h.ac(e.zoom-c),pe=Y>c?Math.min(2,re):Math.max(.5,re),be=Math.pow(pe,1-le),we=or(e.worldSize,ne.add(ae.mult(le*be)).mult(me));e.setLocationAtPoint(e.renderWorldCopies?we.wrap():we,F)}},isZooming:O,elevationCenter:G}}handleFlyTo(e,r){const c=r.zoom!==void 0,p=e.zoom,y=e.getConstrained(h.Q.convert(r.center||r.locationAtOffset),c?+r.zoom:p),T=y.center,C=y.zoom;go(e,T);const I=dn(e.worldSize,r.locationAtOffset),O=dn(e.worldSize,T).sub(I),k=O.mag(),F=h.ac(C-p);let z;if(r.minZoom!==void 0){const G=Math.min(+r.minZoom,p,C),Y=e.getConstrained(T,G).zoom;z=h.ac(Y-p)}return{easeFunc:(G,Y,ne,ae)=>{e.setZoom(G===1?C:p+h.ah(Y));const re=G===1?T:or(e.worldSize,I.add(O.mult(ne)).mult(Y));e.setLocationAtPoint(e.renderWorldCopies?re.wrap():re,ae)},scaleOfZoom:F,targetCenter:T,scaleOfMinZoom:z,pixelPathLength:k}}}class Ni{constructor(e,r,c){this.blendFunction=e,this.blendColor=r,this.mask=c}}Ni.Replace=[1,0],Ni.disabled=new Ni(Ni.Replace,h.b7.transparent,[!1,!1,!1,!1]),Ni.unblended=new Ni(Ni.Replace,h.b7.transparent,[!0,!0,!0,!0]),Ni.alphaBlended=new Ni([1,771],h.b7.transparent,[!0,!0,!0,!0]);const ra=2305;class mi{constructor(e,r,c){this.enable=e,this.mode=r,this.frontFace=c}}mi.disabled=new mi(!1,1029,ra),mi.backCCW=new mi(!0,1029,ra),mi.frontCCW=new mi(!0,1028,ra);class Qt{constructor(e,r,c){this.func=e,this.mask=r,this.range=c}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Ps=7680;class oi{constructor(e,r,c,p,y,T){this.test=e,this.ref=r,this.mask=c,this.fail=p,this.depthFail=y,this.pass=T}}oi.disabled=new oi({func:519,mask:0},0,0,Ps,Ps,Ps);const pn=new WeakMap;function Ia(g){var e;if(pn.has(g))return pn.get(g);{const r=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return pn.set(g,r),r}}class Fu{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const p=new h.aI;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const y=new h.aK;y.emplaceBack(0,1,2),this._fullscreenTriangle=new jo(r.createVertexBuffer(p,fn.members),r.createIndexBuffer(y),h.aJ.simpleSegment(0,0,p.length,y.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const T=c.createTexture();c.bindTexture(c.TEXTURE_2D,T),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),Ia(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const c=this._cachedRenderContext.context,p=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:h.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,p.TRIANGLES,Qt.disabled,oi.disabled,Ni.unblended,mi.disabled,((y,T)=>({u_input:y,u_output_expected:T}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ia(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const y=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ia(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fu._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const Go=h.Z/128;function Rl(g,e){const r=g.granularity!==void 0?Math.max(g.granularity,1):1,c=r+(g.generateBorders?2:0),p=r+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),y=c+1,T=p+1,C=g.generateBorders?-1:0,I=g.generateBorders||g.extendToNorthPole?-1:0,O=r+(g.generateBorders?1:0),k=r+(g.generateBorders||g.extendToSouthPole?1:0),F=y*T,z=c*p*6,G=y*T>65536;if(G&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Y=G||e==="32bit",ne=new Int16Array(2*F);let ae=0;for(let me=I;me<=k;me++)for(let pe=C;pe<=O;pe++){let be=pe/r*h.Z;pe===-1&&(be=-64),pe===r+1&&(be=h.Z+Go);let we=me/r*h.Z;me===-1&&(we=g.extendToNorthPole?h.b9:-64),me===r+1&&(we=g.extendToSouthPole?h.ba:h.Z+Go),ne[ae++]=be,ne[ae++]=we}const re=Y?new Uint32Array(z):new Uint16Array(z);let le=0;for(let me=0;me<p;me++)for(let pe=0;pe<c;pe++){const be=pe+1+me*y,we=pe+(me+1)*y,xe=pe+1+(me+1)*y;re[le++]=pe+me*y,re[le++]=we,re[le++]=be,re[le++]=be,re[le++]=we,re[le++]=xe}return{vertices:ne.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Y}}const _o=new h.aH({fill:new h.bb(128,2),line:new h.bb(512,0),tile:new h.bb(128,32),stencil:new h.bb(128,1),circle:3});class Zo{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Nn.projectionGlobe}get vertexShaderPreludeCode(){return Nn.projectionMercator.vertexSource}get subdivisionGranularity(){return _o}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Fu(e));const r=h.S(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(r,c),y=Ae.now();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=y);const T=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bd(T))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,c,p,y){const T=(y==="stencil"?_o.stencil:_o.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:T,generateBorders:c,extendToNorthPole:r.y===0&&p,extendToSouthPole:r.y===(1<<r.z)-1&&p})}_getMesh(e,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const p=function(y,T){const C=Rl(T,"16bit"),I=h.aI.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),O=h.aK.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new jo(y.createVertexBuffer(I,fn.members),y.createIndexBuffer(O),h.aJ.simpleSegment(0,0,I.length,O.length))}(e,r);return this._tileMeshCache[c]=p,p}recalculate(e){}hasTransition(){const e=Ae.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Yo=new h.r({type:new h.D(h.v.projection.type)});class $o extends h.E{constructor(e){super(),this._transitionable=new h.T(Yo),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.C(0)),this._mercatorProjection=new mo,this._verticalPerspectiveProjection=new Zo}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof h.be){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,c,p,y){return this.currentProjection.getMeshFromTileID(e,r,c,p,y)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Uu(g){const e=Qo(g.worldSize,g.center.lat);return 2*Math.PI*e}function Xo(g,e,r,c,p){const y=1/(1<<p),T=e/h.Z*y+c*y,C=h.bg((g/h.Z*y+r*y)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,O=Math.cos(I),k=new Float64Array(3);return k[0]=Math.sin(C)*O,k[1]=Math.sin(I),k[2]=Math.cos(C)*O,k}function rn(g){return function(e,r){const c=Math.cos(r),p=new Float64Array(3);return p[0]=Math.sin(e)*c,p[1]=Math.sin(r),p[2]=Math.cos(e)*c,p}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function Qo(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ko(g){const e=Math.asin(g[1])/Math.PI*180,r=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(r>1e-6){const c=g[0]/r,p=Math.acos(g[2]/r),y=(c>0?p:-p)/Math.PI*180;return new h.Q(h.aL(y,-180,180),e)}return new h.Q(0,e)}function yo(g){return Math.cos(g*Math.PI/180)}function sn(g,e){const r=yo(g),c=yo(e);return h.ah(c/r)}function vc(g,e){const r=g.rotate(e.bearingInRadians),c=e.zoom+sn(e.center.lat,0),p=h.bc(1/yo(e.center.lat),1/yo(Math.min(Math.abs(e.center.lat),60)),h.bf(c,7,3,0,1)),y=360/Uu({worldSize:e.worldSize,center:{lat:e.center.lat}});return new h.Q(e.center.lng-r.x*y*p,h.ae(e.center.lat+r.y*y,-85.051129,h.af))}function Tc(g){const e=.5*g,r=Math.sin(e),c=Math.cos(e);return Math.log(r+c)-Math.log(c-r)}function Ed(g,e,r,c){const p=g.lat+r*c;if(Math.abs(r)>1){const y=(Math.sign(g.lat+r)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,T=Math.abs(g.lat+r)*Math.PI/180,C=Tc(y+c*(T-y)),I=Tc(y),O=Tc(T);return new h.Q(g.lng+e*((C-I)/(O-I)),p)}return new h.Q(g.lng+e*c,p)}class wd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,r,c,p){const y=`${e.z}_${e.x}_${e.y}`,T=this._cache.get(y);if(T)return T;const C=this._cachePrevious.get(y);if(C)return this._cache.set(y,C),C;const I=this._aabbFactory(e,r,c,p);return this._cache.set(y,I),this._hadAnyChanges=!0,I}}function vn(g,e,r){const c=g-e;return c<0?-c:Math.max(0,c-r)}function Pl(g,e,r,c,p){const y=g-r;let T;return T=y<0?Math.min(-y,1+y-p):y>1?Math.min(Math.max(y-p,0),1-y):0,Math.max(T,vn(e,c,p))}class rs{constructor(){this._aabbCache=new wd(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,r,c,p){const y=1<<c.z,T=1/y,C=c.x/y,I=c.y/y;let O=2;return O=Math.min(O,Pl(e,r,C,I,T)),O=Math.min(O,Pl(e,r,C+.5,-I-T,T)),O=Math.min(O,Pl(e,r,C+.5,2-I-T,T)),O}getWrap(e,r,c){const p=1<<r.z,y=1/p,T=r.x/p,C=vn(e.x,T,y),I=vn(e.x,T-1,y),O=vn(e.x,T+1,y),k=Math.min(C,I,O);return k===O?1:k===I?-1:0}allowVariableZoom(e,r){return Ne(e,r)>4}allowWorldCopies(){return!1}getTileAABB(e,r,c,p){return this._aabbCache.getTileAABB(e,r,c,p)}_computeTileAABB(e,r,c,p){if(e.z<=0)return new Ma([-1,-1,-1],[1,1,1]);if(e.z===1)return new Ma([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const y=[Xo(0,0,e.x,e.y,e.z),Xo(h.Z,0,e.x,e.y,e.z),Xo(h.Z,h.Z,e.x,e.y,e.z),Xo(0,h.Z,e.x,e.y,e.z)],T=[1,1,1],C=[-1,-1,-1];for(const I of y)for(let O=0;O<3;O++)T[O]=Math.min(T[O],I[O]),C[O]=Math.max(C[O],I[O]);if(e.y===0||e.y===(1<<e.z)-1){const I=[0,e.y===0?1:-1,0];for(let O=0;O<3;O++)T[O]=Math.min(T[O],I[O]),C[O]=Math.max(C[O],I[O])}return new Ma(T,C)}}}class Wo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=h.bk(),this._projectionMatrix=h.b1(),this._globeViewProjMatrix32f=h.b0(),this._globeViewProjMatrixNoCorrection=h.b1(),this._globeViewProjMatrixNoCorrectionInverted=h.b1(),this._globeProjMatrixInverted=h.b1(),this._cameraPosition=h.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ca({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new rs}clone(){const e=new Wo;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=h.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:c}=e,p=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,c=this.cameraToCenterDistance/e,p=Math.sin(r)*c,y=Math.cos(r)*c+1,T=1/Math.sqrt(p*p+y*y)*1;let C=-p,I=y;const O=Math.sqrt(C*C+I*I);C/=O,I/=O;const k=[0,C,I];h.bl(k,k,[0,0,0],-this.bearingInRadians),h.bm(k,k,[0,0,0],-1*this.center.lat*Math.PI/180),h.bn(k,k,[0,0,0],this.center.lng*Math.PI/180);const F=1/h.bo(k);return h.aO(k,k,F),[...k,-T*F]}isLocationOccluded(e){return!this.isSurfacePointVisible(rn(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,p=Math.cos(c),y=[Math.sin(r)*p,Math.sin(c),Math.cos(r)*p],T=[y[2],0,-y[0]],C=[0,0,0];h.aU(C,T,y),h.aT(T,T),h.aT(C,C);const I=[0,0,0];return h.aT(I,[T[0]*e[0]+C[0]*e[1]+y[0]*e[2],T[1]*e[0]+C[1]*e[1]+y[1]*e[2],T[2]*e[0]+C[2]*e[1]+y[2]*e[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,c){const p=function(C,I,O){const k=1/(1<<O.z);return new h.$(C/h.Z*k+O.x*k,I/h.Z*k+O.y*k)}(e,r,c.canonical),y=(T=p.y,[h.bg(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(e,r,c,p){const y=c.canonical,T=Xo(e,r,y.x,y.y,y.z),C=1+(p?p(e,r):0)/h.bu,I=[T[0]*C,T[1]*C,T[2]*C,1];h.at(I,I,this._globeViewProjMatrixNoCorrection);const O=this._cachedClippingPlane,k=O[0]*T[0]+O[1]*T[1]+O[2]*T[2]+O[3]<0;return{point:new h.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:k}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Qo(this.worldSize,this.center.lat),r=h.b2(),c=h.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),h.aY(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;r[8]=2*-p.x/this._helper._width,r[9]=2*p.y/this._helper._height,this._projectionMatrix=h.aZ(r),this._globeProjMatrixInverted=h.b2(),h.an(this._globeProjMatrixInverted,r),h.L(r,r,[0,0,-this.cameraToCenterDistance]),h.a_(r,r,this.rollInRadians),h.a$(r,r,-this.pitchInRadians),h.a_(r,r,this.bearingInRadians),h.L(r,r,[0,0,-e]);const y=h.bh();y[0]=e,y[1]=e,y[2]=e,h.a$(c,r,this.center.lat*Math.PI/180),h.bp(c,c,-this.center.lng*Math.PI/180),h.M(c,c,y),this._globeViewProjMatrixNoCorrection=c,h.a$(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bp(r,r,-this.center.lng*Math.PI/180),h.M(r,r,y),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=h.b2(),h.an(this._globeViewProjMatrixNoCorrectionInverted,c);const T=h.bh();this._cameraPosition=h.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,h.bl(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),h.bm(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),h.bl(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),h.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bm(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),h.bn(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const C=h.aZ(this._globeViewProjMatrixNoCorrectionInverted);h.M(C,C,[1,1,-1]),this._cachedFrustum=Ji.fromInvProjectionMatrix(C)}calculateFogMatrix(e){h.w("calculateFogMatrix is not supported on globe projection.");const r=h.b2();return h.ad(r),r}getVisibleUnwrappedCoordinates(e){return[new h.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=rn(e);h.aO(c,c,1+r/h.bu);const p=h.bk();return h.at(p,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,c=[new h.P(0,0),new h.P(e,0),new h.P(this.width,0),new h.P(this.width,r),new h.P(this.width,this.height),new h.P(e,this.height),new h.P(0,this.height),new h.P(0,r)],p=[];for(const F of c)p.push(this.unprojectScreenPoint(F));let y=0,T=0,C=0,I=0;const O=this.center;for(const F of p){const z=h.bq(O.lng,F.lng),G=h.bq(O.lat,F.lat);z<T&&(T=z),z>y&&(y=z),G<I&&(I=G),G>C&&(C=G)}const k=[O.lng+T,O.lat+I,O.lng+y,O.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(k[3]=90,k[0]=-180,k[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(k[1]=-90,k[0]=-180,k[2]=180),new Hi(k)}getConstrained(e,r){const c=h.ae(e.lat,-85.051129,h.af),p=h.ae(+r,this.minZoom+sn(0,c),this.maxZoom);return{center:new h.Q(e.lng,c),zoom:p}}calculateCenterFromCameraLngLatAlt(e,r,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,p)}setLocationAtPoint(e,r){const c=rn(this.unprojectScreenPoint(r)),p=rn(e),y=h.bh();h.br(y);const T=h.bh();h.bn(T,c,y,-this.center.lng*Math.PI/180),h.bm(T,T,y,this.center.lat*Math.PI/180);const C=p[0]*p[0]+p[2]*p[2],I=T[0]*T[0];if(C<I)return;const O=Math.sqrt(C-I),k=-O,F=h.bs(p[0],p[2],T[0],O),z=h.bs(p[0],p[2],T[0],k),G=h.bh();h.bn(G,p,y,-F);const Y=h.bs(G[1],G[2],T[1],T[2]),ne=h.bh();h.bn(ne,p,y,-z);const ae=h.bs(ne[1],ne[2],T[1],T[2]),re=.5*Math.PI,le=Y>=-re&&Y<=re,me=ae>=-re&&ae<=re;let pe,be;if(le&&me){const Ke=this.center.lng*Math.PI/180,Ge=this.center.lat*Math.PI/180;h.bv(F,Ke)+h.bv(Y,Ge)<h.bv(z,Ke)+h.bv(ae,Ge)?(pe=F,be=Y):(pe=z,be=ae)}else if(le)pe=F,be=Y;else{if(!me)return;pe=z,be=ae}const we=pe/Math.PI*180,xe=be/Math.PI*180,ke=this.center.lat;this.setCenter(new h.Q(we,h.ae(xe,-90,90))),this.setZoom(this.zoom+sn(ke,this.center.lat))}locationToScreenPoint(e,r){const c=rn(e);if(r){const p=r.getElevationForLngLatZoom(e,this._helper._tileZoom);h.aO(c,c,1+p/h.bu)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){const r=h.bk();return h.at(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new h.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c)return c}return h.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,r){const c=this._cameraPosition,p=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,p)}getRayDirectionFromPixel(e){const r=h.bk();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,h.at(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=h.bh();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const p=h.bh();return h.aT(p,c),p}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=h.bk();return h.at(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const c=h.aV(e,r),p=h.bh(),y=h.bh();h.aO(y,r,c),h.aS(p,e,y);const T=1-h.aV(p,p);if(T<0)return null;const C=h.aV(e,e)-1,I=-c+(c<0?1:-1)*Math.sqrt(T),O=C/I,k=I;return{tMin:Math.min(O,k),tMax:Math.max(O,k)}}unprojectScreenPoint(e){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(r,c);if(p){const k=h.bh();h.aP(k,r,[c[0]*p.tMin,c[1]*p.tMin,c[2]*p.tMin]);const F=h.bh();return h.aT(F,k),Ko(F)}const y=this._cachedClippingPlane,T=y[0]*c[0]+y[1]*c[1]+y[2]*c[2],C=-h.bt(y,r)/T,I=h.bh();if(C>0)h.aP(I,r,[c[0]*C,c[1]*C,c[2]*C]);else{const k=h.bh();h.aP(k,r,[2*c[0],2*c[1],2*c[2]]);const F=h.bt(this._cachedClippingPlane,k);h.aS(I,k,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const O=function(k){const F=h.bh();return F[0]=k[0]*-k[3],F[1]=k[1]*-k[3],F[2]=k[2]*-k[3],{center:F,radius:Math.sqrt(1-k[3]*k[3])}}(y);return Ko(function(k,F,z){const G=h.bh();h.aS(G,z,k);const Y=h.bh();return h.bi(Y,k,G,F/h.bj(G)),Y}(O.center,O.radius,I))}getMatrixForModel(e,r){const c=h.Q.convert(e),p=1/h.bu,y=h.b1();return h.bp(y,y,c.lng/180*Math.PI),h.a$(y,y,-c.lat/180*Math.PI),h.L(y,y,[0,0,1+r/h.bu]),h.a$(y,y,.5*Math.PI),h.M(y,y,[p,p,p]),y}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new h.Y(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Jo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ca({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new ns,this._verticalPerspectiveTransform=new Wo}clone(){const e=new Jo;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return h.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,c){const p=this._mercatorTransform.getPitchedTextCorrection(e,r,c),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,c);return h.bc(p,y,this._globeness)}projectTileCoordinates(e,r,c,p){return this.currentTransform.projectTileCoordinates(e,r,c,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,p)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Cr{get useGlobeControls(){return!0}handlePanInertia(e,r){const c=vc(e,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const c=e.around,p=r.screenPointToLocation(c);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const y=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const T=r.zoom-y;if(T===0)return;const C=h.bq(r.center.lng,p.lng),I=C/(Math.abs(C/180)+1),O=h.bq(r.center.lat,p.lat),k=r.getRayDirectionFromPixel(c),F=r.cameraPosition,z=-1*h.aV(F,k),G=h.bh();h.aP(G,F,[k[0]*z,k[1]*z,k[2]*z]);const Y=h.bo(G)-1,ne=Math.exp(.5*-Math.max(Y-.3,0)),ae=Qo(r.worldSize,r.center.lat)/Math.min(r.width,r.height),re=h.bf(ae,.9,.5,1,.25),le=(1-h.ac(-T))*Math.min(ne,re),me=r.center.lat,pe=r.zoom,be=new h.Q(r.center.lng+I*le,h.ae(r.center.lat+O*le,-85.051129,h.af));r.setLocationAtPoint(p,c);const we=r.center,xe=h.bf(Math.abs(C),45,85,0,1),ke=h.bf(ae,.75,.35,0,1),Ke=Math.pow(Math.max(xe,ke),.25),Ge=h.bq(we.lng,be.lng),qe=h.bq(we.lat,be.lat);r.setCenter(new h.Q(we.lng+Ge*Ke,we.lat+qe*Ke).wrap()),r.setZoom(pe+sn(me,r.center.lat))}handleMapControlsPan(e,r,c){if(!e.panDelta)return;const p=r.center.lat,y=r.zoom;r.setCenter(vc(e.panDelta,r).wrap()),r.setZoom(y+sn(p,r.center.lat))}cameraForBoxAndBearing(e,r,c,p,y){const T=nn(e,r,c,p,y),C=r.left/y.width*2-1,I=(y.width-r.right)/y.width*2-1,O=r.top/y.height*-2+1,k=(y.height-r.bottom)/y.height*-2+1,F=h.bq(c.getWest(),c.getEast())<0,z=F?c.getEast():c.getWest(),G=F?c.getWest():c.getEast(),Y=Math.max(c.getNorth(),c.getSouth()),ne=Math.min(c.getNorth(),c.getSouth()),ae=z+.5*h.bq(z,G),re=Y+.5*h.bq(Y,ne),le=y.clone();le.setCenter(T.center),le.setBearing(T.bearing),le.setPitch(0),le.setRoll(0),le.setZoom(T.zoom);const me=le.modelViewProjectionMatrix,pe=[rn(c.getNorthWest()),rn(c.getNorthEast()),rn(c.getSouthWest()),rn(c.getSouthEast()),rn(new h.Q(G,re)),rn(new h.Q(z,re)),rn(new h.Q(ae,Y)),rn(new h.Q(ae,ne))],be=rn(T.center);let we=Number.POSITIVE_INFINITY;for(const xe of pe)C<0&&(we=Cr.getLesserNonNegativeNonNull(we,Cr.solveVectorScale(xe,be,me,"x",C))),I>0&&(we=Cr.getLesserNonNegativeNonNull(we,Cr.solveVectorScale(xe,be,me,"x",I))),O>0&&(we=Cr.getLesserNonNegativeNonNull(we,Cr.solveVectorScale(xe,be,me,"y",O))),k<0&&(we=Cr.getLesserNonNegativeNonNull(we,Cr.solveVectorScale(xe,be,me,"y",k)));if(Number.isFinite(we)&&we!==0)return T.zoom=le.zoom+h.ah(we),T;va()}handleJumpToCenterZoom(e,r){const c=e.center.lat,p=e.getConstrained(r.center?h.Q.convert(r.center):e.center,e.zoom).center;e.setCenter(p.wrap());const y=r.zoom!==void 0?+r.zoom:e.zoom+sn(c,p.lat);e.zoom!==y&&e.setZoom(y)}handleEaseTo(e,r){const c=e.zoom,p=e.center,y=e.padding,T={roll:e.roll,pitch:e.pitch,bearing:e.bearing},C={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},I=r.zoom!==void 0,O=!e.isPaddingEqual(r.padding);let k=!1;const F=r.center?h.Q.convert(r.center):p,z=e.getConstrained(F,c).center;go(e,z);const G=e.clone();G.setCenter(z),G.setZoom(I?+r.zoom:c+sn(p.lat,F.lat)),G.setBearing(r.bearing);const Y=new h.P(h.ae(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.ae(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));G.setLocationAtPoint(z,Y);const ne=(r.offset&&r.offsetAsPoint.mag())>0?G.center:z,ae=I?+r.zoom:c+sn(p.lat,ne.lat),re=c+sn(p.lat,0),le=ae+sn(ne.lat,0),me=h.bq(p.lng,ne.lng),pe=h.bq(p.lat,ne.lat),be=h.ac(le-re);return k=ae!==c,{easeFunc:we=>{if(h.b6(T,C)||kn({startEulerAngles:T,endEulerAngles:C,tr:e,k:we,useSlerp:T.roll!=C.roll}),O&&e.interpolatePadding(y,r.padding,we),r.around)h.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const xe=le>re?Math.min(2,be):Math.max(.5,be),ke=Math.pow(xe,1-we),Ke=Ed(p,me,pe,we*ke);e.setCenter(Ke.wrap())}if(k){const xe=h.B.number(re,le,we)+sn(0,e.center.lat);e.setZoom(xe)}},isZooming:k,elevationCenter:ne}}handleFlyTo(e,r){const c=r.zoom!==void 0,p=e.center,y=e.zoom,T=e.padding,C=!e.isPaddingEqual(r.padding),I=e.getConstrained(h.Q.convert(r.center||r.locationAtOffset),y).center,O=c?+r.zoom:e.zoom+sn(e.center.lat,I.lat),k=e.clone();k.setCenter(I),k.setZoom(O),k.setBearing(r.bearing);const F=new h.P(h.ae(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.ae(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));k.setLocationAtPoint(I,F);const z=k.center;go(e,z);const G=function(pe,be,we){const xe=rn(be),ke=rn(we),Ke=h.aV(xe,ke),Ge=Math.acos(Ke),qe=Uu(pe);return Ge/(2*Math.PI)*qe}(e,p,z),Y=y+sn(p.lat,0),ne=O+sn(z.lat,0),ae=h.ac(ne-Y);let re;if(typeof r.minZoom=="number"){const pe=+r.minZoom+sn(z.lat,0),be=Math.min(pe,Y,ne)+sn(0,z.lat),we=e.getConstrained(z,be).zoom+sn(z.lat,0);re=h.ac(we-Y)}const le=h.bq(p.lng,z.lng),me=h.bq(p.lat,z.lat);return{easeFunc:(pe,be,we,xe)=>{const ke=Ed(p,le,me,we);C&&e.interpolatePadding(T,r.padding,pe);const Ke=pe===1?z:ke;e.setCenter(Ke.wrap());const Ge=Y+h.ah(be);e.setZoom(pe===1?O:Ge+sn(0,Ke.lat))},scaleOfZoom:ae,targetCenter:z,scaleOfMinZoom:re,pixelPathLength:G}}static solveVectorScale(e,r,c,p,y){const T=p==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],C=[c[3],c[7],c[11],c[15]],I=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],O=e[0]*C[0]+e[1]*C[1]+e[2]*C[2],k=r[0]*T[0]+r[1]*T[1]+r[2]*T[2],F=r[0]*C[0]+r[1]*C[1]+r[2]*C[2];return k+y*O===I+y*F||C[3]*(I-k)+T[3]*(F-O)+I*F==k*O?null:(k+T[3]-y*F-y*C[3])/(k-I-y*F+y*O)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class eu{constructor(e){this._globe=e,this._mercatorCameraHelper=new Sr,this._verticalPerspectiveCameraHelper=new Cr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,c){this.currentHelper.handleMapControlsPan(e,r,c)}cameraForBoxAndBearing(e,r,c,p,y){return this.currentHelper.cameraForBoxAndBearing(e,r,c,p,y)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const Ec=(g,e)=>h.x(g,e&&e.filter(r=>r.identifier!=="source.canvas")),Ad=h.bw();class Ah extends h.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const p=this.sourceCaches[c].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[c].reload()}},this.map=e,this.dispatcher=new si(Zt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,p)=>this.getGlyphs(c,p)),this.dispatcher.registerMessageHandler("GI",(c,p)=>this.getImages(c,p)),this.imageManager=new Kt,this.imageManager.setEventedParent(this),this.glyphManager=new zi(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new Ee(256,512),this.crossTileSymbolIndex=new zu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.by()),xn().on(Pu,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const p=this.sourceCaches[c.sourceId];if(!p)return;const y=p.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===y.id&&this._validateLayer(C)}})}loadURL(e,r={},c){this.fire(new h.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;h.j(p,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,r,c)}).catch(T=>{this._loadStyleRequest=null,T&&!y.signal.aborted&&this.fire(new h.k(T))})}loadJSON(e,r={},c){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ae.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,c)}).catch(()=>{})}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(Ad,{validate:!1})}_load(e,r,c){var p,y;const T=r.transformStyle?r.transformStyle(c,e):e;if(!r.validate||!Ec(this,h.y(T))){this._loaded=!0,this.stylesheet=T;for(const C in T.sources)this.addSource(C,T.sources[C],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new St(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new Ei(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){const e=h.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const c=h.bA(r);c.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=c}}_loadSprite(e,r=!1,c=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,T,C,I){return h._(this,void 0,void 0,function*(){const O=Oe(y),k=C>1?"@2x":"",F={},z={};for(const{id:G,url:Y}of O){const ne=T.transformRequest(pt(Y,k,".json"),"SpriteJSON");F[G]=h.j(ne,I);const ae=T.transformRequest(pt(Y,k,".png"),"SpriteImage");z[G]=et.getImage(ae,I)}return yield Promise.all([...Object.values(F),...Object.values(z)]),function(G,Y){return h._(this,void 0,void 0,function*(){const ne={};for(const ae in G){ne[ae]={};const re=Ae.getImageCanvasContext((yield Y[ae]).data),le=(yield G[ae]).data;for(const me in le){const{width:pe,height:be,x:we,y:xe,sdf:ke,pixelRatio:Ke,stretchX:Ge,stretchY:qe,content:$e,textFitWidth:_t,textFitHeight:mt}=le[me];ne[ae][me]={data:null,pixelRatio:Ke,sdf:ke,stretchX:Ge,stretchY:qe,content:$e,textFitWidth:_t,textFitHeight:mt,spriteData:{width:pe,height:be,x:we,y:xe,context:re}}}}return ne})}(F,z)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const T in y){this._spritesImagesIds[T]=[];const C=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(I=>!(I in y)):[];for(const I of C)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in y[T]){const O=T==="default"?I:`${T}:${I}`;this._spritesImagesIds[T].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,y[T][I],!1):this.imageManager.addImage(O,y[T][I]),r&&(this._changedImages[O]=!0)}}}).catch(y=>{this._spriteRequest=null,p=y,this.fire(new h.k(p))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),c&&c(p)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const c=e.sourceLayer;if(!c)return;const p=r.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new h.k(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?h.bB(c):c);const p=[];for(const y of e)if(c[y]){const T=r?h.bB(c[y]):c[y];p.push(T)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const p=this._layers[c];p.type!=="custom"&&(e[c]=p.serialize())}return e}hasTransitions(){var e,r,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];c[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in c){const y=this.sourceCaches[p];!!c[p]!=!!y.used&&y.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var c;this._checkLoaded();const p=this.serialize();if(e=r.transformStyle?r.transformStyle(p,e):e,((c=r.validate)===null||c===void 0||c)&&Ec(this,h.y(e)))return!1;(e=h.bB(e)).layers=h.bz(e.layers);const y=h.bC(p,e),T=this._getOperationsToPerform(y);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],c=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":r.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":r.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setSky":r.push(()=>this.setSky.apply(this,p.args));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setTransition":r.push(()=>{});break;default:c.push(p.command)}return{operations:r,unimplemented:c}}addImage(e,r){if(this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(h.y.source,`sources.${e}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=this.sourceCaches[e]=new Le(e,r,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new h.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,c={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new h.k(new Error(`Layer "${p}" already exists on this map.`)));let y;if(e.type==="custom"){if(Ec(this,h.bD(e)))return;y=h.bA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=h.bB(e),e=h.e(e,{source:p})),this._validate(h.y.layer,`layers.${p}`,e,{arrayIndex:-1},c))return;y=h.bA(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const T=r?this._order.indexOf(r):this._order.length;if(r&&T===-1)this.fire(new h.k(new Error(`Cannot add layer "${p}" before non-existing layer "${r}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const C=this._removedLayers[p];delete this._removedLayers[p],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const c=this._order.indexOf(e);this._order.splice(c,1);const p=r?this._order.indexOf(r):this._order.length;r&&p===-1?this.fire(new h.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,c){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===r&&p.maxzoom===c||(r!=null&&(p.minzoom=r),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,c={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!h.bE(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(h.y.filter,`layers.${p.id}.filter`,r,null,c)||(p.filter=h.bB(r),this._updateLayer(p)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.bB(this.getLayer(e).filter)}setLayoutProperty(e,r,c,p={}){this._checkLoaded();const y=this.getLayer(e);y?h.bE(y.getLayoutProperty(r),c)||(y.setLayoutProperty(r,c,p),this._updateLayer(y)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const c=this.getLayer(e);if(c)return c.getLayoutProperty(r);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,c,p={}){this._checkLoaded();const y=this.getLayer(e);y?h.bE(y.getPaintProperty(r),c)||(y.setPaintProperty(r,c,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const c=e.source,p=e.sourceLayer,y=this.sourceCaches[c];if(y===void 0)return void this.fire(new h.k(new Error(`The source '${c}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&p?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,e.id,r)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const c=e.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new h.k(new Error(`The source '${c}' does not exist in the map's style.`)));const y=p.getSource().type,T=y==="vector"?e.sourceLayer:void 0;y!=="vector"||T?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,e.id,r):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,c=e.sourceLayer,p=this.sourceCaches[r];if(p!==void 0)return p.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,e.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.bF(this.sourceCaches,y=>y.serialize()),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,p=this.stylesheet;return h.bG({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:r,terrain:c},y=>y!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=T=>this._layers[T].type==="fill-extrusion",c={},p=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(r(C)){c[C]=T;for(const I of e){const O=I[C];if(O)for(const k of O)p.push(k)}}}p.sort((T,C)=>C.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(r(C))for(let I=p.length-1;I>=0;I--){const O=p[I].feature;if(c[O.layer.id]<T)break;y.push(O),p.pop()}else for(const I of e){const O=I[C];if(O)for(const k of O)y.push(k.feature)}}return y}queryRenderedFeatures(e,r,c){r&&r.filter&&this._validate(h.y.filter,"queryRenderedFeatures.filter",r.filter,null,r);const p={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const O of r.layers){const k=this._layers[O];if(!k)return this.fire(new h.k(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];p[k.source]=!0}}const y=[];r.availableImages=this._availableImages;const T=this._serializedAllLayers(),C=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,I=Object.assign(Object.assign({},r),{layers:C});for(const O in this.sourceCaches)r.layers&&!p[O]||y.push(es(this.sourceCaches[O],this._layers,T,e,I,c,this.map.terrain?(k,F,z)=>this.map.terrain.getElevation(k,F,z):void 0));return this.placement&&y.push(function(O,k,F,z,G,Y,ne){const ae={},re=Y.queryRenderedSymbols(z),le=[];for(const me of Object.keys(re).map(Number))le.push(ne[me]);le.sort(bn);for(const me of le){const pe=me.featureIndex.lookupSymbolFeatures(re[me.bucketInstanceId],k,me.bucketIndex,me.sourceLayerIndex,G.filter,G.layers,G.availableImages,O);for(const be in pe){const we=ae[be]=ae[be]||[],xe=pe[be];xe.sort((ke,Ke)=>{const Ge=me.featureSortOrder;if(Ge){const qe=Ge.indexOf(ke.featureIndex);return Ge.indexOf(Ke.featureIndex)-qe}return Ke.featureIndex-ke.featureIndex});for(const ke of xe)we.push(ke)}}return function(me,pe,be){for(const we in me)for(const xe of me[we])On(xe,be[pe[we].source]);return me}(ae,O,F)}(this._layers,T,this.sourceCaches,e,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,r){r&&r.filter&&this._validate(h.y.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.sourceCaches[e];return c?function(p,y){const T=p.getRenderableIds().map(O=>p.getTileByID(O)),C=[],I={};for(let O=0;O<T.length;O++){const k=T[O],F=k.tileID.canonical.key;I[F]||(I[F]=!0,k.querySourceFeatures(C,y))}return C}(c,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const T in e)if(!h.bE(e[T],c[T])){p=!0;break}if(!p)return;const y={now:Ae.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(y)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const c=this.getSky();let p=!1;if(!e&&!c)return;if(e&&!c)p=!0;else if(!e&&c)p=!0;else for(const T in e)if(!h.bE(e[T],c[T])){p=!0;break}if(!p)return;const y={now:Ae.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(y)}_setProjectionInternal(e){const r=function(c){if(Array.isArray(c)){const p=new $o({type:c});return{projection:p,transform:new Jo,cameraHelper:new eu(p)}}switch(c){case"mercator":return{projection:new mo,transform:new ns,cameraHelper:new Sr};case"globe":{const p=new $o({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:p,transform:new Jo,cameraHelper:new eu(p)}}case"vertical-perspective":return{projection:new Zo,transform:new Wo,cameraHelper:new Cr};default:return h.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new mo,transform:new ns,cameraHelper:new Sr}}}(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.sourceCaches)this.sourceCaches[c].reload()}_validate(e,r,c,p,y={}){return(!y||y.validate!==!1)&&Ec(this,e.call(h.y,h.e({key:r,style:this.serialize(),value:c,styleSpec:h.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),xn().off(Pu,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const c=this.sourceCaches[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,c,p,y=!1){let T=!1,C=!1;const I={};for(const O of this._order){const k=this._layers[O];if(k.type!=="symbol")continue;if(!I[k.source]){const z=this.sourceCaches[k.source];I[k.source]=z.getRenderableIds(!0).map(G=>z.getTileByID(G)).sort((G,Y)=>Y.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(Y.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(k,I[k.source],e.center.lng);T=T||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ae.now(),e.zoom))&&(this.pauseablePlacement=new xc(e,this.map.terrain,this._order,y,r,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ae.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const O of this._order){const k=this._layers[O];k.type==="symbol"&&this.placement.updateLayerOpacities(k,I[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ae.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return h._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[r.source];return p&&p.setDependencies(r.tileID.key,r.type,r.icons),c})}getGlyphs(e,r){return h._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),p=this.sourceCaches[r.source];return p&&p.setDependencies(r.tileID.key,r.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(h.y.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,c={},p){this._checkLoaded();const y=[{id:e,url:r}],T=[...Oe(this.stylesheet.sprite),...y];this._validate(h.y.sprite,"sprite",T,null,c)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,p))}removeSprite(e){this._checkLoaded();const r=Oe(this.stylesheet.sprite);if(r.find(c=>c.id===e)){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex(c=>c.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(e,r={},c){this._checkLoaded(),e&&this._validate(h.y.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}var Hf=h.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,c,p,y,T,C,I,O){this.context=e;let k=this.boundPaintVertexBuffers.length!==p.length;for(let F=0;!k&&F<p.length;F++)this.boundPaintVertexBuffers[F]!==p[F]&&(k=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==O?this.freshBind(r,c,p,y,T,C,I,O):(e.bindVertexArray.set(this.vao),C&&C.bind(),y&&y.dynamicDraw&&y.bind(),I&&I.bind(),O&&O.bind())}freshBind(e,r,c,p,y,T,C,I){const O=e.numAttributes,k=this.context,F=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=I,r.enableAttributes(F,e);for(const z of c)z.enableAttributes(F,e);T&&T.enableAttributes(F,e),C&&C.enableAttributes(F,e),I&&I.enableAttributes(F,e),r.bind(),r.setVertexAttribPointers(F,e,y);for(const z of c)z.bind(),z.setVertexAttribPointers(F,e,y);T&&(T.bind(),T.setVertexAttribPointers(F,e,y)),p&&p.bind(),C&&(C.bind(),C.setVertexAttribPointers(F,e,y)),I&&(I.bind(),I.setVertexAttribPointers(F,e,y)),k.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const qf=(g,e,r,c,p)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):h.b7.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):h.b7.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),wc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Hu(g){const e=[];for(let r=0;r<g.length;r++){if(g[r]===null)continue;const c=g[r].split(" ");e.push(c.pop())}return e}class Ac{constructor(e,r,c,p,y,T,C,I,O=[]){const k=e.gl;this.program=k.createProgram();const F=Hu(r.staticAttributes),z=c?c.getBinderAttributes():[],G=F.concat(z),Y=Nn.prelude.staticUniforms?Hu(Nn.prelude.staticUniforms):[],ne=C.staticUniforms?Hu(C.staticUniforms):[],ae=r.staticUniforms?Hu(r.staticUniforms):[],re=c?c.getBinderUniforms():[],le=Y.concat(ne).concat(ae).concat(re),me=[];for(const Ge of le)me.indexOf(Ge)<0&&me.push(Ge);const pe=c?c.defines():[];Ia(k)&&pe.unshift("#version 300 es"),y&&pe.push("#define OVERDRAW_INSPECTOR;"),T&&pe.push("#define TERRAIN3D;"),I&&pe.push(I),O&&pe.push(...O);let be=pe.concat(Nn.prelude.fragmentSource,C.fragmentSource,r.fragmentSource).join(`
`),we=pe.concat(Nn.prelude.vertexSource,C.vertexSource,r.vertexSource).join(`
`);Ia(k)||(be=function(Ge){return Ge.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(be),we=function(Ge){return Ge.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(we));const xe=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(xe,be),k.compileShader(xe),!k.getShaderParameter(xe,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(xe)}`);k.attachShader(this.program,xe);const ke=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ke,we),k.compileShader(ke),!k.getShaderParameter(ke,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ke)}`);k.attachShader(this.program,ke),this.attributes={};const Ke={};this.numAttributes=G.length;for(let Ge=0;Ge<this.numAttributes;Ge++)G[Ge]&&(k.bindAttribLocation(this.program,Ge,G[Ge]),this.attributes[G[Ge]]=Ge);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ke),k.deleteShader(xe);for(let Ge=0;Ge<me.length;Ge++){const qe=me[Ge];if(qe&&!Ke[qe]){const $e=k.getUniformLocation(this.program,qe);$e&&(Ke[qe]=$e)}}this.fixedUniforms=p(e,Ke),this.terrainUniforms=((Ge,qe)=>({u_depth:new h.bH(Ge,qe.u_depth),u_terrain:new h.bH(Ge,qe.u_terrain),u_terrain_dim:new h.b8(Ge,qe.u_terrain_dim),u_terrain_matrix:new h.bJ(Ge,qe.u_terrain_matrix),u_terrain_unpack:new h.bK(Ge,qe.u_terrain_unpack),u_terrain_exaggeration:new h.b8(Ge,qe.u_terrain_exaggeration)}))(e,Ke),this.projectionUniforms=((Ge,qe)=>({u_projection_matrix:new h.bJ(Ge,qe.u_projection_matrix),u_projection_tile_mercator_coords:new h.bK(Ge,qe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.bK(Ge,qe.u_projection_clipping_plane),u_projection_transition:new h.b8(Ge,qe.u_projection_transition),u_projection_fallback_matrix:new h.bJ(Ge,qe.u_projection_fallback_matrix)}))(e,Ke),this.binderUniforms=c?c.getUniforms(e,Ke):[]}draw(e,r,c,p,y,T,C,I,O,k,F,z,G,Y,ne,ae,re,le,me){const pe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(p),e.setColorMode(y),e.setCullFace(T),I){e.activeTexture.set(pe.TEXTURE2),pe.bindTexture(pe.TEXTURE_2D,I.depthTexture),e.activeTexture.set(pe.TEXTURE3),pe.bindTexture(pe.TEXTURE_2D,I.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(I[we])}if(O)for(const we in O)this.projectionUniforms[wc[we]].set(O[we]);if(C)for(const we in this.fixedUniforms)this.fixedUniforms[we].set(C[we]);ae&&ae.setUniforms(e,this.binderUniforms,Y,{zoom:ne});let be=0;switch(r){case pe.LINES:be=2;break;case pe.TRIANGLES:be=3;break;case pe.LINE_STRIP:be=1}for(const we of G.get()){const xe=we.vaos||(we.vaos={});(xe[k]||(xe[k]=new jf)).bind(e,this,F,ae?ae.getPaintVertexBuffers():[],z,we.vertexOffset,re,le,me),pe.drawElements(r,we.primitiveLength*be,pe.UNSIGNED_SHORT,we.primitiveOffset*be*2)}}}function Sc(g,e,r){const c=1/h.az(r,1,e.transform.tileZoom),p=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,e.transform.tileZoom)/p,T=y*(r.tileID.canonical.x+r.tileID.wrap*p),C=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const Cc=(g,e,r,c)=>{const p=g.style.light,y=p.properties.get("position"),T=[y.x,y.y,y.z],C=h.bN();p.properties.get("anchor")==="viewport"&&h.bO(C,g.transform.bearingInRadians),h.bP(T,T,C);const I=g.transform.transformLightDirection(T),O=p.properties.get("color");return{u_lightpos:T,u_lightpos_globe:I,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:c}},Mr=(g,e,r,c,p,y,T)=>h.e(Cc(g,e,r,c),Sc(y,g,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),ju=(g,e,r,c)=>h.e(Sc(e,g,r),{u_fill_translate:c}),Sh=(g,e)=>({u_world:g,u_fill_translate:e}),qu=(g,e,r,c,p)=>h.e(ju(g,e,r,p),{u_world:c}),Vu=(g,e,r,c,p)=>{const y=g.transform;let T,C,I=0;if(r.paint.get("circle-pitch-alignment")==="map"){const O=h.az(e,1,y.zoom);T=!0,C=[O,O],I=O/(h.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p}else T=!1,C=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:I,u_translate:c}},Sd=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Ll=g=>({u_viewport_size:[g.width,g.height]}),Ch=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),Ir=(g,e,r,c)=>{const p=h.az(g,1,e)/(h.Z*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:h.az(g,1,e),u_intensity:r,u_globe_extrude_scale:p}},Cd=(g,e,r,c)=>{const p=h.K();h.bQ(p,0,g.width,g.height,0,0,1);const y=g.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},Md=(g,e,r)=>{const c=r.paint.get("hillshade-accent-color");let p;switch(r.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const y=r.getIlluminationProperties();for(let T=0;T<y.directionRadians.length;T++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[T]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:Mh(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:c,u_method:p,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Vf=(g,e)=>{const r=e.stride,c=h.K();return h.bQ(c,0,h.Z,-8192,0,0,1),h.L(c,c,[0,-8192,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function Mh(g,e){const r=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new h.$(0,c/r).toLngLat().lat,new h.$(0,(c+1)/r).toLngLat().lat]}const Gu=(g,e,r,c)=>{const p=g.transform;return{u_translation:Ls(g,e,r),u_ratio:c/h.az(e,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Zu=(g,e,r,c,p)=>h.e(Gu(g,e,r,c),{u_image:0,u_image_height:p}),Yu=(g,e,r,c,p)=>{const y=g.transform,T=$u(e,y);return{u_translation:Ls(g,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:c/h.az(e,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Id=(g,e,r,c,p,y)=>{const T=g.lineAtlas,C=$u(e,g.transform),I=r.layout.get("line-cap")==="round",O=T.getDash(p.from,I),k=T.getDash(p.to,I),F=O.width*y.fromScale,z=k.width*y.toScale;return h.e(Gu(g,e,r,c),{u_patternscale_a:[C/F,-O.height/2],u_patternscale_b:[C/z,-k.height/2],u_sdfgamma:T.width/(256*Math.min(F,z)*g.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:k.y,u_mix:y.t})};function $u(g,e){return 1/h.az(g,1,e.tileZoom)}function Ls(g,e,r){return h.aA(g.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ih=(g,e,r,c,p)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(T=c.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=c.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Mc(c.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var y,T};function Mc(g){g*=Math.PI/180;const e=Math.sin(g),r=Math.cos(g);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const bo=(g,e,r,c,p,y,T,C,I,O,k,F,z)=>{const G=T.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:G.width/G.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:I,u_is_text:+k,u_pitch_with_map:+c,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:F,u_texture:0,u_translation:O,u_pitched_scale:z}},Dh=(g,e,r,c,p,y,T,C,I,O,k,F,z,G)=>{const Y=T.transform;return h.e(bo(g,e,r,c,p,y,T,C,I,O,k,F,G),{u_gamma_scale:c?Math.cos(Y.pitch*Math.PI/180)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},Ol=(g,e,r,c,p,y,T,C,I,O,k,F,z)=>h.e(Dh(g,e,r,c,p,y,T,C,I,O,!0,k,0,z),{u_texsize_icon:F,u_texture_icon:1}),Dd=(g,e)=>({u_opacity:g,u_color:e}),Gf=(g,e,r,c,p)=>h.e(function(y,T,C,I){const O=C.imageManager.getPattern(y.from.toString()),k=C.imageManager.getPattern(y.to.toString()),{width:F,height:z}=C.imageManager.getPixelSize(),G=Math.pow(2,I.tileID.overscaledZ),Y=I.tileSize*Math.pow(2,C.transform.tileZoom)/G,ne=Y*(I.tileID.canonical.x+I.tileID.wrap*G),ae=Y*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[F,z],u_mix:T.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/h.az(I,1,C.transform.tileZoom),u_pixel_coord_upper:[ne>>16,ae>>16],u_pixel_coord_lower:[65535&ne,65535&ae]}}(r,p,e,c),{u_opacity:g}),Rh=(g,e)=>{},Rd={fillExtrusion:(g,e)=>({u_lightpos:new h.bL(g,e.u_lightpos),u_lightpos_globe:new h.bL(g,e.u_lightpos_globe),u_lightintensity:new h.b8(g,e.u_lightintensity),u_lightcolor:new h.bL(g,e.u_lightcolor),u_vertical_gradient:new h.b8(g,e.u_vertical_gradient),u_opacity:new h.b8(g,e.u_opacity),u_fill_translate:new h.bM(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new h.bL(g,e.u_lightpos),u_lightpos_globe:new h.bL(g,e.u_lightpos_globe),u_lightintensity:new h.b8(g,e.u_lightintensity),u_lightcolor:new h.bL(g,e.u_lightcolor),u_vertical_gradient:new h.b8(g,e.u_vertical_gradient),u_height_factor:new h.b8(g,e.u_height_factor),u_opacity:new h.b8(g,e.u_opacity),u_fill_translate:new h.bM(g,e.u_fill_translate),u_image:new h.bH(g,e.u_image),u_texsize:new h.bM(g,e.u_texsize),u_pixel_coord_upper:new h.bM(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bM(g,e.u_pixel_coord_lower),u_scale:new h.bL(g,e.u_scale),u_fade:new h.b8(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new h.bM(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new h.bH(g,e.u_image),u_texsize:new h.bM(g,e.u_texsize),u_pixel_coord_upper:new h.bM(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bM(g,e.u_pixel_coord_lower),u_scale:new h.bL(g,e.u_scale),u_fade:new h.b8(g,e.u_fade),u_fill_translate:new h.bM(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new h.bM(g,e.u_world),u_fill_translate:new h.bM(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new h.bM(g,e.u_world),u_image:new h.bH(g,e.u_image),u_texsize:new h.bM(g,e.u_texsize),u_pixel_coord_upper:new h.bM(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bM(g,e.u_pixel_coord_lower),u_scale:new h.bL(g,e.u_scale),u_fade:new h.b8(g,e.u_fade),u_fill_translate:new h.bM(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new h.b8(g,e.u_camera_to_center_distance),u_scale_with_map:new h.bH(g,e.u_scale_with_map),u_pitch_with_map:new h.bH(g,e.u_pitch_with_map),u_extrude_scale:new h.bM(g,e.u_extrude_scale),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new h.b8(g,e.u_globe_extrude_scale),u_translate:new h.bM(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new h.bM(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new h.bM(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new h.bI(g,e.u_color),u_overlay:new h.bH(g,e.u_overlay),u_overlay_scale:new h.b8(g,e.u_overlay_scale)}),depth:Rh,clippingMask:Rh,heatmap:(g,e)=>({u_extrude_scale:new h.b8(g,e.u_extrude_scale),u_intensity:new h.b8(g,e.u_intensity),u_globe_extrude_scale:new h.b8(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new h.bJ(g,e.u_matrix),u_world:new h.bM(g,e.u_world),u_image:new h.bH(g,e.u_image),u_color_ramp:new h.bH(g,e.u_color_ramp),u_opacity:new h.b8(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new h.bH(g,e.u_image),u_latrange:new h.bM(g,e.u_latrange),u_exaggeration:new h.b8(g,e.u_exaggeration),u_altitudes:new h.bS(g,e.u_altitudes),u_azimuths:new h.bS(g,e.u_azimuths),u_accent:new h.bI(g,e.u_accent),u_method:new h.bH(g,e.u_method),u_shadows:new h.bR(g,e.u_shadows),u_highlights:new h.bR(g,e.u_highlights)}),hillshadePrepare:(g,e)=>({u_matrix:new h.bJ(g,e.u_matrix),u_image:new h.bH(g,e.u_image),u_dimension:new h.bM(g,e.u_dimension),u_zoom:new h.b8(g,e.u_zoom),u_unpack:new h.bK(g,e.u_unpack)}),line:(g,e)=>({u_translation:new h.bM(g,e.u_translation),u_ratio:new h.b8(g,e.u_ratio),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_units_to_pixels:new h.bM(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new h.bM(g,e.u_translation),u_ratio:new h.b8(g,e.u_ratio),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_units_to_pixels:new h.bM(g,e.u_units_to_pixels),u_image:new h.bH(g,e.u_image),u_image_height:new h.b8(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new h.bM(g,e.u_translation),u_texsize:new h.bM(g,e.u_texsize),u_ratio:new h.b8(g,e.u_ratio),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_image:new h.bH(g,e.u_image),u_units_to_pixels:new h.bM(g,e.u_units_to_pixels),u_scale:new h.bL(g,e.u_scale),u_fade:new h.b8(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new h.bM(g,e.u_translation),u_ratio:new h.b8(g,e.u_ratio),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_units_to_pixels:new h.bM(g,e.u_units_to_pixels),u_patternscale_a:new h.bM(g,e.u_patternscale_a),u_patternscale_b:new h.bM(g,e.u_patternscale_b),u_sdfgamma:new h.b8(g,e.u_sdfgamma),u_image:new h.bH(g,e.u_image),u_tex_y_a:new h.b8(g,e.u_tex_y_a),u_tex_y_b:new h.b8(g,e.u_tex_y_b),u_mix:new h.b8(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new h.bM(g,e.u_tl_parent),u_scale_parent:new h.b8(g,e.u_scale_parent),u_buffer_scale:new h.b8(g,e.u_buffer_scale),u_fade_t:new h.b8(g,e.u_fade_t),u_opacity:new h.b8(g,e.u_opacity),u_image0:new h.bH(g,e.u_image0),u_image1:new h.bH(g,e.u_image1),u_brightness_low:new h.b8(g,e.u_brightness_low),u_brightness_high:new h.b8(g,e.u_brightness_high),u_saturation_factor:new h.b8(g,e.u_saturation_factor),u_contrast_factor:new h.b8(g,e.u_contrast_factor),u_spin_weights:new h.bL(g,e.u_spin_weights),u_coords_top:new h.bK(g,e.u_coords_top),u_coords_bottom:new h.bK(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new h.bH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bH(g,e.u_is_size_feature_constant),u_size_t:new h.b8(g,e.u_size_t),u_size:new h.b8(g,e.u_size),u_camera_to_center_distance:new h.b8(g,e.u_camera_to_center_distance),u_pitch:new h.b8(g,e.u_pitch),u_rotate_symbol:new h.bH(g,e.u_rotate_symbol),u_aspect_ratio:new h.b8(g,e.u_aspect_ratio),u_fade_change:new h.b8(g,e.u_fade_change),u_label_plane_matrix:new h.bJ(g,e.u_label_plane_matrix),u_coord_matrix:new h.bJ(g,e.u_coord_matrix),u_is_text:new h.bH(g,e.u_is_text),u_pitch_with_map:new h.bH(g,e.u_pitch_with_map),u_is_along_line:new h.bH(g,e.u_is_along_line),u_is_variable_anchor:new h.bH(g,e.u_is_variable_anchor),u_texsize:new h.bM(g,e.u_texsize),u_texture:new h.bH(g,e.u_texture),u_translation:new h.bM(g,e.u_translation),u_pitched_scale:new h.b8(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new h.bH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bH(g,e.u_is_size_feature_constant),u_size_t:new h.b8(g,e.u_size_t),u_size:new h.b8(g,e.u_size),u_camera_to_center_distance:new h.b8(g,e.u_camera_to_center_distance),u_pitch:new h.b8(g,e.u_pitch),u_rotate_symbol:new h.bH(g,e.u_rotate_symbol),u_aspect_ratio:new h.b8(g,e.u_aspect_ratio),u_fade_change:new h.b8(g,e.u_fade_change),u_label_plane_matrix:new h.bJ(g,e.u_label_plane_matrix),u_coord_matrix:new h.bJ(g,e.u_coord_matrix),u_is_text:new h.bH(g,e.u_is_text),u_pitch_with_map:new h.bH(g,e.u_pitch_with_map),u_is_along_line:new h.bH(g,e.u_is_along_line),u_is_variable_anchor:new h.bH(g,e.u_is_variable_anchor),u_texsize:new h.bM(g,e.u_texsize),u_texture:new h.bH(g,e.u_texture),u_gamma_scale:new h.b8(g,e.u_gamma_scale),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_is_halo:new h.bH(g,e.u_is_halo),u_translation:new h.bM(g,e.u_translation),u_pitched_scale:new h.b8(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new h.bH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bH(g,e.u_is_size_feature_constant),u_size_t:new h.b8(g,e.u_size_t),u_size:new h.b8(g,e.u_size),u_camera_to_center_distance:new h.b8(g,e.u_camera_to_center_distance),u_pitch:new h.b8(g,e.u_pitch),u_rotate_symbol:new h.bH(g,e.u_rotate_symbol),u_aspect_ratio:new h.b8(g,e.u_aspect_ratio),u_fade_change:new h.b8(g,e.u_fade_change),u_label_plane_matrix:new h.bJ(g,e.u_label_plane_matrix),u_coord_matrix:new h.bJ(g,e.u_coord_matrix),u_is_text:new h.bH(g,e.u_is_text),u_pitch_with_map:new h.bH(g,e.u_pitch_with_map),u_is_along_line:new h.bH(g,e.u_is_along_line),u_is_variable_anchor:new h.bH(g,e.u_is_variable_anchor),u_texsize:new h.bM(g,e.u_texsize),u_texsize_icon:new h.bM(g,e.u_texsize_icon),u_texture:new h.bH(g,e.u_texture),u_texture_icon:new h.bH(g,e.u_texture_icon),u_gamma_scale:new h.b8(g,e.u_gamma_scale),u_device_pixel_ratio:new h.b8(g,e.u_device_pixel_ratio),u_is_halo:new h.bH(g,e.u_is_halo),u_translation:new h.bM(g,e.u_translation),u_pitched_scale:new h.b8(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new h.b8(g,e.u_opacity),u_color:new h.bI(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new h.b8(g,e.u_opacity),u_image:new h.bH(g,e.u_image),u_pattern_tl_a:new h.bM(g,e.u_pattern_tl_a),u_pattern_br_a:new h.bM(g,e.u_pattern_br_a),u_pattern_tl_b:new h.bM(g,e.u_pattern_tl_b),u_pattern_br_b:new h.bM(g,e.u_pattern_br_b),u_texsize:new h.bM(g,e.u_texsize),u_mix:new h.b8(g,e.u_mix),u_pattern_size_a:new h.bM(g,e.u_pattern_size_a),u_pattern_size_b:new h.bM(g,e.u_pattern_size_b),u_scale_a:new h.b8(g,e.u_scale_a),u_scale_b:new h.b8(g,e.u_scale_b),u_pixel_coord_upper:new h.bM(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bM(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.b8(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new h.bH(g,e.u_texture),u_ele_delta:new h.b8(g,e.u_ele_delta),u_fog_matrix:new h.bJ(g,e.u_fog_matrix),u_fog_color:new h.bI(g,e.u_fog_color),u_fog_ground_blend:new h.b8(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.b8(g,e.u_fog_ground_blend_opacity),u_horizon_color:new h.bI(g,e.u_horizon_color),u_horizon_fog_blend:new h.b8(g,e.u_horizon_fog_blend),u_is_globe_mode:new h.b8(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new h.b8(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new h.bH(g,e.u_texture),u_terrain_coords_id:new h.b8(g,e.u_terrain_coords_id),u_ele_delta:new h.b8(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new h.b8(g,e.u_input),u_output_expected:new h.b8(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new h.bL(g,e.u_sun_pos),u_atmosphere_blend:new h.b8(g,e.u_atmosphere_blend),u_globe_position:new h.bL(g,e.u_globe_position),u_globe_radius:new h.b8(g,e.u_globe_radius),u_inv_proj_matrix:new h.bJ(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new h.bI(g,e.u_sky_color),u_horizon_color:new h.bI(g,e.u_horizon_color),u_horizon:new h.bM(g,e.u_horizon),u_horizon_normal:new h.bM(g,e.u_horizon_normal),u_sky_horizon_blend:new h.b8(g,e.u_sky_horizon_blend),u_sky_blend:new h.b8(g,e.u_sky_blend)})};class Pd{constructor(e,r,c){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ph={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qn{constructor(e,r,c,p){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let c=0;c<this.attributes.length;c++){const p=r.attributes[this.attributes[c].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,r,c){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],T=r.attributes[y.name];T!==void 0&&e.vertexAttribPointer(T,y.components,e[Ph[y.type]],!1,this.itemSize,y.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ss extends gi{getDefault(){return h.b7.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ic extends gi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Dc extends gi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Rc extends gi{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Pc extends gi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Lh extends gi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Dr extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Nl extends gi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class kl extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Oh extends gi{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ld extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class tu extends gi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class iu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Nh extends gi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class kh extends gi{getDefault(){return h.b7.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class os extends gi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Bl extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class zl extends gi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Lc extends gi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class au extends gi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Oc extends gi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Xu extends gi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class hr extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Bh extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nc extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class dr extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xo extends gi{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bn extends gi{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const c=this.gl;Ia(c)?c.bindVertexArray(e):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class zn extends gi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class us extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Qu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class nu extends gi{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Os extends nu{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class vo extends nu{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ru extends nu{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Fl="Framebuffer is not complete";class di{constructor(e,r,c,p,y){this.context=e,this.width=r,this.height=c;const T=e.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Os(e,C),p)this.depthAttachment=y?new ru(e,C):new vo(e,C);else if(y)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(Fl)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class Ns{constructor(e){var r,c;if(this.gl=e,this.clearColor=new ss(this),this.clearDepth=new Ic(this),this.clearStencil=new Dc(this),this.colorMask=new Rc(this),this.depthMask=new Pc(this),this.stencilMask=new Lh(this),this.stencilFunc=new Dr(this),this.stencilOp=new Nl(this),this.stencilTest=new kl(this),this.depthRange=new Oh(this),this.depthTest=new Ld(this),this.depthFunc=new tu(this),this.blend=new iu(this),this.blendFunc=new Nh(this),this.blendColor=new kh(this),this.blendEquation=new os(this),this.cullFace=new Bl(this),this.cullFaceSide=new zl(this),this.frontFace=new Lc(this),this.program=new au(this),this.activeTexture=new Oc(this),this.viewport=new Xu(this),this.bindFramebuffer=new hr(this),this.bindRenderbuffer=new Bh(this),this.bindTexture=new Nc(this),this.bindVertexBuffer=new dr(this),this.bindElementBuffer=new xo(this),this.bindVertexArray=new Bn(this),this.pixelStoreUnpack=new zn(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new Qu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ia(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:p==null?void 0:p.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Pd(this,e,r)}createVertexBuffer(e,r,c){return new Qn(this,e,r,c)}createRenderbuffer(e,r,c){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,e,r,c),this.bindRenderbuffer.set(null),y}createFramebuffer(e,r,c,p){return new di(this,e,r,c,p)}clear({color:e,depth:r,stencil:c}){const p=this.gl;let y=0;e&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.bE(e.blendFunction,Ni.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ia(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return Ia(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let kc;function Fn(g,e,r,c,p){const y=g.context,T=g.transform,C=y.gl,I=g.useProgram("collisionBox"),O=[];let k=0,F=0;for(let re=0;re<c.length;re++){const le=c[re],me=e.getTile(le).getBucket(r);if(!me)continue;const pe=p?me.textCollisionBox:me.iconCollisionBox,be=me.collisionCircleArray;be.length>0&&(O.push({circleArray:be,circleOffset:F,coord:le}),k+=be.length/4,F=k),pe&&I.draw(y,C.LINES,Qt.disabled,oi.disabled,g.colorModeForRenderPass(),mi.disabled,Sd(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(le),T.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,g.transform.zoom,null,null,pe.collisionVertexBuffer)}if(!p||!O.length)return;const z=g.useProgram("collisionCircle"),G=new h.bT;G.resize(4*k),G._trim();let Y=0;for(const re of O)for(let le=0;le<re.circleArray.length/4;le++){const me=4*le,pe=re.circleArray[me+0],be=re.circleArray[me+1],we=re.circleArray[me+2],xe=re.circleArray[me+3];G.emplace(Y++,pe,be,we,xe,0),G.emplace(Y++,pe,be,we,xe,1),G.emplace(Y++,pe,be,we,xe,2),G.emplace(Y++,pe,be,we,xe,3)}(!kc||kc.length<2*k)&&(kc=function(re){const le=2*re,me=new h.bV;me.resize(le),me._trim();for(let pe=0;pe<le;pe++){const be=6*pe;me.uint16[be+0]=4*pe+0,me.uint16[be+1]=4*pe+1,me.uint16[be+2]=4*pe+2,me.uint16[be+3]=4*pe+2,me.uint16[be+4]=4*pe+3,me.uint16[be+5]=4*pe+0}return me}(k));const ne=y.createIndexBuffer(kc,!0),ae=y.createVertexBuffer(G,h.bU.members,!0);for(const re of O){const le=Ll(g.transform);z.draw(y,C.TRIANGLES,Qt.disabled,oi.disabled,g.colorModeForRenderPass(),mi.disabled,le,g.style.map.terrain&&g.style.map.terrain.getTerrainData(re.coord),null,r.id,ae,ne,h.aJ.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,g.transform.zoom,null,null,null)}ae.destroy(),ne.destroy()}const su=h.ad(new Float32Array(16));function ks(g,e,r,c,p,y){const{horizontalAlign:T,verticalAlign:C}=h.aE(g);return new h.P((-(T-.5)*e/p+c[0])*y,(-(C-.5)*r/p+c[1])*y)}function Od(g,e,r,c,p,y){const T=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let C=c.mult(y);r||(C=C.rotate(-p));const I=T.add(C);return Ye(I.x,I.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const C=Wi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),I=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return g.add(c.rotate(I))}return g.add(c)}function Ul(g,e,r,c,p,y,T,C,I,O,k,F){const z=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,Y=g.icon.dynamicLayoutVertexArray,ne={};G.clear();for(let ae=0;ae<z.length;ae++){const re=z.get(ae),le=re.hidden||!re.crossTileID||g.allowVerticalPlacement&&!re.placedOrientation?null:c[re.crossTileID];if(le){const me=new h.P(re.anchorX,re.anchorY),pe={getElevation:F,width:p.width,height:p.height,pitchedLabelPlaneMatrix:y,pitchWithMap:r,transform:p,tileAnchorPoint:me,translation:O,unwrappedTileID:k},be=r?Ut(me.x,me.y,pe):Wi(me.x,me.y,pe),we=Ci(p.cameraToCenterDistance,be.signedDistanceFromCamera);let xe=h.am(g.textSizeData,C,re)*we/h.ay;r&&(xe*=g.tilePixelRatio/T);const{width:ke,height:Ke,anchor:Ge,textOffset:qe,textBoxScale:$e}=le,_t=ks(Ge,ke,Ke,qe,$e,xe),mt=p.getPitchedTextCorrection(me.x+O[0],me.y+O[1],k),rt=Od(be.point,pe,e,_t,-p.bearingInRadians,mt),Rt=g.allowVerticalPlacement&&re.placedOrientation===h.al.vertical?Math.PI/2:0;for(let ui=0;ui<re.numGlyphs;ui++)h.as(G,rt,Rt);I&&re.associatedIconIndex>=0&&(ne[re.associatedIconIndex]={shiftedAnchor:rt,angle:Rt})}else Rs(re.numGlyphs,G)}if(I){Y.clear();const ae=g.icon.placedSymbolArray;for(let re=0;re<ae.length;re++){const le=ae.get(re);if(le.hidden)Rs(le.numGlyphs,Y);else{const me=ne[re];if(me)for(let pe=0;pe<le.numGlyphs;pe++)h.as(Y,me.shiftedAnchor,me.angle);else Rs(le.numGlyphs,Y)}}g.icon.dynamicLayoutVertexBuffer.updateData(Y)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function ou(g,e,r){return r.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ku(g,e,r,c,p,y,T,C,I,O,k,F,z){const G=g.context,Y=G.gl,ne=g.transform,ae=C==="map",re=I==="map",le=C!=="viewport"&&r.layout.get("symbol-placement")!=="point",me=ae&&!re&&!le,pe=!r.layout.get("symbol-sort-key").isConstant();let be=!1;const we=g.getDepthModeForSublayer(0,Qt.ReadOnly),xe=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ke=[],Ke=ne.getCircleRadiusCorrection();for(const Ge of c){const qe=e.getTile(Ge),$e=qe.getBucket(r);if(!$e)continue;const _t=p?$e.text:$e.icon;if(!_t||!_t.segments.get().length||!_t.hasVisibleVertices)continue;const mt=_t.programConfigurations.get(r.id),rt=p||$e.sdfIcons,Rt=p?$e.textSizeData:$e.iconSizeData,ui=re||ne.pitch!==0,_i=g.useProgram(ou(rt,p,$e),mt),da=h.ak(Rt,ne.zoom),ji=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ge);let fa,sa,Xi,Di,za=[0,0],Ka=null;if(p)sa=qe.glyphAtlasTexture,Xi=Y.LINEAR,fa=qe.glyphAtlasTexture.size,$e.iconsInText&&(za=qe.imageAtlasTexture.size,Ka=qe.imageAtlasTexture,Di=ui||g.options.rotating||g.options.zooming||Rt.kind==="composite"||Rt.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const Ea=r.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;sa=qe.imageAtlasTexture,Xi=rt||g.options.rotating||g.options.zooming||Ea||ui?Y.LINEAR:Y.NEAREST,fa=qe.imageAtlasTexture.size}const un=h.az(qe,1,g.transform.zoom),Li=Lt(ae,g.transform,un),bs=h.K();h.an(bs,Li);const Yr=Ft(re,ae,g.transform,un),Zs=h.aA(ne,qe,y,T),Ys=ne.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),sl=xe&&$e.hasTextData(),$s=r.layout.get("icon-text-fit")!=="none"&&sl&&$e.hasIconData();if(le){const Ea=g.style.map.terrain?(Cn,qi)=>g.style.map.terrain.getElevation(Ge,Cn,qi):null,Fa=r.layout.get("text-rotation-alignment")==="map";Mi($e,g,p,Li,bs,re,O,Fa,Ge.toUnwrapped(),ne.width,ne.height,Zs,Ea)}const gu=p&&xe||$s,mr=le||gu?su:re?Li:g.transform.clipSpaceToPixelsMatrix,Xs=rt&&r.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gr;gr=rt?$e.iconsInText?Ol(Rt.kind,da,me,re,le,gu,g,mr,Yr,Zs,fa,za,Ke):Dh(Rt.kind,da,me,re,le,gu,g,mr,Yr,Zs,p,fa,0,Ke):bo(Rt.kind,da,me,re,le,gu,g,mr,Yr,Zs,p,fa,Ke);const xs={program:_i,buffers:_t,uniformValues:gr,projectionData:Ys,atlasTexture:sa,atlasTextureIcon:Ka,atlasInterpolation:Xi,atlasInterpolationIcon:Di,isSDF:rt,hasHalo:Xs};if(pe&&$e.canOverlap){be=!0;const Ea=_t.segments.get();for(const Fa of Ea)ke.push({segments:new h.aJ([Fa]),sortKey:Fa.sortKey,state:xs,terrainData:ji})}else ke.push({segments:_t.segments,sortKey:0,state:xs,terrainData:ji})}be&&ke.sort((Ge,qe)=>Ge.sortKey-qe.sortKey);for(const Ge of ke){const qe=Ge.state;if(G.activeTexture.set(Y.TEXTURE0),qe.atlasTexture.bind(qe.atlasInterpolation,Y.CLAMP_TO_EDGE),qe.atlasTextureIcon&&(G.activeTexture.set(Y.TEXTURE1),qe.atlasTextureIcon&&qe.atlasTextureIcon.bind(qe.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),qe.isSDF){const $e=qe.uniformValues;qe.hasHalo&&($e.u_is_halo=1,uu(qe.buffers,Ge.segments,r,g,qe.program,we,k,F,$e,qe.projectionData,Ge.terrainData)),$e.u_is_halo=0}uu(qe.buffers,Ge.segments,r,g,qe.program,we,k,F,qe.uniformValues,qe.projectionData,Ge.terrainData)}}function uu(g,e,r,c,p,y,T,C,I,O,k){const F=c.context;p.draw(F,F.gl.TRIANGLES,y,T,C,mi.backCCW,I,k,O,r.id,g.layoutVertexBuffer,g.indexBuffer,e,r.paint,c.transform.zoom,g.programConfigurations.get(r.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Bs(g,e,r,c,p){const y=g.context,T=y.gl,C=oi.disabled,I=new Ni([T.ONE,T.ONE],h.b7.transparent,[!0,!0,!0,!0]),O=e.getBucket(r);if(!O)return;const k=c.key;let F=r.heatmapFbos.get(k);F||(F=lu(y,e.tileSize,e.tileSize),r.heatmapFbos.set(k,F)),y.bindFramebuffer.set(F.framebuffer),y.viewport.set([0,0,e.tileSize,e.tileSize]),y.clear({color:h.b7.transparent});const z=O.programConfigurations.get(r.id),G=g.useProgram("heatmap",z,!p),Y=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ne=g.style.map.terrain.getTerrainData(c);G.draw(y,T.TRIANGLES,Qt.disabled,C,I,mi.disabled,Ir(e,g.transform.zoom,r.paint.get("heatmap-intensity"),1),ne,Y,r.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,r.paint,g.transform.zoom,z)}function To(g,e,r,c,p){const y=g.context,T=y.gl,C=g.transform;y.setColorMode(g.colorModeForRenderPass());const I=Wu(y,e),O=r.key,k=e.heatmapFbos.get(O);if(!k)return;y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,k.colorAttachment.get()),y.activeTexture.set(T.TEXTURE1),I.bind(T.LINEAR,T.CLAMP_TO_EDGE);const F=C.getProjectionData({overscaledTileID:r,applyTerrainMatrix:p,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(y,T.TRIANGLES,Qt.disabled,oi.disabled,g.colorModeForRenderPass(),mi.disabled,Cd(g,e,0,1),null,F,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,C.zoom),k.destroy(),e.heatmapFbos.delete(O)}function lu(g,e,r){var c,p;const y=g.gl,T=y.createTexture();y.bindTexture(y.TEXTURE_2D,T),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const C=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:y.UNSIGNED_BYTE,I=(p=g.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,I,e,r,0,y.RGBA,C,null);const O=g.createFramebuffer(e,r,!1,!1);return O.colorAttachment.set(T),O}function Wu(g,e){return e.colorRampTexture||(e.colorRampTexture=new xt(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function Tn(g,e,r,c,p){if(!r||!c||!c.imageAtlas)return;const y=c.imageAtlas.patternPositions;let T=y[r.to.toString()],C=y[r.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const I=p.getPaintProperty(e);T=y[I],C=y[I]}T&&C&&g.setConstantPatternPositions(T,C)}function En(g,e,r,c,p,y,T,C){const I=g.context.gl,O="fill-pattern",k=r.paint.get(O),F=k&&k.constantOr(1),z=r.getCrossfadeParameters();let G,Y,ne,ae,re;const le=g.transform,me=r.paint.get("fill-translate"),pe=r.paint.get("fill-translate-anchor");T?(Y=F&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=I.LINES):(Y=F?"fillPattern":"fill",G=I.TRIANGLES);const be=k.constantOr(null);for(const we of c){const xe=e.getTile(we);if(F&&!xe.patternsLoaded())continue;const ke=xe.getBucket(r);if(!ke)continue;const Ke=ke.programConfigurations.get(r.id),Ge=g.useProgram(Y,Ke),qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(we);F&&(g.context.activeTexture.set(I.TEXTURE0),xe.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ke.updatePaintBuffers(z)),Tn(Ke,O,be,xe,r);const $e=le.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),_t=h.aA(le,xe,me,pe);if(T){ae=ke.indexBuffer2,re=ke.segments2;const rt=[I.drawingBufferWidth,I.drawingBufferHeight];ne=Y==="fillOutlinePattern"&&F?qu(g,z,xe,rt,_t):Sh(rt,_t)}else ae=ke.indexBuffer,re=ke.segments,ne=F?ju(g,z,xe,_t):{u_fill_translate:_t};const mt=g.stencilModeForClipping(we);Ge.draw(g.context,G,p,mt,y,mi.backCCW,ne,qe,$e,r.id,ke.layoutVertexBuffer,ae,re,r.paint,g.transform.zoom,Ke)}}function Fr(g,e,r,c,p,y,T,C){const I=g.context,O=I.gl,k="fill-extrusion-pattern",F=r.paint.get(k),z=F.constantOr(1),G=r.getCrossfadeParameters(),Y=r.paint.get("fill-extrusion-opacity"),ne=F.constantOr(null),ae=g.transform;for(const re of c){const le=e.getTile(re),me=le.getBucket(r);if(!me)continue;const pe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),be=me.programConfigurations.get(r.id),we=g.useProgram(z?"fillExtrusionPattern":"fillExtrusion",be);z&&(g.context.activeTexture.set(O.TEXTURE0),le.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),be.updatePaintBuffers(G));const xe=ae.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Tn(be,k,ne,le,r);const ke=h.aA(ae,le,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ke=r.paint.get("fill-extrusion-vertical-gradient"),Ge=z?Mr(g,Ke,Y,ke,re,G,le):Cc(g,Ke,Y,ke);we.draw(I,I.gl.TRIANGLES,p,y,T,mi.backCCW,Ge,pe,xe,r.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,r.paint,g.transform.zoom,be,g.style.map.terrain&&me.centroidVertexBuffer)}}function Ur(g,e,r,c,p,y,T,C,I){var O;const k=g.style.projection,F=g.context,z=g.transform,G=F.gl,Y=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],ne=g.useProgram("hillshade",null,!1,Y),ae=!g.options.moving;for(const re of c){const le=e.getTile(re),me=le.fbo;if(!me)continue;const pe=k.getMeshFromTileID(F,re.canonical,C,!0,"raster"),be=(O=g.style.map.terrain)===null||O===void 0?void 0:O.getTerrainData(re);F.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,me.colorAttachment.get());const we=z.getProjectionData({overscaledTileID:re,aligned:ae,applyGlobeMatrix:!I,applyTerrainMatrix:!0});ne.draw(F,G.TRIANGLES,y,p[re.overscaledZ],T,mi.backCCW,Md(g,le,r),be,we,r.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}const fr=[new h.P(0,0),new h.P(h.Z,0),new h.P(h.Z,h.Z),new h.P(0,h.Z)];function ls(g,e,r,c,p,y,T,C,I=!1,O=!1){const k=c[c.length-1].overscaledZ,F=g.context,z=F.gl,G=g.useProgram("raster"),Y=g.transform,ne=g.style.projection,ae=g.colorModeForRenderPass(),re=!g.options.moving;for(const le of c){const me=g.getDepthModeForSublayer(le.overscaledZ-k,r.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,z.LESS),pe=e.getTile(le);pe.registerFadeDuration(r.paint.get("raster-fade-duration"));const be=e.findLoadedParent(le,0),we=e.findLoadedSibling(le),xe=zh(pe,be||we||null,e,r,g.transform,g.style.map.terrain);let ke,Ke;const Ge=r.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;F.activeTexture.set(z.TEXTURE0),pe.texture.bind(Ge,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(z.TEXTURE1),be?(be.texture.bind(Ge,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),ke=Math.pow(2,be.tileID.overscaledZ-pe.tileID.overscaledZ),Ke=[pe.tileID.canonical.x*ke%1,pe.tileID.canonical.y*ke%1]):pe.texture.bind(Ge,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),pe.texture.useMipmap&&F.extTextureFilterAnisotropic&&g.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(le),$e=Y.getProjectionData({overscaledTileID:le,aligned:re,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),_t=Ih(Ke||[0,0],ke||1,xe,r,C),mt=ne.getMeshFromTileID(F,le.canonical,y,T,"raster");G.draw(F,z.TRIANGLES,me,p?p[le.overscaledZ]:oi.disabled,ae,I?mi.frontCCW:mi.backCCW,_t,qe,$e,r.id,mt.vertexBuffer,mt.indexBuffer,mt.segments)}}function zh(g,e,r,c,p,y){const T=c.paint.get("raster-fade-duration");if(!y&&T>0){const C=Ae.now(),I=(C-g.timeAdded)/T,O=e?(C-e.timeAdded)/T:-1,k=r.getSource(),F=Ne(p,{tileSize:k.tileSize,roundZoom:k.roundZoom}),z=!e||Math.abs(e.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),G=z&&g.refreshedUponExpiration?1:h.ae(z?I:1-O,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const Ju=new h.b7(1,0,0,1),Hl=new h.b7(0,1,0,1),wn=new h.b7(0,0,1,1),Ta=new h.b7(1,0,1,1),Ii=new h.b7(0,1,1,1);function cs(g,e,r,c){cu(g,0,e+r/2,g.transform.width,r,c)}function Hr(g,e,r,c){cu(g,e-r/2,0,r,g.transform.height,c)}function cu(g,e,r,c,p,y){const T=g.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(e*g.pixelRatio,r*g.pixelRatio,c*g.pixelRatio,p*g.pixelRatio),T.clear({color:y}),C.disable(C.SCISSOR_TEST)}function $i(g,e,r){const c=g.context,p=c.gl,y=g.useProgram("debug"),T=Qt.disabled,C=oi.disabled,I=g.colorModeForRenderPass(),O="$debug",k=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);c.activeTexture.set(p.TEXTURE0);const F=e.getTileByID(r.key).latestRawTileData,z=Math.floor((F&&F.byteLength||0)/1024),G=e.getTile(r).tileSize,Y=512/Math.min(G,512)*(r.overscaledZ/g.transform.zoom)*.5;let ne=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(ne+=` => ${r.overscaledZ}`),function(re,le){re.initDebugOverlayCanvas();const me=re.debugOverlayCanvas,pe=re.context.gl,be=re.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,me.width,me.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(le,5,5),be.strokeText(le,5,5),re.debugOverlayTexture.update(me),re.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(g,`${ne} ${z}kB`);const ae=g.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(c,p.TRIANGLES,T,C,Ni.alphaBlended,mi.disabled,Ch(h.b7.transparent,Y),null,ae,O,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),y.draw(c,p.LINE_STRIP,T,C,I,mi.disabled,Ch(h.b7.red),k,ae,O,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function zs(g,e,r,c){const{isRenderingGlobe:p}=c,y=g.context,T=y.gl,C=g.transform,I=g.colorModeForRenderPass(),O=g.getDepthModeFor3D(),k=g.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]);for(const F of r){const z=e.getTerrainMesh(F.tileID),G=g.renderToTexture.getTexture(F),Y=e.getTerrainData(F.tileID);y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,G.texture);const ne=e.getMeshFrameDelta(C.zoom),ae=C.calculateFogMatrix(F.tileID.toUnwrapped()),re=qf(ne,ae,g.style.sky,C.pitch,p),le=C.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});k.draw(y,T.TRIANGLES,O,oi.disabled,I,mi.backCCW,re,Y,le,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}function Kn(g,e){if(!e.mesh){const r=new h.aI;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new h.aK;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new jo(g.createVertexBuffer(r,fn.members),g.createIndexBuffer(c),h.aJ.simpleSegment(0,0,r.length,c.length))}return e.mesh}class hu{constructor(e,r){this.context=new Ns(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zu}resize(e,r,c){if(this.width=Math.floor(e*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,r=new h.aI;r.emplaceBack(0,0),r.emplaceBack(h.Z,0),r.emplaceBack(0,h.Z),r.emplaceBack(h.Z,h.Z),this.tileExtentBuffer=e.createVertexBuffer(r,fn.members),this.tileExtentSegments=h.aJ.simpleSegment(0,0,4,2);const c=new h.aI;c.emplaceBack(0,0),c.emplaceBack(h.Z,0),c.emplaceBack(0,h.Z),c.emplaceBack(h.Z,h.Z),this.debugBuffer=e.createVertexBuffer(c,fn.members),this.debugSegments=h.aJ.simpleSegment(0,0,4,5);const p=new h.b_;p.emplaceBack(0,0,0,0),p.emplaceBack(h.Z,0,h.Z,0),p.emplaceBack(0,h.Z,0,h.Z),p.emplaceBack(h.Z,h.Z,h.Z,h.Z),this.rasterBoundsBuffer=e.createVertexBuffer(p,Hf.members),this.rasterBoundsSegments=h.aJ.simpleSegment(0,0,4,2);const y=new h.aI;y.emplaceBack(0,0),y.emplaceBack(h.Z,0),y.emplaceBack(0,h.Z),y.emplaceBack(h.Z,h.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(y,fn.members),this.rasterBoundsSegmentsPosOnly=h.aJ.simpleSegment(0,0,4,5);const T=new h.aI;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(T,fn.members),this.viewportSegments=h.aJ.simpleSegment(0,0,4,2);const C=new h.b$;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(C);const I=new h.aK;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(I);const O=this.context.gl;this.stencilClearMode=new oi({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.tileExtentMesh=new jo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=h.K();h.bQ(c,0,this.width,this.height,0,0,1),h.M(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const p={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Qt.disabled,this.stencilClearMode,Ni.disabled,mi.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const p=this.context;p.setColorMode(Ni.disabled),p.setDepthMode(Qt.disabled);const y={};for(const T of r)y[T.key]=this.nextStencilID++;this._renderTileMasks(y,r,c,!0),this._renderTileMasks(y,r,c,!1),this._tileClippingMaskIDs=y}_renderTileMasks(e,r,c,p){const y=this.context,T=y.gl,C=this.style.projection,I=this.transform,O=this.useProgram("clippingMask");for(const k of r){const F=e[k.key],z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),G=C.getMeshFromTileID(this.context,k.canonical,p,!0,"stencil"),Y=I.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!c,applyTerrainMatrix:!0});O.draw(y,T.TRIANGLES,Qt.disabled,new oi({func:T.ALWAYS,mask:0},F,255,T.KEEP,T.KEEP,T.REPLACE),Ni.disabled,c?mi.disabled:mi.backCCW,null,z,Y,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,c=this.style.projection,p=this.transform,y=this.useProgram("depth"),T=this.getDepthModeFor3D(),C=Se(p,{tileSize:p.tileSize});for(const I of C){const O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),k=c.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),F=p.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(e,r.TRIANGLES,T,oi.disabled,Ni.disabled,mi.backCCW,null,O,F,"$clipping",k.vertexBuffer,k.indexBuffer,k.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new oi({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new oi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,c=e.sort((T,C)=>C.overscaledZ-T.overscaledZ),p=c[c.length-1].overscaledZ,y=c[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let C=0;C<y;C++)T[C+p]=new oi({func:r.GEQUAL,mask:255},C+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=y,[T,c]}return[{[p]:oi.disabled},c]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,c=e.sort((T,C)=>C.overscaledZ-T.overscaledZ),p=c[c.length-1].overscaledZ,y=c[0].overscaledZ-p+1;if(this.clearStencil(),y>1){const T={},C={};for(let I=0;I<y;I++)T[I+p]=new oi({func:r.GREATER,mask:255},y+1+I,255,r.KEEP,r.KEEP,r.REPLACE),C[I+p]=new oi({func:r.GREATER,mask:255},1+I,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*y+1,[T,C,c]}return this.nextStencilID=3,[{[p]:new oi({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[p]:new oi({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ni([e.CONSTANT_COLOR,e.ONE],new h.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ni.unblended:Ni.alphaBlended}getDepthModeForSublayer(e,r,c){if(!this.opaquePassEnabledForLayer())return Qt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Qt(c||this.context.gl.LEQUAL,r,[p,p])}getDepthModeFor3D(){return new Qt(this.context.gl.LEQUAL,Qt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var c,p;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ae.now()),this.imageManager.beginFrame();const y=this.style._order,T=this.style.sourceCaches,C={},I={},O={},k={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const z in T){const G=T[z];G.used&&G.prepare(this.context),C[z]=G.getVisibleCoordinates(!1),I[z]=C[z].slice().reverse(),O[z]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<y.length;z++)if(this.style._layers[y[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of y){const G=this.style._layers[z];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const Y=I[G.source];(G.type==="custom"||Y.length)&&this.renderLayer(this,T[G.source],G,Y,k)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:z=>this.useProgram(z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?h.b7.black:h.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,G){const Y=z.context,ne=Y.gl,ae=((we,xe,ke)=>{const Ke=Math.cos(xe.rollInRadians),Ge=Math.sin(xe.rollInRadians),qe=De(xe),$e=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:we.properties.get("sky-color"),u_horizon_color:we.properties.get("horizon-color"),u_horizon:[(xe.width/2-qe*Ge)*ke,(xe.height/2+qe*Ke)*ke],u_horizon_normal:[-Ge,Ke],u_sky_horizon_blend:we.properties.get("sky-horizon-blend")*xe.height/2*ke,u_sky_blend:$e}})(G,z.style.map.transform,z.pixelRatio),re=new Qt(ne.LEQUAL,Qt.ReadWrite,[0,1]),le=oi.disabled,me=z.colorModeForRenderPass(),pe=z.useProgram("sky"),be=Kn(Y,G);pe.draw(Y,ne.TRIANGLES,re,le,me,mi.disabled,ae,null,void 0,"sky",be.vertexBuffer,be.indexBuffer,be.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[y[this.currentLayer]],G=T[z.source],Y=C[z.source];this._renderTileClippingMasks(z,Y,!1),this.renderLayer(this,G,z,Y,k)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const z=this.style._layers[y[this.currentLayer]],G=T[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z,k))continue;this.opaquePassEnabledForLayer()||F||(F=!0,k.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Y=(z.type==="symbol"?O:I)[z.source];this._renderTileClippingMasks(z,C[z.source],!!this.renderToTexture),this.renderLayer(this,G,z,Y,k)}if(k.isRenderingGlobe&&function(z,G,Y){const ne=z.context,ae=ne.gl,re=z.useProgram("atmosphere"),le=new Qt(ae.LEQUAL,Qt.ReadOnly,[0,1]),me=z.transform,pe=function($e,_t){const mt=$e.properties.get("position"),rt=[-mt.x,-mt.y,-mt.z],Rt=h.ad(new Float64Array(16));return $e.properties.get("anchor")==="map"&&(h.a_(Rt,Rt,_t.rollInRadians),h.a$(Rt,Rt,-_t.pitchInRadians),h.a_(Rt,Rt,_t.bearingInRadians),h.a$(Rt,Rt,_t.center.lat*Math.PI/180),h.bp(Rt,Rt,-_t.center.lng*Math.PI/180)),h.bZ(rt,rt,Rt),rt}(Y,z.transform),be=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=G.properties.get("atmosphere-blend")*be.projectionTransition;if(we===0)return;const xe=Qo(me.worldSize,me.center.lat),ke=me.inverseProjectionMatrix,Ke=new Float64Array(4);Ke[3]=1,h.at(Ke,Ke,me.modelViewProjectionMatrix),Ke[0]/=Ke[3],Ke[1]/=Ke[3],Ke[2]/=Ke[3],Ke[3]=1,h.at(Ke,Ke,ke),Ke[0]/=Ke[3],Ke[1]/=Ke[3],Ke[2]/=Ke[3],Ke[3]=1;const Ge=(($e,_t,mt,rt,Rt)=>({u_sun_pos:$e,u_atmosphere_blend:_t,u_globe_position:mt,u_globe_radius:rt,u_inv_proj_matrix:Rt}))(pe,we,[Ke[0],Ke[1],Ke[2]],xe,ke),qe=Kn(ne,G);re.draw(ne,ae.TRIANGLES,le,oi.disabled,Ni.alphaBlended,mi.disabled,Ge,null,null,"atmosphere",qe.vertexBuffer,qe.indexBuffer,qe.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const z=function(G,Y){let ne=null;const ae=Object.values(G._layers).flatMap(pe=>pe.source&&!pe.isHidden(Y)?[G.sourceCaches[pe.source]]:[]),re=ae.filter(pe=>pe.getSource().type==="vector"),le=ae.filter(pe=>pe.getSource().type!=="vector"),me=pe=>{(!ne||ne.getSource().maxzoom<pe.getSource().maxzoom)&&(ne=pe)};return re.forEach(pe=>me(pe)),ne||le.forEach(pe=>me(pe)),ne}(this.style,this.transform.zoom);z&&function(G,Y,ne){for(let ae=0;ae<ne.length;ae++)$i(G,Y,ne[ae])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const G=z.transform.padding;cs(z,z.transform.height-(G.top||0),3,Ju),cs(z,G.bottom||0,3,Hl),Hr(z,G.left||0,3,wn),Hr(z,z.transform.width-(G.right||0),3,Ta);const Y=z.transform.centerPoint;(function(ne,ae,re,le){cu(ne,ae-1,re-10,2,20,le),cu(ne,ae-10,re-1,20,2,le)})(z,Y.x,z.transform.height-Y.y,Ii)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!h.c0(r,c):!h.c1(r,c)),p||(p=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(h.c2(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,T){const C=y.context,I=C.gl,O=y.transform,k=Ni.unblended,F=new Qt(I.LEQUAL,Qt.ReadWrite,[0,1]),z=T.sourceCache.getRenderableTiles(),G=y.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:h.b7.transparent,depth:1});for(const Y of z){const ne=T.getTerrainMesh(Y.tileID),ae=T.getTerrainData(Y.tileID),re=O.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),le={u_ele_delta:T.getMeshFrameDelta(O.zoom)};G.draw(C,I.TRIANGLES,F,oi.disabled,k,mi.backCCW,le,ae,re,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,T){const C=y.context,I=C.gl,O=y.transform,k=Ni.unblended,F=new Qt(I.LEQUAL,Qt.ReadWrite,[0,1]),z=T.getCoordsTexture(),G=T.sourceCache.getRenderableTiles(),Y=y.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:h.b7.transparent,depth:1}),T.coordsIndex=[];for(const ne of G){const ae=T.getTerrainMesh(ne.tileID),re=T.getTerrainData(ne.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,z.texture);const le={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(O.zoom)},me=O.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(C,I.TRIANGLES,F,oi.disabled,k,mi.backCCW,le,re,me,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),T.coordsIndex.push(ne.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(e,r,c,p,y){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,h.c3(c)?function(T,C,I,O,k,F){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:z}=F,G=oi.disabled,Y=T.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ae,re,le,me,pe,be,we,xe){const ke=ae.transform,Ke=ae.style.map.terrain,Ge=me==="map",qe=pe==="map";for(const $e of ne){const _t=le.getTile($e),mt=_t.getBucket(re);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const rt=h.ak(mt.textSizeData,ke.zoom),Rt=h.az(_t,1,ae.transform.zoom),ui=Lt(Ge,ae.transform,Rt),_i=re.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(rt){const da=Math.pow(2,ke.zoom-_t.tileID.overscaledZ),ji=Ke?(fa,sa)=>Ke.getElevation($e,fa,sa):null;Ul(mt,Ge,qe,xe,ke,ui,da,rt,_i,h.aA(ke,_t,be,we),$e.toUnwrapped(),ji)}}}(O,T,I,C,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),k),I.paint.get("icon-opacity").constantOr(1)!==0&&Ku(T,C,I,O,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),G,Y,z),I.paint.get("text-opacity").constantOr(1)!==0&&Ku(T,C,I,O,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),G,Y,z),C.map.showCollisionBoxes&&(Fn(T,C,I,O,!0),Fn(T,C,I,O,!1))}(e,r,c,p,this.style.placement.variableOffsets,y):h.c4(c)?function(T,C,I,O,k){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:F}=k,z=I.paint.get("circle-opacity"),G=I.paint.get("circle-stroke-width"),Y=I.paint.get("circle-stroke-opacity"),ne=!I.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(G.constantOr(1)===0||Y.constantOr(1)===0))return;const ae=T.context,re=ae.gl,le=T.transform,me=T.getDepthModeForSublayer(0,Qt.ReadOnly),pe=oi.disabled,be=T.colorModeForRenderPass(),we=[],xe=le.getCircleRadiusCorrection();for(let ke=0;ke<O.length;ke++){const Ke=O[ke],Ge=C.getTile(Ke),qe=Ge.getBucket(I);if(!qe)continue;const $e=I.paint.get("circle-translate"),_t=I.paint.get("circle-translate-anchor"),mt=h.aA(le,Ge,$e,_t),rt=qe.programConfigurations.get(I.id),Rt=T.useProgram("circle",rt),ui=qe.layoutVertexBuffer,_i=qe.indexBuffer,da=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ke),ji={programConfiguration:rt,program:Rt,layoutVertexBuffer:ui,indexBuffer:_i,uniformValues:Vu(T,Ge,I,mt,xe),terrainData:da,projectionData:le.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(ne){const fa=qe.segments.get();for(const sa of fa)we.push({segments:new h.aJ([sa]),sortKey:sa.sortKey,state:ji})}else we.push({segments:qe.segments,sortKey:0,state:ji})}ne&&we.sort((ke,Ke)=>ke.sortKey-Ke.sortKey);for(const ke of we){const{programConfiguration:Ke,program:Ge,layoutVertexBuffer:qe,indexBuffer:$e,uniformValues:_t,terrainData:mt,projectionData:rt}=ke.state;Ge.draw(ae,re.TRIANGLES,me,pe,be,mi.backCCW,_t,mt,rt,I.id,qe,$e,ke.segments,I.paint,T.transform.zoom,Ke)}}(e,r,c,p,y):h.c5(c)?function(T,C,I,O,k){if(I.paint.get("heatmap-opacity")===0)return;const F=T.context,{isRenderingToTexture:z,isRenderingGlobe:G}=k;if(T.style.map.terrain){for(const Y of O){const ne=C.getTile(Y);C.hasRenderableParent(Y)||(T.renderPass==="offscreen"?Bs(T,ne,I,Y,G):T.renderPass==="translucent"&&To(T,I,Y,z,G))}F.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?function(Y,ne,ae,re){const le=Y.context,me=le.gl,pe=Y.transform,be=oi.disabled,we=new Ni([me.ONE,me.ONE],h.b7.transparent,[!0,!0,!0,!0]);(function(xe,ke,Ke){const Ge=xe.gl;xe.activeTexture.set(Ge.TEXTURE1),xe.viewport.set([0,0,ke.width/4,ke.height/4]);let qe=Ke.heatmapFbos.get(h.bW);qe?(Ge.bindTexture(Ge.TEXTURE_2D,qe.colorAttachment.get()),xe.bindFramebuffer.set(qe.framebuffer)):(qe=lu(xe,ke.width/4,ke.height/4),Ke.heatmapFbos.set(h.bW,qe))})(le,Y,ae),le.clear({color:h.b7.transparent});for(let xe=0;xe<re.length;xe++){const ke=re[xe];if(ne.hasRenderableParent(ke))continue;const Ke=ne.getTile(ke),Ge=Ke.getBucket(ae);if(!Ge)continue;const qe=Ge.programConfigurations.get(ae.id),$e=Y.useProgram("heatmap",qe),_t=pe.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),mt=pe.getCircleRadiusCorrection();$e.draw(le,me.TRIANGLES,Qt.disabled,be,we,mi.backCCW,Ir(Ke,pe.zoom,ae.paint.get("heatmap-intensity"),mt),null,_t,ae.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,ae.paint,pe.zoom,qe)}le.viewport.set([0,0,Y.width,Y.height])}(T,C,I,O):T.renderPass==="translucent"&&function(Y,ne){const ae=Y.context,re=ae.gl;ae.setColorMode(Y.colorModeForRenderPass());const le=ne.heatmapFbos.get(h.bW);le&&(ae.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,le.colorAttachment.get()),ae.activeTexture.set(re.TEXTURE1),Wu(ae,ne).bind(re.LINEAR,re.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(ae,re.TRIANGLES,Qt.disabled,oi.disabled,Y.colorModeForRenderPass(),mi.disabled,Cd(Y,ne,0,1),null,null,ne.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,ne.paint,Y.transform.zoom))}(T,I)}(e,r,c,p,y):h.c6(c)?function(T,C,I,O,k){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:F}=k,z=I.paint.get("line-opacity"),G=I.paint.get("line-width");if(z.constantOr(1)===0||G.constantOr(1)===0)return;const Y=T.getDepthModeForSublayer(0,Qt.ReadOnly),ne=T.colorModeForRenderPass(),ae=I.paint.get("line-dasharray"),re=I.paint.get("line-pattern"),le=re.constantOr(1),me=I.paint.get("line-gradient"),pe=I.getCrossfadeParameters(),be=le?"linePattern":ae?"lineSDF":me?"lineGradient":"line",we=T.context,xe=we.gl,ke=T.transform;let Ke=!0;for(const Ge of O){const qe=C.getTile(Ge);if(le&&!qe.patternsLoaded())continue;const $e=qe.getBucket(I);if(!$e)continue;const _t=$e.programConfigurations.get(I.id),mt=T.context.program.get(),rt=T.useProgram(be,_t),Rt=Ke||rt.program!==mt,ui=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ge),_i=re.constantOr(null);if(_i&&qe.imageAtlas){const Xi=qe.imageAtlas,Di=Xi.patternPositions[_i.to.toString()],za=Xi.patternPositions[_i.from.toString()];Di&&za&&_t.setConstantPatternPositions(Di,za)}const da=ke.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),ji=ke.getPixelScale(),fa=le?Yu(T,qe,I,ji,pe):ae?Id(T,qe,I,ji,ae,pe):me?Zu(T,qe,I,ji,$e.lineClipsArray.length):Gu(T,qe,I,ji);if(le)we.activeTexture.set(xe.TEXTURE0),qe.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),_t.updatePaintBuffers(pe);else if(ae&&(Rt||T.lineAtlas.dirty))we.activeTexture.set(xe.TEXTURE0),T.lineAtlas.bind(we);else if(me){const Xi=$e.gradients[I.id];let Di=Xi.texture;if(I.gradientVersion!==Xi.version){let za=256;if(I.stepInterpolant){const Ka=C.getSource().maxzoom,un=Ge.canonical.z===Ka?Math.ceil(1<<T.transform.maxZoom-Ge.canonical.z):1;za=h.ae(h.bX($e.maxLineLength/h.Z*1024*un),256,we.maxTextureSize)}Xi.gradient=h.bY({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:za,image:Xi.gradient||void 0,clips:$e.lineClipsArray}),Xi.texture?Xi.texture.update(Xi.gradient):Xi.texture=new xt(we,Xi.gradient,xe.RGBA),Xi.version=I.gradientVersion,Di=Xi.texture}we.activeTexture.set(xe.TEXTURE0),Di.bind(I.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}const sa=T.stencilModeForClipping(Ge);rt.draw(we,xe.TRIANGLES,Y,sa,ne,mi.disabled,fa,ui,da,I.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,I.paint,T.transform.zoom,_t,$e.layoutVertexBuffer2),Ke=!1}}(e,r,c,p,y):h.c7(c)?function(T,C,I,O,k){const F=I.paint.get("fill-color"),z=I.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const{isRenderingToTexture:G}=k,Y=T.colorModeForRenderPass(),ne=I.paint.get("fill-pattern"),ae=T.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&F.constantOr(h.b7.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===ae){const re=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);En(T,C,I,O,re,Y,!1,G)}if(T.renderPass==="translucent"&&I.paint.get("fill-antialias")){const re=T.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);En(T,C,I,O,re,Y,!0,G)}}(e,r,c,p,y):h.c8(c)?function(T,C,I,O,k){const F=I.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:z}=k;if(T.renderPass==="translucent"){const G=new Qt(T.context.gl.LEQUAL,Qt.ReadWrite,T.depthRangeFor3D);if(F!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Fr(T,C,I,O,G,oi.disabled,Ni.disabled,z),Fr(T,C,I,O,G,T.stencilModeFor3D(),T.colorModeForRenderPass(),z);else{const Y=T.colorModeForRenderPass();Fr(T,C,I,O,G,oi.disabled,Y,z)}}}(e,r,c,p,y):h.c9(c)?function(T,C,I,O,k){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:F}=k,z=T.context,G=T.style.projection.useSubdivision,Y=T.getDepthModeForSublayer(0,Qt.ReadOnly),ne=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(ae,re,le,me,pe,be,we){const xe=ae.context,ke=xe.gl;for(const Ke of le){const Ge=re.getTile(Ke),qe=Ge.dem;if(!qe||!qe.data||!Ge.needsHillshadePrepare)continue;const $e=qe.dim,_t=qe.stride,mt=qe.getPixels();if(xe.activeTexture.set(ke.TEXTURE1),xe.pixelStoreUnpackPremultiplyAlpha.set(!1),Ge.demTexture=Ge.demTexture||ae.getTileTexture(_t),Ge.demTexture){const Rt=Ge.demTexture;Rt.update(mt,{premultiply:!1}),Rt.bind(ke.NEAREST,ke.CLAMP_TO_EDGE)}else Ge.demTexture=new xt(xe,mt,ke.RGBA,{premultiply:!1}),Ge.demTexture.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);xe.activeTexture.set(ke.TEXTURE0);let rt=Ge.fbo;if(!rt){const Rt=new xt(xe,{width:$e,height:$e,data:null},ke.RGBA);Rt.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),rt=Ge.fbo=xe.createFramebuffer($e,$e,!0,!1),rt.colorAttachment.set(Rt.texture)}xe.bindFramebuffer.set(rt.framebuffer),xe.viewport.set([0,0,$e,$e]),ae.useProgram("hillshadePrepare").draw(xe,ke.TRIANGLES,pe,be,we,mi.disabled,Vf(Ge.tileID,qe),null,null,me.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),Ge.needsHillshadePrepare=!1}})(T,C,O,I,Y,oi.disabled,ne),z.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(G){const[ae,re,le]=T.stencilConfigForOverlapTwoPass(O);Ur(T,C,I,le,ae,Y,ne,!1,F),Ur(T,C,I,le,re,Y,ne,!0,F)}else{const[ae,re]=T.getStencilConfigForOverlapAndUpdateStencilID(O);Ur(T,C,I,re,ae,Y,ne,!1,F)}}(e,r,c,p,y):h.ca(c)?function(T,C,I,O,k){if(T.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!O.length)return;const{isRenderingToTexture:F}=k,z=C.getSource(),G=T.style.projection.useSubdivision;if(z instanceof Zn)ls(T,C,I,O,null,!1,!1,z.tileCoords,z.flippedWindingOrder,F);else if(G){const[Y,ne,ae]=T.stencilConfigForOverlapTwoPass(O);ls(T,C,I,ae,Y,!1,!0,fr,!1,F),ls(T,C,I,ae,ne,!0,!0,fr,!1,F)}else{const[Y,ne]=T.getStencilConfigForOverlapAndUpdateStencilID(O);ls(T,C,I,ne,Y,!1,!0,fr,!1,F)}}(e,r,c,p,y):h.cb(c)?function(T,C,I,O,k){const F=I.paint.get("background-color"),z=I.paint.get("background-opacity");if(z===0)return;const{isRenderingToTexture:G}=k,Y=T.context,ne=Y.gl,ae=T.style.projection,re=T.transform,le=re.tileSize,me=I.paint.get("background-pattern");if(T.isPatternMissing(me))return;const pe=!me&&F.a===1&&z===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==pe)return;const be=oi.disabled,we=T.getDepthModeForSublayer(0,pe==="opaque"?Qt.ReadWrite:Qt.ReadOnly),xe=T.colorModeForRenderPass(),ke=T.useProgram(me?"backgroundPattern":"background"),Ke=O||Se(re,{tileSize:le,terrain:T.style.map.terrain});me&&(Y.activeTexture.set(ne.TEXTURE0),T.imageManager.bind(T.context));const Ge=I.getCrossfadeParameters();for(const qe of Ke){const $e=re.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),_t=me?Gf(z,T,me,{tileID:qe,tileSize:le},Ge):Dd(z,F),mt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(qe),rt=ae.getMeshFromTileID(Y,qe.canonical,!1,!0,"raster");ke.draw(Y,ne.TRIANGLES,we,be,xe,mi.backCCW,_t,mt,$e,I.id,rt.vertexBuffer,rt.indexBuffer,rt.segments)}}(e,0,c,p,y):h.cc(c)&&function(T,C,I,O){const{isRenderingGlobe:k}=O,F=T.context,z=I.implementation,G=T.style.projection,Y=T.transform,ne=Y.getProjectionDataForCustomLayer(k),ae={farZ:Y.farZ,nearZ:Y.nearZ,fov:Y.fov*Math.PI/180,modelViewProjectionMatrix:Y.modelViewProjectionMatrix,projectionMatrix:Y.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:ne},re=z.renderingMode?z.renderingMode:"2d";if(T.renderPass==="offscreen"){const le=z.prerender;le&&(T.setCustomLayerDefaults(),F.setColorMode(T.colorModeForRenderPass()),le.call(z,F.gl,ae),F.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),F.setColorMode(T.colorModeForRenderPass()),F.setStencilMode(oi.disabled);const le=re==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,Qt.ReadOnly);F.setDepthMode(le),z.render(F.gl,ae),F.setDirty(),T.setBaseState(),F.bindFramebuffer.set(null)}}(e,0,c,y))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!r||!c}useProgram(e,r,c=!1,p=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,T=this.style.projection,C=c?Nn.projectionMercator:T.shaderPreludeCode,I=c?qo:T.shaderDefine,O=e+(r?r.cacheKey:"")+`/${c?xi:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[O]||(this.cache[O]=new Ac(this.context,Nn[e],r,Rd[e],this._showOverdrawInspector,y,C,I,p)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new xt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Fs(g,e){let r,c=!1,p=null,y=null;const T=()=>{p=null,c&&(g.apply(y,r),p=setTimeout(T,e),c=!1)};return(...C)=>(c=!0,y=this,r=C,p||T(),p)}class Bc{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let p=c;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${c}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let T=window.location.href.replace(/(#.+)?$/,y);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=Fs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),T=Math.round(r.lng*y)/y,C=Math.round(r.lat*y)/y,I=this._map.getBearing(),O=this._map.getPitch();let k="";if(k+=e?`/${T}/${C}/${c}`:`${c}/${C}/${T}`,(I||O)&&(k+="/"+Math.round(10*I)/10),O&&(k+=`/${Math.round(O)}`),this._hashName){const F=this._hashName;let z=!1;const G=window.location.hash.slice(1).split("&").map(Y=>{const ne=Y.split("=")[0];return ne===F?(z=!0,`${ne}=${k}`):Y}).filter(Y=>Y);return z||G.push(`${F}=${k}`),`#${G.join("&")}`}return`#${k}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new h.Q(+e[2],+e[1])}catch{return!1}const r=+e[0],c=+(e[3]||0),p=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Wn={linearity:.3,easing:h.cd(0,0,.3,1)},jl=h.e({deceleration:2500,maxSpeed:1400},Wn),jr=h.e({deceleration:20,maxSpeed:1400},Wn),qr=h.e({deceleration:1e3,maxSpeed:360},Wn),Us=h.e({deceleration:1e3,maxSpeed:90},Wn),hs=h.e({deceleration:1e3,maxSpeed:360},Wn);class zc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ae.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=Ae.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)r.zoom+=y.zoomDelta||0,r.bearing+=y.bearingDelta||0,r.pitch+=y.pitchDelta||0,r.roll+=y.rollDelta||0,y.panDelta&&r.pan._add(y.panDelta),y.around&&(r.around=y.around),y.pinchAround&&(r.pinchAround=y.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const y=ds(r.pan.mag(),c,h.e({},jl,e||{})),T=r.pan.mult(y.amount/r.pan.mag()),C=this._map.cameraHelper.handlePanInertia(T,this._map.transform);p.center=C.easingCenter,p.offset=C.easingOffset,Eo(p,y)}if(r.zoom){const y=ds(r.zoom,c,jr);p.zoom=this._map.transform.zoom+y.amount,Eo(p,y)}if(r.bearing){const y=ds(r.bearing,c,qr);p.bearing=this._map.transform.bearing+h.ae(y.amount,-179,179),Eo(p,y)}if(r.pitch){const y=ds(r.pitch,c,Us);p.pitch=this._map.transform.pitch+y.amount,Eo(p,y)}if(r.roll){const y=ds(r.roll,c,hs);p.roll=this._map.transform.roll+h.ae(y.amount,-179,179),Eo(p,y)}if(p.zoom||p.bearing){const y=r.pinchAround===void 0?r.around:r.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),h.e(p,{noMoveStart:!0})}}function Eo(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function ds(g,e,r){const{maxSpeed:c,linearity:p,deceleration:y}=r,T=h.ae(g*p/(e/1e3),-c,c),C=Math.abs(T)/(y*p);return{easing:r.easing,duration:1e3*C,amount:T*(C/2)}}class Da extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c,p={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);const y=he.mousePos(r.getCanvas(),c),T=r.unproject(y);super(e,h.e({point:y,lngLat:T,originalEvent:c},p)),this._defaultPrevented=!1,this.target=r}}class Rr extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){const p=e==="touchend"?c.changedTouches:c.touches,y=he.touchPos(r.getCanvasContainer(),p),T=y.map(I=>r.unproject(I)),C=y.reduce((I,O,k,F)=>I.add(O.div(F.length)),new h.P(0,0));super(e,{points:y,point:C,lngLats:T,lngLat:r.unproject(C),originalEvent:c}),this._defaultPrevented=!1}}class on extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class ql{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new on(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new Da(e.type,this._map,e))}mouseup(e){this._map.fire(new Da(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Da(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Da(e.type,this._map,e))}mouseover(e){this._map.fire(new Da(e.type,this._map,e))}mouseout(e){this._map.fire(new Da(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Rr(e.type,this._map,e))}touchmove(e){this._map.fire(new Rr(e.type,this._map,e))}touchend(e){this._map.fire(new Rr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Rr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fh{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Da(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Da("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Da(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class el{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(h.P.convert(e),this._map.terrain)}}class Uh{constructor(e,r){this._map=e,this._tr=new el(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(he.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(p.x,c.x),T=Math.max(p.x,c.x),C=Math.min(p.y,c.y),I=Math.max(p.y,c.y);he.setTransform(this._box,`translate(${y}px,${C}px)`),this._box.style.width=T-y+"px",this._box.style.height=I-C+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const c=this._startPos,p=r;if(this.reset(),he.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(c,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new h.l(e,{originalEvent:r}))}}function Fc(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const r={};for(let c=0;c<g.length;c++)r[g[c].identifier]=e[c];return r}class Ga{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const y=new h.P(0,0);for(const T of p)y._add(T);return y.div(p.length)}(r),this.touches=Fc(c,r)))}touchmove(e,r,c){if(this.aborted||!this.centroid)return;const p=Fc(c,r);for(const y in this.touches){const T=p[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,r,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class wo{constructor(e){this.singleTap=new Ga(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,c){this.singleTap.touchstart(e,r,c)}touchmove(e,r,c){this.singleTap.touchmove(e,r,c)}touchend(e,r,c){const p=this.singleTap.touchend(e,r,c);if(p){const y=e.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(y&&T||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class tl{constructor(e){this._tr=new el(e),this._zoomIn=new wo({numTouches:1,numTaps:2}),this._zoomOut=new wo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,c){this._zoomIn.touchstart(e,r,c),this._zoomOut.touchstart(e,r,c)}touchmove(e,r,c){this._zoomIn.touchmove(e,r,c),this._zoomOut.touchmove(e,r,c)}touchend(e,r,c){const p=this._zoomIn.touchend(e,r,c),y=this._zoomOut.touchend(e,r,c),T=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=Array.isArray(r)?r[0]:r;return!this._moved&&p.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(c,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&he.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const pr={0:1,2:2};class Vr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=he.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,c){const p=pr[c];return r.buttons===void 0||(r.buttons&p)!==p}(e,this._eventButton)}isValidEndEvent(e){return he.mouseButton(e)===this._eventButton}}class An{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class il{constructor(e=new Vr({checkCorrectEvent:()=>!0}),r=new An){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,c){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const Vl=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class Zf{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,c){return this._calculateTransform(e,r,c)}touchmove(e,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,c){this._calculateTransform(e,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,c){c.length>0&&(this._active=!0);const p=Fc(c,r),y=new h.P(0,0),T=new h.P(0,0);let C=0;for(const O in p){const k=p[O],F=this._touches[O];F&&(y._add(k),T._add(k.sub(F)),C++,p[O]=k)}if(this._touches=p,this._shouldBePrevented(C)||!T.mag())return;const I=T.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,c){if(!this._firstTwoTouches)return;e.preventDefault();const[p,y]=this._firstTwoTouches,T=fs(c,r,p),C=fs(c,r,y);if(!T||!C)return;const I=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],I,e)}touchend(e,r,c){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,T=fs(c,r,p),C=fs(c,r,y);T&&C||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function fs(g,e,r){for(let c=0;c<g.length;c++)if(g[c].identifier===r)return e[c]}function Gl(g,e){return Math.log(g/e)/Math.LN2}class Hs extends Uc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Gl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gl(this._distance,c),pinchAround:r}}}function Gr(g,e){return 180*g.angleWith(e)/Math.PI}class wt extends Uc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,c){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gr(this._vector,p),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,c=Gr(e,this._startVector);return Math.abs(c)<r}}function Zl(g){return Math.abs(g.y)>Math.abs(g.x)}class du extends Uc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,c){super.touchstart(e,r,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Zl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,c){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,y=r.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const T=e.y>0==r.y>0;return Zl(e)&&Zl(r)&&T}}const Hc={panStep:100,bearingStep:15,pitchStep:10};class fu{constructor(e){this._tr=new el(e);const r=Hc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,c=0,p=0,y=0,T=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),T=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:C=>{const I=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Ao,zoom:r?Math.round(I.zoom)+r*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+c*this._bearingStep,pitch:I.pitch+p*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ao(g){return g*(2-g)}const jc=4.000244140625;class ci{constructor(e,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new el(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=Ae.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%jc==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=he.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(h.Q.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>jc?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&I!==0&&(I=1/I);const O=typeof this._targetZoom!="number"?e.scale:h.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),h.ah(O*I)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,p=this._easing;let y,T=!1;if(this._type==="wheel"&&c&&p){const C=Ae.now()-this._lastWheelEventTime,I=Math.min((C+5)/200,1),O=p(I);y=h.B.number(c,r,O),I<1?this._frameId||(this._frameId=!0):T=!0}else y=r,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=h.cf;if(this._prevEase){const c=this._prevEase,p=(Ae.now()-c.start)/c.duration,y=c.easing(p+.01)-c.easing(p),T=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-T*T);r=h.cd(T,C,.25,1)}return this._prevEase={start:Ae.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yl{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nd{constructor(e){this._tr=new el(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ps{constructor(){this._tap=new wo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,c){if(!this._swipePoint)if(this._tapTime){const p=r[0],y=e.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;y&&T?c.length>0&&(this._swipePoint=p,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,r,c)}touchmove(e,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=r[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,r,c)}touchend(e,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const p=this._tap.touchend(e,r,c);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qc{constructor(e,r,c){this._el=e,this._mousePan=r,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vc{constructor(e,r,c,p){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ms{constructor(e,r,c,p){this._el=e,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zr{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=r,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=c,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const js=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Hh extends h.l{}function al(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class $l{constructor(e,r){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,C={needsRenderFrame:!1},I={},O={};for(const{handlerName:z,handler:G,allowed:Y}of this._handlers){if(!G.isEnabled())continue;let ne;if(this._blockedByActive(O,Y,z))G.reset();else if(G[y||p.type]){if(h.cg(p,y||p.type)){const ae=he.mousePos(this._map.getCanvas(),p);ne=G[y||p.type](p,ae)}else if(h.ch(p,y||p.type)){const ae=this._getMapTouches(p.touches),re=he.touchPos(this._map.getCanvas(),ae);ne=G[y||p.type](p,re,ae)}else h.ci(y||p.type)||(ne=G[y||p.type](p));this.mergeHandlerResult(C,I,ne,z,T),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()}(ne||G.isActive())&&(O[z]=G)}const k={};for(const z in this._previousActiveHandlers)O[z]||(k[z]=T);this._previousActiveHandlers=O,(Object.keys(k).length||al(C))&&(this._changes.push([C,I,k]),this._triggerRenderFrame()),(Object.keys(O).length||al(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=C;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zc(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,T]of this._listeners)he.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[e,r,c]of this._listeners)he.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new ql(r,e));const p=r.boxZoom=new Uh(r,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const y=r.cooperativeGestures=new Zr(r,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const T=new tl(r),C=new Nd(r);r.doubleClickZoom=new Yl(C,T),this._add("tapZoom",T),this._add("clickZoom",C),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const I=new ps;this._add("tapDragZoom",I);const O=r.touchPitch=new du(r);this._add("touchPitch",O),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const k=()=>r.project(r.getCenter()),F=function({enable:pe,clickTolerance:be,aroundCenter:we=!0,minPixelCenterThreshold:xe=100,rotateDegreesPerPixelMoved:ke=.8},Ke){const Ge=new Vr({checkCorrectEvent:qe=>he.mouseButton(qe)===0&&qe.ctrlKey||he.mouseButton(qe)===2&&!qe.ctrlKey});return new Za({clickTolerance:be,move:(qe,$e)=>{const _t=Ke();if(we&&Math.abs(_t.y-qe.y)>xe)return{bearingDelta:h.ce(new h.P(qe.x,$e.y),$e,_t)};let mt=($e.x-qe.x)*ke;return we&&$e.y<_t.y&&(mt=-mt),{bearingDelta:mt}},moveStateManager:Ge,enable:pe,assignEvents:Vl})}(e,k),z=function({enable:pe,clickTolerance:be,pitchDegreesPerPixelMoved:we=-.5}){const xe=new Vr({checkCorrectEvent:ke=>he.mouseButton(ke)===0&&ke.ctrlKey||he.mouseButton(ke)===2});return new Za({clickTolerance:be,move:(ke,Ke)=>({pitchDelta:(Ke.y-ke.y)*we}),moveStateManager:xe,enable:pe,assignEvents:Vl})}(e),G=function({enable:pe,clickTolerance:be,rollDegreesPerPixelMoved:we=.3},xe){const ke=new Vr({checkCorrectEvent:Ke=>he.mouseButton(Ke)===2&&Ke.ctrlKey});return new Za({clickTolerance:be,move:(Ke,Ge)=>{const qe=xe();let $e=(Ge.x-Ke.x)*we;return Ge.y<qe.y&&($e=-$e),{rollDelta:$e}},moveStateManager:ke,enable:pe,assignEvents:Vl})}(e,k);r.dragRotate=new Vc(e,F,z,G),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const Y=function({enable:pe,clickTolerance:be}){const we=new Vr({checkCorrectEvent:xe=>he.mouseButton(xe)===0&&!xe.ctrlKey});return new Za({clickTolerance:be,move:(xe,ke)=>({around:ke,panDelta:ke.sub(xe)}),activateOnStart:!0,moveStateManager:we,enable:pe,assignEvents:Vl})}(e),ne=new Zf(e,r);r.dragPan=new qc(c,Y,ne),this._add("mousePan",Y),this._add("touchPan",ne,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const ae=new wt,re=new Hs;r.touchZoomRotate=new ms(c,re,ae,I),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const le=r.scrollZoom=new ci(r,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const me=r.keyboard=new fu(r);this._add("keyboard",me),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Fh(r))}_add(e,r,c){this._handlers.push({handlerName:e,handler:r,allowed:c}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!js(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,c){for(const p in e)if(p!==c&&(!r||r.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const c of e)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(e,r,c,p,y){if(!c)return;h.e(e,c);const T={handlerName:p,originalEvent:c.originalEvent||y};c.zoomDelta!==void 0&&(r.zoom=T),c.panDelta!==void 0&&(r.drag=T),c.rollDelta!==void 0&&(r.roll=T),c.pitchDelta!==void 0&&(r.pitch=T),c.bearingDelta!==void 0&&(r.rotate=T)}_applyChanges(){const e={},r={},c={};for(const[p,y,T]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),h.e(r,y),h.e(c,T);this._updateMapTransform(e,r,c),this._changes=[]}_updateMapTransform(e,r,c){const p=this._map,y=p._getTransformForUpdate(),T=p.terrain;if(!(al(e)||T&&this._terrainMovement))return this._fireEvents(r,c,!0);p._stop(!0);let{panDelta:C,zoomDelta:I,bearingDelta:O,pitchDelta:k,rollDelta:F,around:z,pinchAround:G}=e;G!==void 0&&(z=G),z=z||p.transform.centerPoint,T&&!y.isPointOnMapSurface(z)&&(z=y.centerPoint);const Y={panDelta:C,zoomDelta:I,rollDelta:F,pitchDelta:k,bearingDelta:O,around:z};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(z)&&(z=y.centerPoint);const ne=z.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(C?z.sub(C):z);T?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,y),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(C))):this._map.cameraHelper.handleMapControlsPan(Y,y,ne):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Y,y,ne))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Y,y),this._map.cameraHelper.handleMapControlsPan(Y,y,ne)),p._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,c,!0)}_fireEvents(e,r,c){const p=js(this._eventsInProgress),y=js(e),T={};for(const F in e){const{originalEvent:z}=e[F];this._eventsInProgress[F]||(T[`${F}start`]=z),this._eventsInProgress[F]=e[F]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const F in T)this._fireEvent(F,T[F]);y&&this._fireEvent("move",y.originalEvent);for(const F in e){const{originalEvent:z}=e[F];this._fireEvent(F,z)}const C={};let I;for(const F in this._eventsInProgress){const{handlerName:z,originalEvent:G}=this._eventsInProgress[F];this._handlersById[z].isActive()||(delete this._eventsInProgress[F],I=r[z]||G,C[`${F}end`]=I)}for(const F in C)this._fireEvent(F,C[F]);const O=js(this._eventsInProgress),k=(p||y)&&!O;if(k&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(c&&k){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!F||!F.essential&&Ae.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:I})),z(this._map.getBearing())&&this._map.resetNorth()):(z(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new h.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Hh("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xl extends h.E{constructor(e,r,c){super(),this._renderFrameCallback=()=>{const p=Math.min((Ae.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new h.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,c){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},r),c)}panTo(e,r,c){return this.easeTo(h.e({center:e},r),c)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,c){return this.easeTo(h.e({zoom:e},r),c)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)).fire(new h.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,c){return this.easeTo(h.e({bearing:e},r),c)}resetNorth(e,r){return this.rotateTo(0,h.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Hi.convert(e).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,r)}_cameraForBoxAndBearing(e,r,c,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=h.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const O=p.padding;p.padding={top:O,bottom:O,right:O,left:O}}const T=h.e(y,p.padding);p.padding=T;const C=this.transform,I=new Hi(e,r);return this.cameraHelper.cameraForBoxAndBearing(p,T,I,c,C)}fitBounds(e,r,c){return this._fitInternal(this.cameraForBounds(e,r),r,c)}fitScreenCoordinates(e,r,c,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(e)),this.transform.screenPointToLocation(h.P.convert(r)),c,p),p,y)}_fitInternal(e,r,c){return e?(delete(r=h.e(e,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(e,r){this.stop();const c=this._getTransformForUpdate();let p=!1,y=!1,T=!1;const C=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);const I=c.zoom!==C;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(p=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(y=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(T=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)),I&&this.fire(new h.l("zoomstart",r)).fire(new h.l("zoom",r)).fire(new h.l("zoomend",r)),p&&this.fire(new h.l("rotatestart",r)).fire(new h.l("rotate",r)).fire(new h.l("rotateend",r)),y&&this.fire(new h.l("pitchstart",r)).fire(new h.l("pitch",r)).fire(new h.l("pitchend",r)),T&&this.fire(new h.l("rollstart",r)).fire(new h.l("roll",r)).fire(new h.l("rollend",r)),this.fire(new h.l("moveend",r))}calculateCameraOptionsFromTo(e,r,c,p=0){const y=h.$.fromLngLat(e,r),T=h.$.fromLngLat(c,p),C=T.x-y.x,I=T.y-y.y,O=T.z-y.z,k=Math.hypot(C,I,O);if(k===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(C,I),z=h.ah(this.transform.cameraToCenterDistance/k/this.transform.tileSize),G=180*Math.atan2(C,-I)/Math.PI;let Y=180*Math.acos(F/k)/Math.PI;return Y=O<0?90-Y:90+Y,{center:T.toLngLat(),elevation:p,zoom:z,pitch:Y,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,c,p,y){const T=this.transform.calculateCenterFromCameraLngLatAlt(e,r,c,p);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:c,pitch:p,roll:y}}easeTo(e,r){this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.cf},e)).animate===!1||!e.essential&&Ae.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),p=this.getBearing(),y=c.pitch,T=c.roll,C="bearing"in e?this._normalizeBearing(e.bearing,p):p,I="pitch"in e?+e.pitch:y,O="roll"in e?this._normalizeBearing(e.roll,T):T,k="padding"in e?e.padding:c.padding,F=h.P.convert(e.offset);let z,G;e.around&&(z=h.Q.convert(e.around),G=c.locationToScreenPoint(z));const Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ne=this.cameraHelper.handleEaseTo(c,{bearing:C,pitch:I,roll:O,padding:k,around:z,aroundPoint:G,offsetAsPoint:F,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==C,this._pitching=this._pitching||I!==y,this._rolling=this._rolling||O!==T,this._padding=!c.isPaddingEqual(k),this._zooming=this._zooming||ne.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,Y),this.terrain&&this._prepareElevation(ne.elevationCenter),this._ease(ae=>{ne.easeFunc(ae),this.terrain&&!e.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},ae=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,ae)},e),this}_prepareEase(e,r,c={}){this._moving=!0,r||c.moving||this.fire(new h.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new h.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new h.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new h.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new h.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(r-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(h.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),c=e.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(c<p){const y=this.calculateCameraOptionsFromTo(r,p,e.center,e.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(p=>this._elevateCameraIfInsideTerrain(p)),this.transformCameraUpdate&&r.push(p=>this.transformCameraUpdate(p)),!r.length)return;const c=e.clone();for(const p of r){const y=c.clone(),{center:T,zoom:C,roll:I,pitch:O,bearing:k,elevation:F}=p(y);T&&y.setCenter(T),F!==void 0&&y.setElevation(F),C!==void 0&&y.setZoom(C),I!==void 0&&y.setRoll(I),O!==void 0&&y.setPitch(O),k!==void 0&&y.setBearing(k),c.apply(y)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new h.l("move",e)),this._zooming&&this.fire(new h.l("zoom",e)),this._rotating&&this.fire(new h.l("rotate",e)),this._pitching&&this.fire(new h.l("pitch",e)),this._rolling&&this.fire(new h.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,p=this._rotating,y=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new h.l("zoomend",e)),p&&this.fire(new h.l("rotateend",e)),y&&this.fire(new h.l("pitchend",e)),T&&this.fire(new h.l("rollend",e)),this.fire(new h.l("moveend",e))}flyTo(e,r){if(!e.essential&&Ae.prefersReducedMotion){const $e=h.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo($e,r)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cf},e);const c=this._getTransformForUpdate(),p=c.bearing,y=c.pitch,T=c.roll,C=c.padding,I="bearing"in e?this._normalizeBearing(e.bearing,p):p,O="pitch"in e?+e.pitch:y,k="roll"in e?this._normalizeBearing(e.roll,T):T,F="padding"in e?e.padding:c.padding,z=h.P.convert(e.offset);let G=c.centerPoint.add(z);const Y=c.screenPointToLocation(G),ne=this.cameraHelper.handleFlyTo(c,{bearing:I,pitch:O,roll:k,padding:F,locationAtOffset:Y,offsetAsPoint:z,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ae=e.curve;const re=Math.max(c.width,c.height),le=re/ne.scaleOfZoom,me=ne.pixelPathLength;typeof ne.scaleOfMinZoom=="number"&&(ae=Math.sqrt(re/ne.scaleOfMinZoom/me*2));const pe=ae*ae;function be($e){const _t=(le*le-re*re+($e?-1:1)*pe*pe*me*me)/(2*($e?le:re)*pe*me);return Math.log(Math.sqrt(_t*_t+1)-_t)}function we($e){return(Math.exp($e)-Math.exp(-$e))/2}function xe($e){return(Math.exp($e)+Math.exp(-$e))/2}const ke=be(!1);let Ke=function($e){return xe(ke)/xe(ke+ae*$e)},Ge=function($e){return re*((xe(ke)*(we(_t=ke+ae*$e)/xe(_t))-we(ke))/pe)/me;var _t},qe=(be(!0)-ke)/ae;if(Math.abs(me)<2e-6||!isFinite(qe)){if(Math.abs(re-le)<1e-6)return this.easeTo(e,r);const $e=le<re?-1:1;qe=Math.abs(Math.log(le/re))/ae,Ge=()=>0,Ke=_t=>Math.exp($e*ae*_t)}return e.duration="duration"in e?+e.duration:1e3*qe/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==I,this._pitching=O!==y,this._rolling=k!==T,this._padding=!c.isPaddingEqual(F),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(ne.targetCenter),this._ease($e=>{const _t=$e*qe,mt=1/Ke(_t),rt=Ge(_t);this._rotating&&c.setBearing(h.B.number(p,I,$e)),this._pitching&&c.setPitch(h.B.number(y,O,$e)),this._rolling&&c.setRoll(h.B.number(T,k,$e)),this._padding&&(c.interpolatePadding(C,F,$e),G=c.centerPoint.add(z)),ne.easeFunc($e,mt,rt,G),this.terrain&&!e.freezeElevation&&this._updateElevation($e),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,r)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,r,c){c.animate===!1||c.duration===0?(e(1),r()):(this._easeStart=Ae.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=h.aL(e,-180,180);const c=Math.abs(e-r);return Math.abs(e-360-r)<c&&(e-=360),Math.abs(e+360-r)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.Q.convert(e),this.transform.tileZoom):null}}const gs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ea{constructor(e=gs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const c=this._map._getUIString(`AttributionControl.${r}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style.sourceCaches;for(const p in r){const y=r[p];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&e.indexOf(T.attribution)<0&&e.push(T.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,y)=>p.length-y.length),e=e.filter((p,y)=>{for(let T=y+1;T<e.length;T++)if(e[T].indexOf(p)>=0)return!1;return!0});const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=he.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _s{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const r=he.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class nl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const p of c)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var jh=h.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Gc extends h.E{constructor(e){super(),this._lastTilesetChange=Ae.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const c={};for(const p of Se(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))c[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),h.bQ(p.terrainRttPosMatrix32f,0,h.Z,h.Z,0,0,1),this._tiles[p.key]=new Ba(p,this.tileSize),this._lastTilesetChange=Ae.now());for(const p in this._tiles)c[p]||delete this._tiles[p]}freeRtt(e){for(const r in this._tiles){const c=this._tiles[r];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID,y=e.clone(),T=h.b2();if(p.canonical.equals(e.canonical))h.bQ(T,0,h.Z,h.Z,0,0,1);else if(p.canonical.isChildOf(e.canonical)){const C=p.canonical.z-e.canonical.z,I=p.canonical.x-(p.canonical.x>>C<<C),O=p.canonical.y-(p.canonical.y>>C<<C),k=h.Z>>C;h.bQ(T,0,k,k,0,0,1),h.L(T,T,[-I*k,-O*k,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{const C=e.canonical.z-p.canonical.z,I=e.canonical.x-(e.canonical.x>>C<<C),O=e.canonical.y-(e.canonical.y>>C<<C),k=h.Z>>C;h.bQ(T,0,h.Z,h.Z,0,0,1),h.L(T,T,[I*k,O*k,0]),h.M(T,T,[1/2**C,1/2**C,0])}}y.terrainRttPosMatrix32f=new Float32Array(T),r[c]=y}return r}_getTerrainCoordsForTileRanges(e,r){const c={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(!this._isWithinTileRanges(y,r))continue;const T=e.clone(),C=h.b2();if(y.canonical.z===e.canonical.z){const I=e.canonical.x-y.canonical.x,O=e.canonical.y-y.canonical.y;h.bQ(C,0,h.Z,h.Z,0,0,1),h.L(C,C,[I*h.Z,O*h.Z,0])}else if(y.canonical.z>e.canonical.z){const I=y.canonical.z-e.canonical.z,O=y.canonical.x-(y.canonical.x>>I<<I),k=y.canonical.y-(y.canonical.y>>I<<I),F=e.canonical.x-(y.canonical.x>>I),z=e.canonical.y-(y.canonical.y>>I),G=h.Z>>I;h.bQ(C,0,G,G,0,0,1),h.L(C,C,[-O*G+F*h.Z,-k*G+z*h.Z,0])}else{const I=e.canonical.z-y.canonical.z,O=e.canonical.x-(e.canonical.x>>I<<I),k=e.canonical.y-(e.canonical.y>>I<<I),F=(e.canonical.x>>I)-y.canonical.x,z=(e.canonical.y>>I)-y.canonical.y,G=h.Z<<I;h.bQ(C,0,G,G,0,0,1),h.L(C,C,[O*h.Z+F*G,k*h.Z+z*G,0])}T.terrainRttPosMatrix32f=new Float32Array(C),c[p]=T}return c}getSourceTile(e,r){const c=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&r)for(;p>=c.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(p--).key);return y}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class Zc{constructor(e,r,c){this._meshCache={},this.painter=e,this.sourceCache=new Gc(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,c,p=h.Z){var y;if(!(r>=0&&r<p&&c>=0&&c<p))return 0;const T=this.getTerrainData(e),C=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!C)return 0;const I=h.cj([],[r/p*h.Z,c/p*h.Z],T.u_terrain_matrix),O=[I[0]*C.dim,I[1]*C.dim],k=Math.floor(O[0]),F=Math.floor(O[1]),z=O[0]-k,G=O[1]-F;return C.get(k,F)*(1-z)*(1-G)+C.get(k+1,F)*z*(1-G)+C.get(k,F+1)*(1-z)*G+C.get(k+1,F+1)*z*G}getElevationForLngLatZoom(e,r){if(!h.ck(r,e.wrap()))return 0;const{tileID:c,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(c,p%h.Z,y%h.Z,h.Z)}getElevation(e,r,c,p=h.Z){return this.getDEMElevation(e,r,c,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,y=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new xt(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new xt(p,new h.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ad([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const p=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new xt(p,r.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),r.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?y=e.canonical.z-p:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=e.canonical.x-(e.canonical.x>>y<<y),C=e.canonical.y-(e.canonical.y>>y<<y),I=h.cl(new Float64Array(16),[1/(h.Z<<y),1/(h.Z<<y),0]);h.L(I,I,[T*h.Z,C*h.Z,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,c=r.width/devicePixelRatio,p=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new xt(r.context,{width:c,height:p,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new xt(r.context,{width:c,height:p,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,p,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)r[T+0]=255&C,r[T+1]=255&y,r[T+2]=C>>8<<4|y>>8,r[T+3]=0;const c=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),p=new xt(e,c,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,p=c.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,C-T-1,1,1,p.RGBA,p.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const I=r[0]+(r[2]>>4<<8),O=r[1]+((15&r[2])<<8),k=this.coordsIndex[255-r[3]],F=k&&this.sourceCache.getTileByID(k);if(!F)return null;const z=this._coordsTextureSize,G=(1<<F.tileID.canonical.z)*z;return new h.$((F.tileID.canonical.x*z+I)/G+F.tileID.wrap,(F.tileID.canonical.y*z+O)/G,this.getElevation(F.tileID,I,O,z))}depthAtPoint(e){const r=new Uint8Array(4),c=this.painter.context,p=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,p=c&&e.canonical.y===0,y=c&&e.canonical.y===(1<<e.canonical.z)-1,T=`m_${p?"n":""}_${y?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const C=this.painter.context,I=new h.cm,O=new h.aK,k=this.meshSize,F=h.Z/k,z=k*k;for(let xe=0;xe<=k;xe++)for(let ke=0;ke<=k;ke++)I.emplaceBack(ke*F,xe*F,0);for(let xe=0;xe<z;xe+=k+1)for(let ke=0;ke<k;ke++)O.emplaceBack(ke+xe,k+ke+xe+1,k+ke+xe+2),O.emplaceBack(ke+xe,k+ke+xe+2,ke+xe+1);const G=I.length,Y=G+(k+1),ne=(k+1)*k,ae=p?h.b9:0,re=p?0:1,le=y?h.ba:h.Z,me=y?0:1;for(let xe=0;xe<=k;xe++)I.emplaceBack(xe*F,ae,re);for(let xe=0;xe<=k;xe++)I.emplaceBack(xe*F,le,me);for(let xe=0;xe<k;xe++)O.emplaceBack(ne+xe,Y+xe,Y+xe+1),O.emplaceBack(ne+xe,Y+xe+1,ne+xe+1),O.emplaceBack(0+xe,G+xe+1,G+xe),O.emplaceBack(0+xe,0+xe+1,G+xe+1);const pe=I.length,be=pe+2*(k+1);for(const xe of[0,1])for(let ke=0;ke<=k;ke++)for(const Ke of[0,1])I.emplaceBack(xe*h.Z,ke*F,Ke);for(let xe=0;xe<2*k;xe+=2)O.emplaceBack(pe+xe,pe+xe+1,pe+xe+3),O.emplaceBack(pe+xe,pe+xe+3,pe+xe+2),O.emplaceBack(be+xe,be+xe+3,be+xe+1),O.emplaceBack(be+xe,be+xe+2,be+xe+3);const we=new jo(C.createVertexBuffer(I,jh.members),C.createIndexBuffer(O),h.aJ.simpleSegment(0,0,I.length,O.length));return this._meshCache[T]=we,we}getMeshFrameDelta(e){return 2*Math.PI*h.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var c;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(c=this.getMinMaxElevation(p).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,r){const c=h.$.fromLngLat(e.wrap()),p=(1<<r)*h.Z,y=c.x*p,T=c.y*p,C=Math.floor(y/h.Z),I=Math.floor(T/h.Z);return{tileID:new h.Y(r,0,r,C,I),mercatorX:y,mercatorY:T}}}class So{constructor(e,r,c){this._context=e,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new xt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:e,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const $t={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ki{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new So(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(c=>!e._layers[c].isHidden(r)),this._coordsAscending={};for(const c in e.sourceCaches){this._coordsAscending[c]={};const p=e.sourceCaches[c].getVisibleCoordinates(),y=e.sourceCaches[c].getSource(),T=y instanceof Zn?y.terrainTileRanges:null;for(const C of p){const I=this.terrain.sourceCache.getTerrainCoords(C,T);for(const O in I)this._coordsAscending[c][O]||(this._coordsAscending[c][O]=[]),this._coordsAscending[c][O].push(I[O])}}this._coordsAscendingStr={};for(const c of e._order){const p=e._layers[c],y=p.source;if($t[p.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const T in this._coordsAscending[y])this._coordsAscendingStr[y][T]=this._coordsAscending[y][T].map(C=>C.key).sort().join()}}for(const c of this._renderableTiles)for(const p in this._coordsAscendingStr){const y=this._coordsAscendingStr[p][c.tileID.key];y&&y!==c.rttCoords[p]&&(c.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),p=e.type,y=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($t[p]&&(this._prevType&&$t[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!T))return!0;if($t[this._prevType]||$t[p]&&T){this._prevType=p;const C=this._stacks.length-1,I=this._stacks[C]||[];for(const O of this._renderableTiles){if(this.pool.isFull()&&(zs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(O),O.rtt[C]){const F=this.pool.getObjectForId(O.rtt[C].id);if(F.stamp===O.rtt[C].stamp){this.pool.useObject(F);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),O.rtt[C]={id:k.id,stamp:k.stamp},y.context.bindFramebuffer.set(k.fbo.framebuffer),y.context.clear({color:h.b7.transparent,stencil:0}),y.currentStencilSource=void 0;for(let F=0;F<I.length;F++){const z=y.style._layers[I[F]],G=z.source?this._coordsAscending[z.source][O.tileID.key]:[O.tileID];y.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),y._renderTileClippingMasks(z,G,!0),y.renderLayer(y,y.style.sourceCaches[z.source],z,G,c),z.source&&(O.rttCoords[z.source]=this._coordsAscendingStr[z.source][O.tileID.key])}}return zs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),$t[p]}return!1}}const vt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ht=Z,ys={hash:!1,interactive:!0,bearingSnap:7,attributionControl:gs,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},qs={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class rl{constructor(e,r,c=!1){this.mousedown=y=>{this.startMove(y,he.mousePos(this.element,y)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,he.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHanlder.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const p=new il;this._rotatePitchHanlder=new Za({clickTolerance:3,move:(y,T)=>{const C=r.getBoundingClientRect(),I=new h.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:h.ce(new h.P(y.x,T.y),T,I),pitchDelta:c?-.5*(T.y-y.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,he.addEventListener(r,"mousedown",this.mousedown),he.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHanlder.dragStart(e,r),he.disableDrag()}move(e,r){const c=this.map,{bearingDelta:p,pitchDelta:y}=this._rotatePitchHanlder.dragMove(e,r)||{};p&&c.setBearing(c.getBearing()+p),y&&c.setPitch(c.getPitch()+y)}off(){const e=this.element;he.removeEventListener(e,"mousedown",this.mousedown),he.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let ma;function Co(g,e,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return g==null?void 0:g.wrap();const p=new h.Q(g.lng,g.lat);if(g=new h.Q(g.lng,g.lat),e){const y=new h.Q(g.lng-360,g.lat),T=new h.Q(g.lng+360,g.lat),C=r.locationToScreenPoint(g).distSqr(e);r.locationToScreenPoint(y).distSqr(e)<C?g=y:r.locationToScreenPoint(T).distSqr(e)<C&&(g=T)}for(;Math.abs(g.lng-r.center.lng)>180;){const y=r.locationToScreenPoint(g);if(y.x>=0&&y.y>=0&&y.x<=r.width&&y.y<=r.height)break;g.lng>r.center.lng?g.lng-=360:g.lng+=360}return g.lng!==p.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(g))?g:p}const Pr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ra(g,e,r){const c=g.classList;for(const p in Pr)c.remove(`maplibregl-${r}-anchor-${p}`);c.add(`maplibregl-${r}-anchor-${e}`)}class Vs extends h.E{constructor(e){if(super(),this._onKeyPress=r=>{const c=r.code,p=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Co(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${Pr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),Ae.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const r=he.createNS("http://www.w3.org/2000/svg","svg"),c=41,p=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${p}px`),r.setAttributeNS(null,"viewBox",`0 0 ${p} ${c}`);const y=he.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=he.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=he.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of I){const le=he.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",re.rx),le.setAttributeNS(null,"ry",re.ry),C.appendChild(le)}const O=he.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const k=he.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(k);const F=he.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const z=he.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(z);const G=he.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const Y=he.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=he.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const ae=he.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),Y.appendChild(ne),Y.appendChild(ae),T.appendChild(C),T.appendChild(O),T.appendChild(F),T.appendChild(G),T.appendChild(Y),r.appendChild(T),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(r),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Ra(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,c;const p=(r=this._map)===null||r===void 0?void 0:r.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!p||y){const G=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const T=this._map,C=T.terrain.depthAtPoint(this._pos),I=T.terrain.getElevationForLngLatZoom(this._lngLat,T.transform.tileZoom);if(T.transform.lngLatToCameraDepth(this._lngLat,I)-C<.006)return void(this._element.style.opacity=this._opacity);const O=-this._offset.y/T.transform.pixelsPerMeter,k=Math.sin(T.getPitch()*Math.PI/180)*O,F=T.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),z=T.transform.lngLatToCameraDepth(this._lngLat,I+k)-F>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const la={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ca=0,pu=!1;const Ql={maxWidth:100,unit:"metric"};function mu(g,e,r){const c=r&&r.maxWidth||100,p=g._container.clientHeight/2,y=g._container.clientWidth/2,T=g.unproject([y-c/2,p]),C=g.unproject([y+c/2,p]),I=Math.round(g.project(C).x-g.project(T).x),O=Math.min(c,I,g._container.clientWidth),k=T.distanceTo(C);if(r&&r.unit==="imperial"){const F=3.2808*k;F>5280?Gs(e,O,F/5280,g._getUIString("ScaleControl.Miles")):Gs(e,O,F,g._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Gs(e,O,k/1852,g._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Gs(e,O,k/1e3,g._getUIString("ScaleControl.Kilometers")):Gs(e,O,k,g._getUIString("ScaleControl.Meters"))}function Gs(g,e,r,c){const p=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const O=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*O)/O}(C),T*C}(r);g.style.width=e*(p/r)+"px",g.innerHTML=`${p}&nbsp;${c}`}const Kl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Sn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,g),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-g),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(g,0),right:new h.P(-g,0)}}if(g instanceof h.P||Array.isArray(g)){const e=h.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(g.center||[0,0]),top:h.P.convert(g.top||[0,0]),"top-left":h.P.convert(g["top-left"]||[0,0]),"top-right":h.P.convert(g["top-right"]||[0,0]),bottom:h.P.convert(g.bottom||[0,0]),"bottom-left":h.P.convert(g["bottom-left"]||[0,0]),"bottom-right":h.P.convert(g["bottom-right"]||[0,0]),left:h.P.convert(g.left||[0,0]),right:h.P.convert(g.right||[0,0])}}return ha(new h.P(0,0))}const Wl=Z;S.AJAXError=h.cq,S.Event=h.l,S.Evented=h.E,S.LngLat=h.Q,S.MercatorCoordinate=h.$,S.Point=h.P,S.addProtocol=h.cr,S.config=h.a,S.removeProtocol=h.cs,S.AttributionControl=ea,S.BoxZoomHandler=Uh,S.CanvasSource=zo,S.CooperativeGesturesHandler=Zr,S.DoubleClickZoomHandler=Yl,S.DragPanHandler=qc,S.DragRotateHandler=Vc,S.EdgeInsets=Vo,S.FullscreenControl=class extends h.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Ru,S.GeolocateControl=class extends h.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new h.Q(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,p=this._map.getBearing(),y=h.e({bearing:p},this.options.fitBoundsOptions),T=Hi.fromLngLat(r,c);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new h.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&pu)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vs({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))})}},this.options=h.e({},la,g)}onAdd(g){return this._map=g,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return h._(this,arguments,void 0,function*(e=!1){if(ma!==void 0&&!e)return ma;if(window.navigator.permissions===void 0)return ma=!!window.navigator.geolocation,ma;try{ma=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ma=!!window.navigator.geolocation}return ma})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ca=0,pu=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),r=g.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),r=g.getNorthEast(),c=e.distanceTo(r),p=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ca--,pu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ca++,ca>1?(g={maximumAge:6e5,timeout:0},pu=!0):(g=this.options.positionOptions,pu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=he.create("button","maplibregl-ctrl-globe",this._container),he.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=Bc,S.ImageSource=Zn,S.KeyboardHandler=fu,S.LngLatBounds=Hi,S.LogoControl=_s,S.Map=class extends Xl{constructor(g){var e,r;h.cn.mark(h.co.create);const c=Object.assign(Object.assign(Object.assign({},ys),g),{canvasContextAttributes:Object.assign(Object.assign({},ys.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new ns,y=new Sr;if(c.minZoom!==void 0&&p.setMinZoom(c.minZoom),c.maxZoom!==void 0&&p.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&p.setMinPitch(c.minPitch),c.maxPitch!==void 0&&p.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&p.setRenderWorldCopies(c.renderWorldCopies),super(p,y,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new nl,this._controls=[],this._mapId=h.a4(),this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},vt),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=et.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ie(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const I=Fs(O=>{this._trackResize&&!this._removed&&(this.resize(O),this.redraw())},50);this._resizeObserver=new ResizeObserver(O=>{C?I(O):C=!0}),this._resizeObserver.observe(this._container)}this.handlers=new $l(this,c),this._hash=c.hash&&new Bc(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,h.e({},c.fitBoundsOptions,{duration:0}))));const T=typeof c.style=="string"||((r=(e=c.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new ea(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new _s,c.logoPosition),this.on("style.load",()=>{if(T||this._resizeTransform(),this.transform.unmodified){const C=h.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}}),this.on("data",C=>{this._update(C.dataType==="style"),this.fire(new h.l(`${C.dataType}data`,C))}),this.on("dataloading",C=>{this.fire(new h.l(`${C.dataType}dataloading`,C))}),this.on("dataabort",C=>{this.fire(new h.l("sourcedataabort",C))})}_getMapId(){return this._mapId}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,r,c)}resize(g,e=!0){const[r,c]=this._containerDimensions(),p=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,p),this.painter.resize(r,c,p),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const C=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,C),this.painter.resize(r,c,C)}this._resizeTransform(e);const y=!this._moving;return y&&(this.stop(),this.fire(new h.l("movestart",g)).fire(new h.l("move",g))),this.fire(new h.l("resize",g)),y&&this.fire(new h.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[r,c]=this._containerDimensions();this.transform.resize(r,c,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,c,g)}_getClampedPixelRatio(g,e){const{0:r,1:c}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,T=e*p;return Math.min(y>r?r/y:1,T>c?c/T:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Hi.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(h.Q.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(h.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,r){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{const T=e.filter(I=>this.getLayer(I)),C=T.length!==0?this.queryRenderedFeatures(y.point,{layers:T}):[];C.length?c||(c=!0,r.call(this,new Da(g,this,y.originalEvent,{features:C}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:T=>{const C=e.filter(I=>this.getLayer(I));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?c=!0:c&&(c=!1,r.call(this,new Da(g,this,T.originalEvent)))},mouseout:T=>{c&&(c=!1,r.call(this,new Da(g,this,T.originalEvent)))}}}}{const c=p=>{const y=e.filter(C=>this.getLayer(C)),T=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];T.length&&(p.features=T,r.call(this,p),delete p.features)};return{layers:e,listener:r,delegates:{[g]:c}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,r){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let p=0;p<c.length;p++){const y=c[p];if(y.listener===r&&y.layers.length===e.length&&y.layers.every(T=>e.includes(T))){for(const T in y.delegates)this.off(T,y.delegates[T]);return void c.splice(p,1)}}}on(g,e,r){if(r===void 0)return super.on(g,e);const c=typeof e=="string"?[e]:e,p=this._createDelegatedListener(g,c,r);this._saveDelegatedListener(g,p);for(const y in p.delegates)this.on(y,p.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,r)}}}once(g,e,r){if(r===void 0)return super.once(g,e);const c=typeof e=="string"?[e]:e,p=this._createDelegatedListener(g,c,r);for(const y in p.delegates){const T=p.delegates[y];p.delegates[y]=(...C)=>{this._removeDelegatedListener(g,c,r),T(...C)}}this._saveDelegatedListener(g,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(g,e,r){return r===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let r;const c=g instanceof h.P||Array.isArray(g),p=c?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:g)||{},p instanceof h.P||typeof p[0]=="number")r=[h.P.convert(p)];else{const y=h.P.convert(p[0]),T=h.P.convert(p[1]);r=[y,new h.P(T.x,y.y),T,new h.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var r,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,e));const p=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new Ah(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,p):this.style.loadJSON(g,e,p),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ah(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const r=this._requestManager.transformRequest(g,"Style");h.j(r,new AbortController).then(c=>{this._updateDiff(c.data,e)}).catch(c=>{c&&this.fire(new h.k(c))})}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(r){h.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new h.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===g.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Zc(this.painter,e,g),this.painter.renderToTexture=new ki(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const r=g[e]._tiles;for(const c in r){const p=r[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,e,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=Te(Math.max(1,g),Math.max(1,e))}else for(const c in this.style.sourceCaches)this.style.sourceCaches[c].getSource().calculateTileZoom=Te(Math.max(1,g),Math.max(1,e));return this._update(!0),this}refreshTiles(g,e){const r=this.style.sourceCaches[g];if(!r)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);e===void 0?r.reload():r.refreshTiles(e.map(c=>new h.a1(c.z,c.x,c.y)))}addImage(g,e,r={}){const{pixelRatio:c=1,sdf:p=!1,stretchX:y,stretchY:T,content:C,textFitWidth:I,textFitHeight:O}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:F,data:z}=e,G=e;return this.style.addImage(g,{data:new h.R({width:k,height:F},new Uint8Array(z)),pixelRatio:c,stretchX:y,stretchY:T,content:C,textFitWidth:I,textFitHeight:O,sdf:p,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:k,height:F,data:z}=Ae.getImageData(e);this.style.addImage(g,{data:new h.R({width:k,height:F},z),pixelRatio:c,stretchX:y,stretchY:T,content:C,textFitWidth:I,textFitHeight:O,sdf:p,version:0})}}updateImage(g,e){const r=this.style.getImage(g);if(!r)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||h.b(e)?Ae.getImageData(e):e,{width:p,height:y,data:T}=c;if(p===void 0||y===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==r.data.width||y!==r.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(e instanceof HTMLImageElement||h.b(e));return r.data.replace(T,C),this.style.updateImage(g,r),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return et.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,r){return this.style.setLayerZoomRange(g,e,r),this._update(!0)}setFilter(g,e,r={}){return this.style.setFilter(g,e,r),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,r,c={}){return this.style.setPaintProperty(g,e,r,c),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,r,c={}){return this.style.setLayoutProperty(g,e,r,c),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,r,c=>{c||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,r=>{r||this._update(!0)}),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=he.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const p=this._controlContainer=he.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=he.create("div",`maplibregl-ctrl-${T} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,r){this._canvas.width=Math.floor(r*g),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{e={requestedAttributes:g},c&&(e.statusMessage=c.statusMessage,e.type=c.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!r){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new hu(r,this.transform),Ve.testSupport(r)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,r,c,p,y;const T=this._idleTriggered?this._fadeDuration:0,C=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,z=Ae.now();this.style.zoomHistory.update(F,z);const G=new h.C(F,{now:z,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=G.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(I=!0,this._crossFadingFactor=Y),this.style.update(G)}const O=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==C;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||O)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,O),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cn.mark(h.co.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,h.cn.mark(h.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),et.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cn.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ae.frame(this._frameRequest,g=>{h.cn.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!h.cp(e)&&!function(r){return r.message===Fl}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Ht}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},S.MapMouseEvent=Da,S.MapTouchEvent=Rr,S.MapWheelEvent=on,S.Marker=Vs,S.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);e.title=c,e.setAttribute("aria-label",c)},this.options=h.e({},qs,g),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const r=he.create("button",g,this._container);return r.type="button",r.addEventListener("click",e),r}},S.Popup=class extends h.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Co(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const p=ha(this.options.offset);if(!c){const T=this._container.offsetWidth,C=this._container.offsetHeight;let I;I=r.y+p.bottom.y<C?["top"]:r.y>this._map.transform.height-C?["bottom"]:[],r.x<T/2?I.push("left"):r.x>this._map.transform.width-T/2&&I.push("right"),c=I.length===0?"bottom":I.join("-")}let y=r.add(p[c]);this.options.subpixelPositioning||(y=y.round()),he.setTransform(this._container,`${Pr[c]} translate(${y.x}px,${y.y}px)`),Ra(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Kl),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=h.Q.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=g;c=r.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Sn);g&&g.focus()}},S.RasterDEMTileSource=Cl,S.RasterTileSource=ka,S.ScaleControl=class{constructor(g){this._onMove=()=>{mu(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,mu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ql),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=ci,S.Style=Ah,S.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=du,S.TwoFingersTouchRotateHandler=wt,S.TwoFingersTouchZoomHandler=Hs,S.TwoFingersTouchZoomRotateHandler=ms,S.VectorTileSource=so,S.VideoSource=sr,S.addSourceType=(g,e)=>h._(void 0,void 0,void 0,function*(){if(Ds(g))throw new Error(`A source type called "${g}" already exists.`);((r,c)=>{oo[r]=c})(g,e)}),S.clearPrewarmedResources=function(){const g=Nt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(ct),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Rl,S.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return xn().getRTLTextPluginStatus()},S.getVersion=function(){return Wl},S.getWorkerCount=function(){return Et.workerCount},S.getWorkerUrl=function(){return h.a.WORKER_URL},S.importScriptInWorkers=function(g){return yi().broadcast("IS",g)},S.prewarm=function(){Zt().acquire(ct)},S.setMaxParallelImageRequests=function(g){h.a.MAX_PARALLEL_IMAGE_REQUESTS=g},S.setRTLTextPlugin=function(g,e){return xn().setRTLTextPlugin(g,e)},S.setWorkerCount=function(g){Et.workerCount=g},S.setWorkerUrl=function(g){h.a.WORKER_URL=g}});var R=f;return R})}(Vp)),Vp.exports}var Q_=Iy();const K_=Y_(Q_),Dy=yy({__proto__:null,default:K_},[Q_]);function Ry({row:i,isExpanded:n,onToggle:f,map:x,selectedRow:A,setSelectedRow:R}){const S=i.header,h=i.points&&i.points.length>0;return Dt.jsxs("div",{className:`border-b border-gray-200 last:border-0 ${n?"bg-gray-300":h?"hover:bg-gray-100":""}`,children:[Dt.jsxs("div",{className:`p-1 flex items-center justify-between ${h?"cursor-pointer":""}`,onClick:()=>{if(h&&(f(),x&&i.points&&i.points.length>0)){const Z=i.points.reduce((Q,ge)=>Q?[[Math.min(Q[0][0],ge.lon),Math.min(Q[0][1],ge.lat)],[Math.max(Q[1][0],ge.lon),Math.max(Q[1][1],ge.lat)]]:[[ge.lon,ge.lat],[ge.lon,ge.lat]],null);if(Z){const Q=[Z[0][0],Z[0][1],Z[1][0],Z[1][1]];x.fitBounds(Q,{padding:100,duration:2e3})}}},children:[Dt.jsx("div",{className:`flex-1 overflow-hidden ${n?"":"text-ellipsis whitespace-nowrap"}`,children:S}),h&&Dt.jsx("svg",{className:`w-5 h-5 transform transition-transform ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Dt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&h&&i.points&&Dt.jsxs("div",{className:"p-4 pl-10",children:[Dt.jsx("h4",{className:"font-medium mb-2",children:":"}),Dt.jsx("div",{className:"space-y-2",children:i.points.map((Z,Q)=>Dt.jsxs("div",{className:"flex items-start space-x-2 cursor-pointer hover:bg-gray-400",onClick:()=>{x&&x.flyTo({center:[Z.lon,Z.lat],speed:.5,curve:1.5})},children:[Dt.jsxs("span",{className:"font-medium min-w-[24px]",children:[Z.index,"."]}),Dt.jsx("span",{children:Z.original})]},Q))})]})]})}function Py({document:i,onBack:n,map:f,selectedRow:x,setSelectedRow:A}){const R=h=>{A(x===h?null:h)},S=Ct.useRef(null);return Ct.useEffect(()=>{console.log(S),S.current&&(!S.current.getBoundingClientRect().top||S.current.getBoundingClientRect().top<0||S.current.getBoundingClientRect().bottom>window.innerHeight)&&S.current.scrollIntoView({behavior:"smooth"})},[x,S]),console.log(x),Dt.jsxs("div",{className:"p-5 h-full flex flex-col",children:[Dt.jsx("div",{className:"flex items-center mb-5",children:Dt.jsxs("button",{onClick:n,className:"flex items-center text-blue-600 hover:text-blue-800 transition-colors",children:[Dt.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Dt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),""]})}),Dt.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.header}),i.rows.map((h,Z)=>Dt.jsx("div",{ref:Z===x?S:void 0,children:Dt.jsx(Ry,{row:h,isExpanded:Z===x,onToggle:()=>R(Z),map:f,selectedRow:x,setSelectedRow:A})},Z))]})}function Ly({region:i,onBack:n,openedDocument:f,setOpenedDocument:x,map:A,selectedRow:R,setSelectedRow:S}){const[h,Z]=Ct.useState(null),Q=async Me=>{x(i.documents[Me])},ge=()=>{x(null),Z(null)};return f?Dt.jsx(Py,{document:f,onBack:ge,map:A,selectedRow:R,setSelectedRow:S}):Dt.jsxs("div",{className:"p-5 h-full flex flex-col",children:[Dt.jsx("div",{className:"flex items-center mb-5",children:Dt.jsxs("button",{onClick:n,className:"flex items-center text-blue-600 hover:text-blue-800 transition-colors",children:[Dt.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Dt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),""]})}),Dt.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.region}),Dt.jsx("div",{className:"bg-white rounded-lg shadow mb-4 flex-grow overflow-y-auto",children:Dt.jsx("div",{className:"p-4 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:i.contentHtml}})}),i.documents.length>0&&Dt.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[Dt.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:""}),h&&Dt.jsx("div",{className:"mb-3 p-3 bg-red-50 text-red-700 rounded-md",children:h}),Dt.jsx("ul",{className:"space-y-2",children:i.documents.map((Me,Ae)=>Dt.jsx("li",{className:"flex items-center p-2 mb-2 border rounded-lg cursor-pointer transition-all duration-200 hover:bg-gray-50 hover:translate-y-[-1px] hover:shadow-sm",children:Dt.jsxs("button",{onClick:()=>Q(Ae),className:"flex items-center text-gray-700  w-full text-left hover:cursor-pointer",children:[Dt.jsx("svg",{className:"w-5 h-5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Dt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),Dt.jsx("span",{children:Me.title})]})},Ae))})]})]})}function Oy({regions:i,selectedRegion:n,onRegionSelect:f,selectedDocuments:x,setSelectedDocuments:A,openedDocument:R,setOpenedDocument:S,map:h,selectedRow:Z,setSelectedRow:Q}){const ge=()=>{f(null)};return n?Dt.jsx(Ly,{region:n,onBack:ge,openedDocument:R,setOpenedDocument:S,map:h,selectedRow:Z,setSelectedRow:Q}):Dt.jsxs("div",{className:"p-5 h-full flex flex-col",children:[Dt.jsx("h2",{className:"mb-1 text-2xl font-semibold text-gray-800",children:""}),Dt.jsxs("div",{className:"p-2 border-b border-gray-200",children:[Dt.jsxs("label",{className:"flex items-center gap-2",children:[Dt.jsx("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 rounded border-gray-300",checked:x.length===i.flatMap(Me=>Me.documents).length,onChange:Me=>{Me.target.checked?A(i.flatMap(Ae=>Ae.documents)):A([])}}),Dt.jsx("span",{className:"text-sm font-medium",children:"  "})]}),Dt.jsxs("label",{className:"flex items-center gap-2",children:[Dt.jsx("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 rounded border-gray-300",checked:i.flatMap(Me=>Me.documents).filter(Me=>{var Ae;return(Ae=Me.header)==null?void 0:Ae.toLowerCase().includes("")}).every(Me=>x.includes(Me)),onChange:Me=>{Me.target.checked?A(i.flatMap(Ae=>Ae.documents).filter(Ae=>{var he;return(he=Ae.header)==null?void 0:he.toLowerCase().includes("")})):A(x.filter(Ae=>{var he;return!((he=Ae.header)!=null&&he.toLowerCase().includes(""))}))}}),Dt.jsx("span",{className:"text-sm font-medium",children:" "})]}),Dt.jsxs("label",{className:"flex items-center gap-2",children:[Dt.jsx("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 rounded border-gray-300",checked:i.flatMap(Me=>Me.documents).filter(Me=>{var Ae;return(Ae=Me.header)==null?void 0:Ae.toLowerCase().includes("")}).every(Me=>x.includes(Me)),onChange:Me=>{Me.target.checked?A(i.flatMap(Ae=>Ae.documents).filter(Ae=>{var he;return((he=Ae.header)==null?void 0:he.toLowerCase().includes(""))||x.includes(Ae)})):A(x.filter(Ae=>{var he;return!((he=Ae.header)!=null&&he.toLowerCase().includes(""))}))}}),Dt.jsx("span",{className:"text-sm font-medium",children:" "})]})]}),Dt.jsx("div",{className:"flex-1 overflow-y-auto",children:i.map(Me=>Dt.jsxs("div",{className:`flex flex-col p-2 mb-2 border rounded-lg cursor-pointer transition-all duration-200 hover:bg-gray-50 hover:translate-y-[-1px] hover:shadow-sm ${n===Me.region?"bg-blue-50 border-blue-500":"border-gray-200"}`,children:[Dt.jsxs("span",{className:"mb text-lg",onClick:()=>f(Me),children:[Me.region," (",Me.documents.length,")"]}),Me.documents.map((Ae,he)=>{var Ve;return Dt.jsx("div",{className:"flex flex-col",children:Dt.jsxs("label",{className:"text-sm whitespace-nowrap overflow-hidden text-ellipsis flex items-center gap-1",children:[Dt.jsx("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 rounded border-gray-300",checked:x.includes(Ae),onChange:Vt=>{Vt.target.checked?A([...x,Ae]):A(x.filter(li=>li!==Ae))}}),(Ve=Ae.header)==null?void 0:Ve.toLowerCase()]})},he)})]},Me.region))})]})}const Ny="modulepreload",ky=function(i){return"/"+i},Kg={},By=function(n,f,x){let A=Promise.resolve();if(f&&f.length>0){let S=function(Q){return Promise.all(Q.map(ge=>Promise.resolve(ge).then(Me=>({status:"fulfilled",value:Me}),Me=>({status:"rejected",reason:Me}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),Z=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));A=S(f.map(Q=>{if(Q=ky(Q),Q in Kg)return;Kg[Q]=!0;const ge=Q.endsWith(".css"),Me=ge?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Q}"]${Me}`))return;const Ae=document.createElement("link");if(Ae.rel=ge?"stylesheet":Ny,ge||(Ae.as="script"),Ae.crossOrigin="",Ae.href=Q,Z&&Ae.setAttribute("nonce",Z),document.head.appendChild(Ae),ge)return new Promise((he,Ve)=>{Ae.addEventListener("load",he),Ae.addEventListener("error",()=>Ve(new Error(`Unable to preload CSS for ${Q}`)))})}))}function R(S){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=S,window.dispatchEvent(h),!h.defaultPrevented)throw S}return A.then(S=>{for(const h of S||[])h.status==="rejected"&&R(h.reason);return n().catch(R)})},zy=Ct.createContext(null);function Fy(i,n){const f=Array.isArray(i)?i[0]:i?i.x:0,x=Array.isArray(i)?i[1]:i?i.y:0,A=Array.isArray(n)?n[0]:n?n.x:0,R=Array.isArray(n)?n[1]:n?n.y:0;return f===A&&x===R}function Ms(i,n){if(i===n)return!0;if(!i||!n)return!1;if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let f=0;f<i.length;f++)if(!Ms(i[f],n[f]))return!1;return!0}else if(Array.isArray(n))return!1;if(typeof i=="object"&&typeof n=="object"){const f=Object.keys(i),x=Object.keys(n);if(f.length!==x.length)return!1;for(const A of f)if(!n.hasOwnProperty(A)||!Ms(i[A],n[A]))return!1;return!0}return!1}function Wg(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function Jg(i,n){const f=n.viewState||n,x={};if("longitude"in f&&"latitude"in f&&(f.longitude!==i.center.lng||f.latitude!==i.center.lat)){const A=i.center.constructor;x.center=new A(f.longitude,f.latitude)}return"zoom"in f&&f.zoom!==i.zoom&&(x.zoom=f.zoom),"bearing"in f&&f.bearing!==i.bearing&&(x.bearing=f.bearing),"pitch"in f&&f.pitch!==i.pitch&&(x.pitch=f.pitch),f.padding&&i.padding&&!Ms(f.padding,i.padding)&&(x.padding=f.padding),x}const Uy=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function e_(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;const n={};for(const x of i.layers)n[x.id]=x;const f=i.layers.map(x=>{let A=null;"interactive"in x&&(A=Object.assign({},x),delete A.interactive);const R=n[x.ref];if(R){A=A||Object.assign({},x),delete A.ref;for(const S of Uy)S in R&&(A[S]=R[S])}return A||x});return{...i,layers:f}}const t_={version:8,sources:{},layers:[]},i_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},a_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},n_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Hy=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],jy=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Lf{constructor(n,f,x){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=A=>{const R=this.props[n_[A.type]];R?R(A):A.type==="error"&&console.error(A.error)},this._onCameraEvent=A=>{if(this._internalUpdate)return;A.viewState=this._propsedCameraUpdate||Wg(this._map.transform);const R=this.props[a_[A.type]];R&&R(A)},this._onCameraUpdate=A=>this._internalUpdate?A:(this._propsedCameraUpdate=Wg(A),Jg(A,this.props)),this._onPointerEvent=A=>{(A.type==="mousemove"||A.type==="mouseout")&&this._updateHover(A);const R=this.props[i_[A.type]];R&&(this.props.interactiveLayerIds&&A.type!=="mouseover"&&A.type!=="mouseout"&&(A.features=this._hoveredFeatures||this._queryRenderedFeatures(A.point)),R(A),delete A.features)},this._MapClass=n,this.props=f,this._initialize(x)}get map(){return this._map}setProps(n){const f=this.props;this.props=n;const x=this._updateSettings(n,f),A=this._updateSize(n),R=this._updateViewState(n);this._updateStyle(n,f),this._updateStyleComponents(n),this._updateHandlers(n,f),(x||A||R&&!this._map.isMoving())&&this.redraw()}static reuse(n,f){const x=Lf.savedMaps.pop();if(!x)return null;const A=x.map,R=A.getContainer();for(f.className=R.className;R.childNodes.length>0;)f.appendChild(R.childNodes[0]);A._container=f;const S=A._resizeObserver;S&&(S.disconnect(),S.observe(f)),x.setProps({...n,styleDiffing:!1}),A.resize();const{initialViewState:h}=n;return h&&(h.bounds?A.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):x._updateViewState(h)),A.isStyleLoaded()?A.fire("load"):A.once("style.load",()=>A.fire("load")),A._update(),x}_initialize(n){const{props:f}=this,{mapStyle:x=t_}=f,A={...f,...f.initialViewState,container:n,style:e_(x)},R=A.initialViewState||A.viewState||A;if(Object.assign(A,{center:[R.longitude||0,R.latitude||0],zoom:R.zoom||0,pitch:R.pitch||0,bearing:R.bearing||0}),f.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,f.gl)}const S=new this._MapClass(A);R.padding&&S.setPadding(R.padding),f.cursor&&(S.getCanvas().style.cursor=f.cursor),S.transformCameraUpdate=this._onCameraUpdate,S.on("style.load",()=>{var h;this._styleComponents={light:S.getLight(),sky:S.getSky(),projection:(h=S.getProjection)==null?void 0:h.call(S),terrain:S.getTerrain()},this._updateStyleComponents(this.props)}),S.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in i_)S.on(h,this._onPointerEvent);for(const h in a_)S.on(h,this._onCameraEvent);for(const h in n_)S.on(h,this._onEvent);this._map=S}recycle(){const f=this.map.getContainer().querySelector("[mapboxgl-children]");f==null||f.remove(),Lf.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const n=this._map;n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}_updateSize(n){const{viewState:f}=n;if(f){const x=this._map;if(f.width!==x.transform.width||f.height!==x.transform.height)return x.resize(),!0}return!1}_updateViewState(n){const f=this._map,x=f.transform;if(!f.isMoving()){const R=Jg(x,n);if(Object.keys(R).length>0)return this._internalUpdate=!0,f.jumpTo(R),this._internalUpdate=!1,!0}return!1}_updateSettings(n,f){const x=this._map;let A=!1;for(const R of Hy)if(R in n&&!Ms(n[R],f[R])){A=!0;const S=x[`set${R[0].toUpperCase()}${R.slice(1)}`];S==null||S.call(x,n[R])}return A}_updateStyle(n,f){if(n.cursor!==f.cursor&&(this._map.getCanvas().style.cursor=n.cursor||""),n.mapStyle!==f.mapStyle){const{mapStyle:x=t_,styleDiffing:A=!0}=n,R={diff:A};"localIdeographFontFamily"in n&&(R.localIdeographFontFamily=n.localIdeographFontFamily),this._map.setStyle(e_(x),R)}}_updateStyleComponents({light:n,projection:f,sky:x,terrain:A}){var h,Z;const R=this._map,S=this._styleComponents;R.style._loaded&&(n&&!Ms(n,S.light)&&(S.light=n,R.setLight(n)),f&&!Ms(f,S.projection)&&f!==((h=S.projection)==null?void 0:h.type)&&(S.projection=typeof f=="string"?{type:f}:f,(Z=R.setProjection)==null||Z.call(R,S.projection)),x&&!Ms(x,S.sky)&&(S.sky=x,R.setSky(x)),A!==void 0&&!Ms(A,S.terrain)&&(!A||R.getSource(A.source))&&(S.terrain=A,R.setTerrain(A)))}_updateHandlers(n,f){const x=this._map;for(const A of jy){const R=n[A]??!0,S=f[A]??!0;Ms(R,S)||(R?x[A].enable(R):x[A].disable())}}_queryRenderedFeatures(n){const f=this._map,{interactiveLayerIds:x=[]}=this.props;try{return f.queryRenderedFeatures(n,{layers:x.filter(f.getLayer.bind(f))})}catch{return[]}}_updateHover(n){var A;const{props:f}=this;if(f.interactiveLayerIds&&(f.onMouseMove||f.onMouseEnter||f.onMouseLeave)){const R=n.type,S=((A=this._hoveredFeatures)==null?void 0:A.length)>0,h=this._queryRenderedFeatures(n.point),Z=h.length>0;!Z&&S&&(n.type="mouseleave",this._onPointerEvent(n)),this._hoveredFeatures=h,Z&&!S&&(n.type="mouseenter",this._onPointerEvent(n)),n.type=R}else this._hoveredFeatures=null}}Lf.savedMaps=[];const qy=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Vy(i){if(!i)return null;const n=i.map,f={getMap:()=>n};for(const x of Gy(n))!(x in f)&&!qy.includes(x)&&(f[x]=n[x].bind(n));return f}function Gy(i){const n=new Set;let f=i;for(;f;){for(const x of Object.getOwnPropertyNames(f))x[0]!=="_"&&typeof i[x]=="function"&&x!=="fire"&&x!=="setEventedParent"&&n.add(x);f=Object.getPrototypeOf(f)}return Array.from(n)}const Zy=typeof document<"u"?Ct.useLayoutEffect:Ct.useEffect;function Yy(i,n){const{RTLTextPlugin:f,maxParallelImageRequests:x,workerCount:A,workerUrl:R}=n;if(f&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:S,lazy:h=!0}=typeof f=="string"?{pluginUrl:f}:f;i.setRTLTextPlugin(S,Z=>{Z&&console.error(Z)},h)}x!==void 0&&i.setMaxParallelImageRequests(x),A!==void 0&&i.setWorkerCount(A),R!==void 0&&i.setWorkerUrl(R)}const kf=Ct.createContext(null);function $y(i,n){const f=Ct.useContext(zy),[x,A]=Ct.useState(null),R=Ct.useRef(),{current:S}=Ct.useRef({mapLib:null,map:null});Ct.useEffect(()=>{const Q=i.mapLib;let ge=!0,Me;return Promise.resolve(Q||By(()=>Promise.resolve().then(()=>Dy),void 0)).then(Ae=>{if(!ge)return;if(!Ae)throw new Error("Invalid mapLib");const he="Map"in Ae?Ae:Ae.default;if(!he.Map)throw new Error("Invalid mapLib");Yy(he,i),i.reuseMaps&&(Me=Lf.reuse(i,R.current)),Me||(Me=new Lf(he.Map,i,R.current)),S.map=Vy(Me),S.mapLib=he,A(Me),f==null||f.onMapMount(S.map,i.id)}).catch(Ae=>{const{onError:he}=i;he?he({type:"error",target:null,originalEvent:null,error:Ae}):console.error(Ae)}),()=>{ge=!1,Me&&(f==null||f.onMapUnmount(i.id),i.reuseMaps?Me.recycle():Me.destroy())}},[]),Zy(()=>{x&&x.setProps(i)}),Ct.useImperativeHandle(n,()=>S.map,[x]);const h=Ct.useMemo(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]),Z={height:"100%"};return Ct.createElement("div",{id:i.id,ref:R,style:h},x&&Ct.createElement(kf.Provider,{value:S},Ct.createElement("div",{"mapboxgl-children":"",style:Z},i.children)))}const Xy=Ct.forwardRef($y);var W_=$_();const Qy=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function _c(i,n){if(!i||!n)return;const f=i.style;for(const x in n){const A=n[x];Number.isFinite(A)&&!Qy.test(x)?f[x]=`${A}px`:f[x]=A}}function J_(i,n){if(i===n)return null;const f=r_(i),x=r_(n),A=[];for(const R of x)f.has(R)||A.push(R);for(const R of f)x.has(R)||A.push(R);return A.length===0?null:A}function r_(i){return new Set(i?i.trim().split(/\s+/):[])}Ct.memo(Ct.forwardRef((i,n)=>{const{map:f,mapLib:x}=Ct.useContext(kf),A=Ct.useRef({props:i}),R=Ct.useMemo(()=>{let Pi=!1;Ct.Children.forEach(i.children,et=>{et&&(Pi=!0)});const Bi={...i,element:Pi?document.createElement("div"):void 0},jt=new x.Marker(Bi);return jt.setLngLat([i.longitude,i.latitude]),jt.getElement().addEventListener("click",et=>{var Ie,Oe;(Oe=(Ie=A.current.props).onClick)==null||Oe.call(Ie,{type:"click",target:jt,originalEvent:et})}),jt.on("dragstart",et=>{var Oe,pt;const Ie=et;Ie.lngLat=R.getLngLat(),(pt=(Oe=A.current.props).onDragStart)==null||pt.call(Oe,Ie)}),jt.on("drag",et=>{var Oe,pt;const Ie=et;Ie.lngLat=R.getLngLat(),(pt=(Oe=A.current.props).onDrag)==null||pt.call(Oe,Ie)}),jt.on("dragend",et=>{var Oe,pt;const Ie=et;Ie.lngLat=R.getLngLat(),(pt=(Oe=A.current.props).onDragEnd)==null||pt.call(Oe,Ie)}),jt},[]);Ct.useEffect(()=>(R.addTo(f.getMap()),()=>{R.remove()}),[]);const{longitude:S,latitude:h,offset:Z,style:Q,draggable:ge=!1,popup:Me=null,rotation:Ae=0,rotationAlignment:he="auto",pitchAlignment:Ve="auto"}=i;Ct.useEffect(()=>{_c(R.getElement(),Q)},[Q]),Ct.useImperativeHandle(n,()=>R,[]);const Vt=A.current.props;(R.getLngLat().lng!==S||R.getLngLat().lat!==h)&&R.setLngLat([S,h]),Z&&!Fy(R.getOffset(),Z)&&R.setOffset(Z),R.isDraggable()!==ge&&R.setDraggable(ge),R.getRotation()!==Ae&&R.setRotation(Ae),R.getRotationAlignment()!==he&&R.setRotationAlignment(he),R.getPitchAlignment()!==Ve&&R.setPitchAlignment(Ve),R.getPopup()!==Me&&R.setPopup(Me);const li=J_(Vt.className,i.className);if(li)for(const Pi of li)R.toggleClassName(Pi);return A.current.props=i,W_.createPortal(i.children,R.getElement())}));const Ky=Ct.memo(Ct.forwardRef((i,n)=>{const{map:f,mapLib:x}=Ct.useContext(kf),A=Ct.useMemo(()=>document.createElement("div"),[]),R=Ct.useRef({props:i}),S=Ct.useMemo(()=>{const h={...i},Z=new x.Popup(h);return Z.setLngLat([i.longitude,i.latitude]),Z.once("open",Q=>{var ge,Me;(Me=(ge=R.current.props).onOpen)==null||Me.call(ge,Q)}),Z},[]);if(Ct.useEffect(()=>{const h=Z=>{var Q,ge;(ge=(Q=R.current.props).onClose)==null||ge.call(Q,Z)};return S.on("close",h),S.setDOMContent(A).addTo(f.getMap()),()=>{S.off("close",h),S.isOpen()&&S.remove()}},[]),Ct.useEffect(()=>{_c(S.getElement(),i.style)},[i.style]),Ct.useImperativeHandle(n,()=>S,[]),S.isOpen()){const h=R.current.props;(S.getLngLat().lng!==i.longitude||S.getLngLat().lat!==i.latitude)&&S.setLngLat([i.longitude,i.latitude]),i.offset&&!Ms(h.offset,i.offset)&&S.setOffset(i.offset),(h.anchor!==i.anchor||h.maxWidth!==i.maxWidth)&&(S.options.anchor=i.anchor,S.setMaxWidth(i.maxWidth));const Z=J_(h.className,i.className);if(Z)for(const Q of Z)S.toggleClassName(Q);R.current.props=i}return W_.createPortal(i.children,A)}));function yd(i,n,f,x){const A=Ct.useContext(kf),R=Ct.useMemo(()=>i(A),[]);return Ct.useEffect(()=>{const S=n,h=null,Z=typeof n=="function"?n:null,{map:Q}=A;return Q.hasControl(R)||(Q.addControl(R,S==null?void 0:S.position),h&&h(A)),()=>{Z&&Z(A),Q.hasControl(R)&&Q.removeControl(R)}},[]),R}function Wy(i){const n=yd(({mapLib:f})=>new f.AttributionControl(i),{position:i.position});return Ct.useEffect(()=>{_c(n._container,i.style)},[i.style]),null}Ct.memo(Wy);function Jy(i){const n=yd(({mapLib:f})=>new f.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return Ct.useEffect(()=>{_c(n._controlContainer,i.style)},[i.style]),null}Ct.memo(Jy);function eb(i,n){const f=Ct.useRef({props:i}),x=yd(({mapLib:A})=>{const R=new A.GeolocateControl(i),S=R._setupUI;return R._setupUI=()=>{R._container.hasChildNodes()||S()},R.on("geolocate",h=>{var Z,Q;(Q=(Z=f.current.props).onGeolocate)==null||Q.call(Z,h)}),R.on("error",h=>{var Z,Q;(Q=(Z=f.current.props).onError)==null||Q.call(Z,h)}),R.on("outofmaxbounds",h=>{var Z,Q;(Q=(Z=f.current.props).onOutOfMaxBounds)==null||Q.call(Z,h)}),R.on("trackuserlocationstart",h=>{var Z,Q;(Q=(Z=f.current.props).onTrackUserLocationStart)==null||Q.call(Z,h)}),R.on("trackuserlocationend",h=>{var Z,Q;(Q=(Z=f.current.props).onTrackUserLocationEnd)==null||Q.call(Z,h)}),R},{position:i.position});return f.current.props=i,Ct.useImperativeHandle(n,()=>x,[]),Ct.useEffect(()=>{_c(x._container,i.style)},[i.style]),null}Ct.memo(Ct.forwardRef(eb));function tb(i){const n=yd(({mapLib:f})=>new f.NavigationControl(i),{position:i.position});return Ct.useEffect(()=>{_c(n._container,i.style)},[i.style]),null}Ct.memo(tb);function ib(i){const n=yd(({mapLib:R})=>new R.ScaleControl(i),{position:i.position}),f=Ct.useRef(i),x=f.current;f.current=i;const{style:A}=i;return i.maxWidth!==void 0&&i.maxWidth!==x.maxWidth&&(n.options.maxWidth=i.maxWidth),i.unit!==void 0&&i.unit!==x.unit&&n.setUnit(i.unit),Ct.useEffect(()=>{_c(n._container,A)},[A]),null}Ct.memo(ib);function ab(i){const n=yd(({mapLib:f})=>new f.TerrainControl(i),{position:i.position});return Ct.useEffect(()=>{_c(n._container,i.style)},[i.style]),null}Ct.memo(ab);function nb(i){const n=yd(({mapLib:f})=>new f.LogoControl(i),{position:i.position});return Ct.useEffect(()=>{_c(n._container,i.style)},[i.style]),null}Ct.memo(nb);function $p(i,n){if(!i)throw new Error(n)}let rb=0;function sb(i,n,f){if(i.style&&i.style._loaded){const x={...f};return delete x.id,delete x.children,i.addSource(n,x),i.getSource(n)}return null}function ob(i,n,f){var S,h,Z;$p(n.id===f.id,"source id changed"),$p(n.type===f.type,"source type changed");let x="",A=0;for(const Q in n)Q!=="children"&&Q!=="id"&&!Ms(f[Q],n[Q])&&(x=Q,A++);if(!A)return;const R=n.type;if(R==="geojson")i.setData(n.data);else if(R==="image")i.updateImage({url:n.url,coordinates:n.coordinates});else switch(x){case"coordinates":(S=i.setCoordinates)==null||S.call(i,n.coordinates);break;case"url":(h=i.setUrl)==null||h.call(i,n.url);break;case"tiles":(Z=i.setTiles)==null||Z.call(i,n.tiles);break;default:console.warn(`Unable to update <Source> prop: ${x}`)}}function Bm(i){const n=Ct.useContext(kf).map.getMap(),f=Ct.useRef(i),[,x]=Ct.useState(0),A=Ct.useMemo(()=>i.id||`jsx-source-${rb++}`,[]);Ct.useEffect(()=>{if(n){const S=()=>setTimeout(()=>x(h=>h+1),0);return n.on("styledata",S),S(),()=>{var h;if(n.off("styledata",S),n.style&&n.style._loaded&&n.getSource(A)){const Z=(h=n.getStyle())==null?void 0:h.layers;if(Z)for(const Q of Z)Q.source===A&&n.removeLayer(Q.id);n.removeSource(A)}}}},[n]);let R=n&&n.style&&n.getSource(A);return R?ob(R,i,f.current):R=sb(n,A,i),f.current=i,R&&Ct.Children.map(i.children,S=>S&&Ct.cloneElement(S,{source:A}))||null}function ub(i,n,f,x){if($p(f.id===x.id,"layer id changed"),$p(f.type===x.type,"layer type changed"),f.type==="custom"||x.type==="custom")return;const{layout:A={},paint:R={},filter:S,minzoom:h,maxzoom:Z,beforeId:Q}=f;if(Q!==x.beforeId&&i.moveLayer(n,Q),A!==x.layout){const ge=x.layout||{};for(const Me in A)Ms(A[Me],ge[Me])||i.setLayoutProperty(n,Me,A[Me]);for(const Me in ge)A.hasOwnProperty(Me)||i.setLayoutProperty(n,Me,void 0)}if(R!==x.paint){const ge=x.paint||{};for(const Me in R)Ms(R[Me],ge[Me])||i.setPaintProperty(n,Me,R[Me]);for(const Me in ge)R.hasOwnProperty(Me)||i.setPaintProperty(n,Me,void 0)}Ms(S,x.filter)||i.setFilter(n,S),(h!==x.minzoom||Z!==x.maxzoom)&&i.setLayerZoomRange(n,h,Z)}function lb(i,n,f){if(i.style&&i.style._loaded&&(!("source"in f)||i.getSource(f.source))){const x={...f,id:n};delete x.beforeId,i.addLayer(x,f.beforeId)}}let cb=0;function zm(i){const n=Ct.useContext(kf).map.getMap(),f=Ct.useRef(i),[,x]=Ct.useState(0),A=Ct.useMemo(()=>i.id||`jsx-layer-${cb++}`,[]);if(Ct.useEffect(()=>{if(n){const S=()=>x(h=>h+1);return n.on("styledata",S),S(),()=>{n.off("styledata",S),n.style&&n.style._loaded&&n.getLayer(A)&&n.removeLayer(A)}}},[n]),n&&n.style&&n.getLayer(A))try{ub(n,A,i,f.current)}catch(S){console.warn(S)}else lb(n,A,i);return f.current=i,null}function Fm(i,n,f,x){function A(R){return R instanceof f?R:new f(function(S){S(R)})}return new(f||(f=Promise))(function(R,S){function h(ge){try{Q(x.next(ge))}catch(Me){S(Me)}}function Z(ge){try{Q(x.throw(ge))}catch(Me){S(Me)}}function Q(ge){ge.done?R(ge.value):A(ge.value).then(h,Z)}Q((x=x.apply(i,n||[])).next())})}var zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Um,s_;function e1(){if(s_)return Um;s_=1,Um=n;var i=Object.prototype.hasOwnProperty;function n(){for(var f={},x=0;x<arguments.length;x++){var A=arguments[x];for(var R in A)i.call(A,R)&&(f[R]=A[R])}return f}return Um}var Hm={exports:{}},o_;function hb(){return o_||(o_=1,function(i,n){(function(){var f={};i.exports=f,f.simpleFilter=function(x,A){return A.filter(function(R){return f.test(x,R)})},f.test=function(x,A){return f.match(x,A)!==null},f.match=function(x,A,R){R=R||{};var S=0,h=[],Z=A.length,Q=0,ge=0,Me=R.pre||"",Ae=R.post||"",he=R.caseSensitive&&A||A.toLowerCase(),Ve;x=R.caseSensitive&&x||x.toLowerCase();for(var Vt=0;Vt<Z;Vt++)Ve=A[Vt],he[Vt]===x[S]?(Ve=Me+Ve+Ae,S+=1,ge+=1+ge):ge=0,Q+=ge,h[h.length]=Ve;return S===x.length?(Q=he===x?1/0:Q,{rendered:h.join(""),score:Q}):null},f.filter=function(x,A,R){return!A||A.length===0?[]:typeof x!="string"?A:(R=R||{},A.reduce(function(S,h,Z,Q){var ge=h;R.extract&&(ge=R.extract(h));var Me=f.match(x,ge,R);return Me!=null&&(S[S.length]={string:Me.rendered,score:Me.score,index:Z,original:h}),S},[]).sort(function(S,h){var Z=h.score-S.score;return Z||S.index-h.index}))}})()}(Hm)),Hm.exports}var jm,u_;function db(){if(u_)return jm;u_=1;var i=function(n){return this.component=n,this.items=[],this.active=n.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,n.el.parentNode.insertBefore(this.wrapper,n.el.nextSibling),this};return i.prototype.show=function(){this.element.style.display="block"},i.prototype.hide=function(){this.element.style.display="none"},i.prototype.add=function(n){this.items.push(n)},i.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},i.prototype.isEmpty=function(){return!this.items.length},i.prototype.isVisible=function(){return this.element.style.display==="block"},i.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var n=0;n<this.items.length;n++)this.drawItem(this.items[n],this.active===n);this.show()},i.prototype.drawItem=function(n,f){var x=document.createElement("li"),A=document.createElement("a");f&&(x.className+=" active"),A.innerHTML=n.string,x.appendChild(A),this.element.appendChild(x),x.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),x.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,n)}).bind(this))},i.prototype.handleMouseUp=function(n){this.selectingListItem=!1,this.component.value(n.original),this.clear(),this.draw()},i.prototype.move=function(n){this.active=n,this.draw()},i.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},i.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},i.prototype.drawError=function(n){var f=document.createElement("li");f.innerHTML=n,this.element.appendChild(f),this.show()},jm=i,jm}var qm,l_;function fb(){if(l_)return qm;l_=1;var i=e1(),n=hb(),f=db(),x=function(A,R,S){return S=S||{},this.options=i({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},S),this.el=A,this.data=R||[],this.list=new f(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(h){this.handleKeyUp(h.keyCode,h)}).bind(this),!1),this.el.addEventListener("keydown",(function(h){this.handleKeyDown(h)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(h){this.handlePaste(h)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return x.prototype.handleKeyUp=function(A,R){if(!(A===40||A===38||A===27||A===9)){if(A===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),R.stopPropagation());return}this.handleInputChange(this.el.value)}},x.prototype.handleKeyDown=function(A){switch(A.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&A.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},x.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},x.prototype.handlePaste=function(A){if(A.clipboardData)this.handleInputChange(A.clipboardData.getData("Text"));else{var R=this;setTimeout(function(){R.handleInputChange(A.target.value)},100)}},x.prototype.handleInputChange=function(A){if(this.query=this.normalize(A),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(R){for(var S=0;S<R.length&&(this.list.add(R[S]),S!==this.options.limit-1);S++);this.list.draw()}).bind(this))},x.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},x.prototype.update=function(A){this.data=A,this.handleKeyUp()},x.prototype.clear=function(){this.data=[],this.list.clear()},x.prototype.normalize=function(A){return A=A.toLowerCase(),A},x.prototype.match=function(A,R){return A.indexOf(R)>-1},x.prototype.value=function(A){if(this.selected=A,this.el.value=this.getItemValue(A||{place_name:this.query}),document.createEvent){var R=document.createEvent("HTMLEvents");R.initEvent("change",!0,!1),this.el.dispatchEvent(R)}else this.el.fireEvent("onchange")},x.prototype.getCandidates=function(A){var R={pre:"<strong>",post:"</strong>",extract:(function(h){return this.getItemValue(h)}).bind(this)},S;this.options.filter?(S=n.filter(this.query,this.data,R),S=S.map((function(h){return{original:h.original,string:this.render(h.original,h.string)}}).bind(this))):S=this.data.map((function(h){var Z=this.render(h);return{original:h,string:Z}}).bind(this)),A(S)},x.prototype.getItemValue=function(A){return A},x.prototype.render=function(A,R){if(R)return R;for(var S=A.original?this.getItemValue(A.original):this.getItemValue(A),h=this.normalize(S),Z=h.lastIndexOf(this.query);Z>-1;){var Q=Z+this.query.length;S=S.slice(0,Z)+"<strong>"+S.slice(Z,Q)+"</strong>"+S.slice(Q),Z=h.slice(0,Z).lastIndexOf(this.query)}return S},x.prototype.renderError=function(A){this.list.drawError(A)},qm=x,qm}var Vm,c_;function pb(){if(c_)return Vm;c_=1;var i=fb();return Vm=i,typeof window<"u"&&(window.Suggestions=i),Vm}var mb=pb(),gb=sm(mb),Gp={exports:{}},_b=Gp.exports,h_;function yb(){return h_||(h_=1,function(i){(function(n,f,x){i.exports?i.exports=x():n[f]=x()})(_b,"subtag",function(){var n="",f=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function x(Z){return Z.match(f)||[]}function A(Z){return x(Z).filter(function(Q,ge){return Q&&ge})}function R(Z){return Z=x(Z),{language:Z[1]||n,extlang:Z[2]||n,script:Z[3]||n,region:Z[4]||n}}function S(Z,Q,ge){Object.defineProperty(Z,Q,{value:ge,enumerable:!0})}function h(Z,Q,ge){function Me(Ae){return x(Ae)[Z]||n}S(Me,"pattern",Q),S(R,ge,Me)}return h(1,/^[a-zA-Z]{2,3}$/,"language"),h(2,/^[a-zA-Z]{3}$/,"extlang"),h(3,/^[a-zA-Z]{4}$/,"script"),h(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),S(R,"split",A),R})}(Gp)),Gp.exports}var bb=yb(),xb=sm(bb),Gm,d_;function vb(){if(d_)return Gm;d_=1;var i="Expected a function",n=NaN,f="[object Symbol]",x=/^\s+|\s+$/g,A=/^[-+]0x[0-9a-f]+$/i,R=/^0b[01]+$/i,S=/^0o[0-7]+$/i,h=parseInt,Z=typeof zp=="object"&&zp&&zp.Object===Object&&zp,Q=typeof self=="object"&&self&&self.Object===Object&&self,ge=Z||Q||Function("return this")(),Me=Object.prototype,Ae=Me.toString,he=Math.max,Ve=Math.min,Vt=function(){return ge.Date.now()};function li(Ie,Oe,pt){var xt,ai,Kt,Si,hi,Gi,zi=0,xa=!1,Je=!1,St=!0;if(typeof Ie!="function")throw new TypeError(i);Oe=et(Oe)||0,Pi(pt)&&(xa=!!pt.leading,Je="maxWait"in pt,Kt=Je?he(et(pt.maxWait)||0,Oe):Kt,St="trailing"in pt?!!pt.trailing:St);function At(si){var yi=xt,Va=ai;return xt=ai=void 0,zi=si,Si=Ie.apply(Va,yi),Si}function Ei(si){return zi=si,hi=setTimeout(Et,Oe),xa?At(si):Si}function Ee(si){var yi=si-Gi,Va=si-zi,es=Oe-yi;return Je?Ve(es,Kt-Va):es}function ct(si){var yi=si-Gi,Va=si-zi;return Gi===void 0||yi>=Oe||yi<0||Je&&Va>=Kt}function Et(){var si=Vt();if(ct(si))return Mt(si);hi=setTimeout(Et,Ee(si))}function Mt(si){return hi=void 0,St&&xt?At(si):(xt=ai=void 0,Si)}function Nt(){hi!==void 0&&clearTimeout(hi),zi=0,xt=Gi=ai=hi=void 0}function Wt(){return hi===void 0?Si:Mt(Vt())}function Zt(){var si=Vt(),yi=ct(si);if(xt=arguments,ai=this,Gi=si,yi){if(hi===void 0)return Ei(Gi);if(Je)return hi=setTimeout(Et,Oe),At(Gi)}return hi===void 0&&(hi=setTimeout(Et,Oe)),Si}return Zt.cancel=Nt,Zt.flush=Wt,Zt}function Pi(Ie){var Oe=typeof Ie;return!!Ie&&(Oe=="object"||Oe=="function")}function Bi(Ie){return!!Ie&&typeof Ie=="object"}function jt(Ie){return typeof Ie=="symbol"||Bi(Ie)&&Ae.call(Ie)==f}function et(Ie){if(typeof Ie=="number")return Ie;if(jt(Ie))return n;if(Pi(Ie)){var Oe=typeof Ie.valueOf=="function"?Ie.valueOf():Ie;Ie=Pi(Oe)?Oe+"":Oe}if(typeof Ie!="string")return Ie===0?Ie:+Ie;Ie=Ie.replace(x,"");var pt=R.test(Ie);return pt||S.test(Ie)?h(Ie.slice(2),pt?2:8):A.test(Ie)?n:+Ie}return Gm=li,Gm}var Tb=vb(),Eb=sm(Tb),wb=e1(),Iu=sm(wb),Fp={exports:{}},f_;function Ab(){if(f_)return Fp.exports;f_=1;var i=typeof Reflect=="object"?Reflect:null,n=i&&typeof i.apply=="function"?i.apply:function(Ie,Oe,pt){return Function.prototype.apply.call(Ie,Oe,pt)},f;i&&typeof i.ownKeys=="function"?f=i.ownKeys:Object.getOwnPropertySymbols?f=function(Ie){return Object.getOwnPropertyNames(Ie).concat(Object.getOwnPropertySymbols(Ie))}:f=function(Ie){return Object.getOwnPropertyNames(Ie)};function x(et){console&&console.warn&&console.warn(et)}var A=Number.isNaN||function(Ie){return Ie!==Ie};function R(){R.init.call(this)}Fp.exports=R,Fp.exports.once=Pi,R.EventEmitter=R,R.prototype._events=void 0,R.prototype._eventsCount=0,R.prototype._maxListeners=void 0;var S=10;function h(et){if(typeof et!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof et)}Object.defineProperty(R,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(et){if(typeof et!="number"||et<0||A(et))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+et+".");S=et}}),R.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},R.prototype.setMaxListeners=function(Ie){if(typeof Ie!="number"||Ie<0||A(Ie))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ie+".");return this._maxListeners=Ie,this};function Z(et){return et._maxListeners===void 0?R.defaultMaxListeners:et._maxListeners}R.prototype.getMaxListeners=function(){return Z(this)},R.prototype.emit=function(Ie){for(var Oe=[],pt=1;pt<arguments.length;pt++)Oe.push(arguments[pt]);var xt=Ie==="error",ai=this._events;if(ai!==void 0)xt=xt&&ai.error===void 0;else if(!xt)return!1;if(xt){var Kt;if(Oe.length>0&&(Kt=Oe[0]),Kt instanceof Error)throw Kt;var Si=new Error("Unhandled error."+(Kt?" ("+Kt.message+")":""));throw Si.context=Kt,Si}var hi=ai[Ie];if(hi===void 0)return!1;if(typeof hi=="function")n(hi,this,Oe);else for(var Gi=hi.length,zi=Ve(hi,Gi),pt=0;pt<Gi;++pt)n(zi[pt],this,Oe);return!0};function Q(et,Ie,Oe,pt){var xt,ai,Kt;if(h(Oe),ai=et._events,ai===void 0?(ai=et._events=Object.create(null),et._eventsCount=0):(ai.newListener!==void 0&&(et.emit("newListener",Ie,Oe.listener?Oe.listener:Oe),ai=et._events),Kt=ai[Ie]),Kt===void 0)Kt=ai[Ie]=Oe,++et._eventsCount;else if(typeof Kt=="function"?Kt=ai[Ie]=pt?[Oe,Kt]:[Kt,Oe]:pt?Kt.unshift(Oe):Kt.push(Oe),xt=Z(et),xt>0&&Kt.length>xt&&!Kt.warned){Kt.warned=!0;var Si=new Error("Possible EventEmitter memory leak detected. "+Kt.length+" "+String(Ie)+" listeners added. Use emitter.setMaxListeners() to increase limit");Si.name="MaxListenersExceededWarning",Si.emitter=et,Si.type=Ie,Si.count=Kt.length,x(Si)}return et}R.prototype.addListener=function(Ie,Oe){return Q(this,Ie,Oe,!1)},R.prototype.on=R.prototype.addListener,R.prototype.prependListener=function(Ie,Oe){return Q(this,Ie,Oe,!0)};function ge(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Me(et,Ie,Oe){var pt={fired:!1,wrapFn:void 0,target:et,type:Ie,listener:Oe},xt=ge.bind(pt);return xt.listener=Oe,pt.wrapFn=xt,xt}R.prototype.once=function(Ie,Oe){return h(Oe),this.on(Ie,Me(this,Ie,Oe)),this},R.prototype.prependOnceListener=function(Ie,Oe){return h(Oe),this.prependListener(Ie,Me(this,Ie,Oe)),this},R.prototype.removeListener=function(Ie,Oe){var pt,xt,ai,Kt,Si;if(h(Oe),xt=this._events,xt===void 0)return this;if(pt=xt[Ie],pt===void 0)return this;if(pt===Oe||pt.listener===Oe)--this._eventsCount===0?this._events=Object.create(null):(delete xt[Ie],xt.removeListener&&this.emit("removeListener",Ie,pt.listener||Oe));else if(typeof pt!="function"){for(ai=-1,Kt=pt.length-1;Kt>=0;Kt--)if(pt[Kt]===Oe||pt[Kt].listener===Oe){Si=pt[Kt].listener,ai=Kt;break}if(ai<0)return this;ai===0?pt.shift():Vt(pt,ai),pt.length===1&&(xt[Ie]=pt[0]),xt.removeListener!==void 0&&this.emit("removeListener",Ie,Si||Oe)}return this},R.prototype.off=R.prototype.removeListener,R.prototype.removeAllListeners=function(Ie){var Oe,pt,xt;if(pt=this._events,pt===void 0)return this;if(pt.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):pt[Ie]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete pt[Ie]),this;if(arguments.length===0){var ai=Object.keys(pt),Kt;for(xt=0;xt<ai.length;++xt)Kt=ai[xt],Kt!=="removeListener"&&this.removeAllListeners(Kt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Oe=pt[Ie],typeof Oe=="function")this.removeListener(Ie,Oe);else if(Oe!==void 0)for(xt=Oe.length-1;xt>=0;xt--)this.removeListener(Ie,Oe[xt]);return this};function Ae(et,Ie,Oe){var pt=et._events;if(pt===void 0)return[];var xt=pt[Ie];return xt===void 0?[]:typeof xt=="function"?Oe?[xt.listener||xt]:[xt]:Oe?li(xt):Ve(xt,xt.length)}R.prototype.listeners=function(Ie){return Ae(this,Ie,!0)},R.prototype.rawListeners=function(Ie){return Ae(this,Ie,!1)},R.listenerCount=function(et,Ie){return typeof et.listenerCount=="function"?et.listenerCount(Ie):he.call(et,Ie)},R.prototype.listenerCount=he;function he(et){var Ie=this._events;if(Ie!==void 0){var Oe=Ie[et];if(typeof Oe=="function")return 1;if(Oe!==void 0)return Oe.length}return 0}R.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function Ve(et,Ie){for(var Oe=new Array(Ie),pt=0;pt<Ie;++pt)Oe[pt]=et[pt];return Oe}function Vt(et,Ie){for(;Ie+1<et.length;Ie++)et[Ie]=et[Ie+1];et.pop()}function li(et){for(var Ie=new Array(et.length),Oe=0;Oe<Ie.length;++Oe)Ie[Oe]=et[Oe].listener||et[Oe];return Ie}function Pi(et,Ie){return new Promise(function(Oe,pt){function xt(Kt){et.removeListener(Ie,ai),pt(Kt)}function ai(){typeof et.removeListener=="function"&&et.removeListener("error",xt),Oe([].slice.call(arguments))}jt(et,Ie,ai,{once:!0}),Ie!=="error"&&Bi(et,xt,{once:!0})})}function Bi(et,Ie,Oe){typeof et.on=="function"&&jt(et,"error",Ie,Oe)}function jt(et,Ie,Oe,pt){if(typeof et.on=="function")pt.once?et.once(Ie,Oe):et.on(Ie,Oe);else if(typeof et.addEventListener=="function")et.addEventListener(Ie,function xt(ai){pt.once&&et.removeEventListener(Ie,xt),Oe(ai)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof et)}return Fp.exports}var Sb=Ab();const p_={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Cb={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Mb={en:"No results found",de:"Keine Ergebnisse gefunden"},Ib={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"};var B0={placeholder:Cb,errorNoResults:Mb,errorConnectionFailed:Ib};const Db=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class Rb{constructor(n,f){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:x=>x.text!==void 0?x.text:x.place_name,render:function(x){if(!x.geometry){const R=x.text,S=R.toLowerCase().indexOf(this.query.toLowerCase()),h=this.query.length,Z=R.substring(0,S),Q=R.substring(S,S+h),ge=R.substring(S+h);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+Z+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+Q+"</span>"+ge+"</div></div></div>"}const A=x.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+A[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+A.splice(1,A.length).join(",")+"</div></div></div>"},popupRender:x=>{const A=x.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+A[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+A.splice(1,A.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new Sb.EventEmitter,this.options=Iu({},this.options,f),this.fresh=!0,this.lastSelected=null,this.geocoderApi=n}addTo(n){function f(x,A){if(!document.body.contains(A))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const R=x.onAdd();A.appendChild(R)}if(n instanceof HTMLElement)f(this,n);else if(typeof n=="string"){const x=document.querySelectorAll(n);if(x.length===0)throw new Error("Element "+n+"not found.");if(x.length>1)throw new Error("Geocoder can only be added to a single html element");f(this,x[0])}else if("addControl"in n)n.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(n){if(n&&typeof n!="string"&&(this._map=n),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const f=this.container=document.createElement("div");f.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const x=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Eb(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const A=document.createElement("div");A.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const R=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(R),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),A.appendChild(this._clearEl),A.appendChild(this._loadingEl),f.appendChild(x),f.appendChild(this._inputEl),f.appendChild(A),this._typeahead=new gb(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),f}createIcon(n,f){const x=document.createElementNS("http://www.w3.org/2000/svg","svg");if(x.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+n),x.setAttribute("viewBox","0 0 18 18"),x.setAttribute("xml:space","preserve"),x.setAttribute("width","18"),x.setAttribute("height","18"),"innerHTML"in x)x.innerHTML=f;else{const A=document.createElement("div");A.innerHTML="<svg>"+f.valueOf().toString()+"</svg>";const R=A.firstChild,S=R.firstChild;x.appendChild(S)}return x}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(n){const f=(n.clipboardData||window.clipboardData).getData("text");f.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(f)}_onKeyDown(n){if(n.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(n),this._inputEl.blur();const R=this._inputEl.value;if(!R)return this.fresh=!0,n.keyCode!==9&&this.clear(n),this._clearEl.style.display="none";if(!(n.metaKey||[9,27,37,39,38,40].indexOf(n.keyCode)!==-1)){if(n.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(R);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(R,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}R.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(R)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(n){this.options.clearOnBlur&&this._clearOnBlur(n),this.options.collapsed&&this._collapse()}_onChange(){const n=this._typeahead.selected;if(n&&!n.geometry)n.placeId?this._geocode(n.placeId,!0,!0):this._geocode(n.text,!0);else if(n&&JSON.stringify(n)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let f;if(this._removeResultMarkers(),n.properties&&p_[n.properties.short_code])f=Iu({},this.options.flyTo),this._map&&this._map.fitBounds(p_[n.properties.short_code].bbox,f);else if(n.bbox){const x=n.bbox;f=Iu({},this.options.flyTo),this._map&&this._map.fitBounds([[x[0],x[1]],[x[2],x[3]]],f)}else{const x={zoom:this.options.zoom};f=Iu({},x,this.options.flyTo),n.center?f.center=n.center:n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(f.center=n.geometry.coordinates),this._map&&this._map.flyTo(f)}}this.options.marker&&this._maplibregl&&this._handleMarker(n),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(n),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:n})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((x,A)=>(this.options[A]&&(["countries","types","language"].indexOf(A)>-1?x[A]=this.options[A].split(/[\s,]+/):x[A]=this.options[A],A==="proximity"&&this.options[A]&&typeof this.options[A].longitude=="number"&&typeof this.options[A].latitude=="number"&&(x[A]=[this.options[A].longitude,this.options[A].latitude])),x),{})}_geocode(n){return Fm(this,arguments,void 0,function*(f,x=!1,A=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:f});const R=this._getConfigForRequest(),S=this._createGeocodeRequest(R,f,x,A),h=this.options.localGeocoder?this.options.localGeocoder(f)||[]:[];try{const Z=yield S;yield this._handleGeocodeResponse(Z,R,f,x,h)}catch(Z){this._handleGeocodeErrorResponse(Z,h)}return S})}_createGeocodeRequest(n,f,x,A){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&Db.test(f)?this._createReverseGeocodeRequest(f,n):(n.query=f,this.geocoderApi.getSuggestions?x?this.geocoderApi.searchByPlaceId&&A?this.geocoderApi.searchByPlaceId(n):this.geocoderApi.forwardGeocode(n):this.geocoderApi.getSuggestions(n):this.geocoderApi.forwardGeocode(n))}_createReverseGeocodeRequest(n,f){const x=n.split(/[\s(,)?]+/).map(A=>parseFloat(A)).reverse();return f.query=x,f.limit=1,"proximity"in f&&delete f.proximity,this.geocoderApi.reverseGeocode(f)}_handleGeocodeResponse(n,f,x,A,R){return Fm(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let S={};n?S=n:S={type:"FeatureCollection",features:[]},S.config=f,this.fresh&&(this.fresh=!1),S.features=S.features?R.concat(S.features):R;const h=this.options.externalGeocoder?this.options.externalGeocoder(x,S.features,f)||Promise.resolve([]):Promise.resolve([]);try{const Q=yield h;S.features=S.features?Q.concat(S.features):Q}catch{}this.options.filter&&S.features.length&&(S.features=S.features.filter(this.options.filter));let Z=[];"suggestions"in S?Z=S.suggestions:"place"in S?Z=[S.place]:Z=S.features,Z.length?(this._clearEl.style.display="block",this._typeahead.update(Z),(!this.options.showResultsWhileTyping||A)&&this.options.showResultMarkers&&(S.features.length>0||"place"in S)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",S)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",S))})}_handleGeocodeErrorResponse(n,f){this._loadingEl.style.display="none",f.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(f)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:f}),this._eventEmitter.emit("error",{error:n})}_clear(n){n&&n.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(n){this._clear(n),this._inputEl.focus()}_clearOnBlur(n){n.relatedTarget&&this._clear(n)}_onQueryResult(n){if(!("features"in n)||!n.features.length)return;const f=n.features[0];this._typeahead.selected=f,this._inputEl.value=f.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const n=this._map.getCenter().wrap();this.setProximity({longitude:n.lng,latitude:n.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(n){return Fm(this,void 0,void 0,function*(){const f=yield this._geocode(n);this._onQueryResult(f)})}_renderError(){const n=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(n)}_renderNoResults(){const n=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(n)}_renderMessage(n){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(n)}_localize(n){const f=xb.language(this.options.language.split(",")[0]);return this.options.language&&(B0!=null&&B0[n][f])?B0[n][f]:B0[n].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const n=this._typeahead.data.filter(f=>typeof f!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const x=Iu({},{padding:100},this.options.flyTo),A=new this._maplibregl.LngLatBounds;for(const R of n)A.extend(R.geometry.coordinates);this._map.fitBounds(A,x)}return n.length>0&&this._maplibregl&&this._handleResultMarkers(n),this}setInput(n){return this._inputEl.value=n,this._typeahead.selected=null,this._typeahead.clear(),n.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(n),this}setProximity(n){return this.options.proximity=n,this}getProximity(){return this.options.proximity}setRenderFunction(n){return n&&typeof n=="function"&&(this._typeahead.render=n),this}getRenderFunction(){return this._typeahead.render}setLanguage(n){return this.options.language=n||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(n){return this.options.zoom=n,this}getFlyTo(){return this.options.flyTo}setFlyTo(n){return this.options.flyTo=n,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(n){return this.placeholder=n||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(n){return this.options.bbox=n,this}getCountries(){return this.options.countries}setCountries(n){return this.options.countries=n,this}getTypes(){return this.options.types}setTypes(n){return this.options.types=n,this}getMinLength(){return this.options.minLength}setMinLength(n){return this.options.minLength=n,this._typeahead&&(this._typeahead.options.minLength=n),this}getLimit(){return this.options.limit}setLimit(n){return this.options.limit=n,this._typeahead&&(this._typeahead.options.limit=n),this}getFilter(){return this.options.filter}setFilter(n){return this.options.filter=n,this}setGeocoderApi(n){return this.geocoderApi=n,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(n){if(!this._map)return;this._removeMarker();const x=Iu({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(x);let A;if(this.options.popup){const S=Iu({},{},this.options.popup);A=new this._maplibregl.Popup(S).setHTML(this.options.popupRender(n))}return n.center?(this.mapMarker.setLngLat(n.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(A)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(this.mapMarker.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(A)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(n){if(!this._map)return;this._removeResultMarkers();let x=Iu({},{color:"#4668F2"},this.options.showResultMarkers);for(const A of n){let R;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(R=this.options.showResultMarkers.element.cloneNode(!0),x=Iu(x,{element:R}));const S=new this._maplibregl.Marker(Iu({},x,{element:R}));let h;if(this.options.popup){const Q=Iu({},{},this.options.popup);h=new this._maplibregl.Popup(Q).setHTML(this.options.popupRender(A))}A.center?(S.setLngLat(A.center).addTo(this._map),this.options.popup&&S.setPopup(h)):A.geometry&&A.geometry.type&&A.geometry.type==="Point"&&A.geometry.coordinates&&(S.setLngLat(A.geometry.coordinates).addTo(this._map),this.options.popup&&S.setPopup(h)),this.resultMarkers.push(S)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(n){n.remove()}),this.resultMarkers=[])}on(n,f){return this._eventEmitter.on(n,f),this}once(n){return new Promise(f=>{this._eventEmitter.once(n,f)})}off(n,f){return this._eventEmitter.removeListener(n,f),this}}const Pb=({geoJson:i,onFeatureClick:n,onMapLoaded:f})=>{var h;const[x,A]=Ct.useState({longitude:37.7333,latitude:55.9833,zoom:11}),[R,S]=Ct.useState(null);return Dt.jsx("div",{className:"relative h-full",children:Dt.jsxs(Xy,{initialViewState:{longitude:37.7333,latitude:55.9833,zoom:11},...x,onMove:Z=>A(Z.viewState),mapStyle:"https://tiles.stadiamaps.com/styles/osm_bright.json",style:{width:"100%",height:"100%"},cursor:R?"pointer":"auto",onLoad:Z=>{const Q=Z.target;Q.on("mousemove",["polygons","lines","points"],Me=>{var Ae;if(Q)if((Ae=Me.features)!=null&&Ae[0]){const he=Me.features[0],Ve=Me.lngLat;S({feature:he,coordinates:Ve})}else S(null)}),Q.on("mouseleave",["polygons","lines","points"],()=>{Q&&S(null)}),Q.on("click",["polygons","lines","points"],Me=>{var he;if(!Q)return;const Ae=(he=Me.features)==null?void 0:he[0];Ae&&n(Ae)});const ge=new Rb({forwardGeocode:async Me=>{try{return{type:"FeatureCollection",features:(await(await fetch(`https://nominatim.openstreetmap.org/search?q=${Me.query}&format=geojson&polygon_geojson=1&addressdetails=1`)).json()).features.map(Ve=>{const Vt=[Ve.bbox[0]+(Ve.bbox[2]-Ve.bbox[0])/2,Ve.bbox[1]+(Ve.bbox[3]-Ve.bbox[1])/2];return{type:"Feature",geometry:{type:"Point",coordinates:Vt},place_name:Ve.properties.display_name,properties:Ve.properties,text:Ve.properties.display_name,place_type:["place"],center:Vt}})}}catch(Ae){return console.error(`Failed to forwardGeocode with error: ${Ae}`),{type:"FeatureCollection",features:[]}}}},{maplibregl:K_,marker:!0,flyTo:{duration:2e3}});Q.addControl(ge,"top-left"),f(Q)},children:[Dt.jsx(Bm,{id:"polygons",type:"geojson",data:{type:"FeatureCollection",features:i.features.filter(Z=>Z.geometry.type==="Polygon")},children:Dt.jsx(zm,{id:"polygons",type:"fill",paint:{"fill-color":["get","fillColor"],"fill-opacity":["get","fillOpacity"],"fill-outline-color":["get","strokeColor"]}})}),Dt.jsx(Bm,{id:"lines",type:"geojson",data:{type:"FeatureCollection",features:i.features.filter(Z=>Z.geometry.type==="LineString")},children:Dt.jsx(zm,{id:"lines",type:"line",paint:{"line-color":["get","color"],"line-width":["get","width"]}})}),Dt.jsx(Bm,{id:"points",type:"geojson",data:{type:"FeatureCollection",features:i.features.filter(Z=>Z.geometry.type==="Point")},children:Dt.jsx(zm,{id:"points",type:"circle",paint:{"circle-radius":["get","radius"],"circle-color":["get","color"],"circle-stroke-width":["get","strokeWidth"],"circle-stroke-color":["get","strokeColor"]}})}),R&&Dt.jsx(Ky,{longitude:R.coordinates.lng,latitude:R.coordinates.lat,closeButton:!1,children:Dt.jsx("div",{children:Dt.jsx("h3",{children:(h=R.feature.properties)==null?void 0:h.name})})})]})})};var na;(function(i){i.Root="root",i.Text="text",i.Directive="directive",i.Comment="comment",i.Script="script",i.Style="style",i.Tag="tag",i.CDATA="cdata",i.Doctype="doctype"})(na||(na={}));function Lb(i){return i.type===na.Tag||i.type===na.Script||i.type===na.Style}const Ob=na.Root,Nb=na.Text,kb=na.Directive,Bb=na.Comment,zb=na.Script,Fb=na.Style,Ub=na.Tag,Hb=na.CDATA,jb=na.Doctype;class t1{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(n){this.parent=n}get previousSibling(){return this.prev}set previousSibling(n){this.prev=n}get nextSibling(){return this.next}set nextSibling(n){this.next=n}cloneNode(n=!1){return X0(this,n)}}class yg extends t1{constructor(n){super(),this.data=n}get nodeValue(){return this.data}set nodeValue(n){this.data=n}}class $0 extends yg{constructor(){super(...arguments),this.type=na.Text}get nodeType(){return 3}}class bg extends yg{constructor(){super(...arguments),this.type=na.Comment}get nodeType(){return 8}}class xg extends yg{constructor(n,f){super(f),this.name=n,this.type=na.Directive}get nodeType(){return 1}}class vg extends t1{constructor(n){super(),this.children=n}get firstChild(){var n;return(n=this.children[0])!==null&&n!==void 0?n:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(n){this.children=n}}class i1 extends vg{constructor(){super(...arguments),this.type=na.CDATA}get nodeType(){return 4}}class gd extends vg{constructor(){super(...arguments),this.type=na.Root}get nodeType(){return 9}}class Tg extends vg{constructor(n,f,x=[],A=n==="script"?na.Script:n==="style"?na.Style:na.Tag){super(x),this.name=n,this.attribs=f,this.type=A}get nodeType(){return 1}get tagName(){return this.name}set tagName(n){this.name=n}get attributes(){return Object.keys(this.attribs).map(n=>{var f,x;return{name:n,value:this.attribs[n],namespace:(f=this["x-attribsNamespace"])===null||f===void 0?void 0:f[n],prefix:(x=this["x-attribsPrefix"])===null||x===void 0?void 0:x[n]}})}}function fi(i){return Lb(i)}function om(i){return i.type===na.CDATA}function Sl(i){return i.type===na.Text}function um(i){return i.type===na.Comment}function ag(i){return i.type===na.Directive}function Th(i){return i.type===na.Root}function yn(i){return Object.prototype.hasOwnProperty.call(i,"children")}function X0(i,n=!1){let f;if(Sl(i))f=new $0(i.data);else if(um(i))f=new bg(i.data);else if(fi(i)){const x=n?Zm(i.children):[],A=new Tg(i.name,{...i.attribs},x);x.forEach(R=>R.parent=A),i.namespace!=null&&(A.namespace=i.namespace),i["x-attribsNamespace"]&&(A["x-attribsNamespace"]={...i["x-attribsNamespace"]}),i["x-attribsPrefix"]&&(A["x-attribsPrefix"]={...i["x-attribsPrefix"]}),f=A}else if(om(i)){const x=n?Zm(i.children):[],A=new i1(x);x.forEach(R=>R.parent=A),f=A}else if(Th(i)){const x=n?Zm(i.children):[],A=new gd(x);x.forEach(R=>R.parent=A),i["x-mode"]&&(A["x-mode"]=i["x-mode"]),f=A}else if(ag(i)){const x=new xg(i.name,i.data);i["x-name"]!=null&&(x["x-name"]=i["x-name"],x["x-publicId"]=i["x-publicId"],x["x-systemId"]=i["x-systemId"]),f=x}else throw new Error(`Not implemented yet: ${i.type}`);return f.startIndex=i.startIndex,f.endIndex=i.endIndex,i.sourceCodeLocation!=null&&(f.sourceCodeLocation=i.sourceCodeLocation),f}function Zm(i){const n=i.map(f=>X0(f,!0));for(let f=1;f<n.length;f++)n[f].prev=n[f-1],n[f-1].next=n[f];return n}const m_={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class qb{constructor(n,f,x){this.dom=[],this.root=new gd(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof f=="function"&&(x=f,f=m_),typeof n=="object"&&(f=n,n=void 0),this.callback=n??null,this.options=f??m_,this.elementCB=x??null}onparserinit(n){this.parser=n}onreset(){this.dom=[],this.root=new gd(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(n){this.handleCallback(n)}onclosetag(){this.lastNode=null;const n=this.tagStack.pop();this.options.withEndIndices&&(n.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(n)}onopentag(n,f){const x=this.options.xmlMode?na.Tag:void 0,A=new Tg(n,f,void 0,x);this.addNode(A),this.tagStack.push(A)}ontext(n){const{lastNode:f}=this;if(f&&f.type===na.Text)f.data+=n,this.options.withEndIndices&&(f.endIndex=this.parser.endIndex);else{const x=new $0(n);this.addNode(x),this.lastNode=x}}oncomment(n){if(this.lastNode&&this.lastNode.type===na.Comment){this.lastNode.data+=n;return}const f=new bg(n);this.addNode(f),this.lastNode=f}oncommentend(){this.lastNode=null}oncdatastart(){const n=new $0(""),f=new i1([n]);this.addNode(f),n.parent=f,this.lastNode=n}oncdataend(){this.lastNode=null}onprocessinginstruction(n,f){const x=new xg(n,f);this.addNode(x)}handleCallback(n){if(typeof this.callback=="function")this.callback(n,this.dom);else if(n)throw n}addNode(n){const f=this.tagStack[this.tagStack.length-1],x=f.children[f.children.length-1];this.options.withStartIndices&&(n.startIndex=this.parser.startIndex),this.options.withEndIndices&&(n.endIndex=this.parser.endIndex),f.children.push(n),x&&(n.prev=x,x.next=n),n.parent=f,this.lastNode=null}}const a1=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(i=>i.charCodeAt(0))),n1=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(i=>i.charCodeAt(0)));var Ym;const Vb=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),ng=(Ym=String.fromCodePoint)!==null&&Ym!==void 0?Ym:function(i){let n="";return i>65535&&(i-=65536,n+=String.fromCharCode(i>>>10&1023|55296),i=56320|i&1023),n+=String.fromCharCode(i),n};function Gb(i){var n;return i>=55296&&i<=57343||i>1114111?65533:(n=Vb.get(i))!==null&&n!==void 0?n:i}var nr;(function(i){i[i.NUM=35]="NUM",i[i.SEMI=59]="SEMI",i[i.EQUALS=61]="EQUALS",i[i.ZERO=48]="ZERO",i[i.NINE=57]="NINE",i[i.LOWER_A=97]="LOWER_A",i[i.LOWER_F=102]="LOWER_F",i[i.LOWER_X=120]="LOWER_X",i[i.LOWER_Z=122]="LOWER_Z",i[i.UPPER_A=65]="UPPER_A",i[i.UPPER_F=70]="UPPER_F",i[i.UPPER_Z=90]="UPPER_Z"})(nr||(nr={}));const Zb=32;var bh;(function(i){i[i.VALUE_LENGTH=49152]="VALUE_LENGTH",i[i.BRANCH_LENGTH=16256]="BRANCH_LENGTH",i[i.JUMP_TABLE=127]="JUMP_TABLE"})(bh||(bh={}));function rg(i){return i>=nr.ZERO&&i<=nr.NINE}function Yb(i){return i>=nr.UPPER_A&&i<=nr.UPPER_F||i>=nr.LOWER_A&&i<=nr.LOWER_F}function $b(i){return i>=nr.UPPER_A&&i<=nr.UPPER_Z||i>=nr.LOWER_A&&i<=nr.LOWER_Z||rg(i)}function Xb(i){return i===nr.EQUALS||$b(i)}var ir;(function(i){i[i.EntityStart=0]="EntityStart",i[i.NumericStart=1]="NumericStart",i[i.NumericDecimal=2]="NumericDecimal",i[i.NumericHex=3]="NumericHex",i[i.NamedEntity=4]="NamedEntity"})(ir||(ir={}));var wl;(function(i){i[i.Legacy=0]="Legacy",i[i.Strict=1]="Strict",i[i.Attribute=2]="Attribute"})(wl||(wl={}));let r1=class{constructor(n,f,x){this.decodeTree=n,this.emitCodePoint=f,this.errors=x,this.state=ir.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=wl.Strict}startEntity(n){this.decodeMode=n,this.state=ir.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(n,f){switch(this.state){case ir.EntityStart:return n.charCodeAt(f)===nr.NUM?(this.state=ir.NumericStart,this.consumed+=1,this.stateNumericStart(n,f+1)):(this.state=ir.NamedEntity,this.stateNamedEntity(n,f));case ir.NumericStart:return this.stateNumericStart(n,f);case ir.NumericDecimal:return this.stateNumericDecimal(n,f);case ir.NumericHex:return this.stateNumericHex(n,f);case ir.NamedEntity:return this.stateNamedEntity(n,f)}}stateNumericStart(n,f){return f>=n.length?-1:(n.charCodeAt(f)|Zb)===nr.LOWER_X?(this.state=ir.NumericHex,this.consumed+=1,this.stateNumericHex(n,f+1)):(this.state=ir.NumericDecimal,this.stateNumericDecimal(n,f))}addToNumericResult(n,f,x,A){if(f!==x){const R=x-f;this.result=this.result*Math.pow(A,R)+parseInt(n.substr(f,R),A),this.consumed+=R}}stateNumericHex(n,f){const x=f;for(;f<n.length;){const A=n.charCodeAt(f);if(rg(A)||Yb(A))f+=1;else return this.addToNumericResult(n,x,f,16),this.emitNumericEntity(A,3)}return this.addToNumericResult(n,x,f,16),-1}stateNumericDecimal(n,f){const x=f;for(;f<n.length;){const A=n.charCodeAt(f);if(rg(A))f+=1;else return this.addToNumericResult(n,x,f,10),this.emitNumericEntity(A,2)}return this.addToNumericResult(n,x,f,10),-1}emitNumericEntity(n,f){var x;if(this.consumed<=f)return(x=this.errors)===null||x===void 0||x.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(n===nr.SEMI)this.consumed+=1;else if(this.decodeMode===wl.Strict)return 0;return this.emitCodePoint(Gb(this.result),this.consumed),this.errors&&(n!==nr.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(n,f){const{decodeTree:x}=this;let A=x[this.treeIndex],R=(A&bh.VALUE_LENGTH)>>14;for(;f<n.length;f++,this.excess++){const S=n.charCodeAt(f);if(this.treeIndex=Qb(x,A,this.treeIndex+Math.max(1,R),S),this.treeIndex<0)return this.result===0||this.decodeMode===wl.Attribute&&(R===0||Xb(S))?0:this.emitNotTerminatedNamedEntity();if(A=x[this.treeIndex],R=(A&bh.VALUE_LENGTH)>>14,R!==0){if(S===nr.SEMI)return this.emitNamedEntityData(this.treeIndex,R,this.consumed+this.excess);this.decodeMode!==wl.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var n;const{result:f,decodeTree:x}=this,A=(x[f]&bh.VALUE_LENGTH)>>14;return this.emitNamedEntityData(f,A,this.consumed),(n=this.errors)===null||n===void 0||n.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(n,f,x){const{decodeTree:A}=this;return this.emitCodePoint(f===1?A[n]&~bh.VALUE_LENGTH:A[n+1],x),f===3&&this.emitCodePoint(A[n+2],x),x}end(){var n;switch(this.state){case ir.NamedEntity:return this.result!==0&&(this.decodeMode!==wl.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ir.NumericDecimal:return this.emitNumericEntity(0,2);case ir.NumericHex:return this.emitNumericEntity(0,3);case ir.NumericStart:return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ir.EntityStart:return 0}}};function s1(i){let n="";const f=new r1(i,x=>n+=ng(x));return function(A,R){let S=0,h=0;for(;(h=A.indexOf("&",h))>=0;){n+=A.slice(S,h),f.startEntity(R);const Q=f.write(A,h+1);if(Q<0){S=h+f.end();break}S=h+Q,h=Q===0?S+1:S}const Z=n+A.slice(S);return n="",Z}}function Qb(i,n,f,x){const A=(n&bh.BRANCH_LENGTH)>>7,R=n&bh.JUMP_TABLE;if(A===0)return R!==0&&x===R?f:-1;if(R){const Z=x-R;return Z<0||Z>=A?-1:i[f+Z]-1}let S=f,h=S+A-1;for(;S<=h;){const Z=S+h>>>1,Q=i[Z];if(Q<x)S=Z+1;else if(Q>x)h=Z-1;else return i[Z+A]}return-1}s1(a1);s1(n1);const g_=/["&'<>$\x80-\uFFFF]/g,Kb=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),Wb=String.prototype.codePointAt!=null?(i,n)=>i.codePointAt(n):(i,n)=>(i.charCodeAt(n)&64512)===55296?(i.charCodeAt(n)-55296)*1024+i.charCodeAt(n+1)-56320+65536:i.charCodeAt(n);function o1(i){let n="",f=0,x;for(;(x=g_.exec(i))!==null;){const A=x.index,R=i.charCodeAt(A),S=Kb.get(R);S!==void 0?(n+=i.substring(f,A)+S,f=A+1):(n+=`${i.substring(f,A)}&#x${Wb(i,A).toString(16)};`,f=g_.lastIndex+=+((R&64512)===55296))}return n+i.substr(f)}function u1(i,n){return function(x){let A,R=0,S="";for(;A=i.exec(x);)R!==A.index&&(S+=x.substring(R,A.index)),S+=n.get(A[0].charCodeAt(0)),R=A.index+1;return S+x.substring(R)}}const Jb=u1(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),e2=u1(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),t2=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(i=>[i.toLowerCase(),i])),i2=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(i=>[i.toLowerCase(),i])),a2=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function n2(i){return i.replace(/"/g,"&quot;")}function r2(i,n){var f;if(!i)return;const x=((f=n.encodeEntities)!==null&&f!==void 0?f:n.decodeEntities)===!1?n2:n.xmlMode||n.encodeEntities!=="utf8"?o1:Jb;return Object.keys(i).map(A=>{var R,S;const h=(R=i[A])!==null&&R!==void 0?R:"";return n.xmlMode==="foreign"&&(A=(S=i2.get(A))!==null&&S!==void 0?S:A),!n.emptyAttrs&&!n.xmlMode&&h===""?A:`${A}="${x(h)}"`}).join(" ")}const __=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function lm(i,n={}){const f="length"in i?i:[i];let x="";for(let A=0;A<f.length;A++)x+=s2(f[A],n);return x}function s2(i,n){switch(i.type){case Ob:return lm(i.children,n);case jb:case kb:return c2(i);case Bb:return f2(i);case Hb:return d2(i);case zb:case Fb:case Ub:return l2(i,n);case Nb:return h2(i,n)}}const o2=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),u2=new Set(["svg","math"]);function l2(i,n){var f;n.xmlMode==="foreign"&&(i.name=(f=t2.get(i.name))!==null&&f!==void 0?f:i.name,i.parent&&o2.has(i.parent.name)&&(n={...n,xmlMode:!1})),!n.xmlMode&&u2.has(i.name)&&(n={...n,xmlMode:"foreign"});let x=`<${i.name}`;const A=r2(i.attribs,n);return A&&(x+=` ${A}`),i.children.length===0&&(n.xmlMode?n.selfClosingTags!==!1:n.selfClosingTags&&__.has(i.name))?(n.xmlMode||(x+=" "),x+="/>"):(x+=">",i.children.length>0&&(x+=lm(i.children,n)),(n.xmlMode||!__.has(i.name))&&(x+=`</${i.name}>`)),x}function c2(i){return`<${i.data}>`}function h2(i,n){var f;let x=i.data||"";return((f=n.encodeEntities)!==null&&f!==void 0?f:n.decodeEntities)!==!1&&!(!n.xmlMode&&i.parent&&a2.has(i.parent.name))&&(x=n.xmlMode||n.encodeEntities!=="utf8"?o1(x):e2(x)),x}function d2(i){return`<![CDATA[${i.children[0].data}]]>`}function f2(i){return`<!--${i.data}-->`}function l1(i,n){return lm(i,n)}function p2(i,n){return yn(i)?i.children.map(f=>l1(f,n)).join(""):""}function Zp(i){return Array.isArray(i)?i.map(Zp).join(""):fi(i)?i.name==="br"?`
`:Zp(i.children):om(i)?Zp(i.children):Sl(i)?i.data:""}function Of(i){return Array.isArray(i)?i.map(Of).join(""):yn(i)&&!um(i)?Of(i.children):Sl(i)?i.data:""}function Xp(i){return Array.isArray(i)?i.map(Xp).join(""):yn(i)&&(i.type===na.Tag||om(i))?Xp(i.children):Sl(i)?i.data:""}function cm(i){return yn(i)?i.children:[]}function c1(i){return i.parent||null}function h1(i){const n=c1(i);if(n!=null)return cm(n);const f=[i];let{prev:x,next:A}=i;for(;x!=null;)f.unshift(x),{prev:x}=x;for(;A!=null;)f.push(A),{next:A}=A;return f}function m2(i,n){var f;return(f=i.attribs)===null||f===void 0?void 0:f[n]}function g2(i,n){return i.attribs!=null&&Object.prototype.hasOwnProperty.call(i.attribs,n)&&i.attribs[n]!=null}function _2(i){return i.name}function Eg(i){let{next:n}=i;for(;n!==null&&!fi(n);)({next:n}=n);return n}function wg(i){let{prev:n}=i;for(;n!==null&&!fi(n);)({prev:n}=n);return n}function bd(i){if(i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),i.parent){const n=i.parent.children,f=n.lastIndexOf(i);f>=0&&n.splice(f,1)}i.next=null,i.prev=null,i.parent=null}function y2(i,n){const f=n.prev=i.prev;f&&(f.next=n);const x=n.next=i.next;x&&(x.prev=n);const A=n.parent=i.parent;if(A){const R=A.children;R[R.lastIndexOf(i)]=n,i.parent=null}}function b2(i,n){if(bd(n),n.next=null,n.parent=i,i.children.push(n)>1){const f=i.children[i.children.length-2];f.next=n,n.prev=f}else n.prev=null}function x2(i,n){bd(n);const{parent:f}=i,x=i.next;if(n.next=x,n.prev=i,i.next=n,n.parent=f,x){if(x.prev=n,f){const A=f.children;A.splice(A.lastIndexOf(x),0,n)}}else f&&f.children.push(n)}function v2(i,n){if(bd(n),n.parent=i,n.prev=null,i.children.unshift(n)!==1){const f=i.children[1];f.prev=n,n.next=f}else n.next=null}function T2(i,n){bd(n);const{parent:f}=i;if(f){const x=f.children;x.splice(x.indexOf(i),0,n)}i.prev&&(i.prev.next=n),n.parent=f,n.prev=i.prev,n.next=i,i.prev=n}function ep(i,n,f=!0,x=1/0){return Ag(i,Array.isArray(n)?n:[n],f,x)}function Ag(i,n,f,x){const A=[],R=[Array.isArray(n)?n:[n]],S=[0];for(;;){if(S[0]>=R[0].length){if(S.length===1)return A;R.shift(),S.shift();continue}const h=R[0][S[0]++];if(i(h)&&(A.push(h),--x<=0))return A;f&&yn(h)&&h.children.length>0&&(S.unshift(0),R.unshift(h.children))}}function E2(i,n){return n.find(i)}function Sg(i,n,f=!0){const x=Array.isArray(n)?n:[n];for(let A=0;A<x.length;A++){const R=x[A];if(fi(R)&&i(R))return R;if(f&&yn(R)&&R.children.length>0){const S=Sg(i,R.children,!0);if(S)return S}}return null}function d1(i,n){return(Array.isArray(n)?n:[n]).some(f=>fi(f)&&i(f)||yn(f)&&d1(i,f.children))}function w2(i,n){const f=[],x=[Array.isArray(n)?n:[n]],A=[0];for(;;){if(A[0]>=x[0].length){if(x.length===1)return f;x.shift(),A.shift();continue}const R=x[0][A[0]++];fi(R)&&i(R)&&f.push(R),yn(R)&&R.children.length>0&&(A.unshift(0),x.unshift(R.children))}}const Qp={tag_name(i){return typeof i=="function"?n=>fi(n)&&i(n.name):i==="*"?fi:n=>fi(n)&&n.name===i},tag_type(i){return typeof i=="function"?n=>i(n.type):n=>n.type===i},tag_contains(i){return typeof i=="function"?n=>Sl(n)&&i(n.data):n=>Sl(n)&&n.data===i}};function Cg(i,n){return typeof n=="function"?f=>fi(f)&&n(f.attribs[i]):f=>fi(f)&&f.attribs[i]===n}function A2(i,n){return f=>i(f)||n(f)}function f1(i){const n=Object.keys(i).map(f=>{const x=i[f];return Object.prototype.hasOwnProperty.call(Qp,f)?Qp[f](x):Cg(f,x)});return n.length===0?null:n.reduce(A2)}function S2(i,n){const f=f1(i);return f?f(n):!0}function C2(i,n,f,x=1/0){const A=f1(i);return A?ep(A,n,f,x):[]}function M2(i,n,f=!0){return Array.isArray(n)||(n=[n]),Sg(Cg("id",i),n,f)}function Bf(i,n,f=!0,x=1/0){return ep(Qp.tag_name(i),n,f,x)}function I2(i,n,f=!0,x=1/0){return ep(Cg("class",i),n,f,x)}function D2(i,n,f=!0,x=1/0){return ep(Qp.tag_type(i),n,f,x)}function R2(i){let n=i.length;for(;--n>=0;){const f=i[n];if(n>0&&i.lastIndexOf(f,n-1)>=0){i.splice(n,1);continue}for(let x=f.parent;x;x=x.parent)if(i.includes(x)){i.splice(n,1);break}}return i}var Bo;(function(i){i[i.DISCONNECTED=1]="DISCONNECTED",i[i.PRECEDING=2]="PRECEDING",i[i.FOLLOWING=4]="FOLLOWING",i[i.CONTAINS=8]="CONTAINS",i[i.CONTAINED_BY=16]="CONTAINED_BY"})(Bo||(Bo={}));function p1(i,n){const f=[],x=[];if(i===n)return 0;let A=yn(i)?i:i.parent;for(;A;)f.unshift(A),A=A.parent;for(A=yn(n)?n:n.parent;A;)x.unshift(A),A=A.parent;const R=Math.min(f.length,x.length);let S=0;for(;S<R&&f[S]===x[S];)S++;if(S===0)return Bo.DISCONNECTED;const h=f[S-1],Z=h.children,Q=f[S],ge=x[S];return Z.indexOf(Q)>Z.indexOf(ge)?h===n?Bo.FOLLOWING|Bo.CONTAINED_BY:Bo.FOLLOWING:h===i?Bo.PRECEDING|Bo.CONTAINS:Bo.PRECEDING}function zf(i){return i=i.filter((n,f,x)=>!x.includes(n,f+1)),i.sort((n,f)=>{const x=p1(n,f);return x&Bo.PRECEDING?-1:x&Bo.FOLLOWING?1:0}),i}function P2(i){const n=Kp(B2,i);return n?n.name==="feed"?L2(n):O2(n):null}function L2(i){var n;const f=i.children,x={type:"atom",items:Bf("entry",f).map(S=>{var h;const{children:Z}=S,Q={media:m1(Z)};Cs(Q,"id","id",Z),Cs(Q,"title","title",Z);const ge=(h=Kp("link",Z))===null||h===void 0?void 0:h.attribs.href;ge&&(Q.link=ge);const Me=xh("summary",Z)||xh("content",Z);Me&&(Q.description=Me);const Ae=xh("updated",Z);return Ae&&(Q.pubDate=new Date(Ae)),Q})};Cs(x,"id","id",f),Cs(x,"title","title",f);const A=(n=Kp("link",f))===null||n===void 0?void 0:n.attribs.href;A&&(x.link=A),Cs(x,"description","subtitle",f);const R=xh("updated",f);return R&&(x.updated=new Date(R)),Cs(x,"author","email",f,!0),x}function O2(i){var n,f;const x=(f=(n=Kp("channel",i.children))===null||n===void 0?void 0:n.children)!==null&&f!==void 0?f:[],A={type:i.name.substr(0,3),id:"",items:Bf("item",i.children).map(S=>{const{children:h}=S,Z={media:m1(h)};Cs(Z,"id","guid",h),Cs(Z,"title","title",h),Cs(Z,"link","link",h),Cs(Z,"description","description",h);const Q=xh("pubDate",h)||xh("dc:date",h);return Q&&(Z.pubDate=new Date(Q)),Z})};Cs(A,"title","title",x),Cs(A,"link","link",x),Cs(A,"description","description",x);const R=xh("lastBuildDate",x);return R&&(A.updated=new Date(R)),Cs(A,"author","managingEditor",x,!0),A}const N2=["url","type","lang"],k2=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function m1(i){return Bf("media:content",i).map(n=>{const{attribs:f}=n,x={medium:f.medium,isDefault:!!f.isDefault};for(const A of N2)f[A]&&(x[A]=f[A]);for(const A of k2)f[A]&&(x[A]=parseInt(f[A],10));return f.expression&&(x.expression=f.expression),x})}function Kp(i,n){return Bf(i,n,!0,1)[0]}function xh(i,n,f=!1){return Of(Bf(i,n,f,1)).trim()}function Cs(i,n,f,x,A=!1){const R=xh(f,x,A);R&&(i[n]=R)}function B2(i){return i==="rss"||i==="feed"||i==="rdf:RDF"}const hm=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return Bo},append:x2,appendChild:b2,compareDocumentPosition:p1,existsOne:d1,filter:ep,find:Ag,findAll:w2,findOne:Sg,findOneChild:E2,getAttributeValue:m2,getChildren:cm,getElementById:M2,getElements:C2,getElementsByClassName:I2,getElementsByTagName:Bf,getElementsByTagType:D2,getFeed:P2,getInnerHTML:p2,getName:_2,getOuterHTML:l1,getParent:c1,getSiblings:h1,getText:Zp,hasAttrib:g2,hasChildren:yn,innerText:Xp,isCDATA:om,isComment:um,isDocument:Th,isTag:fi,isText:Sl,nextElementSibling:Eg,prepend:T2,prependChild:v2,prevElementSibling:wg,removeElement:bd,removeSubsets:R2,replaceElement:y2,testElement:S2,textContent:Of,uniqueSort:zf},Symbol.toStringTag,{value:"Module"})),z2={_useHtmlParser2:!1};function sg(i,n){if(!i)return n??z2;const f={_useHtmlParser2:!!i.xmlMode,...n,...i};return i.xml?(f._useHtmlParser2=!0,f.xmlMode=!0,i.xml!==!0&&Object.assign(f,i.xml)):i.xmlMode&&(f._useHtmlParser2=!0),f}function g1(i,n,f){return i?i(n??i._root.children,null,void 0,f).toString():""}function F2(i,n){return typeof i=="object"&&i!=null&&!("length"in i)&&!("type"in i)}function U2(i,n){const f=F2(i)?(n=i,void 0):i,x={...this===null||this===void 0?void 0:this._options,...sg(n)};return g1(this,f,x)}function H2(i){const n={...this._options,xmlMode:!0};return g1(this,i,n)}function Q0(i){const n=i??(this?this.root():[]);let f="";for(let x=0;x<n.length;x++)f+=Of(n[x]);return f}function j2(i,n,f=typeof n=="boolean"?n:!1){if(!i||typeof i!="string")return null;typeof n=="boolean"&&(f=n);const x=this.load(i,this._options,!1);return f||x("script").remove(),[...x.root()[0].children]}function q2(){return this(this._root)}function _1(i,n){if(n===i)return!1;let f=n;for(;f&&f!==f.parent;)if(f=f.parent,f===i)return!0;return!1}function V2(i){return this.root().extract(i)}function G2(i,n){if(!y_(i)||!y_(n))return;let f=i.length;const x=+n.length;for(let A=0;A<x;A++)i[f++]=n[A];return i.length=f,i}function y_(i){if(Array.isArray(i))return!0;if(typeof i!="object"||i===null||!("length"in i)||typeof i.length!="number"||i.length<0)return!1;for(let n=0;n<i.length;n++)if(!(n in i))return!1;return!0}const Z2=Object.freeze(Object.defineProperty({__proto__:null,contains:_1,extract:V2,html:U2,merge:G2,parseHTML:j2,root:q2,text:Q0,xml:H2},Symbol.toStringTag,{value:"Module"}));function gc(i){return i.cheerio!=null}function Y2(i){return i.replace(/[._-](\w|$)/g,(n,f)=>f.toUpperCase())}function $2(i){return i.replace(/[A-Z]/g,"-$&").toLowerCase()}function tn(i,n){const f=i.length;for(let x=0;x<f;x++)n(i[x],x);return i}var pd;(function(i){i[i.LowerA=97]="LowerA",i[i.LowerZ=122]="LowerZ",i[i.UpperA=65]="UpperA",i[i.UpperZ=90]="UpperZ",i[i.Exclamation=33]="Exclamation"})(pd||(pd={}));function og(i){const n=i.indexOf("<");if(n<0||n>i.length-3)return!1;const f=i.charCodeAt(n+1);return(f>=pd.LowerA&&f<=pd.LowerZ||f>=pd.UpperA&&f<=pd.UpperZ||f===pd.Exclamation)&&i.includes(">",n+2)}const K0=Object.prototype.hasOwnProperty,W0=/\s+/,ug="data-",Mg=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,X2=/^{[^]*}$|^\[[^]*]$/;function Wp(i,n,f){var x;if(!(!i||!fi(i))){if((x=i.attribs)!==null&&x!==void 0||(i.attribs={}),!n)return i.attribs;if(K0.call(i.attribs,n))return!f&&Mg.test(n)?n:i.attribs[n];if(i.name==="option"&&n==="value")return Q0(i.children);if(i.name==="input"&&(i.attribs.type==="radio"||i.attribs.type==="checkbox")&&n==="value")return"on"}}function Pf(i,n,f){f===null?b1(i,n):i.attribs[n]=`${f}`}function Q2(i,n){if(typeof i=="object"||n!==void 0){if(typeof n=="function"){if(typeof i!="string")throw new Error("Bad combination of arguments.");return tn(this,(f,x)=>{fi(f)&&Pf(f,i,n.call(f,x,f.attribs[i]))})}return tn(this,f=>{if(fi(f))if(typeof i=="object")for(const x of Object.keys(i)){const A=i[x];Pf(f,x,A)}else Pf(f,i,n)})}return arguments.length>1?this:Wp(this[0],i,this.options.xmlMode)}function b_(i,n,f){return n in i?i[n]:!f&&Mg.test(n)?Wp(i,n,!1)!==void 0:Wp(i,n,f)}function $m(i,n,f,x){n in i?i[n]=f:Pf(i,n,!x&&Mg.test(n)?f?"":null:`${f}`)}function K2(i,n){var f;if(typeof i=="string"&&n===void 0){const x=this[0];if(!x||!fi(x))return;switch(i){case"style":{const A=this.css(),R=Object.keys(A);for(let S=0;S<R.length;S++)A[S]=R[S];return A.length=R.length,A}case"tagName":case"nodeName":return x.name.toUpperCase();case"href":case"src":{const A=(f=x.attribs)===null||f===void 0?void 0:f[i];return typeof URL<"u"&&(i==="href"&&(x.tagName==="a"||x.tagName==="link")||i==="src"&&(x.tagName==="img"||x.tagName==="iframe"||x.tagName==="audio"||x.tagName==="video"||x.tagName==="source"))&&A!==void 0&&this.options.baseURI?new URL(A,this.options.baseURI).href:A}case"innerText":return Xp(x);case"textContent":return Of(x);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return b_(x,i,this.options.xmlMode)}}if(typeof i=="object"||n!==void 0){if(typeof n=="function"){if(typeof i=="object")throw new TypeError("Bad combination of arguments.");return tn(this,(x,A)=>{fi(x)&&$m(x,i,n.call(x,A,b_(x,i,this.options.xmlMode)),this.options.xmlMode)})}return tn(this,x=>{if(fi(x))if(typeof i=="object")for(const A of Object.keys(i)){const R=i[A];$m(x,A,R,this.options.xmlMode)}else $m(x,i,n,this.options.xmlMode)})}}function x_(i,n,f){var x;(x=i.data)!==null&&x!==void 0||(i.data={}),typeof n=="object"?Object.assign(i.data,n):typeof n=="string"&&f!==void 0&&(i.data[n]=f)}function W2(i){for(const n of Object.keys(i.attribs)){if(!n.startsWith(ug))continue;const f=Y2(n.slice(ug.length));K0.call(i.data,f)||(i.data[f]=y1(i.attribs[n]))}return i.data}function J2(i,n){const f=ug+$2(n),x=i.data;if(K0.call(x,n))return x[n];if(K0.call(i.attribs,f))return x[n]=y1(i.attribs[f])}function y1(i){if(i==="null")return null;if(i==="true")return!0;if(i==="false")return!1;const n=Number(i);if(i===String(n))return n;if(X2.test(i))try{return JSON.parse(i)}catch{}return i}function ex(i,n){var f;const x=this[0];if(!x||!fi(x))return;const A=x;return(f=A.data)!==null&&f!==void 0||(A.data={}),i==null?W2(A):typeof i=="object"||n!==void 0?(tn(this,R=>{fi(R)&&(typeof i=="object"?x_(R,i):x_(R,i,n))}),this):J2(A,i)}function tx(i){const n=arguments.length===0,f=this[0];if(!f||!fi(f))return n?void 0:this;switch(f.name){case"textarea":return this.text(i);case"select":{const x=this.find("option:selected");if(!n){if(this.attr("multiple")==null&&typeof i=="object")return this;this.find("option").removeAttr("selected");const A=typeof i=="object"?i:[i];for(const R of A)this.find(`option[value="${R}"]`).attr("selected","");return this}return this.attr("multiple")?x.toArray().map(A=>Q0(A.children)):x.attr("value")}case"input":case"option":return n?this.attr("value"):this.attr("value",i)}}function b1(i,n){!i.attribs||!K0.call(i.attribs,n)||delete i.attribs[n]}function Jp(i){return i?i.trim().split(W0):[]}function ix(i){const n=Jp(i);for(const f of n)tn(this,x=>{fi(x)&&b1(x,f)});return this}function ax(i){return this.toArray().some(n=>{const f=fi(n)&&n.attribs.class;let x=-1;if(f&&i.length>0)for(;(x=f.indexOf(i,x+1))>-1;){const A=x+i.length;if((x===0||W0.test(f[x-1]))&&(A===f.length||W0.test(f[A])))return!0}return!1})}function x1(i){if(typeof i=="function")return tn(this,(x,A)=>{if(fi(x)){const R=x.attribs.class||"";x1.call([x],i.call(x,A,R))}});if(!i||typeof i!="string")return this;const n=i.split(W0),f=this.length;for(let x=0;x<f;x++){const A=this[x];if(!fi(A))continue;const R=Wp(A,"class",!1);if(R){let S=` ${R} `;for(const h of n){const Z=`${h} `;S.includes(` ${Z}`)||(S+=Z)}Pf(A,"class",S.trim())}else Pf(A,"class",n.join(" ").trim())}return this}function v1(i){if(typeof i=="function")return tn(this,(A,R)=>{fi(A)&&v1.call([A],i.call(A,R,A.attribs.class||""))});const n=Jp(i),f=n.length,x=arguments.length===0;return tn(this,A=>{if(fi(A))if(x)A.attribs.class="";else{const R=Jp(A.attribs.class);let S=!1;for(let h=0;h<f;h++){const Z=R.indexOf(n[h]);Z>=0&&(R.splice(Z,1),S=!0,h--)}S&&(A.attribs.class=R.join(" "))}})}function T1(i,n){if(typeof i=="function")return tn(this,(S,h)=>{fi(S)&&T1.call([S],i.call(S,h,S.attribs.class||"",n),n)});if(!i||typeof i!="string")return this;const f=i.split(W0),x=f.length,A=typeof n=="boolean"?n?1:-1:0,R=this.length;for(let S=0;S<R;S++){const h=this[S];if(!fi(h))continue;const Z=Jp(h.attribs.class);for(let Q=0;Q<x;Q++){const ge=Z.indexOf(f[Q]);A>=0&&ge<0?Z.push(f[Q]):A<=0&&ge>=0&&Z.splice(ge,1)}h.attribs.class=Z.join(" ")}return this}const nx=Object.freeze(Object.defineProperty({__proto__:null,addClass:x1,attr:Q2,data:ex,hasClass:ax,prop:K2,removeAttr:ix,removeClass:v1,toggleClass:T1,val:tx},Symbol.toStringTag,{value:"Module"}));var ti;(function(i){i.Attribute="attribute",i.Pseudo="pseudo",i.PseudoElement="pseudo-element",i.Tag="tag",i.Universal="universal",i.Adjacent="adjacent",i.Child="child",i.Descendant="descendant",i.Parent="parent",i.Sibling="sibling",i.ColumnCombinator="column-combinator"})(ti||(ti={}));var Gn;(function(i){i.Any="any",i.Element="element",i.End="end",i.Equals="equals",i.Exists="exists",i.Hyphen="hyphen",i.Not="not",i.Start="start"})(Gn||(Gn={}));const v_=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,rx=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,sx=new Map([[126,Gn.Element],[94,Gn.Start],[36,Gn.End],[42,Gn.Any],[33,Gn.Not],[124,Gn.Hyphen]]),ox=new Set(["has","not","matches","is","where","host","host-context"]);function j0(i){switch(i.type){case ti.Adjacent:case ti.Child:case ti.Descendant:case ti.Parent:case ti.Sibling:case ti.ColumnCombinator:return!0;default:return!1}}const ux=new Set(["contains","icontains"]);function lx(i,n,f){const x=parseInt(n,16)-65536;return x!==x||f?n:x<0?String.fromCharCode(x+65536):String.fromCharCode(x>>10|55296,x&1023|56320)}function z0(i){return i.replace(rx,lx)}function Xm(i){return i===39||i===34}function T_(i){return i===32||i===9||i===10||i===12||i===13}function dm(i){const n=[],f=E1(n,`${i}`,0);if(f<i.length)throw new Error(`Unmatched selector: ${i.slice(f)}`);return n}function E1(i,n,f){let x=[];function A(Ae){const he=n.slice(f+Ae).match(v_);if(!he)throw new Error(`Expected name, found ${n.slice(f)}`);const[Ve]=he;return f+=Ae+Ve.length,z0(Ve)}function R(Ae){for(f+=Ae;f<n.length&&T_(n.charCodeAt(f));)f++}function S(){f+=1;const Ae=f;let he=1;for(;he>0&&f<n.length;f++)n.charCodeAt(f)===40&&!h(f)?he++:n.charCodeAt(f)===41&&!h(f)&&he--;if(he)throw new Error("Parenthesis not matched");return z0(n.slice(Ae,f-1))}function h(Ae){let he=0;for(;n.charCodeAt(--Ae)===92;)he++;return(he&1)===1}function Z(){if(x.length>0&&j0(x[x.length-1]))throw new Error("Did not expect successive traversals.")}function Q(Ae){if(x.length>0&&x[x.length-1].type===ti.Descendant){x[x.length-1].type=Ae;return}Z(),x.push({type:Ae})}function ge(Ae,he){x.push({type:ti.Attribute,name:Ae,action:he,value:A(1),namespace:null,ignoreCase:"quirks"})}function Me(){if(x.length&&x[x.length-1].type===ti.Descendant&&x.pop(),x.length===0)throw new Error("Empty sub-selector");i.push(x)}if(R(0),n.length===f)return f;e:for(;f<n.length;){const Ae=n.charCodeAt(f);switch(Ae){case 32:case 9:case 10:case 12:case 13:{(x.length===0||x[0].type!==ti.Descendant)&&(Z(),x.push({type:ti.Descendant})),R(1);break}case 62:{Q(ti.Child),R(1);break}case 60:{Q(ti.Parent),R(1);break}case 126:{Q(ti.Sibling),R(1);break}case 43:{Q(ti.Adjacent),R(1);break}case 46:{ge("class",Gn.Element);break}case 35:{ge("id",Gn.Equals);break}case 91:{R(1);let he,Ve=null;n.charCodeAt(f)===124?he=A(1):n.startsWith("*|",f)?(Ve="*",he=A(2)):(he=A(0),n.charCodeAt(f)===124&&n.charCodeAt(f+1)!==61&&(Ve=he,he=A(1))),R(0);let Vt=Gn.Exists;const li=sx.get(n.charCodeAt(f));if(li){if(Vt=li,n.charCodeAt(f+1)!==61)throw new Error("Expected `=`");R(2)}else n.charCodeAt(f)===61&&(Vt=Gn.Equals,R(1));let Pi="",Bi=null;if(Vt!=="exists"){if(Xm(n.charCodeAt(f))){const Ie=n.charCodeAt(f);let Oe=f+1;for(;Oe<n.length&&(n.charCodeAt(Oe)!==Ie||h(Oe));)Oe+=1;if(n.charCodeAt(Oe)!==Ie)throw new Error("Attribute value didn't end");Pi=z0(n.slice(f+1,Oe)),f=Oe+1}else{const Ie=f;for(;f<n.length&&(!T_(n.charCodeAt(f))&&n.charCodeAt(f)!==93||h(f));)f+=1;Pi=z0(n.slice(Ie,f))}R(0);const et=n.charCodeAt(f)|32;et===115?(Bi=!1,R(1)):et===105&&(Bi=!0,R(1))}if(n.charCodeAt(f)!==93)throw new Error("Attribute selector didn't terminate");f+=1;const jt={type:ti.Attribute,name:he,action:Vt,value:Pi,namespace:Ve,ignoreCase:Bi};x.push(jt);break}case 58:{if(n.charCodeAt(f+1)===58){x.push({type:ti.PseudoElement,name:A(2).toLowerCase(),data:n.charCodeAt(f)===40?S():null});continue}const he=A(1).toLowerCase();let Ve=null;if(n.charCodeAt(f)===40)if(ox.has(he)){if(Xm(n.charCodeAt(f+1)))throw new Error(`Pseudo-selector ${he} cannot be quoted`);if(Ve=[],f=E1(Ve,n,f+1),n.charCodeAt(f)!==41)throw new Error(`Missing closing parenthesis in :${he} (${n})`);f+=1}else{if(Ve=S(),ux.has(he)){const Vt=Ve.charCodeAt(0);Vt===Ve.charCodeAt(Ve.length-1)&&Xm(Vt)&&(Ve=Ve.slice(1,-1))}Ve=z0(Ve)}x.push({type:ti.Pseudo,name:he,data:Ve});break}case 44:{Me(),x=[],R(1);break}default:{if(n.startsWith("/*",f)){const Vt=n.indexOf("*/",f+2);if(Vt<0)throw new Error("Comment was not terminated");f=Vt+2,x.length===0&&R(0);break}let he=null,Ve;if(Ae===42)f+=1,Ve="*";else if(Ae===124){if(Ve="",n.charCodeAt(f+1)===124){Q(ti.ColumnCombinator),R(2);break}}else if(v_.test(n.slice(f)))Ve=A(0);else break e;n.charCodeAt(f)===124&&n.charCodeAt(f+1)!==124&&(he=Ve,n.charCodeAt(f+1)===42?(Ve="*",f+=2):Ve=A(1)),x.push(Ve==="*"?{type:ti.Universal,namespace:he}:{type:ti.Tag,name:Ve,namespace:he})}}}return Me(),f}var Qm,E_;function cx(){return E_||(E_=1,Qm={trueFunc:function(){return!0},falseFunc:function(){return!1}}),Qm}var em=cx();const Ri=Y_(em),w1=new Map([[ti.Universal,50],[ti.Tag,30],[ti.Attribute,1],[ti.Pseudo,0]]);function Ig(i){return!w1.has(i.type)}const hx=new Map([[Gn.Exists,10],[Gn.Equals,8],[Gn.Not,7],[Gn.Start,6],[Gn.End,6],[Gn.Any,5]]);function dx(i){const n=i.map(A1);for(let f=1;f<i.length;f++){const x=n[f];if(!(x<0))for(let A=f-1;A>=0&&x<n[A];A--){const R=i[A+1];i[A+1]=i[A],i[A]=R,n[A+1]=n[A],n[A]=x}}}function A1(i){var n,f;let x=(n=w1.get(i.type))!==null&&n!==void 0?n:-1;return i.type===ti.Attribute?(x=(f=hx.get(i.action))!==null&&f!==void 0?f:4,i.action===Gn.Equals&&i.name==="id"&&(x=9),i.ignoreCase&&(x>>=1)):i.type===ti.Pseudo&&(i.data?i.name==="has"||i.name==="contains"?x=0:Array.isArray(i.data)?(x=Math.min(...i.data.map(A=>Math.min(...A.map(A1)))),x<0&&(x=0)):x=2:x=3),x}const fx=/[-[\]{}()*+?.,\\^$|#\s]/g;function w_(i){return i.replace(fx,"\\$&")}const px=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function fd(i,n){return typeof i.ignoreCase=="boolean"?i.ignoreCase:i.ignoreCase==="quirks"?!!n.quirksMode:!n.xmlMode&&px.has(i.name)}const mx={equals(i,n,f){const{adapter:x}=f,{name:A}=n;let{value:R}=n;return fd(n,f)?(R=R.toLowerCase(),S=>{const h=x.getAttributeValue(S,A);return h!=null&&h.length===R.length&&h.toLowerCase()===R&&i(S)}):S=>x.getAttributeValue(S,A)===R&&i(S)},hyphen(i,n,f){const{adapter:x}=f,{name:A}=n;let{value:R}=n;const S=R.length;return fd(n,f)?(R=R.toLowerCase(),function(Z){const Q=x.getAttributeValue(Z,A);return Q!=null&&(Q.length===S||Q.charAt(S)==="-")&&Q.substr(0,S).toLowerCase()===R&&i(Z)}):function(Z){const Q=x.getAttributeValue(Z,A);return Q!=null&&(Q.length===S||Q.charAt(S)==="-")&&Q.substr(0,S)===R&&i(Z)}},element(i,n,f){const{adapter:x}=f,{name:A,value:R}=n;if(/\s/.test(R))return Ri.falseFunc;const S=new RegExp(`(?:^|\\s)${w_(R)}(?:$|\\s)`,fd(n,f)?"i":"");return function(Z){const Q=x.getAttributeValue(Z,A);return Q!=null&&Q.length>=R.length&&S.test(Q)&&i(Z)}},exists(i,{name:n},{adapter:f}){return x=>f.hasAttrib(x,n)&&i(x)},start(i,n,f){const{adapter:x}=f,{name:A}=n;let{value:R}=n;const S=R.length;return S===0?Ri.falseFunc:fd(n,f)?(R=R.toLowerCase(),h=>{const Z=x.getAttributeValue(h,A);return Z!=null&&Z.length>=S&&Z.substr(0,S).toLowerCase()===R&&i(h)}):h=>{var Z;return!!(!((Z=x.getAttributeValue(h,A))===null||Z===void 0)&&Z.startsWith(R))&&i(h)}},end(i,n,f){const{adapter:x}=f,{name:A}=n;let{value:R}=n;const S=-R.length;return S===0?Ri.falseFunc:fd(n,f)?(R=R.toLowerCase(),h=>{var Z;return((Z=x.getAttributeValue(h,A))===null||Z===void 0?void 0:Z.substr(S).toLowerCase())===R&&i(h)}):h=>{var Z;return!!(!((Z=x.getAttributeValue(h,A))===null||Z===void 0)&&Z.endsWith(R))&&i(h)}},any(i,n,f){const{adapter:x}=f,{name:A,value:R}=n;if(R==="")return Ri.falseFunc;if(fd(n,f)){const S=new RegExp(w_(R),"i");return function(Z){const Q=x.getAttributeValue(Z,A);return Q!=null&&Q.length>=R.length&&S.test(Q)&&i(Z)}}return S=>{var h;return!!(!((h=x.getAttributeValue(S,A))===null||h===void 0)&&h.includes(R))&&i(S)}},not(i,n,f){const{adapter:x}=f,{name:A}=n;let{value:R}=n;return R===""?S=>!!x.getAttributeValue(S,A)&&i(S):fd(n,f)?(R=R.toLowerCase(),S=>{const h=x.getAttributeValue(S,A);return(h==null||h.length!==R.length||h.toLowerCase()!==R)&&i(S)}):S=>x.getAttributeValue(S,A)!==R&&i(S)}},gx=new Set([9,10,12,13,32]),A_=48,_x=57;function yx(i){if(i=i.trim().toLowerCase(),i==="even")return[2,0];if(i==="odd")return[2,1];let n=0,f=0,x=R(),A=S();if(n<i.length&&i.charAt(n)==="n"&&(n++,f=x*(A??1),h(),n<i.length?(x=R(),h(),A=S()):x=A=0),A===null||n<i.length)throw new Error(`n-th rule couldn't be parsed ('${i}')`);return[f,x*A];function R(){return i.charAt(n)==="-"?(n++,-1):(i.charAt(n)==="+"&&n++,1)}function S(){const Z=n;let Q=0;for(;n<i.length&&i.charCodeAt(n)>=A_&&i.charCodeAt(n)<=_x;)Q=Q*10+(i.charCodeAt(n)-A_),n++;return n===Z?null:Q}function h(){for(;n<i.length&&gx.has(i.charCodeAt(n));)n++}}function bx(i){const n=i[0],f=i[1]-1;if(f<0&&n<=0)return Ri.falseFunc;if(n===-1)return R=>R<=f;if(n===0)return R=>R===f;if(n===1)return f<0?Ri.trueFunc:R=>R>=f;const x=Math.abs(n),A=(f%x+x)%x;return n>1?R=>R>=f&&R%x===A:R=>R<=f&&R%x===A}function Up(i){return bx(yx(i))}function Hp(i,n){return f=>{const x=n.getParent(f);return x!=null&&n.isTag(x)&&i(f)}}const lg={contains(i,n,{adapter:f}){return function(A){return i(A)&&f.getText(A).includes(n)}},icontains(i,n,{adapter:f}){const x=n.toLowerCase();return function(R){return i(R)&&f.getText(R).toLowerCase().includes(x)}},"nth-child"(i,n,{adapter:f,equals:x}){const A=Up(n);return A===Ri.falseFunc?Ri.falseFunc:A===Ri.trueFunc?Hp(i,f):function(S){const h=f.getSiblings(S);let Z=0;for(let Q=0;Q<h.length&&!x(S,h[Q]);Q++)f.isTag(h[Q])&&Z++;return A(Z)&&i(S)}},"nth-last-child"(i,n,{adapter:f,equals:x}){const A=Up(n);return A===Ri.falseFunc?Ri.falseFunc:A===Ri.trueFunc?Hp(i,f):function(S){const h=f.getSiblings(S);let Z=0;for(let Q=h.length-1;Q>=0&&!x(S,h[Q]);Q--)f.isTag(h[Q])&&Z++;return A(Z)&&i(S)}},"nth-of-type"(i,n,{adapter:f,equals:x}){const A=Up(n);return A===Ri.falseFunc?Ri.falseFunc:A===Ri.trueFunc?Hp(i,f):function(S){const h=f.getSiblings(S);let Z=0;for(let Q=0;Q<h.length;Q++){const ge=h[Q];if(x(S,ge))break;f.isTag(ge)&&f.getName(ge)===f.getName(S)&&Z++}return A(Z)&&i(S)}},"nth-last-of-type"(i,n,{adapter:f,equals:x}){const A=Up(n);return A===Ri.falseFunc?Ri.falseFunc:A===Ri.trueFunc?Hp(i,f):function(S){const h=f.getSiblings(S);let Z=0;for(let Q=h.length-1;Q>=0;Q--){const ge=h[Q];if(x(S,ge))break;f.isTag(ge)&&f.getName(ge)===f.getName(S)&&Z++}return A(Z)&&i(S)}},root(i,n,{adapter:f}){return x=>{const A=f.getParent(x);return(A==null||!f.isTag(A))&&i(x)}},scope(i,n,f,x){const{equals:A}=f;return!x||x.length===0?lg.root(i,n,f):x.length===1?R=>A(x[0],R)&&i(R):R=>x.includes(R)&&i(R)},hover:Km("isHovered"),visited:Km("isVisited"),active:Km("isActive")};function Km(i){return function(f,x,{adapter:A}){const R=A[i];return typeof R!="function"?Ri.falseFunc:function(h){return R(h)&&f(h)}}}const S_={empty(i,{adapter:n}){return!n.getChildren(i).some(f=>n.isTag(f)||n.getText(f)!=="")},"first-child"(i,{adapter:n,equals:f}){if(n.prevElementSibling)return n.prevElementSibling(i)==null;const x=n.getSiblings(i).find(A=>n.isTag(A));return x!=null&&f(i,x)},"last-child"(i,{adapter:n,equals:f}){const x=n.getSiblings(i);for(let A=x.length-1;A>=0;A--){if(f(i,x[A]))return!0;if(n.isTag(x[A]))break}return!1},"first-of-type"(i,{adapter:n,equals:f}){const x=n.getSiblings(i),A=n.getName(i);for(let R=0;R<x.length;R++){const S=x[R];if(f(i,S))return!0;if(n.isTag(S)&&n.getName(S)===A)break}return!1},"last-of-type"(i,{adapter:n,equals:f}){const x=n.getSiblings(i),A=n.getName(i);for(let R=x.length-1;R>=0;R--){const S=x[R];if(f(i,S))return!0;if(n.isTag(S)&&n.getName(S)===A)break}return!1},"only-of-type"(i,{adapter:n,equals:f}){const x=n.getName(i);return n.getSiblings(i).every(A=>f(i,A)||!n.isTag(A)||n.getName(A)!==x)},"only-child"(i,{adapter:n,equals:f}){return n.getSiblings(i).every(x=>f(i,x)||!n.isTag(x))}};function C_(i,n,f,x){if(f===null){if(i.length>x)throw new Error(`Pseudo-class :${n} requires an argument`)}else if(i.length===x)throw new Error(`Pseudo-class :${n} doesn't have any arguments`)}const xx={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},S1={};function vx(i,n){return i===Ri.falseFunc?Ri.falseFunc:f=>n.isTag(f)&&i(f)}function C1(i,n){const f=n.getSiblings(i);if(f.length<=1)return[];const x=f.indexOf(i);return x<0||x===f.length-1?[]:f.slice(x+1).filter(n.isTag)}function cg(i){return{xmlMode:!!i.xmlMode,lowerCaseAttributeNames:!!i.lowerCaseAttributeNames,lowerCaseTags:!!i.lowerCaseTags,quirksMode:!!i.quirksMode,cacheResults:!!i.cacheResults,pseudos:i.pseudos,adapter:i.adapter,equals:i.equals}}const Wm=(i,n,f,x,A)=>{const R=A(n,cg(f),x);return R===Ri.trueFunc?i:R===Ri.falseFunc?Ri.falseFunc:S=>R(S)&&i(S)},Jm={is:Wm,matches:Wm,where:Wm,not(i,n,f,x,A){const R=A(n,cg(f),x);return R===Ri.falseFunc?i:R===Ri.trueFunc?Ri.falseFunc:S=>!R(S)&&i(S)},has(i,n,f,x,A){const{adapter:R}=f,S=cg(f);S.relativeSelector=!0;const h=n.some(ge=>ge.some(Ig))?[S1]:void 0,Z=A(n,S,h);if(Z===Ri.falseFunc)return Ri.falseFunc;const Q=vx(Z,R);if(h&&Z!==Ri.trueFunc){const{shouldTestNextSiblings:ge=!1}=Z;return Me=>{if(!i(Me))return!1;h[0]=Me;const Ae=R.getChildren(Me),he=ge?[...Ae,...C1(Me,R)]:Ae;return R.existsOne(Q,he)}}return ge=>i(ge)&&R.existsOne(Q,R.getChildren(ge))}};function Tx(i,n,f,x,A){var R;const{name:S,data:h}=n;if(Array.isArray(h)){if(!(S in Jm))throw new Error(`Unknown pseudo-class :${S}(${h})`);return Jm[S](i,h,f,x,A)}const Z=(R=f.pseudos)===null||R===void 0?void 0:R[S],Q=typeof Z=="string"?Z:xx[S];if(typeof Q=="string"){if(h!=null)throw new Error(`Pseudo ${S} doesn't have any arguments`);const ge=dm(Q);return Jm.is(i,ge,f,x,A)}if(typeof Z=="function")return C_(Z,S,h,1),ge=>Z(ge,h)&&i(ge);if(S in lg)return lg[S](i,h,f,x);if(S in S_){const ge=S_[S];return C_(ge,S,h,2),Me=>ge(Me,f,h)&&i(Me)}throw new Error(`Unknown pseudo-class :${S}`)}function eg(i,n){const f=n.getParent(i);return f&&n.isTag(f)?f:null}function Ex(i,n,f,x,A){const{adapter:R,equals:S}=f;switch(n.type){case ti.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case ti.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case ti.Attribute:{if(n.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!f.xmlMode||f.lowerCaseAttributeNames)&&(n.name=n.name.toLowerCase()),mx[n.action](i,n,f)}case ti.Pseudo:return Tx(i,n,f,x,A);case ti.Tag:{if(n.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:h}=n;return(!f.xmlMode||f.lowerCaseTags)&&(h=h.toLowerCase()),function(Q){return R.getName(Q)===h&&i(Q)}}case ti.Descendant:{if(f.cacheResults===!1||typeof WeakSet>"u")return function(Q){let ge=Q;for(;ge=eg(ge,R);)if(i(ge))return!0;return!1};const h=new WeakSet;return function(Q){let ge=Q;for(;ge=eg(ge,R);)if(!h.has(ge)){if(R.isTag(ge)&&i(ge))return!0;h.add(ge)}return!1}}case"_flexibleDescendant":return function(Z){let Q=Z;do if(i(Q))return!0;while(Q=eg(Q,R));return!1};case ti.Parent:return function(Z){return R.getChildren(Z).some(Q=>R.isTag(Q)&&i(Q))};case ti.Child:return function(Z){const Q=R.getParent(Z);return Q!=null&&R.isTag(Q)&&i(Q)};case ti.Sibling:return function(Z){const Q=R.getSiblings(Z);for(let ge=0;ge<Q.length;ge++){const Me=Q[ge];if(S(Z,Me))break;if(R.isTag(Me)&&i(Me))return!0}return!1};case ti.Adjacent:return R.prevElementSibling?function(Z){const Q=R.prevElementSibling(Z);return Q!=null&&i(Q)}:function(Z){const Q=R.getSiblings(Z);let ge;for(let Me=0;Me<Q.length;Me++){const Ae=Q[Me];if(S(Z,Ae))break;R.isTag(Ae)&&(ge=Ae)}return!!ge&&i(ge)};case ti.Universal:{if(n.namespace!=null&&n.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return i}}}function M1(i){return i.type===ti.Pseudo&&(i.name==="scope"||Array.isArray(i.data)&&i.data.some(n=>n.some(M1)))}const wx={type:ti.Descendant},Ax={type:"_flexibleDescendant"},Sx={type:ti.Pseudo,name:"scope",data:null};function Cx(i,{adapter:n},f){const x=!!(f!=null&&f.every(A=>{const R=n.isTag(A)&&n.getParent(A);return A===S1||R&&n.isTag(R)}));for(const A of i){if(!(A.length>0&&Ig(A[0])&&A[0].type!==ti.Descendant))if(x&&!A.some(M1))A.unshift(wx);else continue;A.unshift(Sx)}}function I1(i,n,f){var x;i.forEach(dx),f=(x=n.context)!==null&&x!==void 0?x:f;const A=Array.isArray(f),R=f&&(Array.isArray(f)?f:[f]);if(n.relativeSelector!==!1)Cx(i,n,R);else if(i.some(Z=>Z.length>0&&Ig(Z[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let S=!1;const h=i.map(Z=>{if(Z.length>=2){const[Q,ge]=Z;Q.type!==ti.Pseudo||Q.name!=="scope"||(A&&ge.type===ti.Descendant?Z[1]=Ax:(ge.type===ti.Adjacent||ge.type===ti.Sibling)&&(S=!0))}return Mx(Z,n,R)}).reduce(Ix,Ri.falseFunc);return h.shouldTestNextSiblings=S,h}function Mx(i,n,f){var x;return i.reduce((A,R)=>A===Ri.falseFunc?Ri.falseFunc:Ex(A,R,n,f,I1),(x=n.rootFunc)!==null&&x!==void 0?x:Ri.trueFunc)}function Ix(i,n){return n===Ri.falseFunc||i===Ri.trueFunc?i:i===Ri.falseFunc||n===Ri.trueFunc?n:function(x){return i(x)||n(x)}}const D1=(i,n)=>i===n,Dx={adapter:hm,equals:D1};function Rx(i){var n,f,x,A;const R=i??Dx;return(n=R.adapter)!==null&&n!==void 0||(R.adapter=hm),(f=R.equals)!==null&&f!==void 0||(R.equals=(A=(x=R.adapter)===null||x===void 0?void 0:x.equals)!==null&&A!==void 0?A:D1),R}function Px(i){return function(f,x,A){const R=Rx(x);return i(f,R,A)}}const Dg=Px(I1);function R1(i,n,f=!1){return f&&(i=Lx(i,n)),Array.isArray(i)?n.removeSubsets(i):n.getChildren(i)}function Lx(i,n){const f=Array.isArray(i)?i.slice(0):[i],x=f.length;for(let A=0;A<x;A++){const R=C1(f[A],n);f.push(...R)}return f}const Ox=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function tm(i){return i.type!=="pseudo"?!1:Ox.has(i.name)?!0:i.name==="not"&&Array.isArray(i.data)?i.data.some(n=>n.some(tm)):!1}function Nx(i,n,f){const x=n!=null?parseInt(n,10):NaN;switch(i){case"first":return 1;case"nth":case"eq":return isFinite(x)?x>=0?x+1:1/0:0;case"lt":return isFinite(x)?x>=0?Math.min(x,f):1/0:0;case"gt":return isFinite(x)?1/0:0;case"odd":return 2*f;case"even":return 2*f-1;case"last":case"not":return 1/0}}function kx(i){for(;i.parent;)i=i.parent;return i}function Rg(i){const n=[],f=[];for(const x of i)x.some(tm)?n.push(x):f.push(x);return[f,n]}const Bx={type:ti.Universal,namespace:null},zx={type:ti.Pseudo,name:"scope",data:null};function P1(i,n,f={}){return L1([i],n,f)}function L1(i,n,f={}){if(typeof n=="function")return i.some(n);const[x,A]=Rg(dm(n));return x.length>0&&i.some(Dg(x,f))||A.some(R=>k1(R,i,f).length>0)}function Fx(i,n,f,x){const A=typeof f=="string"?parseInt(f,10):NaN;switch(i){case"first":case"lt":return n;case"last":return n.length>0?[n[n.length-1]]:n;case"nth":case"eq":return isFinite(A)&&Math.abs(A)<n.length?[A<0?n[n.length+A]:n[A]]:[];case"gt":return isFinite(A)?n.slice(A+1):[];case"even":return n.filter((R,S)=>S%2===0);case"odd":return n.filter((R,S)=>S%2===1);case"not":{const R=new Set(N1(f,n,x));return n.filter(S=>!R.has(S))}}}function O1(i,n,f={}){return N1(dm(i),n,f)}function N1(i,n,f){if(n.length===0)return[];const[x,A]=Rg(i);let R;if(x.length){const S=dg(n,x,f);if(A.length===0)return S;S.length&&(R=new Set(S))}for(let S=0;S<A.length&&(R==null?void 0:R.size)!==n.length;S++){const h=A[S];if((R?n.filter(ge=>fi(ge)&&!R.has(ge)):n).length===0)break;const Q=k1(h,n,f);if(Q.length)if(R)Q.forEach(ge=>R.add(ge));else{if(S===A.length-1)return Q;R=new Set(Q)}}return typeof R<"u"?R.size===n.length?n:n.filter(S=>R.has(S)):[]}function k1(i,n,f){var x;if(i.some(j0)){const A=(x=f.root)!==null&&x!==void 0?x:kx(n[0]),R={...f,context:n,relativeSelector:!1};return i.push(zx),im(A,i,R,!0,n.length)}return im(n,i,f,!1,n.length)}function Ux(i,n,f={},x=1/0){if(typeof i=="function")return B1(n,i);const[A,R]=Rg(dm(i)),S=R.map(h=>im(n,h,f,!0,x));return A.length&&S.push(hg(n,A,f,x)),S.length===0?[]:S.length===1?S[0]:zf(S.reduce((h,Z)=>[...h,...Z]))}function im(i,n,f,x,A){const R=n.findIndex(tm),S=n.slice(0,R),h=n[R],Z=n.length-1===R?A:1/0,Q=Nx(h.name,h.data,Z);if(Q===0)return[];const Me=(S.length===0&&!Array.isArray(i)?cm(i).filter(fi):S.length===0?(Array.isArray(i)?i:[i]).filter(fi):x||S.some(j0)?hg(i,[S],f,Q):dg(i,[S],f)).slice(0,Q);let Ae=Fx(h.name,Me,h.data,f);if(Ae.length===0||n.length===R+1)return Ae;const he=n.slice(R+1),Ve=he.some(j0);if(Ve){if(j0(he[0])){const{type:Vt}=he[0];(Vt===ti.Sibling||Vt===ti.Adjacent)&&(Ae=R1(Ae,hm,!0)),he.unshift(Bx)}f={...f,relativeSelector:!1,rootFunc:Vt=>Ae.includes(Vt)}}else f.rootFunc&&f.rootFunc!==em.trueFunc&&(f={...f,rootFunc:em.trueFunc});return he.some(tm)?im(Ae,he,f,!1,A):Ve?hg(Ae,[he],f,A):dg(Ae,[he],f)}function hg(i,n,f,x){const A=Dg(n,f,i);return B1(i,A,x)}function B1(i,n,f=1/0){const x=R1(i,hm,n.shouldTestNextSiblings);return Ag(A=>fi(A)&&n(A),x,!0,f)}function dg(i,n,f){const x=(Array.isArray(i)?i:[i]).filter(fi);if(x.length===0)return x;const A=Dg(n,f);return A===em.trueFunc?x:x.filter(A)}const Hx=/^\s*[+~]/;function jx(i){if(!i)return this._make([]);if(typeof i!="string"){const n=gc(i)?i.toArray():[i],f=this.toArray();return this._make(n.filter(x=>f.some(A=>_1(A,x))))}return this._findBySelector(i,Number.POSITIVE_INFINITY)}function qx(i,n){var f;const x=this.toArray(),A=Hx.test(i)?x:this.children().toArray(),R={context:x,root:(f=this._root)===null||f===void 0?void 0:f[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(Ux(i,A,R,n))}function Pg(i){return function(n,...f){return function(x){var A;let R=i(n,this);return x&&(R=Ng(R,x,this.options.xmlMode,(A=this._root)===null||A===void 0?void 0:A[0])),this._make(this.length>1&&R.length>1?f.reduce((S,h)=>h(S),R):R)}}}const tp=Pg((i,n)=>{let f=[];for(let x=0;x<n.length;x++){const A=i(n[x]);A.length>0&&(f=f.concat(A))}return f}),Lg=Pg((i,n)=>{const f=[];for(let x=0;x<n.length;x++){const A=i(n[x]);A!==null&&f.push(A)}return f});function Og(i,...n){let f=null;const x=Pg((A,R)=>{const S=[];return tn(R,h=>{for(let Z;(Z=A(h))&&!(f!=null&&f(Z,S.length));h=Z)S.push(Z)}),S})(i,...n);return function(A,R){f=typeof A=="string"?h=>P1(h,A,this.options):A?ip(A):null;const S=x.call(this,R);return f=null,S}}function Ff(i){return i.length>1?Array.from(new Set(i)):i}const Vx=Lg(({parent:i})=>i&&!Th(i)?i:null,Ff),Gx=tp(i=>{const n=[];for(;i.parent&&!Th(i.parent);)n.push(i.parent),i=i.parent;return n},zf,i=>i.reverse()),Zx=Og(({parent:i})=>i&&!Th(i)?i:null,zf,i=>i.reverse());function Yx(i){var n;const f=[];if(!i)return this._make(f);const x={xmlMode:this.options.xmlMode,root:(n=this._root)===null||n===void 0?void 0:n[0]},A=typeof i=="string"?R=>P1(R,i,x):ip(i);return tn(this,R=>{for(R&&!Th(R)&&!fi(R)&&(R=R.parent);R&&fi(R);){if(A(R,0)){f.includes(R)||f.push(R);break}R=R.parent}}),this._make(f)}const $x=Lg(i=>Eg(i)),Xx=tp(i=>{const n=[];for(;i.next;)i=i.next,fi(i)&&n.push(i);return n},Ff),Qx=Og(i=>Eg(i),Ff),Kx=Lg(i=>wg(i)),Wx=tp(i=>{const n=[];for(;i.prev;)i=i.prev,fi(i)&&n.push(i);return n},Ff),Jx=Og(i=>wg(i),Ff),ev=tp(i=>h1(i).filter(n=>fi(n)&&n!==i),zf),tv=tp(i=>cm(i).filter(fi),Ff);function iv(){const i=this.toArray().reduce((n,f)=>yn(f)?n.concat(f.children):n,[]);return this._make(i)}function av(i){let n=0;const f=this.length;for(;n<f&&i.call(this[n],n,this[n])!==!1;)++n;return this}function nv(i){let n=[];for(let f=0;f<this.length;f++){const x=this[f],A=i.call(x,f,x);A!=null&&(n=n.concat(A))}return this._make(n)}function ip(i){return typeof i=="function"?(n,f)=>i.call(n,f,n):gc(i)?n=>Array.prototype.includes.call(i,n):function(n){return i===n}}function rv(i){var n;return this._make(Ng(this.toArray(),i,this.options.xmlMode,(n=this._root)===null||n===void 0?void 0:n[0]))}function Ng(i,n,f,x){return typeof n=="string"?O1(n,i,{xmlMode:f,root:x}):i.filter(ip(n))}function sv(i){const n=this.toArray();return typeof i=="string"?L1(n.filter(fi),i,this.options):i?n.some(ip(i)):!1}function ov(i){let n=this.toArray();if(typeof i=="string"){const f=new Set(O1(i,n,this.options));n=n.filter(x=>!f.has(x))}else{const f=ip(i);n=n.filter((x,A)=>!f(x,A))}return this._make(n)}function uv(i){return this.filter(typeof i=="string"?`:has(${i})`:(n,f)=>this._make(f).find(i).length>0)}function lv(){return this.length>1?this._make(this[0]):this}function cv(){return this.length>0?this._make(this[this.length-1]):this}function hv(i){var n;return i=+i,i===0&&this.length<=1?this:(i<0&&(i=this.length+i),this._make((n=this[i])!==null&&n!==void 0?n:[]))}function dv(i){return i==null?this.toArray():this[i<0?this.length+i:i]}function fv(){return Array.prototype.slice.call(this)}function pv(i){let n,f;return i==null?(n=this.parent().children(),f=this[0]):typeof i=="string"?(n=this._make(i),f=this[0]):(n=this,f=gc(i)?i[0]:i),Array.prototype.indexOf.call(n,f)}function mv(i,n){return this._make(Array.prototype.slice.call(this,i,n))}function gv(){var i;return(i=this.prevObject)!==null&&i!==void 0?i:this._make([])}function _v(i,n){const f=this._make(i,n),x=zf([...this.get(),...f.get()]);return this._make(x)}function yv(i){return this.prevObject?this.add(i?this.prevObject.filter(i):this.prevObject):this}const bv=Object.freeze(Object.defineProperty({__proto__:null,_findBySelector:qx,add:_v,addBack:yv,children:tv,closest:Yx,contents:iv,each:av,end:gv,eq:hv,filter:rv,filterArray:Ng,find:jx,first:lv,get:dv,has:uv,index:pv,is:sv,last:cv,map:nv,next:$x,nextAll:Xx,nextUntil:Qx,not:ov,parent:Vx,parents:Gx,parentsUntil:Zx,prev:Kx,prevAll:Wx,prevUntil:Jx,siblings:ev,slice:mv,toArray:fv},Symbol.toStringTag,{value:"Module"}));function xv(i){return function(f,x,A,R){if(typeof Buffer<"u"&&Buffer.isBuffer(f)&&(f=f.toString()),typeof f=="string")return i(f,x,A,R);const S=f;if(!Array.isArray(S)&&Th(S))return S;const h=new gd([]);return _d(S,h),h}}function _d(i,n){const f=Array.isArray(i)?i:[i];n?n.children=f:n=null;for(let x=0;x<f.length;x++){const A=f[x];A.parent&&A.parent.children!==f&&bd(A),n?(A.prev=f[x-1]||null,A.next=f[x+1]||null):A.prev=A.next=null,A.parent=n}return n}function vv(i,n){if(i==null)return[];if(typeof i=="string")return this._parse(i,this.options,!1,null).children.slice(0);if("length"in i){if(i.length===1)return this._makeDomArray(i[0],n);const f=[];for(let x=0;x<i.length;x++){const A=i[x];if(typeof A=="object"){if(A==null)continue;if(!("length"in A)){f.push(n?X0(A,!0):A);continue}}f.push(...this._makeDomArray(A,n))}return f}return[n?X0(i,!0):i]}function z1(i){return function(...n){const f=this.length-1;return tn(this,(x,A)=>{if(!yn(x))return;const R=typeof n[0]=="function"?n[0].call(x,A,this._render(x.children)):n,S=this._makeDomArray(R,A<f);i(S,x.children,x)})}}function Eh(i,n,f,x,A){var R,S;const h=[n,f,...x],Z=n===0?null:i[n-1],Q=n+f>=i.length?null:i[n+f];for(let ge=0;ge<x.length;++ge){const Me=x[ge],Ae=Me.parent;if(Ae){const Ve=Ae.children.indexOf(Me);Ve>-1&&(Ae.children.splice(Ve,1),A===Ae&&n>Ve&&h[0]--)}Me.parent=A,Me.prev&&(Me.prev.next=(R=Me.next)!==null&&R!==void 0?R:null),Me.next&&(Me.next.prev=(S=Me.prev)!==null&&S!==void 0?S:null),Me.prev=ge===0?Z:x[ge-1],Me.next=ge===x.length-1?Q:x[ge+1]}return Z&&(Z.next=x[0]),Q&&(Q.prev=x[x.length-1]),i.splice(...h)}function Tv(i){return(gc(i)?i:this._make(i)).append(this),this}function Ev(i){return(gc(i)?i:this._make(i)).prepend(this),this}const wv=z1((i,n,f)=>{Eh(n,n.length,0,i,f)}),Av=z1((i,n,f)=>{Eh(n,0,0,i,f)});function F1(i){return function(n){const f=this.length-1,x=this.parents().last();for(let A=0;A<this.length;A++){const R=this[A],S=typeof n=="function"?n.call(R,A,R):typeof n=="string"&&!og(n)?x.find(n).clone():n,[h]=this._makeDomArray(S,A<f);if(!h||!yn(h))continue;let Z=h,Q=0;for(;Q<Z.children.length;){const ge=Z.children[Q];fi(ge)?(Z=ge,Q=0):Q++}i(R,Z,[h])}return this}}const Sv=F1((i,n,f)=>{const{parent:x}=i;if(!x)return;const A=x.children,R=A.indexOf(i);_d([i],n),Eh(A,R,0,f,x)}),Cv=F1((i,n,f)=>{yn(i)&&(_d(i.children,n),_d(f,i))});function Mv(i){return this.parent(i).not("body").each((n,f)=>{this._make(f).replaceWith(f.children)}),this}function Iv(i){const n=this[0];if(n){const f=this._make(typeof i=="function"?i.call(n,0,n):i).insertBefore(n);let x;for(let R=0;R<f.length;R++)f[R].type==="tag"&&(x=f[R]);let A=0;for(;x&&A<x.children.length;){const R=x.children[A];R.type==="tag"?(x=R,A=0):A++}x&&this._make(x).append(this)}return this}function Dv(...i){const n=this.length-1;return tn(this,(f,x)=>{if(!yn(f)||!f.parent)return;const A=f.parent.children,R=A.indexOf(f);if(R<0)return;const S=typeof i[0]=="function"?i[0].call(f,x,this._render(f.children)):i,h=this._makeDomArray(S,x<n);Eh(A,R+1,0,h,f.parent)})}function Rv(i){typeof i=="string"&&(i=this._make(i)),this.remove();const n=[];for(const f of this._makeDomArray(i)){const x=this.clone().toArray(),{parent:A}=f;if(!A)continue;const R=A.children,S=R.indexOf(f);S<0||(Eh(R,S+1,0,x,A),n.push(...x))}return this._make(n)}function Pv(...i){const n=this.length-1;return tn(this,(f,x)=>{if(!yn(f)||!f.parent)return;const A=f.parent.children,R=A.indexOf(f);if(R<0)return;const S=typeof i[0]=="function"?i[0].call(f,x,this._render(f.children)):i,h=this._makeDomArray(S,x<n);Eh(A,R,0,h,f.parent)})}function Lv(i){const n=this._make(i);this.remove();const f=[];return tn(n,x=>{const A=this.clone().toArray(),{parent:R}=x;if(!R)return;const S=R.children,h=S.indexOf(x);h<0||(Eh(S,h,0,A,R),f.push(...A))}),this._make(f)}function Ov(i){const n=i?this.filter(i):this;return tn(n,f=>{bd(f),f.prev=f.next=f.parent=null}),this}function Nv(i){return tn(this,(n,f)=>{const{parent:x}=n;if(!x)return;const A=x.children,R=typeof i=="function"?i.call(n,f,n):i,S=this._makeDomArray(R);_d(S,null);const h=A.indexOf(n);Eh(A,h,1,S,x),S.includes(n)||(n.parent=n.prev=n.next=null)})}function kv(){return tn(this,i=>{if(yn(i)){for(const n of i.children)n.next=n.prev=n.parent=null;i.children.length=0}})}function Bv(i){if(i===void 0){const n=this[0];return!n||!yn(n)?null:this._render(n.children)}return tn(this,n=>{if(!yn(n))return;for(const x of n.children)x.next=x.prev=x.parent=null;const f=gc(i)?i.toArray():this._parse(`${i}`,this.options,!1,n).children;_d(f,n)})}function zv(){return this._render(this)}function Fv(i){return i===void 0?Q0(this):typeof i=="function"?tn(this,(n,f)=>this._make(n).text(i.call(n,f,Q0([n])))):tn(this,n=>{if(!yn(n))return;for(const x of n.children)x.next=x.prev=x.parent=null;const f=new $0(`${i}`);_d(f,n)})}function Uv(){const i=Array.prototype.map.call(this.get(),f=>X0(f,!0)),n=new gd(i);for(const f of i)f.parent=n;return this._make(i)}const Hv=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:vv,after:Dv,append:wv,appendTo:Tv,before:Pv,clone:Uv,empty:kv,html:Bv,insertAfter:Rv,insertBefore:Lv,prepend:Av,prependTo:Ev,remove:Ov,replaceWith:Nv,text:Fv,toString:zv,unwrap:Mv,wrap:Sv,wrapAll:Iv,wrapInner:Cv},Symbol.toStringTag,{value:"Module"}));function jv(i,n){if(i!=null&&n!=null||typeof i=="object"&&!Array.isArray(i))return tn(this,(f,x)=>{fi(f)&&U1(f,i,n,x)});if(this.length!==0)return H1(this[0],i)}function U1(i,n,f,x){if(typeof n=="string"){const A=H1(i),R=typeof f=="function"?f.call(i,x,A[n]):f;R===""?delete A[n]:R!=null&&(A[n]=R),i.attribs.style=qv(A)}else if(typeof n=="object"){const A=Object.keys(n);for(let R=0;R<A.length;R++){const S=A[R];U1(i,S,n[S],R)}}}function H1(i,n){if(!i||!fi(i))return;const f=Vv(i.attribs.style);if(typeof n=="string")return f[n];if(Array.isArray(n)){const x={};for(const A of n)f[A]!=null&&(x[A]=f[A]);return x}return f}function qv(i){return Object.keys(i).reduce((n,f)=>`${n}${n?" ":""}${f}: ${i[f]};`,"")}function Vv(i){if(i=(i||"").trim(),!i)return{};const n={};let f;for(const x of i.split(";")){const A=x.indexOf(":");if(A<1||A===x.length-1){const R=x.trimEnd();R.length>0&&f!==void 0&&(n[f]+=`;${R}`)}else f=x.slice(0,A).trim(),n[f]=x.slice(A+1).trim()}return n}const Gv=Object.freeze(Object.defineProperty({__proto__:null,css:jv},Symbol.toStringTag,{value:"Module"})),M_="input,select,textarea,keygen",Zv=/%20/g,I_=/\r?\n/g;function Yv(){return this.serializeArray().map(f=>`${encodeURIComponent(f.name)}=${encodeURIComponent(f.value)}`).join("&").replace(Zv,"+")}function $v(){return this.map((i,n)=>{const f=this._make(n);return fi(n)&&n.name==="form"?f.find(M_).toArray():f.filter(M_).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((i,n)=>{var f;const x=this._make(n),A=x.attr("name"),R=(f=x.val())!==null&&f!==void 0?f:"";return Array.isArray(R)?R.map(S=>({name:A,value:S.replace(I_,`\r
`)})):{name:A,value:R.replace(I_,`\r
`)}}).toArray()}const Xv=Object.freeze(Object.defineProperty({__proto__:null,serialize:Yv,serializeArray:$v},Symbol.toStringTag,{value:"Module"}));function Qv(i){var n;return typeof i=="string"?{selector:i,value:"textContent"}:{selector:i.selector,value:(n=i.value)!==null&&n!==void 0?n:"textContent"}}function Kv(i){const n={};for(const f in i){const x=i[f],A=Array.isArray(x),{selector:R,value:S}=Qv(A?x[0]:x),h=typeof S=="function"?S:typeof S=="string"?Z=>this._make(Z).prop(S):Z=>this._make(Z).extract(S);if(A)n[f]=this._findBySelector(R,Number.POSITIVE_INFINITY).map((Z,Q)=>h(Q,f,n)).get();else{const Z=this._findBySelector(R,1);n[f]=Z.length>0?h(Z[0],f,n):void 0}}return n}const Wv=Object.freeze(Object.defineProperty({__proto__:null,extract:Kv},Symbol.toStringTag,{value:"Module"}));class ap{constructor(n,f,x){if(this.length=0,this.options=x,this._root=f,n){for(let A=0;A<n.length;A++)this[A]=n[A];this.length=n.length}}}ap.prototype.cheerio="[cheerio object]";ap.prototype.splice=Array.prototype.splice;ap.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(ap.prototype,nx,bv,Hv,Gv,Xv,Wv);function Jv(i,n){return function f(x,A,R=!0){if(x==null)throw new Error("cheerio.load() expects a string");const S=sg(A),h=i(x,S,R,null);class Z extends ap{_make(Me,Ae){const he=Q(Me,Ae);return he.prevObject=this,he}_parse(Me,Ae,he,Ve){return i(Me,Ae,he,Ve)}_render(Me){return n(Me,this.options)}}function Q(ge,Me,Ae=h,he){if(ge&&gc(ge))return ge;const Ve=sg(he,S),Vt=typeof Ae=="string"?[i(Ae,Ve,!1,null)]:"length"in Ae?Ae:[Ae],li=gc(Vt)?Vt:new Z(Vt,null,Ve);if(li._root=li,!ge)return new Z(void 0,li,Ve);const Pi=typeof ge=="string"&&og(ge)?i(ge,Ve,!1,null).children:eT(ge)?[ge]:Array.isArray(ge)?ge:void 0,Bi=new Z(Pi,li,Ve);if(Pi)return Bi;if(typeof ge!="string")throw new TypeError("Unexpected type of selector");let jt=ge;const et=Me?typeof Me=="string"?og(Me)?new Z([i(Me,Ve,!1,null)],li,Ve):(jt=`${Me} ${jt}`,li):gc(Me)?Me:new Z(Array.isArray(Me)?Me:[Me],li,Ve):li;return et?et.find(jt):Bi}return Object.assign(Q,Z2,{load:f,_root:h,_options:S,fn:Z.prototype,prototype:Z.prototype}),Q}}function eT(i){return!!i.name||i.type==="root"||i.type==="text"||i.type==="comment"}const tT=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Ya="";var se;(function(i){i[i.EOF=-1]="EOF",i[i.NULL=0]="NULL",i[i.TABULATION=9]="TABULATION",i[i.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",i[i.LINE_FEED=10]="LINE_FEED",i[i.FORM_FEED=12]="FORM_FEED",i[i.SPACE=32]="SPACE",i[i.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",i[i.QUOTATION_MARK=34]="QUOTATION_MARK",i[i.AMPERSAND=38]="AMPERSAND",i[i.APOSTROPHE=39]="APOSTROPHE",i[i.HYPHEN_MINUS=45]="HYPHEN_MINUS",i[i.SOLIDUS=47]="SOLIDUS",i[i.DIGIT_0=48]="DIGIT_0",i[i.DIGIT_9=57]="DIGIT_9",i[i.SEMICOLON=59]="SEMICOLON",i[i.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",i[i.EQUALS_SIGN=61]="EQUALS_SIGN",i[i.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",i[i.QUESTION_MARK=63]="QUESTION_MARK",i[i.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",i[i.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",i[i.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",i[i.GRAVE_ACCENT=96]="GRAVE_ACCENT",i[i.LATIN_SMALL_A=97]="LATIN_SMALL_A",i[i.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(se||(se={}));const Ss={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function j1(i){return i>=55296&&i<=57343}function iT(i){return i>=56320&&i<=57343}function aT(i,n){return(i-55296)*1024+9216+n}function q1(i){return i!==32&&i!==10&&i!==13&&i!==9&&i!==12&&i>=1&&i<=31||i>=127&&i<=159}function V1(i){return i>=64976&&i<=65007||tT.has(i)}var tt;(function(i){i.controlCharacterInInputStream="control-character-in-input-stream",i.noncharacterInInputStream="noncharacter-in-input-stream",i.surrogateInInputStream="surrogate-in-input-stream",i.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",i.endTagWithAttributes="end-tag-with-attributes",i.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",i.unexpectedSolidusInTag="unexpected-solidus-in-tag",i.unexpectedNullCharacter="unexpected-null-character",i.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",i.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",i.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",i.missingEndTagName="missing-end-tag-name",i.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",i.unknownNamedCharacterReference="unknown-named-character-reference",i.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",i.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",i.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",i.eofBeforeTagName="eof-before-tag-name",i.eofInTag="eof-in-tag",i.missingAttributeValue="missing-attribute-value",i.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",i.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",i.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",i.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",i.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",i.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",i.missingDoctypePublicIdentifier="missing-doctype-public-identifier",i.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",i.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",i.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",i.cdataInHtmlContent="cdata-in-html-content",i.incorrectlyOpenedComment="incorrectly-opened-comment",i.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",i.eofInDoctype="eof-in-doctype",i.nestedComment="nested-comment",i.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",i.eofInComment="eof-in-comment",i.incorrectlyClosedComment="incorrectly-closed-comment",i.eofInCdata="eof-in-cdata",i.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",i.nullCharacterReference="null-character-reference",i.surrogateCharacterReference="surrogate-character-reference",i.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",i.controlCharacterReference="control-character-reference",i.noncharacterCharacterReference="noncharacter-character-reference",i.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",i.missingDoctypeName="missing-doctype-name",i.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",i.duplicateAttribute="duplicate-attribute",i.nonConformingDoctype="non-conforming-doctype",i.missingDoctype="missing-doctype",i.misplacedDoctype="misplaced-doctype",i.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",i.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",i.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",i.openElementsLeftAfterEof="open-elements-left-after-eof",i.abandonedHeadElementChild="abandoned-head-element-child",i.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",i.nestedNoscriptInHead="nested-noscript-in-head",i.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(tt||(tt={}));const nT=65536;class rT{constructor(n){this.handler=n,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=nT,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(n,f){const{line:x,col:A,offset:R}=this,S=A+f,h=R+f;return{code:n,startLine:x,endLine:x,startCol:S,endCol:S,startOffset:h,endOffset:h}}_err(n){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(n,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(n){if(this.pos!==this.html.length-1){const f=this.html.charCodeAt(this.pos+1);if(iT(f))return this.pos++,this._addGap(),aT(n,f)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,se.EOF;return this._err(tt.surrogateInInputStream),n}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(n,f){this.html.length>0?this.html+=n:this.html=n,this.endOfChunkHit=!1,this.lastChunkWritten=f}insertHtmlAtCurrentPos(n){this.html=this.html.substring(0,this.pos+1)+n+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(n,f){if(this.pos+n.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(f)return this.html.startsWith(n,this.pos);for(let x=0;x<n.length;x++)if((this.html.charCodeAt(this.pos+x)|32)!==n.charCodeAt(x))return!1;return!0}peek(n){const f=this.pos+n;if(f>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,se.EOF;const x=this.html.charCodeAt(f);return x===se.CARRIAGE_RETURN?se.LINE_FEED:x}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,se.EOF;let n=this.html.charCodeAt(this.pos);return n===se.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,se.LINE_FEED):n===se.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,j1(n)&&(n=this._processSurrogate(n)),this.handler.onParseError===null||n>31&&n<127||n===se.LINE_FEED||n===se.CARRIAGE_RETURN||n>159&&n<64976||this._checkForProblematicCharacters(n),n)}_checkForProblematicCharacters(n){q1(n)?this._err(tt.controlCharacterInInputStream):V1(n)&&this._err(tt.noncharacterInInputStream)}retreat(n){for(this.pos-=n;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Vi;(function(i){i[i.CHARACTER=0]="CHARACTER",i[i.NULL_CHARACTER=1]="NULL_CHARACTER",i[i.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",i[i.START_TAG=3]="START_TAG",i[i.END_TAG=4]="END_TAG",i[i.COMMENT=5]="COMMENT",i[i.DOCTYPE=6]="DOCTYPE",i[i.EOF=7]="EOF",i[i.HIBERNATION=8]="HIBERNATION"})(Vi||(Vi={}));function G1(i,n){for(let f=i.attrs.length-1;f>=0;f--)if(i.attrs[f].name===n)return i.attrs[f].value;return null}const sT=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(i=>i.charCodeAt(0))),oT=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function uT(i){var n;return i>=55296&&i<=57343||i>1114111?65533:(n=oT.get(i))!==null&&n!==void 0?n:i}var rr;(function(i){i[i.NUM=35]="NUM",i[i.SEMI=59]="SEMI",i[i.EQUALS=61]="EQUALS",i[i.ZERO=48]="ZERO",i[i.NINE=57]="NINE",i[i.LOWER_A=97]="LOWER_A",i[i.LOWER_F=102]="LOWER_F",i[i.LOWER_X=120]="LOWER_X",i[i.LOWER_Z=122]="LOWER_Z",i[i.UPPER_A=65]="UPPER_A",i[i.UPPER_F=70]="UPPER_F",i[i.UPPER_Z=90]="UPPER_Z"})(rr||(rr={}));const lT=32;var vh;(function(i){i[i.VALUE_LENGTH=49152]="VALUE_LENGTH",i[i.BRANCH_LENGTH=16256]="BRANCH_LENGTH",i[i.JUMP_TABLE=127]="JUMP_TABLE"})(vh||(vh={}));function fg(i){return i>=rr.ZERO&&i<=rr.NINE}function cT(i){return i>=rr.UPPER_A&&i<=rr.UPPER_F||i>=rr.LOWER_A&&i<=rr.LOWER_F}function hT(i){return i>=rr.UPPER_A&&i<=rr.UPPER_Z||i>=rr.LOWER_A&&i<=rr.LOWER_Z||fg(i)}function dT(i){return i===rr.EQUALS||hT(i)}var ar;(function(i){i[i.EntityStart=0]="EntityStart",i[i.NumericStart=1]="NumericStart",i[i.NumericDecimal=2]="NumericDecimal",i[i.NumericHex=3]="NumericHex",i[i.NamedEntity=4]="NamedEntity"})(ar||(ar={}));var mc;(function(i){i[i.Legacy=0]="Legacy",i[i.Strict=1]="Strict",i[i.Attribute=2]="Attribute"})(mc||(mc={}));class fT{constructor(n,f,x){this.decodeTree=n,this.emitCodePoint=f,this.errors=x,this.state=ar.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=mc.Strict}startEntity(n){this.decodeMode=n,this.state=ar.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(n,f){switch(this.state){case ar.EntityStart:return n.charCodeAt(f)===rr.NUM?(this.state=ar.NumericStart,this.consumed+=1,this.stateNumericStart(n,f+1)):(this.state=ar.NamedEntity,this.stateNamedEntity(n,f));case ar.NumericStart:return this.stateNumericStart(n,f);case ar.NumericDecimal:return this.stateNumericDecimal(n,f);case ar.NumericHex:return this.stateNumericHex(n,f);case ar.NamedEntity:return this.stateNamedEntity(n,f)}}stateNumericStart(n,f){return f>=n.length?-1:(n.charCodeAt(f)|lT)===rr.LOWER_X?(this.state=ar.NumericHex,this.consumed+=1,this.stateNumericHex(n,f+1)):(this.state=ar.NumericDecimal,this.stateNumericDecimal(n,f))}addToNumericResult(n,f,x,A){if(f!==x){const R=x-f;this.result=this.result*Math.pow(A,R)+Number.parseInt(n.substr(f,R),A),this.consumed+=R}}stateNumericHex(n,f){const x=f;for(;f<n.length;){const A=n.charCodeAt(f);if(fg(A)||cT(A))f+=1;else return this.addToNumericResult(n,x,f,16),this.emitNumericEntity(A,3)}return this.addToNumericResult(n,x,f,16),-1}stateNumericDecimal(n,f){const x=f;for(;f<n.length;){const A=n.charCodeAt(f);if(fg(A))f+=1;else return this.addToNumericResult(n,x,f,10),this.emitNumericEntity(A,2)}return this.addToNumericResult(n,x,f,10),-1}emitNumericEntity(n,f){var x;if(this.consumed<=f)return(x=this.errors)===null||x===void 0||x.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(n===rr.SEMI)this.consumed+=1;else if(this.decodeMode===mc.Strict)return 0;return this.emitCodePoint(uT(this.result),this.consumed),this.errors&&(n!==rr.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(n,f){const{decodeTree:x}=this;let A=x[this.treeIndex],R=(A&vh.VALUE_LENGTH)>>14;for(;f<n.length;f++,this.excess++){const S=n.charCodeAt(f);if(this.treeIndex=pT(x,A,this.treeIndex+Math.max(1,R),S),this.treeIndex<0)return this.result===0||this.decodeMode===mc.Attribute&&(R===0||dT(S))?0:this.emitNotTerminatedNamedEntity();if(A=x[this.treeIndex],R=(A&vh.VALUE_LENGTH)>>14,R!==0){if(S===rr.SEMI)return this.emitNamedEntityData(this.treeIndex,R,this.consumed+this.excess);this.decodeMode!==mc.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var n;const{result:f,decodeTree:x}=this,A=(x[f]&vh.VALUE_LENGTH)>>14;return this.emitNamedEntityData(f,A,this.consumed),(n=this.errors)===null||n===void 0||n.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(n,f,x){const{decodeTree:A}=this;return this.emitCodePoint(f===1?A[n]&~vh.VALUE_LENGTH:A[n+1],x),f===3&&this.emitCodePoint(A[n+2],x),x}end(){var n;switch(this.state){case ar.NamedEntity:return this.result!==0&&(this.decodeMode!==mc.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ar.NumericDecimal:return this.emitNumericEntity(0,2);case ar.NumericHex:return this.emitNumericEntity(0,3);case ar.NumericStart:return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ar.EntityStart:return 0}}}function pT(i,n,f,x){const A=(n&vh.BRANCH_LENGTH)>>7,R=n&vh.JUMP_TABLE;if(A===0)return R!==0&&x===R?f:-1;if(R){const Z=x-R;return Z<0||Z>=A?-1:i[f+Z]-1}let S=f,h=S+A-1;for(;S<=h;){const Z=S+h>>>1,Q=i[Z];if(Q<x)S=Z+1;else if(Q>x)h=Z-1;else return i[Z+A]}return-1}var dt;(function(i){i.HTML="http://www.w3.org/1999/xhtml",i.MATHML="http://www.w3.org/1998/Math/MathML",i.SVG="http://www.w3.org/2000/svg",i.XLINK="http://www.w3.org/1999/xlink",i.XML="http://www.w3.org/XML/1998/namespace",i.XMLNS="http://www.w3.org/2000/xmlns/"})(dt||(dt={}));var md;(function(i){i.TYPE="type",i.ACTION="action",i.ENCODING="encoding",i.PROMPT="prompt",i.NAME="name",i.COLOR="color",i.FACE="face",i.SIZE="size"})(md||(md={}));var ro;(function(i){i.NO_QUIRKS="no-quirks",i.QUIRKS="quirks",i.LIMITED_QUIRKS="limited-quirks"})(ro||(ro={}));var Fe;(function(i){i.A="a",i.ADDRESS="address",i.ANNOTATION_XML="annotation-xml",i.APPLET="applet",i.AREA="area",i.ARTICLE="article",i.ASIDE="aside",i.B="b",i.BASE="base",i.BASEFONT="basefont",i.BGSOUND="bgsound",i.BIG="big",i.BLOCKQUOTE="blockquote",i.BODY="body",i.BR="br",i.BUTTON="button",i.CAPTION="caption",i.CENTER="center",i.CODE="code",i.COL="col",i.COLGROUP="colgroup",i.DD="dd",i.DESC="desc",i.DETAILS="details",i.DIALOG="dialog",i.DIR="dir",i.DIV="div",i.DL="dl",i.DT="dt",i.EM="em",i.EMBED="embed",i.FIELDSET="fieldset",i.FIGCAPTION="figcaption",i.FIGURE="figure",i.FONT="font",i.FOOTER="footer",i.FOREIGN_OBJECT="foreignObject",i.FORM="form",i.FRAME="frame",i.FRAMESET="frameset",i.H1="h1",i.H2="h2",i.H3="h3",i.H4="h4",i.H5="h5",i.H6="h6",i.HEAD="head",i.HEADER="header",i.HGROUP="hgroup",i.HR="hr",i.HTML="html",i.I="i",i.IMG="img",i.IMAGE="image",i.INPUT="input",i.IFRAME="iframe",i.KEYGEN="keygen",i.LABEL="label",i.LI="li",i.LINK="link",i.LISTING="listing",i.MAIN="main",i.MALIGNMARK="malignmark",i.MARQUEE="marquee",i.MATH="math",i.MENU="menu",i.META="meta",i.MGLYPH="mglyph",i.MI="mi",i.MO="mo",i.MN="mn",i.MS="ms",i.MTEXT="mtext",i.NAV="nav",i.NOBR="nobr",i.NOFRAMES="noframes",i.NOEMBED="noembed",i.NOSCRIPT="noscript",i.OBJECT="object",i.OL="ol",i.OPTGROUP="optgroup",i.OPTION="option",i.P="p",i.PARAM="param",i.PLAINTEXT="plaintext",i.PRE="pre",i.RB="rb",i.RP="rp",i.RT="rt",i.RTC="rtc",i.RUBY="ruby",i.S="s",i.SCRIPT="script",i.SEARCH="search",i.SECTION="section",i.SELECT="select",i.SOURCE="source",i.SMALL="small",i.SPAN="span",i.STRIKE="strike",i.STRONG="strong",i.STYLE="style",i.SUB="sub",i.SUMMARY="summary",i.SUP="sup",i.TABLE="table",i.TBODY="tbody",i.TEMPLATE="template",i.TEXTAREA="textarea",i.TFOOT="tfoot",i.TD="td",i.TH="th",i.THEAD="thead",i.TITLE="title",i.TR="tr",i.TRACK="track",i.TT="tt",i.U="u",i.UL="ul",i.SVG="svg",i.VAR="var",i.WBR="wbr",i.XMP="xmp"})(Fe||(Fe={}));var L;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.A=1]="A",i[i.ADDRESS=2]="ADDRESS",i[i.ANNOTATION_XML=3]="ANNOTATION_XML",i[i.APPLET=4]="APPLET",i[i.AREA=5]="AREA",i[i.ARTICLE=6]="ARTICLE",i[i.ASIDE=7]="ASIDE",i[i.B=8]="B",i[i.BASE=9]="BASE",i[i.BASEFONT=10]="BASEFONT",i[i.BGSOUND=11]="BGSOUND",i[i.BIG=12]="BIG",i[i.BLOCKQUOTE=13]="BLOCKQUOTE",i[i.BODY=14]="BODY",i[i.BR=15]="BR",i[i.BUTTON=16]="BUTTON",i[i.CAPTION=17]="CAPTION",i[i.CENTER=18]="CENTER",i[i.CODE=19]="CODE",i[i.COL=20]="COL",i[i.COLGROUP=21]="COLGROUP",i[i.DD=22]="DD",i[i.DESC=23]="DESC",i[i.DETAILS=24]="DETAILS",i[i.DIALOG=25]="DIALOG",i[i.DIR=26]="DIR",i[i.DIV=27]="DIV",i[i.DL=28]="DL",i[i.DT=29]="DT",i[i.EM=30]="EM",i[i.EMBED=31]="EMBED",i[i.FIELDSET=32]="FIELDSET",i[i.FIGCAPTION=33]="FIGCAPTION",i[i.FIGURE=34]="FIGURE",i[i.FONT=35]="FONT",i[i.FOOTER=36]="FOOTER",i[i.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",i[i.FORM=38]="FORM",i[i.FRAME=39]="FRAME",i[i.FRAMESET=40]="FRAMESET",i[i.H1=41]="H1",i[i.H2=42]="H2",i[i.H3=43]="H3",i[i.H4=44]="H4",i[i.H5=45]="H5",i[i.H6=46]="H6",i[i.HEAD=47]="HEAD",i[i.HEADER=48]="HEADER",i[i.HGROUP=49]="HGROUP",i[i.HR=50]="HR",i[i.HTML=51]="HTML",i[i.I=52]="I",i[i.IMG=53]="IMG",i[i.IMAGE=54]="IMAGE",i[i.INPUT=55]="INPUT",i[i.IFRAME=56]="IFRAME",i[i.KEYGEN=57]="KEYGEN",i[i.LABEL=58]="LABEL",i[i.LI=59]="LI",i[i.LINK=60]="LINK",i[i.LISTING=61]="LISTING",i[i.MAIN=62]="MAIN",i[i.MALIGNMARK=63]="MALIGNMARK",i[i.MARQUEE=64]="MARQUEE",i[i.MATH=65]="MATH",i[i.MENU=66]="MENU",i[i.META=67]="META",i[i.MGLYPH=68]="MGLYPH",i[i.MI=69]="MI",i[i.MO=70]="MO",i[i.MN=71]="MN",i[i.MS=72]="MS",i[i.MTEXT=73]="MTEXT",i[i.NAV=74]="NAV",i[i.NOBR=75]="NOBR",i[i.NOFRAMES=76]="NOFRAMES",i[i.NOEMBED=77]="NOEMBED",i[i.NOSCRIPT=78]="NOSCRIPT",i[i.OBJECT=79]="OBJECT",i[i.OL=80]="OL",i[i.OPTGROUP=81]="OPTGROUP",i[i.OPTION=82]="OPTION",i[i.P=83]="P",i[i.PARAM=84]="PARAM",i[i.PLAINTEXT=85]="PLAINTEXT",i[i.PRE=86]="PRE",i[i.RB=87]="RB",i[i.RP=88]="RP",i[i.RT=89]="RT",i[i.RTC=90]="RTC",i[i.RUBY=91]="RUBY",i[i.S=92]="S",i[i.SCRIPT=93]="SCRIPT",i[i.SEARCH=94]="SEARCH",i[i.SECTION=95]="SECTION",i[i.SELECT=96]="SELECT",i[i.SOURCE=97]="SOURCE",i[i.SMALL=98]="SMALL",i[i.SPAN=99]="SPAN",i[i.STRIKE=100]="STRIKE",i[i.STRONG=101]="STRONG",i[i.STYLE=102]="STYLE",i[i.SUB=103]="SUB",i[i.SUMMARY=104]="SUMMARY",i[i.SUP=105]="SUP",i[i.TABLE=106]="TABLE",i[i.TBODY=107]="TBODY",i[i.TEMPLATE=108]="TEMPLATE",i[i.TEXTAREA=109]="TEXTAREA",i[i.TFOOT=110]="TFOOT",i[i.TD=111]="TD",i[i.TH=112]="TH",i[i.THEAD=113]="THEAD",i[i.TITLE=114]="TITLE",i[i.TR=115]="TR",i[i.TRACK=116]="TRACK",i[i.TT=117]="TT",i[i.U=118]="U",i[i.UL=119]="UL",i[i.SVG=120]="SVG",i[i.VAR=121]="VAR",i[i.WBR=122]="WBR",i[i.XMP=123]="XMP"})(L||(L={}));const mT=new Map([[Fe.A,L.A],[Fe.ADDRESS,L.ADDRESS],[Fe.ANNOTATION_XML,L.ANNOTATION_XML],[Fe.APPLET,L.APPLET],[Fe.AREA,L.AREA],[Fe.ARTICLE,L.ARTICLE],[Fe.ASIDE,L.ASIDE],[Fe.B,L.B],[Fe.BASE,L.BASE],[Fe.BASEFONT,L.BASEFONT],[Fe.BGSOUND,L.BGSOUND],[Fe.BIG,L.BIG],[Fe.BLOCKQUOTE,L.BLOCKQUOTE],[Fe.BODY,L.BODY],[Fe.BR,L.BR],[Fe.BUTTON,L.BUTTON],[Fe.CAPTION,L.CAPTION],[Fe.CENTER,L.CENTER],[Fe.CODE,L.CODE],[Fe.COL,L.COL],[Fe.COLGROUP,L.COLGROUP],[Fe.DD,L.DD],[Fe.DESC,L.DESC],[Fe.DETAILS,L.DETAILS],[Fe.DIALOG,L.DIALOG],[Fe.DIR,L.DIR],[Fe.DIV,L.DIV],[Fe.DL,L.DL],[Fe.DT,L.DT],[Fe.EM,L.EM],[Fe.EMBED,L.EMBED],[Fe.FIELDSET,L.FIELDSET],[Fe.FIGCAPTION,L.FIGCAPTION],[Fe.FIGURE,L.FIGURE],[Fe.FONT,L.FONT],[Fe.FOOTER,L.FOOTER],[Fe.FOREIGN_OBJECT,L.FOREIGN_OBJECT],[Fe.FORM,L.FORM],[Fe.FRAME,L.FRAME],[Fe.FRAMESET,L.FRAMESET],[Fe.H1,L.H1],[Fe.H2,L.H2],[Fe.H3,L.H3],[Fe.H4,L.H4],[Fe.H5,L.H5],[Fe.H6,L.H6],[Fe.HEAD,L.HEAD],[Fe.HEADER,L.HEADER],[Fe.HGROUP,L.HGROUP],[Fe.HR,L.HR],[Fe.HTML,L.HTML],[Fe.I,L.I],[Fe.IMG,L.IMG],[Fe.IMAGE,L.IMAGE],[Fe.INPUT,L.INPUT],[Fe.IFRAME,L.IFRAME],[Fe.KEYGEN,L.KEYGEN],[Fe.LABEL,L.LABEL],[Fe.LI,L.LI],[Fe.LINK,L.LINK],[Fe.LISTING,L.LISTING],[Fe.MAIN,L.MAIN],[Fe.MALIGNMARK,L.MALIGNMARK],[Fe.MARQUEE,L.MARQUEE],[Fe.MATH,L.MATH],[Fe.MENU,L.MENU],[Fe.META,L.META],[Fe.MGLYPH,L.MGLYPH],[Fe.MI,L.MI],[Fe.MO,L.MO],[Fe.MN,L.MN],[Fe.MS,L.MS],[Fe.MTEXT,L.MTEXT],[Fe.NAV,L.NAV],[Fe.NOBR,L.NOBR],[Fe.NOFRAMES,L.NOFRAMES],[Fe.NOEMBED,L.NOEMBED],[Fe.NOSCRIPT,L.NOSCRIPT],[Fe.OBJECT,L.OBJECT],[Fe.OL,L.OL],[Fe.OPTGROUP,L.OPTGROUP],[Fe.OPTION,L.OPTION],[Fe.P,L.P],[Fe.PARAM,L.PARAM],[Fe.PLAINTEXT,L.PLAINTEXT],[Fe.PRE,L.PRE],[Fe.RB,L.RB],[Fe.RP,L.RP],[Fe.RT,L.RT],[Fe.RTC,L.RTC],[Fe.RUBY,L.RUBY],[Fe.S,L.S],[Fe.SCRIPT,L.SCRIPT],[Fe.SEARCH,L.SEARCH],[Fe.SECTION,L.SECTION],[Fe.SELECT,L.SELECT],[Fe.SOURCE,L.SOURCE],[Fe.SMALL,L.SMALL],[Fe.SPAN,L.SPAN],[Fe.STRIKE,L.STRIKE],[Fe.STRONG,L.STRONG],[Fe.STYLE,L.STYLE],[Fe.SUB,L.SUB],[Fe.SUMMARY,L.SUMMARY],[Fe.SUP,L.SUP],[Fe.TABLE,L.TABLE],[Fe.TBODY,L.TBODY],[Fe.TEMPLATE,L.TEMPLATE],[Fe.TEXTAREA,L.TEXTAREA],[Fe.TFOOT,L.TFOOT],[Fe.TD,L.TD],[Fe.TH,L.TH],[Fe.THEAD,L.THEAD],[Fe.TITLE,L.TITLE],[Fe.TR,L.TR],[Fe.TRACK,L.TRACK],[Fe.TT,L.TT],[Fe.U,L.U],[Fe.UL,L.UL],[Fe.SVG,L.SVG],[Fe.VAR,L.VAR],[Fe.WBR,L.WBR],[Fe.XMP,L.XMP]]);function fm(i){var n;return(n=mT.get(i))!==null&&n!==void 0?n:L.UNKNOWN}const bt=L,gT={[dt.HTML]:new Set([bt.ADDRESS,bt.APPLET,bt.AREA,bt.ARTICLE,bt.ASIDE,bt.BASE,bt.BASEFONT,bt.BGSOUND,bt.BLOCKQUOTE,bt.BODY,bt.BR,bt.BUTTON,bt.CAPTION,bt.CENTER,bt.COL,bt.COLGROUP,bt.DD,bt.DETAILS,bt.DIR,bt.DIV,bt.DL,bt.DT,bt.EMBED,bt.FIELDSET,bt.FIGCAPTION,bt.FIGURE,bt.FOOTER,bt.FORM,bt.FRAME,bt.FRAMESET,bt.H1,bt.H2,bt.H3,bt.H4,bt.H5,bt.H6,bt.HEAD,bt.HEADER,bt.HGROUP,bt.HR,bt.HTML,bt.IFRAME,bt.IMG,bt.INPUT,bt.LI,bt.LINK,bt.LISTING,bt.MAIN,bt.MARQUEE,bt.MENU,bt.META,bt.NAV,bt.NOEMBED,bt.NOFRAMES,bt.NOSCRIPT,bt.OBJECT,bt.OL,bt.P,bt.PARAM,bt.PLAINTEXT,bt.PRE,bt.SCRIPT,bt.SECTION,bt.SELECT,bt.SOURCE,bt.STYLE,bt.SUMMARY,bt.TABLE,bt.TBODY,bt.TD,bt.TEMPLATE,bt.TEXTAREA,bt.TFOOT,bt.TH,bt.THEAD,bt.TITLE,bt.TR,bt.TRACK,bt.UL,bt.WBR,bt.XMP]),[dt.MATHML]:new Set([bt.MI,bt.MO,bt.MN,bt.MS,bt.MTEXT,bt.ANNOTATION_XML]),[dt.SVG]:new Set([bt.TITLE,bt.FOREIGN_OBJECT,bt.DESC]),[dt.XLINK]:new Set,[dt.XML]:new Set,[dt.XMLNS]:new Set},pg=new Set([bt.H1,bt.H2,bt.H3,bt.H4,bt.H5,bt.H6]),_T=new Set([Fe.STYLE,Fe.SCRIPT,Fe.XMP,Fe.IFRAME,Fe.NOEMBED,Fe.NOFRAMES,Fe.PLAINTEXT]);function yT(i,n){return _T.has(i)||n&&i===Fe.NOSCRIPT}var ce;(function(i){i[i.DATA=0]="DATA",i[i.RCDATA=1]="RCDATA",i[i.RAWTEXT=2]="RAWTEXT",i[i.SCRIPT_DATA=3]="SCRIPT_DATA",i[i.PLAINTEXT=4]="PLAINTEXT",i[i.TAG_OPEN=5]="TAG_OPEN",i[i.END_TAG_OPEN=6]="END_TAG_OPEN",i[i.TAG_NAME=7]="TAG_NAME",i[i.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",i[i.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",i[i.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",i[i.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",i[i.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",i[i.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",i[i.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",i[i.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",i[i.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",i[i.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",i[i.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",i[i.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",i[i.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",i[i.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",i[i.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",i[i.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",i[i.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",i[i.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",i[i.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",i[i.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",i[i.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",i[i.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",i[i.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",i[i.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",i[i.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",i[i.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",i[i.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",i[i.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",i[i.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",i[i.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",i[i.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",i[i.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",i[i.BOGUS_COMMENT=40]="BOGUS_COMMENT",i[i.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",i[i.COMMENT_START=42]="COMMENT_START",i[i.COMMENT_START_DASH=43]="COMMENT_START_DASH",i[i.COMMENT=44]="COMMENT",i[i.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",i[i.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",i[i.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",i[i.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",i[i.COMMENT_END_DASH=49]="COMMENT_END_DASH",i[i.COMMENT_END=50]="COMMENT_END",i[i.COMMENT_END_BANG=51]="COMMENT_END_BANG",i[i.DOCTYPE=52]="DOCTYPE",i[i.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",i[i.DOCTYPE_NAME=54]="DOCTYPE_NAME",i[i.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",i[i.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",i[i.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",i[i.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",i[i.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",i[i.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",i[i.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",i[i.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",i[i.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",i[i.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",i[i.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",i[i.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",i[i.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",i[i.CDATA_SECTION=68]="CDATA_SECTION",i[i.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",i[i.CDATA_SECTION_END=70]="CDATA_SECTION_END",i[i.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",i[i.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(ce||(ce={}));const Is={DATA:ce.DATA,RCDATA:ce.RCDATA,RAWTEXT:ce.RAWTEXT,SCRIPT_DATA:ce.SCRIPT_DATA,PLAINTEXT:ce.PLAINTEXT,CDATA_SECTION:ce.CDATA_SECTION};function bT(i){return i>=se.DIGIT_0&&i<=se.DIGIT_9}function H0(i){return i>=se.LATIN_CAPITAL_A&&i<=se.LATIN_CAPITAL_Z}function xT(i){return i>=se.LATIN_SMALL_A&&i<=se.LATIN_SMALL_Z}function _h(i){return xT(i)||H0(i)}function D_(i){return _h(i)||bT(i)}function jp(i){return i+32}function Z1(i){return i===se.SPACE||i===se.LINE_FEED||i===se.TABULATION||i===se.FORM_FEED}function R_(i){return Z1(i)||i===se.SOLIDUS||i===se.GREATER_THAN_SIGN}function vT(i){return i===se.NULL?tt.nullCharacterReference:i>1114111?tt.characterReferenceOutsideUnicodeRange:j1(i)?tt.surrogateCharacterReference:V1(i)?tt.noncharacterCharacterReference:q1(i)||i===se.CARRIAGE_RETURN?tt.controlCharacterReference:null}let TT=class{constructor(n,f){this.options=n,this.handler=f,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=ce.DATA,this.returnState=ce.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new rT(f),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new fT(sT,(x,A)=>{this.preprocessor.pos=this.entityStartPos+A-1,this._flushCodePointConsumedAsCharacterReference(x)},f.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(tt.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:x=>{this._err(tt.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+x)},validateNumericCharacterReference:x=>{const A=vT(x);A&&this._err(A,1)}}:void 0)}_err(n,f=0){var x,A;(A=(x=this.handler).onParseError)===null||A===void 0||A.call(x,this.preprocessor.getError(n,f))}getCurrentLocation(n){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-n,startOffset:this.preprocessor.offset-n,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const n=this._consume();this._ensureHibernation()||this._callState(n)}this.inLoop=!1}}pause(){this.paused=!0}resume(n){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||n==null||n())}write(n,f,x){this.active=!0,this.preprocessor.write(n,f),this._runParsingLoop(),this.paused||x==null||x()}insertHtmlAtCurrentPos(n){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(n),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(n){this.consumedAfterSnapshot+=n;for(let f=0;f<n;f++)this.preprocessor.advance()}_consumeSequenceIfMatch(n,f){return this.preprocessor.startsWith(n,f)?(this._advanceBy(n.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Vi.START_TAG,tagName:"",tagID:L.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Vi.END_TAG,tagName:"",tagID:L.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(n){this.currentToken={type:Vi.COMMENT,data:"",location:this.getCurrentLocation(n)}}_createDoctypeToken(n){this.currentToken={type:Vi.DOCTYPE,name:n,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(n,f){this.currentCharacterToken={type:n,chars:f,location:this.currentLocation}}_createAttr(n){this.currentAttr={name:n,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var n,f;const x=this.currentToken;if(G1(x,this.currentAttr.name)===null){if(x.attrs.push(this.currentAttr),x.location&&this.currentLocation){const A=(n=(f=x.location).attrs)!==null&&n!==void 0?n:f.attrs=Object.create(null);A[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(tt.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(n){this._emitCurrentCharacterToken(n.location),this.currentToken=null,n.location&&(n.location.endLine=this.preprocessor.line,n.location.endCol=this.preprocessor.col+1,n.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const n=this.currentToken;this.prepareToken(n),n.tagID=fm(n.tagName),n.type===Vi.START_TAG?(this.lastStartTagName=n.tagName,this.handler.onStartTag(n)):(n.attrs.length>0&&this._err(tt.endTagWithAttributes),n.selfClosing&&this._err(tt.endTagWithTrailingSolidus),this.handler.onEndTag(n)),this.preprocessor.dropParsedChunk()}emitCurrentComment(n){this.prepareToken(n),this.handler.onComment(n),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(n){this.prepareToken(n),this.handler.onDoctype(n),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(n){if(this.currentCharacterToken){switch(n&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=n.startLine,this.currentCharacterToken.location.endCol=n.startCol,this.currentCharacterToken.location.endOffset=n.startOffset),this.currentCharacterToken.type){case Vi.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Vi.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Vi.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const n=this.getCurrentLocation(0);n&&(n.endLine=n.startLine,n.endCol=n.startCol,n.endOffset=n.startOffset),this._emitCurrentCharacterToken(n),this.handler.onEof({type:Vi.EOF,location:n}),this.active=!1}_appendCharToCurrentCharacterToken(n,f){if(this.currentCharacterToken)if(this.currentCharacterToken.type===n){this.currentCharacterToken.chars+=f;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(n,f)}_emitCodePoint(n){const f=Z1(n)?Vi.WHITESPACE_CHARACTER:n===se.NULL?Vi.NULL_CHARACTER:Vi.CHARACTER;this._appendCharToCurrentCharacterToken(f,String.fromCodePoint(n))}_emitChars(n){this._appendCharToCurrentCharacterToken(Vi.CHARACTER,n)}_startCharacterReference(){this.returnState=this.state,this.state=ce.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?mc.Attribute:mc.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===ce.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===ce.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===ce.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(n){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(n):this._emitCodePoint(n)}_callState(n){switch(this.state){case ce.DATA:{this._stateData(n);break}case ce.RCDATA:{this._stateRcdata(n);break}case ce.RAWTEXT:{this._stateRawtext(n);break}case ce.SCRIPT_DATA:{this._stateScriptData(n);break}case ce.PLAINTEXT:{this._statePlaintext(n);break}case ce.TAG_OPEN:{this._stateTagOpen(n);break}case ce.END_TAG_OPEN:{this._stateEndTagOpen(n);break}case ce.TAG_NAME:{this._stateTagName(n);break}case ce.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(n);break}case ce.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(n);break}case ce.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(n);break}case ce.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(n);break}case ce.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(n);break}case ce.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(n);break}case ce.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(n);break}case ce.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(n);break}case ce.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(n);break}case ce.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(n);break}case ce.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(n);break}case ce.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(n);break}case ce.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(n);break}case ce.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(n);break}case ce.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(n);break}case ce.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(n);break}case ce.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(n);break}case ce.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(n);break}case ce.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(n);break}case ce.ATTRIBUTE_NAME:{this._stateAttributeName(n);break}case ce.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(n);break}case ce.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(n);break}case ce.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(n);break}case ce.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(n);break}case ce.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(n);break}case ce.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(n);break}case ce.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(n);break}case ce.BOGUS_COMMENT:{this._stateBogusComment(n);break}case ce.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(n);break}case ce.COMMENT_START:{this._stateCommentStart(n);break}case ce.COMMENT_START_DASH:{this._stateCommentStartDash(n);break}case ce.COMMENT:{this._stateComment(n);break}case ce.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(n);break}case ce.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(n);break}case ce.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(n);break}case ce.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(n);break}case ce.COMMENT_END_DASH:{this._stateCommentEndDash(n);break}case ce.COMMENT_END:{this._stateCommentEnd(n);break}case ce.COMMENT_END_BANG:{this._stateCommentEndBang(n);break}case ce.DOCTYPE:{this._stateDoctype(n);break}case ce.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(n);break}case ce.DOCTYPE_NAME:{this._stateDoctypeName(n);break}case ce.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(n);break}case ce.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(n);break}case ce.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(n);break}case ce.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(n);break}case ce.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(n);break}case ce.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(n);break}case ce.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(n);break}case ce.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(n);break}case ce.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(n);break}case ce.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(n);break}case ce.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(n);break}case ce.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(n);break}case ce.BOGUS_DOCTYPE:{this._stateBogusDoctype(n);break}case ce.CDATA_SECTION:{this._stateCdataSection(n);break}case ce.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(n);break}case ce.CDATA_SECTION_END:{this._stateCdataSectionEnd(n);break}case ce.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case ce.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(n);break}default:throw new Error("Unknown state")}}_stateData(n){switch(n){case se.LESS_THAN_SIGN:{this.state=ce.TAG_OPEN;break}case se.AMPERSAND:{this._startCharacterReference();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitCodePoint(n);break}case se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateRcdata(n){switch(n){case se.AMPERSAND:{this._startCharacterReference();break}case se.LESS_THAN_SIGN:{this.state=ce.RCDATA_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateRawtext(n){switch(n){case se.LESS_THAN_SIGN:{this.state=ce.RAWTEXT_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateScriptData(n){switch(n){case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(n)}}_statePlaintext(n){switch(n){case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateTagOpen(n){if(_h(n))this._createStartTagToken(),this.state=ce.TAG_NAME,this._stateTagName(n);else switch(n){case se.EXCLAMATION_MARK:{this.state=ce.MARKUP_DECLARATION_OPEN;break}case se.SOLIDUS:{this.state=ce.END_TAG_OPEN;break}case se.QUESTION_MARK:{this._err(tt.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=ce.BOGUS_COMMENT,this._stateBogusComment(n);break}case se.EOF:{this._err(tt.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(tt.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=ce.DATA,this._stateData(n)}}_stateEndTagOpen(n){if(_h(n))this._createEndTagToken(),this.state=ce.TAG_NAME,this._stateTagName(n);else switch(n){case se.GREATER_THAN_SIGN:{this._err(tt.missingEndTagName),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(tt.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=ce.BOGUS_COMMENT,this._stateBogusComment(n)}}_stateTagName(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.BEFORE_ATTRIBUTE_NAME;break}case se.SOLIDUS:{this.state=ce.SELF_CLOSING_START_TAG;break}case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentTagToken();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.tagName+=Ya;break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:f.tagName+=String.fromCodePoint(H0(n)?jp(n):n)}}_stateRcdataLessThanSign(n){n===se.SOLIDUS?this.state=ce.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=ce.RCDATA,this._stateRcdata(n))}_stateRcdataEndTagOpen(n){_h(n)?(this.state=ce.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(n)):(this._emitChars("</"),this.state=ce.RCDATA,this._stateRcdata(n))}handleSpecialEndTag(n){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const f=this.currentToken;switch(f.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=ce.BEFORE_ATTRIBUTE_NAME,!1;case se.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=ce.SELF_CLOSING_START_TAG,!1;case se.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=ce.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(n){this.handleSpecialEndTag(n)&&(this._emitChars("</"),this.state=ce.RCDATA,this._stateRcdata(n))}_stateRawtextLessThanSign(n){n===se.SOLIDUS?this.state=ce.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=ce.RAWTEXT,this._stateRawtext(n))}_stateRawtextEndTagOpen(n){_h(n)?(this.state=ce.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(n)):(this._emitChars("</"),this.state=ce.RAWTEXT,this._stateRawtext(n))}_stateRawtextEndTagName(n){this.handleSpecialEndTag(n)&&(this._emitChars("</"),this.state=ce.RAWTEXT,this._stateRawtext(n))}_stateScriptDataLessThanSign(n){switch(n){case se.SOLIDUS:{this.state=ce.SCRIPT_DATA_END_TAG_OPEN;break}case se.EXCLAMATION_MARK:{this.state=ce.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=ce.SCRIPT_DATA,this._stateScriptData(n)}}_stateScriptDataEndTagOpen(n){_h(n)?(this.state=ce.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(n)):(this._emitChars("</"),this.state=ce.SCRIPT_DATA,this._stateScriptData(n))}_stateScriptDataEndTagName(n){this.handleSpecialEndTag(n)&&(this._emitChars("</"),this.state=ce.SCRIPT_DATA,this._stateScriptData(n))}_stateScriptDataEscapeStart(n){n===se.HYPHEN_MINUS?(this.state=ce.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=ce.SCRIPT_DATA,this._stateScriptData(n))}_stateScriptDataEscapeStartDash(n){n===se.HYPHEN_MINUS?(this.state=ce.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=ce.SCRIPT_DATA,this._stateScriptData(n))}_stateScriptDataEscaped(n){switch(n){case se.HYPHEN_MINUS:{this.state=ce.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateScriptDataEscapedDash(n){switch(n){case se.HYPHEN_MINUS:{this.state=ce.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.state=ce.SCRIPT_DATA_ESCAPED,this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=ce.SCRIPT_DATA_ESCAPED,this._emitCodePoint(n)}}_stateScriptDataEscapedDashDash(n){switch(n){case se.HYPHEN_MINUS:{this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case se.GREATER_THAN_SIGN:{this.state=ce.SCRIPT_DATA,this._emitChars(">");break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.state=ce.SCRIPT_DATA_ESCAPED,this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=ce.SCRIPT_DATA_ESCAPED,this._emitCodePoint(n)}}_stateScriptDataEscapedLessThanSign(n){n===se.SOLIDUS?this.state=ce.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:_h(n)?(this._emitChars("<"),this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(n)):(this._emitChars("<"),this.state=ce.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(n))}_stateScriptDataEscapedEndTagOpen(n){_h(n)?(this.state=ce.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(n)):(this._emitChars("</"),this.state=ce.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(n))}_stateScriptDataEscapedEndTagName(n){this.handleSpecialEndTag(n)&&(this._emitChars("</"),this.state=ce.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(n))}_stateScriptDataDoubleEscapeStart(n){if(this.preprocessor.startsWith(Ss.SCRIPT,!1)&&R_(this.preprocessor.peek(Ss.SCRIPT.length))){this._emitCodePoint(n);for(let f=0;f<Ss.SCRIPT.length;f++)this._emitCodePoint(this._consume());this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=ce.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(n))}_stateScriptDataDoubleEscaped(n){switch(n){case se.HYPHEN_MINUS:{this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateScriptDataDoubleEscapedDash(n){switch(n){case se.HYPHEN_MINUS:{this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(n)}}_stateScriptDataDoubleEscapedDashDash(n){switch(n){case se.HYPHEN_MINUS:{this._emitChars("-");break}case se.LESS_THAN_SIGN:{this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case se.GREATER_THAN_SIGN:{this.state=ce.SCRIPT_DATA,this._emitChars(">");break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Ya);break}case se.EOF:{this._err(tt.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(n)}}_stateScriptDataDoubleEscapedLessThanSign(n){n===se.SOLIDUS?(this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(n))}_stateScriptDataDoubleEscapeEnd(n){if(this.preprocessor.startsWith(Ss.SCRIPT,!1)&&R_(this.preprocessor.peek(Ss.SCRIPT.length))){this._emitCodePoint(n);for(let f=0;f<Ss.SCRIPT.length;f++)this._emitCodePoint(this._consume());this.state=ce.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=ce.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(n))}_stateBeforeAttributeName(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.SOLIDUS:case se.GREATER_THAN_SIGN:case se.EOF:{this.state=ce.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(n);break}case se.EQUALS_SIGN:{this._err(tt.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=ce.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=ce.ATTRIBUTE_NAME,this._stateAttributeName(n)}}_stateAttributeName(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:case se.SOLIDUS:case se.GREATER_THAN_SIGN:case se.EOF:{this._leaveAttrName(),this.state=ce.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(n);break}case se.EQUALS_SIGN:{this._leaveAttrName(),this.state=ce.BEFORE_ATTRIBUTE_VALUE;break}case se.QUOTATION_MARK:case se.APOSTROPHE:case se.LESS_THAN_SIGN:{this._err(tt.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(n);break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.currentAttr.name+=Ya;break}default:this.currentAttr.name+=String.fromCodePoint(H0(n)?jp(n):n)}}_stateAfterAttributeName(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.SOLIDUS:{this.state=ce.SELF_CLOSING_START_TAG;break}case se.EQUALS_SIGN:{this.state=ce.BEFORE_ATTRIBUTE_VALUE;break}case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentTagToken();break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=ce.ATTRIBUTE_NAME,this._stateAttributeName(n)}}_stateBeforeAttributeValue(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.QUOTATION_MARK:{this.state=ce.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case se.APOSTROPHE:{this.state=ce.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingAttributeValue),this.state=ce.DATA,this.emitCurrentTagToken();break}default:this.state=ce.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(n)}}_stateAttributeValueDoubleQuoted(n){switch(n){case se.QUOTATION_MARK:{this.state=ce.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case se.AMPERSAND:{this._startCharacterReference();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.currentAttr.value+=Ya;break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(n)}}_stateAttributeValueSingleQuoted(n){switch(n){case se.APOSTROPHE:{this.state=ce.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case se.AMPERSAND:{this._startCharacterReference();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.currentAttr.value+=Ya;break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(n)}}_stateAttributeValueUnquoted(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this._leaveAttrValue(),this.state=ce.BEFORE_ATTRIBUTE_NAME;break}case se.AMPERSAND:{this._startCharacterReference();break}case se.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=ce.DATA,this.emitCurrentTagToken();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),this.currentAttr.value+=Ya;break}case se.QUOTATION_MARK:case se.APOSTROPHE:case se.LESS_THAN_SIGN:case se.EQUALS_SIGN:case se.GRAVE_ACCENT:{this._err(tt.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(n);break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(n)}}_stateAfterAttributeValueQuoted(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this._leaveAttrValue(),this.state=ce.BEFORE_ATTRIBUTE_NAME;break}case se.SOLIDUS:{this._leaveAttrValue(),this.state=ce.SELF_CLOSING_START_TAG;break}case se.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=ce.DATA,this.emitCurrentTagToken();break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this._err(tt.missingWhitespaceBetweenAttributes),this.state=ce.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(n)}}_stateSelfClosingStartTag(n){switch(n){case se.GREATER_THAN_SIGN:{const f=this.currentToken;f.selfClosing=!0,this.state=ce.DATA,this.emitCurrentTagToken();break}case se.EOF:{this._err(tt.eofInTag),this._emitEOFToken();break}default:this._err(tt.unexpectedSolidusInTag),this.state=ce.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(n)}}_stateBogusComment(n){const f=this.currentToken;switch(n){case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentComment(f);break}case se.EOF:{this.emitCurrentComment(f),this._emitEOFToken();break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.data+=Ya;break}default:f.data+=String.fromCodePoint(n)}}_stateMarkupDeclarationOpen(n){this._consumeSequenceIfMatch(Ss.DASH_DASH,!0)?(this._createCommentToken(Ss.DASH_DASH.length+1),this.state=ce.COMMENT_START):this._consumeSequenceIfMatch(Ss.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Ss.DOCTYPE.length+1),this.state=ce.DOCTYPE):this._consumeSequenceIfMatch(Ss.CDATA_START,!0)?this.inForeignNode?this.state=ce.CDATA_SECTION:(this._err(tt.cdataInHtmlContent),this._createCommentToken(Ss.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=ce.BOGUS_COMMENT):this._ensureHibernation()||(this._err(tt.incorrectlyOpenedComment),this._createCommentToken(2),this.state=ce.BOGUS_COMMENT,this._stateBogusComment(n))}_stateCommentStart(n){switch(n){case se.HYPHEN_MINUS:{this.state=ce.COMMENT_START_DASH;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptClosingOfEmptyComment),this.state=ce.DATA;const f=this.currentToken;this.emitCurrentComment(f);break}default:this.state=ce.COMMENT,this._stateComment(n)}}_stateCommentStartDash(n){const f=this.currentToken;switch(n){case se.HYPHEN_MINUS:{this.state=ce.COMMENT_END;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptClosingOfEmptyComment),this.state=ce.DATA,this.emitCurrentComment(f);break}case se.EOF:{this._err(tt.eofInComment),this.emitCurrentComment(f),this._emitEOFToken();break}default:f.data+="-",this.state=ce.COMMENT,this._stateComment(n)}}_stateComment(n){const f=this.currentToken;switch(n){case se.HYPHEN_MINUS:{this.state=ce.COMMENT_END_DASH;break}case se.LESS_THAN_SIGN:{f.data+="<",this.state=ce.COMMENT_LESS_THAN_SIGN;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.data+=Ya;break}case se.EOF:{this._err(tt.eofInComment),this.emitCurrentComment(f),this._emitEOFToken();break}default:f.data+=String.fromCodePoint(n)}}_stateCommentLessThanSign(n){const f=this.currentToken;switch(n){case se.EXCLAMATION_MARK:{f.data+="!",this.state=ce.COMMENT_LESS_THAN_SIGN_BANG;break}case se.LESS_THAN_SIGN:{f.data+="<";break}default:this.state=ce.COMMENT,this._stateComment(n)}}_stateCommentLessThanSignBang(n){n===se.HYPHEN_MINUS?this.state=ce.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=ce.COMMENT,this._stateComment(n))}_stateCommentLessThanSignBangDash(n){n===se.HYPHEN_MINUS?this.state=ce.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=ce.COMMENT_END_DASH,this._stateCommentEndDash(n))}_stateCommentLessThanSignBangDashDash(n){n!==se.GREATER_THAN_SIGN&&n!==se.EOF&&this._err(tt.nestedComment),this.state=ce.COMMENT_END,this._stateCommentEnd(n)}_stateCommentEndDash(n){const f=this.currentToken;switch(n){case se.HYPHEN_MINUS:{this.state=ce.COMMENT_END;break}case se.EOF:{this._err(tt.eofInComment),this.emitCurrentComment(f),this._emitEOFToken();break}default:f.data+="-",this.state=ce.COMMENT,this._stateComment(n)}}_stateCommentEnd(n){const f=this.currentToken;switch(n){case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentComment(f);break}case se.EXCLAMATION_MARK:{this.state=ce.COMMENT_END_BANG;break}case se.HYPHEN_MINUS:{f.data+="-";break}case se.EOF:{this._err(tt.eofInComment),this.emitCurrentComment(f),this._emitEOFToken();break}default:f.data+="--",this.state=ce.COMMENT,this._stateComment(n)}}_stateCommentEndBang(n){const f=this.currentToken;switch(n){case se.HYPHEN_MINUS:{f.data+="--!",this.state=ce.COMMENT_END_DASH;break}case se.GREATER_THAN_SIGN:{this._err(tt.incorrectlyClosedComment),this.state=ce.DATA,this.emitCurrentComment(f);break}case se.EOF:{this._err(tt.eofInComment),this.emitCurrentComment(f),this._emitEOFToken();break}default:f.data+="--!",this.state=ce.COMMENT,this._stateComment(n)}}_stateDoctype(n){switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.BEFORE_DOCTYPE_NAME;break}case se.GREATER_THAN_SIGN:{this.state=ce.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(n);break}case se.EOF:{this._err(tt.eofInDoctype),this._createDoctypeToken(null);const f=this.currentToken;f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingWhitespaceBeforeDoctypeName),this.state=ce.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(n)}}_stateBeforeDoctypeName(n){if(H0(n))this._createDoctypeToken(String.fromCharCode(jp(n))),this.state=ce.DOCTYPE_NAME;else switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.NULL:{this._err(tt.unexpectedNullCharacter),this._createDoctypeToken(Ya),this.state=ce.DOCTYPE_NAME;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingDoctypeName),this._createDoctypeToken(null);const f=this.currentToken;f.forceQuirks=!0,this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),this._createDoctypeToken(null);const f=this.currentToken;f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(n)),this.state=ce.DOCTYPE_NAME}}_stateDoctypeName(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.AFTER_DOCTYPE_NAME;break}case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.name+=Ya;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:f.name+=String.fromCodePoint(H0(n)?jp(n):n)}}_stateAfterDoctypeName(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Ss.PUBLIC,!1)?this.state=ce.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Ss.SYSTEM,!1)?this.state=ce.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(tt.invalidCharacterSequenceAfterDoctypeName),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n))}}_stateAfterDoctypePublicKeyword(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case se.QUOTATION_MARK:{this._err(tt.missingWhitespaceAfterDoctypePublicKeyword),f.publicId="",this.state=ce.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{this._err(tt.missingWhitespaceAfterDoctypePublicKeyword),f.publicId="",this.state=ce.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingDoctypePublicIdentifier),f.forceQuirks=!0,this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypePublicIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateBeforeDoctypePublicIdentifier(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.QUOTATION_MARK:{f.publicId="",this.state=ce.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{f.publicId="",this.state=ce.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingDoctypePublicIdentifier),f.forceQuirks=!0,this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypePublicIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateDoctypePublicIdentifierDoubleQuoted(n){const f=this.currentToken;switch(n){case se.QUOTATION_MARK:{this.state=ce.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.publicId+=Ya;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptDoctypePublicIdentifier),f.forceQuirks=!0,this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:f.publicId+=String.fromCodePoint(n)}}_stateDoctypePublicIdentifierSingleQuoted(n){const f=this.currentToken;switch(n){case se.APOSTROPHE:{this.state=ce.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.publicId+=Ya;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptDoctypePublicIdentifier),f.forceQuirks=!0,this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:f.publicId+=String.fromCodePoint(n)}}_stateAfterDoctypePublicIdentifier(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case se.GREATER_THAN_SIGN:{this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.QUOTATION_MARK:{this._err(tt.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{this._err(tt.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateBetweenDoctypePublicAndSystemIdentifiers(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.QUOTATION_MARK:{f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateAfterDoctypeSystemKeyword(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:{this.state=ce.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case se.QUOTATION_MARK:{this._err(tt.missingWhitespaceAfterDoctypeSystemKeyword),f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{this._err(tt.missingWhitespaceAfterDoctypeSystemKeyword),f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateBeforeDoctypeSystemIdentifier(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.QUOTATION_MARK:{f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case se.APOSTROPHE:{f.systemId="",this.state=ce.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case se.GREATER_THAN_SIGN:{this._err(tt.missingDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.DATA,this.emitCurrentDoctype(f);break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.missingQuoteBeforeDoctypeSystemIdentifier),f.forceQuirks=!0,this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateDoctypeSystemIdentifierDoubleQuoted(n){const f=this.currentToken;switch(n){case se.QUOTATION_MARK:{this.state=ce.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.systemId+=Ya;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptDoctypeSystemIdentifier),f.forceQuirks=!0,this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:f.systemId+=String.fromCodePoint(n)}}_stateDoctypeSystemIdentifierSingleQuoted(n){const f=this.currentToken;switch(n){case se.APOSTROPHE:{this.state=ce.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case se.NULL:{this._err(tt.unexpectedNullCharacter),f.systemId+=Ya;break}case se.GREATER_THAN_SIGN:{this._err(tt.abruptDoctypeSystemIdentifier),f.forceQuirks=!0,this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:f.systemId+=String.fromCodePoint(n)}}_stateAfterDoctypeSystemIdentifier(n){const f=this.currentToken;switch(n){case se.SPACE:case se.LINE_FEED:case se.TABULATION:case se.FORM_FEED:break;case se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.EOF:{this._err(tt.eofInDoctype),f.forceQuirks=!0,this.emitCurrentDoctype(f),this._emitEOFToken();break}default:this._err(tt.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=ce.BOGUS_DOCTYPE,this._stateBogusDoctype(n)}}_stateBogusDoctype(n){const f=this.currentToken;switch(n){case se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(f),this.state=ce.DATA;break}case se.NULL:{this._err(tt.unexpectedNullCharacter);break}case se.EOF:{this.emitCurrentDoctype(f),this._emitEOFToken();break}}}_stateCdataSection(n){switch(n){case se.RIGHT_SQUARE_BRACKET:{this.state=ce.CDATA_SECTION_BRACKET;break}case se.EOF:{this._err(tt.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(n)}}_stateCdataSectionBracket(n){n===se.RIGHT_SQUARE_BRACKET?this.state=ce.CDATA_SECTION_END:(this._emitChars("]"),this.state=ce.CDATA_SECTION,this._stateCdataSection(n))}_stateCdataSectionEnd(n){switch(n){case se.GREATER_THAN_SIGN:{this.state=ce.DATA;break}case se.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=ce.CDATA_SECTION,this._stateCdataSection(n)}}_stateCharacterReference(){let n=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(n<0)if(this.preprocessor.lastChunkWritten)n=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}n===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(se.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&D_(this.preprocessor.peek(1))?ce.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(n){D_(n)?this._flushCodePointConsumedAsCharacterReference(n):(n===se.SEMICOLON&&this._err(tt.unknownNamedCharacterReference),this.state=this.returnState,this._callState(n))}};const Y1=new Set([L.DD,L.DT,L.LI,L.OPTGROUP,L.OPTION,L.P,L.RB,L.RP,L.RT,L.RTC]),P_=new Set([...Y1,L.CAPTION,L.COLGROUP,L.TBODY,L.TD,L.TFOOT,L.TH,L.THEAD,L.TR]),am=new Set([L.APPLET,L.CAPTION,L.HTML,L.MARQUEE,L.OBJECT,L.TABLE,L.TD,L.TEMPLATE,L.TH]),ET=new Set([...am,L.OL,L.UL]),wT=new Set([...am,L.BUTTON]),L_=new Set([L.ANNOTATION_XML,L.MI,L.MN,L.MO,L.MS,L.MTEXT]),O_=new Set([L.DESC,L.FOREIGN_OBJECT,L.TITLE]),AT=new Set([L.TR,L.TEMPLATE,L.HTML]),ST=new Set([L.TBODY,L.TFOOT,L.THEAD,L.TEMPLATE,L.HTML]),CT=new Set([L.TABLE,L.TEMPLATE,L.HTML]),MT=new Set([L.TD,L.TH]);class IT{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(n,f,x){this.treeAdapter=f,this.handler=x,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=L.UNKNOWN,this.current=n}_indexOf(n){return this.items.lastIndexOf(n,this.stackTop)}_isInTemplate(){return this.currentTagId===L.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===dt.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(n,f){this.stackTop++,this.items[this.stackTop]=n,this.current=n,this.tagIDs[this.stackTop]=f,this.currentTagId=f,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(n,f,!0)}pop(){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,!0)}replace(n,f){const x=this._indexOf(n);this.items[x]=f,x===this.stackTop&&(this.current=f)}insertAfter(n,f,x){const A=this._indexOf(n)+1;this.items.splice(A,0,f),this.tagIDs.splice(A,0,x),this.stackTop++,A===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,A===this.stackTop)}popUntilTagNamePopped(n){let f=this.stackTop+1;do f=this.tagIDs.lastIndexOf(n,f-1);while(f>0&&this.treeAdapter.getNamespaceURI(this.items[f])!==dt.HTML);this.shortenToLength(Math.max(f,0))}shortenToLength(n){for(;this.stackTop>=n;){const f=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(f,this.stackTop<n)}}popUntilElementPopped(n){const f=this._indexOf(n);this.shortenToLength(Math.max(f,0))}popUntilPopped(n,f){const x=this._indexOfTagNames(n,f);this.shortenToLength(Math.max(x,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(pg,dt.HTML)}popUntilTableCellPopped(){this.popUntilPopped(MT,dt.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(n,f){for(let x=this.stackTop;x>=0;x--)if(n.has(this.tagIDs[x])&&this.treeAdapter.getNamespaceURI(this.items[x])===f)return x;return-1}clearBackTo(n,f){const x=this._indexOfTagNames(n,f);this.shortenToLength(x+1)}clearBackToTableContext(){this.clearBackTo(CT,dt.HTML)}clearBackToTableBodyContext(){this.clearBackTo(ST,dt.HTML)}clearBackToTableRowContext(){this.clearBackTo(AT,dt.HTML)}remove(n){const f=this._indexOf(n);f>=0&&(f===this.stackTop?this.pop():(this.items.splice(f,1),this.tagIDs.splice(f,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===L.BODY?this.items[1]:null}contains(n){return this._indexOf(n)>-1}getCommonAncestor(n){const f=this._indexOf(n)-1;return f>=0?this.items[f]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===L.HTML}hasInDynamicScope(n,f){for(let x=this.stackTop;x>=0;x--){const A=this.tagIDs[x];switch(this.treeAdapter.getNamespaceURI(this.items[x])){case dt.HTML:{if(A===n)return!0;if(f.has(A))return!1;break}case dt.SVG:{if(O_.has(A))return!1;break}case dt.MATHML:{if(L_.has(A))return!1;break}}}return!0}hasInScope(n){return this.hasInDynamicScope(n,am)}hasInListItemScope(n){return this.hasInDynamicScope(n,ET)}hasInButtonScope(n){return this.hasInDynamicScope(n,wT)}hasNumberedHeaderInScope(){for(let n=this.stackTop;n>=0;n--){const f=this.tagIDs[n];switch(this.treeAdapter.getNamespaceURI(this.items[n])){case dt.HTML:{if(pg.has(f))return!0;if(am.has(f))return!1;break}case dt.SVG:{if(O_.has(f))return!1;break}case dt.MATHML:{if(L_.has(f))return!1;break}}}return!0}hasInTableScope(n){for(let f=this.stackTop;f>=0;f--)if(this.treeAdapter.getNamespaceURI(this.items[f])===dt.HTML)switch(this.tagIDs[f]){case n:return!0;case L.TABLE:case L.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===dt.HTML)switch(this.tagIDs[n]){case L.TBODY:case L.THEAD:case L.TFOOT:return!0;case L.TABLE:case L.HTML:return!1}return!0}hasInSelectScope(n){for(let f=this.stackTop;f>=0;f--)if(this.treeAdapter.getNamespaceURI(this.items[f])===dt.HTML)switch(this.tagIDs[f]){case n:return!0;case L.OPTION:case L.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&Y1.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&P_.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(n){for(;this.currentTagId!==void 0&&this.currentTagId!==n&&P_.has(this.currentTagId);)this.pop()}}const tg=3;var El;(function(i){i[i.Marker=0]="Marker",i[i.Element=1]="Element"})(El||(El={}));const N_={type:El.Marker};class DT{constructor(n){this.treeAdapter=n,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(n,f){const x=[],A=f.length,R=this.treeAdapter.getTagName(n),S=this.treeAdapter.getNamespaceURI(n);for(let h=0;h<this.entries.length;h++){const Z=this.entries[h];if(Z.type===El.Marker)break;const{element:Q}=Z;if(this.treeAdapter.getTagName(Q)===R&&this.treeAdapter.getNamespaceURI(Q)===S){const ge=this.treeAdapter.getAttrList(Q);ge.length===A&&x.push({idx:h,attrs:ge})}}return x}_ensureNoahArkCondition(n){if(this.entries.length<tg)return;const f=this.treeAdapter.getAttrList(n),x=this._getNoahArkConditionCandidates(n,f);if(x.length<tg)return;const A=new Map(f.map(S=>[S.name,S.value]));let R=0;for(let S=0;S<x.length;S++){const h=x[S];h.attrs.every(Z=>A.get(Z.name)===Z.value)&&(R+=1,R>=tg&&this.entries.splice(h.idx,1))}}insertMarker(){this.entries.unshift(N_)}pushElement(n,f){this._ensureNoahArkCondition(n),this.entries.unshift({type:El.Element,element:n,token:f})}insertElementAfterBookmark(n,f){const x=this.entries.indexOf(this.bookmark);this.entries.splice(x,0,{type:El.Element,element:n,token:f})}removeEntry(n){const f=this.entries.indexOf(n);f!==-1&&this.entries.splice(f,1)}clearToLastMarker(){const n=this.entries.indexOf(N_);n===-1?this.entries.length=0:this.entries.splice(0,n+1)}getElementEntryInScopeWithTagName(n){const f=this.entries.find(x=>x.type===El.Marker||this.treeAdapter.getTagName(x.element)===n);return f&&f.type===El.Element?f:null}getElementEntry(n){return this.entries.find(f=>f.type===El.Element&&f.element===n)}}const pc={createDocument(){return{nodeName:"#document",mode:ro.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(i,n,f){return{nodeName:i,tagName:i,attrs:f,namespaceURI:n,childNodes:[],parentNode:null}},createCommentNode(i){return{nodeName:"#comment",data:i,parentNode:null}},createTextNode(i){return{nodeName:"#text",value:i,parentNode:null}},appendChild(i,n){i.childNodes.push(n),n.parentNode=i},insertBefore(i,n,f){const x=i.childNodes.indexOf(f);i.childNodes.splice(x,0,n),n.parentNode=i},setTemplateContent(i,n){i.content=n},getTemplateContent(i){return i.content},setDocumentType(i,n,f,x){const A=i.childNodes.find(R=>R.nodeName==="#documentType");if(A)A.name=n,A.publicId=f,A.systemId=x;else{const R={nodeName:"#documentType",name:n,publicId:f,systemId:x,parentNode:null};pc.appendChild(i,R)}},setDocumentMode(i,n){i.mode=n},getDocumentMode(i){return i.mode},detachNode(i){if(i.parentNode){const n=i.parentNode.childNodes.indexOf(i);i.parentNode.childNodes.splice(n,1),i.parentNode=null}},insertText(i,n){if(i.childNodes.length>0){const f=i.childNodes[i.childNodes.length-1];if(pc.isTextNode(f)){f.value+=n;return}}pc.appendChild(i,pc.createTextNode(n))},insertTextBefore(i,n,f){const x=i.childNodes[i.childNodes.indexOf(f)-1];x&&pc.isTextNode(x)?x.value+=n:pc.insertBefore(i,pc.createTextNode(n),f)},adoptAttributes(i,n){const f=new Set(i.attrs.map(x=>x.name));for(let x=0;x<n.length;x++)f.has(n[x].name)||i.attrs.push(n[x])},getFirstChild(i){return i.childNodes[0]},getChildNodes(i){return i.childNodes},getParentNode(i){return i.parentNode},getAttrList(i){return i.attrs},getTagName(i){return i.tagName},getNamespaceURI(i){return i.namespaceURI},getTextNodeContent(i){return i.value},getCommentNodeContent(i){return i.data},getDocumentTypeNodeName(i){return i.name},getDocumentTypeNodePublicId(i){return i.publicId},getDocumentTypeNodeSystemId(i){return i.systemId},isTextNode(i){return i.nodeName==="#text"},isCommentNode(i){return i.nodeName==="#comment"},isDocumentTypeNode(i){return i.nodeName==="#documentType"},isElementNode(i){return Object.prototype.hasOwnProperty.call(i,"tagName")},setNodeSourceCodeLocation(i,n){i.sourceCodeLocation=n},getNodeSourceCodeLocation(i){return i.sourceCodeLocation},updateNodeSourceCodeLocation(i,n){i.sourceCodeLocation={...i.sourceCodeLocation,...n}}},$1="html",RT="about:legacy-compat",PT="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",X1=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],LT=[...X1,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],OT=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),Q1=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],NT=[...Q1,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function k_(i,n){return n.some(f=>i.startsWith(f))}function kT(i){return i.name===$1&&i.publicId===null&&(i.systemId===null||i.systemId===RT)}function BT(i){if(i.name!==$1)return ro.QUIRKS;const{systemId:n}=i;if(n&&n.toLowerCase()===PT)return ro.QUIRKS;let{publicId:f}=i;if(f!==null){if(f=f.toLowerCase(),OT.has(f))return ro.QUIRKS;let x=n===null?LT:X1;if(k_(f,x))return ro.QUIRKS;if(x=n===null?Q1:NT,k_(f,x))return ro.LIMITED_QUIRKS}return ro.NO_QUIRKS}const B_={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},zT="definitionurl",FT="definitionURL",UT=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(i=>[i.toLowerCase(),i])),HT=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:dt.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:dt.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:dt.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:dt.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:dt.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:dt.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:dt.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:dt.XML}],["xml:space",{prefix:"xml",name:"space",namespace:dt.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:dt.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:dt.XMLNS}]]),jT=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(i=>[i.toLowerCase(),i])),qT=new Set([L.B,L.BIG,L.BLOCKQUOTE,L.BODY,L.BR,L.CENTER,L.CODE,L.DD,L.DIV,L.DL,L.DT,L.EM,L.EMBED,L.H1,L.H2,L.H3,L.H4,L.H5,L.H6,L.HEAD,L.HR,L.I,L.IMG,L.LI,L.LISTING,L.MENU,L.META,L.NOBR,L.OL,L.P,L.PRE,L.RUBY,L.S,L.SMALL,L.SPAN,L.STRONG,L.STRIKE,L.SUB,L.SUP,L.TABLE,L.TT,L.U,L.UL,L.VAR]);function VT(i){const n=i.tagID;return n===L.FONT&&i.attrs.some(({name:x})=>x===md.COLOR||x===md.SIZE||x===md.FACE)||qT.has(n)}function K1(i){for(let n=0;n<i.attrs.length;n++)if(i.attrs[n].name===zT){i.attrs[n].name=FT;break}}function W1(i){for(let n=0;n<i.attrs.length;n++){const f=UT.get(i.attrs[n].name);f!=null&&(i.attrs[n].name=f)}}function kg(i){for(let n=0;n<i.attrs.length;n++){const f=HT.get(i.attrs[n].name);f&&(i.attrs[n].prefix=f.prefix,i.attrs[n].name=f.name,i.attrs[n].namespace=f.namespace)}}function GT(i){const n=jT.get(i.tagName);n!=null&&(i.tagName=n,i.tagID=fm(i.tagName))}function ZT(i,n){return n===dt.MATHML&&(i===L.MI||i===L.MO||i===L.MN||i===L.MS||i===L.MTEXT)}function YT(i,n,f){if(n===dt.MATHML&&i===L.ANNOTATION_XML){for(let x=0;x<f.length;x++)if(f[x].name===md.ENCODING){const A=f[x].value.toLowerCase();return A===B_.TEXT_HTML||A===B_.APPLICATION_XML}}return n===dt.SVG&&(i===L.FOREIGN_OBJECT||i===L.DESC||i===L.TITLE)}function $T(i,n,f,x){return(!x||x===dt.HTML)&&YT(i,n,f)||(!x||x===dt.MATHML)&&ZT(i,n)}const XT="hidden",QT=8,KT=3;var ye;(function(i){i[i.INITIAL=0]="INITIAL",i[i.BEFORE_HTML=1]="BEFORE_HTML",i[i.BEFORE_HEAD=2]="BEFORE_HEAD",i[i.IN_HEAD=3]="IN_HEAD",i[i.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",i[i.AFTER_HEAD=5]="AFTER_HEAD",i[i.IN_BODY=6]="IN_BODY",i[i.TEXT=7]="TEXT",i[i.IN_TABLE=8]="IN_TABLE",i[i.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",i[i.IN_CAPTION=10]="IN_CAPTION",i[i.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",i[i.IN_TABLE_BODY=12]="IN_TABLE_BODY",i[i.IN_ROW=13]="IN_ROW",i[i.IN_CELL=14]="IN_CELL",i[i.IN_SELECT=15]="IN_SELECT",i[i.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",i[i.IN_TEMPLATE=17]="IN_TEMPLATE",i[i.AFTER_BODY=18]="AFTER_BODY",i[i.IN_FRAMESET=19]="IN_FRAMESET",i[i.AFTER_FRAMESET=20]="AFTER_FRAMESET",i[i.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",i[i.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(ye||(ye={}));const WT={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},J1=new Set([L.TABLE,L.TBODY,L.TFOOT,L.THEAD,L.TR]),z_={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:pc,onParseError:null};let ey=class{constructor(n,f,x=null,A=null){this.fragmentContext=x,this.scriptHandler=A,this.currentToken=null,this.stopped=!1,this.insertionMode=ye.INITIAL,this.originalInsertionMode=ye.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...z_,...n},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=f??this.treeAdapter.createDocument(),this.tokenizer=new TT(this.options,this),this.activeFormattingElements=new DT(this.treeAdapter),this.fragmentContextID=x?fm(this.treeAdapter.getTagName(x)):L.UNKNOWN,this._setContextModes(x??this.document,this.fragmentContextID),this.openElements=new IT(this.document,this.treeAdapter,this)}static parse(n,f){const x=new this(f);return x.tokenizer.write(n,!0),x.document}static getFragmentParser(n,f){const x={...z_,...f};n??(n=x.treeAdapter.createElement(Fe.TEMPLATE,dt.HTML,[]));const A=x.treeAdapter.createElement("documentmock",dt.HTML,[]),R=new this(x,A,n);return R.fragmentContextID===L.TEMPLATE&&R.tmplInsertionModeStack.unshift(ye.IN_TEMPLATE),R._initTokenizerForFragmentParsing(),R._insertFakeRootElement(),R._resetInsertionMode(),R._findFormInFragmentContext(),R}getFragment(){const n=this.treeAdapter.getFirstChild(this.document),f=this.treeAdapter.createDocumentFragment();return this._adoptNodes(n,f),f}_err(n,f,x){var A;if(!this.onParseError)return;const R=(A=n.location)!==null&&A!==void 0?A:WT,S={code:f,startLine:R.startLine,startCol:R.startCol,startOffset:R.startOffset,endLine:x?R.startLine:R.endLine,endCol:x?R.startCol:R.endCol,endOffset:x?R.startOffset:R.endOffset};this.onParseError(S)}onItemPush(n,f,x){var A,R;(R=(A=this.treeAdapter).onItemPush)===null||R===void 0||R.call(A,n),x&&this.openElements.stackTop>0&&this._setContextModes(n,f)}onItemPop(n,f){var x,A;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(n,this.currentToken),(A=(x=this.treeAdapter).onItemPop)===null||A===void 0||A.call(x,n,this.openElements.current),f){let R,S;this.openElements.stackTop===0&&this.fragmentContext?(R=this.fragmentContext,S=this.fragmentContextID):{current:R,currentTagId:S}=this.openElements,this._setContextModes(R,S)}}_setContextModes(n,f){const x=n===this.document||n&&this.treeAdapter.getNamespaceURI(n)===dt.HTML;this.currentNotInHTML=!x,this.tokenizer.inForeignNode=!x&&n!==void 0&&f!==void 0&&!this._isIntegrationPoint(f,n)}_switchToTextParsing(n,f){this._insertElement(n,dt.HTML),this.tokenizer.state=f,this.originalInsertionMode=this.insertionMode,this.insertionMode=ye.TEXT}switchToPlaintextParsing(){this.insertionMode=ye.TEXT,this.originalInsertionMode=ye.IN_BODY,this.tokenizer.state=Is.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let n=this.fragmentContext;for(;n;){if(this.treeAdapter.getTagName(n)===Fe.FORM){this.formElement=n;break}n=this.treeAdapter.getParentNode(n)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==dt.HTML))switch(this.fragmentContextID){case L.TITLE:case L.TEXTAREA:{this.tokenizer.state=Is.RCDATA;break}case L.STYLE:case L.XMP:case L.IFRAME:case L.NOEMBED:case L.NOFRAMES:case L.NOSCRIPT:{this.tokenizer.state=Is.RAWTEXT;break}case L.SCRIPT:{this.tokenizer.state=Is.SCRIPT_DATA;break}case L.PLAINTEXT:{this.tokenizer.state=Is.PLAINTEXT;break}}}_setDocumentType(n){const f=n.name||"",x=n.publicId||"",A=n.systemId||"";if(this.treeAdapter.setDocumentType(this.document,f,x,A),n.location){const S=this.treeAdapter.getChildNodes(this.document).find(h=>this.treeAdapter.isDocumentTypeNode(h));S&&this.treeAdapter.setNodeSourceCodeLocation(S,n.location)}}_attachElementToTree(n,f){if(this.options.sourceCodeLocationInfo){const x=f&&{...f,startTag:f};this.treeAdapter.setNodeSourceCodeLocation(n,x)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(n);else{const x=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(x??this.document,n)}}_appendElement(n,f){const x=this.treeAdapter.createElement(n.tagName,f,n.attrs);this._attachElementToTree(x,n.location)}_insertElement(n,f){const x=this.treeAdapter.createElement(n.tagName,f,n.attrs);this._attachElementToTree(x,n.location),this.openElements.push(x,n.tagID)}_insertFakeElement(n,f){const x=this.treeAdapter.createElement(n,dt.HTML,[]);this._attachElementToTree(x,null),this.openElements.push(x,f)}_insertTemplate(n){const f=this.treeAdapter.createElement(n.tagName,dt.HTML,n.attrs),x=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(f,x),this._attachElementToTree(f,n.location),this.openElements.push(f,n.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(x,null)}_insertFakeRootElement(){const n=this.treeAdapter.createElement(Fe.HTML,dt.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,null),this.treeAdapter.appendChild(this.openElements.current,n),this.openElements.push(n,L.HTML)}_appendCommentNode(n,f){const x=this.treeAdapter.createCommentNode(n.data);this.treeAdapter.appendChild(f,x),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(x,n.location)}_insertCharacters(n){let f,x;if(this._shouldFosterParentOnInsertion()?({parent:f,beforeElement:x}=this._findFosterParentingLocation(),x?this.treeAdapter.insertTextBefore(f,n.chars,x):this.treeAdapter.insertText(f,n.chars)):(f=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(f,n.chars)),!n.location)return;const A=this.treeAdapter.getChildNodes(f),R=x?A.lastIndexOf(x):A.length,S=A[R-1];if(this.treeAdapter.getNodeSourceCodeLocation(S)){const{endLine:Z,endCol:Q,endOffset:ge}=n.location;this.treeAdapter.updateNodeSourceCodeLocation(S,{endLine:Z,endCol:Q,endOffset:ge})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(S,n.location)}_adoptNodes(n,f){for(let x=this.treeAdapter.getFirstChild(n);x;x=this.treeAdapter.getFirstChild(n))this.treeAdapter.detachNode(x),this.treeAdapter.appendChild(f,x)}_setEndLocation(n,f){if(this.treeAdapter.getNodeSourceCodeLocation(n)&&f.location){const x=f.location,A=this.treeAdapter.getTagName(n),R=f.type===Vi.END_TAG&&A===f.tagName?{endTag:{...x},endLine:x.endLine,endCol:x.endCol,endOffset:x.endOffset}:{endLine:x.startLine,endCol:x.startCol,endOffset:x.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(n,R)}}shouldProcessStartTagTokenInForeignContent(n){if(!this.currentNotInHTML)return!1;let f,x;return this.openElements.stackTop===0&&this.fragmentContext?(f=this.fragmentContext,x=this.fragmentContextID):{current:f,currentTagId:x}=this.openElements,n.tagID===L.SVG&&this.treeAdapter.getTagName(f)===Fe.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(f)===dt.MATHML?!1:this.tokenizer.inForeignNode||(n.tagID===L.MGLYPH||n.tagID===L.MALIGNMARK)&&x!==void 0&&!this._isIntegrationPoint(x,f,dt.HTML)}_processToken(n){switch(n.type){case Vi.CHARACTER:{this.onCharacter(n);break}case Vi.NULL_CHARACTER:{this.onNullCharacter(n);break}case Vi.COMMENT:{this.onComment(n);break}case Vi.DOCTYPE:{this.onDoctype(n);break}case Vi.START_TAG:{this._processStartTag(n);break}case Vi.END_TAG:{this.onEndTag(n);break}case Vi.EOF:{this.onEof(n);break}case Vi.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(n);break}}}_isIntegrationPoint(n,f,x){const A=this.treeAdapter.getNamespaceURI(f),R=this.treeAdapter.getAttrList(f);return $T(n,A,R,x)}_reconstructActiveFormattingElements(){const n=this.activeFormattingElements.entries.length;if(n){const f=this.activeFormattingElements.entries.findIndex(A=>A.type===El.Marker||this.openElements.contains(A.element)),x=f===-1?n-1:f-1;for(let A=x;A>=0;A--){const R=this.activeFormattingElements.entries[A];this._insertElement(R.token,this.treeAdapter.getNamespaceURI(R.element)),R.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=ye.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(L.P),this.openElements.popUntilTagNamePopped(L.P)}_resetInsertionMode(){for(let n=this.openElements.stackTop;n>=0;n--)switch(n===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[n]){case L.TR:{this.insertionMode=ye.IN_ROW;return}case L.TBODY:case L.THEAD:case L.TFOOT:{this.insertionMode=ye.IN_TABLE_BODY;return}case L.CAPTION:{this.insertionMode=ye.IN_CAPTION;return}case L.COLGROUP:{this.insertionMode=ye.IN_COLUMN_GROUP;return}case L.TABLE:{this.insertionMode=ye.IN_TABLE;return}case L.BODY:{this.insertionMode=ye.IN_BODY;return}case L.FRAMESET:{this.insertionMode=ye.IN_FRAMESET;return}case L.SELECT:{this._resetInsertionModeForSelect(n);return}case L.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case L.HTML:{this.insertionMode=this.headElement?ye.AFTER_HEAD:ye.BEFORE_HEAD;return}case L.TD:case L.TH:{if(n>0){this.insertionMode=ye.IN_CELL;return}break}case L.HEAD:{if(n>0){this.insertionMode=ye.IN_HEAD;return}break}}this.insertionMode=ye.IN_BODY}_resetInsertionModeForSelect(n){if(n>0)for(let f=n-1;f>0;f--){const x=this.openElements.tagIDs[f];if(x===L.TEMPLATE)break;if(x===L.TABLE){this.insertionMode=ye.IN_SELECT_IN_TABLE;return}}this.insertionMode=ye.IN_SELECT}_isElementCausesFosterParenting(n){return J1.has(n)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let n=this.openElements.stackTop;n>=0;n--){const f=this.openElements.items[n];switch(this.openElements.tagIDs[n]){case L.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(f)===dt.HTML)return{parent:this.treeAdapter.getTemplateContent(f),beforeElement:null};break}case L.TABLE:{const x=this.treeAdapter.getParentNode(f);return x?{parent:x,beforeElement:f}:{parent:this.openElements.items[n-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(n){const f=this._findFosterParentingLocation();f.beforeElement?this.treeAdapter.insertBefore(f.parent,n,f.beforeElement):this.treeAdapter.appendChild(f.parent,n)}_isSpecialElement(n,f){const x=this.treeAdapter.getNamespaceURI(n);return gT[x].has(f)}onCharacter(n){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){M3(this,n);return}switch(this.insertionMode){case ye.INITIAL:{F0(this,n);break}case ye.BEFORE_HTML:{q0(this,n);break}case ye.BEFORE_HEAD:{V0(this,n);break}case ye.IN_HEAD:{G0(this,n);break}case ye.IN_HEAD_NO_SCRIPT:{Z0(this,n);break}case ye.AFTER_HEAD:{Y0(this,n);break}case ye.IN_BODY:case ye.IN_CAPTION:case ye.IN_CELL:case ye.IN_TEMPLATE:{iy(this,n);break}case ye.TEXT:case ye.IN_SELECT:case ye.IN_SELECT_IN_TABLE:{this._insertCharacters(n);break}case ye.IN_TABLE:case ye.IN_TABLE_BODY:case ye.IN_ROW:{ig(this,n);break}case ye.IN_TABLE_TEXT:{uy(this,n);break}case ye.IN_COLUMN_GROUP:{nm(this,n);break}case ye.AFTER_BODY:{rm(this,n);break}case ye.AFTER_AFTER_BODY:{Yp(this,n);break}}}onNullCharacter(n){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){C3(this,n);return}switch(this.insertionMode){case ye.INITIAL:{F0(this,n);break}case ye.BEFORE_HTML:{q0(this,n);break}case ye.BEFORE_HEAD:{V0(this,n);break}case ye.IN_HEAD:{G0(this,n);break}case ye.IN_HEAD_NO_SCRIPT:{Z0(this,n);break}case ye.AFTER_HEAD:{Y0(this,n);break}case ye.TEXT:{this._insertCharacters(n);break}case ye.IN_TABLE:case ye.IN_TABLE_BODY:case ye.IN_ROW:{ig(this,n);break}case ye.IN_COLUMN_GROUP:{nm(this,n);break}case ye.AFTER_BODY:{rm(this,n);break}case ye.AFTER_AFTER_BODY:{Yp(this,n);break}}}onComment(n){if(this.skipNextNewLine=!1,this.currentNotInHTML){mg(this,n);return}switch(this.insertionMode){case ye.INITIAL:case ye.BEFORE_HTML:case ye.BEFORE_HEAD:case ye.IN_HEAD:case ye.IN_HEAD_NO_SCRIPT:case ye.AFTER_HEAD:case ye.IN_BODY:case ye.IN_TABLE:case ye.IN_CAPTION:case ye.IN_COLUMN_GROUP:case ye.IN_TABLE_BODY:case ye.IN_ROW:case ye.IN_CELL:case ye.IN_SELECT:case ye.IN_SELECT_IN_TABLE:case ye.IN_TEMPLATE:case ye.IN_FRAMESET:case ye.AFTER_FRAMESET:{mg(this,n);break}case ye.IN_TABLE_TEXT:{U0(this,n);break}case ye.AFTER_BODY:{rE(this,n);break}case ye.AFTER_AFTER_BODY:case ye.AFTER_AFTER_FRAMESET:{sE(this,n);break}}}onDoctype(n){switch(this.skipNextNewLine=!1,this.insertionMode){case ye.INITIAL:{oE(this,n);break}case ye.BEFORE_HEAD:case ye.IN_HEAD:case ye.IN_HEAD_NO_SCRIPT:case ye.AFTER_HEAD:{this._err(n,tt.misplacedDoctype);break}case ye.IN_TABLE_TEXT:{U0(this,n);break}}}onStartTag(n){this.skipNextNewLine=!1,this.currentToken=n,this._processStartTag(n),n.selfClosing&&!n.ackSelfClosing&&this._err(n,tt.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(n){this.shouldProcessStartTagTokenInForeignContent(n)?I3(this,n):this._startTagOutsideForeignContent(n)}_startTagOutsideForeignContent(n){switch(this.insertionMode){case ye.INITIAL:{F0(this,n);break}case ye.BEFORE_HTML:{uE(this,n);break}case ye.BEFORE_HEAD:{cE(this,n);break}case ye.IN_HEAD:{Du(this,n);break}case ye.IN_HEAD_NO_SCRIPT:{fE(this,n);break}case ye.AFTER_HEAD:{mE(this,n);break}case ye.IN_BODY:{zr(this,n);break}case ye.IN_TABLE:{Nf(this,n);break}case ye.IN_TABLE_TEXT:{U0(this,n);break}case ye.IN_CAPTION:{h3(this,n);break}case ye.IN_COLUMN_GROUP:{Fg(this,n);break}case ye.IN_TABLE_BODY:{gm(this,n);break}case ye.IN_ROW:{_m(this,n);break}case ye.IN_CELL:{p3(this,n);break}case ye.IN_SELECT:{hy(this,n);break}case ye.IN_SELECT_IN_TABLE:{g3(this,n);break}case ye.IN_TEMPLATE:{y3(this,n);break}case ye.AFTER_BODY:{x3(this,n);break}case ye.IN_FRAMESET:{v3(this,n);break}case ye.AFTER_FRAMESET:{E3(this,n);break}case ye.AFTER_AFTER_BODY:{A3(this,n);break}case ye.AFTER_AFTER_FRAMESET:{S3(this,n);break}}}onEndTag(n){this.skipNextNewLine=!1,this.currentToken=n,this.currentNotInHTML?D3(this,n):this._endTagOutsideForeignContent(n)}_endTagOutsideForeignContent(n){switch(this.insertionMode){case ye.INITIAL:{F0(this,n);break}case ye.BEFORE_HTML:{lE(this,n);break}case ye.BEFORE_HEAD:{hE(this,n);break}case ye.IN_HEAD:{dE(this,n);break}case ye.IN_HEAD_NO_SCRIPT:{pE(this,n);break}case ye.AFTER_HEAD:{gE(this,n);break}case ye.IN_BODY:{mm(this,n);break}case ye.TEXT:{t3(this,n);break}case ye.IN_TABLE:{J0(this,n);break}case ye.IN_TABLE_TEXT:{U0(this,n);break}case ye.IN_CAPTION:{d3(this,n);break}case ye.IN_COLUMN_GROUP:{f3(this,n);break}case ye.IN_TABLE_BODY:{gg(this,n);break}case ye.IN_ROW:{cy(this,n);break}case ye.IN_CELL:{m3(this,n);break}case ye.IN_SELECT:{dy(this,n);break}case ye.IN_SELECT_IN_TABLE:{_3(this,n);break}case ye.IN_TEMPLATE:{b3(this,n);break}case ye.AFTER_BODY:{py(this,n);break}case ye.IN_FRAMESET:{T3(this,n);break}case ye.AFTER_FRAMESET:{w3(this,n);break}case ye.AFTER_AFTER_BODY:{Yp(this,n);break}}}onEof(n){switch(this.insertionMode){case ye.INITIAL:{F0(this,n);break}case ye.BEFORE_HTML:{q0(this,n);break}case ye.BEFORE_HEAD:{V0(this,n);break}case ye.IN_HEAD:{G0(this,n);break}case ye.IN_HEAD_NO_SCRIPT:{Z0(this,n);break}case ye.AFTER_HEAD:{Y0(this,n);break}case ye.IN_BODY:case ye.IN_TABLE:case ye.IN_CAPTION:case ye.IN_COLUMN_GROUP:case ye.IN_TABLE_BODY:case ye.IN_ROW:case ye.IN_CELL:case ye.IN_SELECT:case ye.IN_SELECT_IN_TABLE:{sy(this,n);break}case ye.TEXT:{i3(this,n);break}case ye.IN_TABLE_TEXT:{U0(this,n);break}case ye.IN_TEMPLATE:{fy(this,n);break}case ye.AFTER_BODY:case ye.IN_FRAMESET:case ye.AFTER_FRAMESET:case ye.AFTER_AFTER_BODY:case ye.AFTER_AFTER_FRAMESET:{zg(this,n);break}}}onWhitespaceCharacter(n){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,n.chars.charCodeAt(0)===se.LINE_FEED)){if(n.chars.length===1)return;n.chars=n.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(n);return}switch(this.insertionMode){case ye.IN_HEAD:case ye.IN_HEAD_NO_SCRIPT:case ye.AFTER_HEAD:case ye.TEXT:case ye.IN_COLUMN_GROUP:case ye.IN_SELECT:case ye.IN_SELECT_IN_TABLE:case ye.IN_FRAMESET:case ye.AFTER_FRAMESET:{this._insertCharacters(n);break}case ye.IN_BODY:case ye.IN_CAPTION:case ye.IN_CELL:case ye.IN_TEMPLATE:case ye.AFTER_BODY:case ye.AFTER_AFTER_BODY:case ye.AFTER_AFTER_FRAMESET:{ty(this,n);break}case ye.IN_TABLE:case ye.IN_TABLE_BODY:case ye.IN_ROW:{ig(this,n);break}case ye.IN_TABLE_TEXT:{oy(this,n);break}}}};function JT(i,n){let f=i.activeFormattingElements.getElementEntryInScopeWithTagName(n.tagName);return f?i.openElements.contains(f.element)?i.openElements.hasInScope(n.tagID)||(f=null):(i.activeFormattingElements.removeEntry(f),f=null):ry(i,n),f}function eE(i,n){let f=null,x=i.openElements.stackTop;for(;x>=0;x--){const A=i.openElements.items[x];if(A===n.element)break;i._isSpecialElement(A,i.openElements.tagIDs[x])&&(f=A)}return f||(i.openElements.shortenToLength(Math.max(x,0)),i.activeFormattingElements.removeEntry(n)),f}function tE(i,n,f){let x=n,A=i.openElements.getCommonAncestor(n);for(let R=0,S=A;S!==f;R++,S=A){A=i.openElements.getCommonAncestor(S);const h=i.activeFormattingElements.getElementEntry(S),Z=h&&R>=KT;!h||Z?(Z&&i.activeFormattingElements.removeEntry(h),i.openElements.remove(S)):(S=iE(i,h),x===n&&(i.activeFormattingElements.bookmark=h),i.treeAdapter.detachNode(x),i.treeAdapter.appendChild(S,x),x=S)}return x}function iE(i,n){const f=i.treeAdapter.getNamespaceURI(n.element),x=i.treeAdapter.createElement(n.token.tagName,f,n.token.attrs);return i.openElements.replace(n.element,x),n.element=x,x}function aE(i,n,f){const x=i.treeAdapter.getTagName(n),A=fm(x);if(i._isElementCausesFosterParenting(A))i._fosterParentElement(f);else{const R=i.treeAdapter.getNamespaceURI(n);A===L.TEMPLATE&&R===dt.HTML&&(n=i.treeAdapter.getTemplateContent(n)),i.treeAdapter.appendChild(n,f)}}function nE(i,n,f){const x=i.treeAdapter.getNamespaceURI(f.element),{token:A}=f,R=i.treeAdapter.createElement(A.tagName,x,A.attrs);i._adoptNodes(n,R),i.treeAdapter.appendChild(n,R),i.activeFormattingElements.insertElementAfterBookmark(R,A),i.activeFormattingElements.removeEntry(f),i.openElements.remove(f.element),i.openElements.insertAfter(n,R,A.tagID)}function Bg(i,n){for(let f=0;f<QT;f++){const x=JT(i,n);if(!x)break;const A=eE(i,x);if(!A)break;i.activeFormattingElements.bookmark=x;const R=tE(i,A,x.element),S=i.openElements.getCommonAncestor(x.element);i.treeAdapter.detachNode(R),S&&aE(i,S,R),nE(i,A,x)}}function mg(i,n){i._appendCommentNode(n,i.openElements.currentTmplContentOrNode)}function rE(i,n){i._appendCommentNode(n,i.openElements.items[0])}function sE(i,n){i._appendCommentNode(n,i.document)}function zg(i,n){if(i.stopped=!0,n.location){const f=i.fragmentContext?0:2;for(let x=i.openElements.stackTop;x>=f;x--)i._setEndLocation(i.openElements.items[x],n);if(!i.fragmentContext&&i.openElements.stackTop>=0){const x=i.openElements.items[0],A=i.treeAdapter.getNodeSourceCodeLocation(x);if(A&&!A.endTag&&(i._setEndLocation(x,n),i.openElements.stackTop>=1)){const R=i.openElements.items[1],S=i.treeAdapter.getNodeSourceCodeLocation(R);S&&!S.endTag&&i._setEndLocation(R,n)}}}}function oE(i,n){i._setDocumentType(n);const f=n.forceQuirks?ro.QUIRKS:BT(n);kT(n)||i._err(n,tt.nonConformingDoctype),i.treeAdapter.setDocumentMode(i.document,f),i.insertionMode=ye.BEFORE_HTML}function F0(i,n){i._err(n,tt.missingDoctype,!0),i.treeAdapter.setDocumentMode(i.document,ro.QUIRKS),i.insertionMode=ye.BEFORE_HTML,i._processToken(n)}function uE(i,n){n.tagID===L.HTML?(i._insertElement(n,dt.HTML),i.insertionMode=ye.BEFORE_HEAD):q0(i,n)}function lE(i,n){const f=n.tagID;(f===L.HTML||f===L.HEAD||f===L.BODY||f===L.BR)&&q0(i,n)}function q0(i,n){i._insertFakeRootElement(),i.insertionMode=ye.BEFORE_HEAD,i._processToken(n)}function cE(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.HEAD:{i._insertElement(n,dt.HTML),i.headElement=i.openElements.current,i.insertionMode=ye.IN_HEAD;break}default:V0(i,n)}}function hE(i,n){const f=n.tagID;f===L.HEAD||f===L.BODY||f===L.HTML||f===L.BR?V0(i,n):i._err(n,tt.endTagWithoutMatchingOpenElement)}function V0(i,n){i._insertFakeElement(Fe.HEAD,L.HEAD),i.headElement=i.openElements.current,i.insertionMode=ye.IN_HEAD,i._processToken(n)}function Du(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.BASE:case L.BASEFONT:case L.BGSOUND:case L.LINK:case L.META:{i._appendElement(n,dt.HTML),n.ackSelfClosing=!0;break}case L.TITLE:{i._switchToTextParsing(n,Is.RCDATA);break}case L.NOSCRIPT:{i.options.scriptingEnabled?i._switchToTextParsing(n,Is.RAWTEXT):(i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_HEAD_NO_SCRIPT);break}case L.NOFRAMES:case L.STYLE:{i._switchToTextParsing(n,Is.RAWTEXT);break}case L.SCRIPT:{i._switchToTextParsing(n,Is.SCRIPT_DATA);break}case L.TEMPLATE:{i._insertTemplate(n),i.activeFormattingElements.insertMarker(),i.framesetOk=!1,i.insertionMode=ye.IN_TEMPLATE,i.tmplInsertionModeStack.unshift(ye.IN_TEMPLATE);break}case L.HEAD:{i._err(n,tt.misplacedStartTagForHeadElement);break}default:G0(i,n)}}function dE(i,n){switch(n.tagID){case L.HEAD:{i.openElements.pop(),i.insertionMode=ye.AFTER_HEAD;break}case L.BODY:case L.BR:case L.HTML:{G0(i,n);break}case L.TEMPLATE:{xd(i,n);break}default:i._err(n,tt.endTagWithoutMatchingOpenElement)}}function xd(i,n){i.openElements.tmplCount>0?(i.openElements.generateImpliedEndTagsThoroughly(),i.openElements.currentTagId!==L.TEMPLATE&&i._err(n,tt.closingOfElementWithOpenChildElements),i.openElements.popUntilTagNamePopped(L.TEMPLATE),i.activeFormattingElements.clearToLastMarker(),i.tmplInsertionModeStack.shift(),i._resetInsertionMode()):i._err(n,tt.endTagWithoutMatchingOpenElement)}function G0(i,n){i.openElements.pop(),i.insertionMode=ye.AFTER_HEAD,i._processToken(n)}function fE(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.BASEFONT:case L.BGSOUND:case L.HEAD:case L.LINK:case L.META:case L.NOFRAMES:case L.STYLE:{Du(i,n);break}case L.NOSCRIPT:{i._err(n,tt.nestedNoscriptInHead);break}default:Z0(i,n)}}function pE(i,n){switch(n.tagID){case L.NOSCRIPT:{i.openElements.pop(),i.insertionMode=ye.IN_HEAD;break}case L.BR:{Z0(i,n);break}default:i._err(n,tt.endTagWithoutMatchingOpenElement)}}function Z0(i,n){const f=n.type===Vi.EOF?tt.openElementsLeftAfterEof:tt.disallowedContentInNoscriptInHead;i._err(n,f),i.openElements.pop(),i.insertionMode=ye.IN_HEAD,i._processToken(n)}function mE(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.BODY:{i._insertElement(n,dt.HTML),i.framesetOk=!1,i.insertionMode=ye.IN_BODY;break}case L.FRAMESET:{i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_FRAMESET;break}case L.BASE:case L.BASEFONT:case L.BGSOUND:case L.LINK:case L.META:case L.NOFRAMES:case L.SCRIPT:case L.STYLE:case L.TEMPLATE:case L.TITLE:{i._err(n,tt.abandonedHeadElementChild),i.openElements.push(i.headElement,L.HEAD),Du(i,n),i.openElements.remove(i.headElement);break}case L.HEAD:{i._err(n,tt.misplacedStartTagForHeadElement);break}default:Y0(i,n)}}function gE(i,n){switch(n.tagID){case L.BODY:case L.HTML:case L.BR:{Y0(i,n);break}case L.TEMPLATE:{xd(i,n);break}default:i._err(n,tt.endTagWithoutMatchingOpenElement)}}function Y0(i,n){i._insertFakeElement(Fe.BODY,L.BODY),i.insertionMode=ye.IN_BODY,pm(i,n)}function pm(i,n){switch(n.type){case Vi.CHARACTER:{iy(i,n);break}case Vi.WHITESPACE_CHARACTER:{ty(i,n);break}case Vi.COMMENT:{mg(i,n);break}case Vi.START_TAG:{zr(i,n);break}case Vi.END_TAG:{mm(i,n);break}case Vi.EOF:{sy(i,n);break}}}function ty(i,n){i._reconstructActiveFormattingElements(),i._insertCharacters(n)}function iy(i,n){i._reconstructActiveFormattingElements(),i._insertCharacters(n),i.framesetOk=!1}function _E(i,n){i.openElements.tmplCount===0&&i.treeAdapter.adoptAttributes(i.openElements.items[0],n.attrs)}function yE(i,n){const f=i.openElements.tryPeekProperlyNestedBodyElement();f&&i.openElements.tmplCount===0&&(i.framesetOk=!1,i.treeAdapter.adoptAttributes(f,n.attrs))}function bE(i,n){const f=i.openElements.tryPeekProperlyNestedBodyElement();i.framesetOk&&f&&(i.treeAdapter.detachNode(f),i.openElements.popAllUpToHtmlElement(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_FRAMESET)}function xE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML)}function vE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i.openElements.currentTagId!==void 0&&pg.has(i.openElements.currentTagId)&&i.openElements.pop(),i._insertElement(n,dt.HTML)}function TE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML),i.skipNextNewLine=!0,i.framesetOk=!1}function EE(i,n){const f=i.openElements.tmplCount>0;(!i.formElement||f)&&(i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML),f||(i.formElement=i.openElements.current))}function wE(i,n){i.framesetOk=!1;const f=n.tagID;for(let x=i.openElements.stackTop;x>=0;x--){const A=i.openElements.tagIDs[x];if(f===L.LI&&A===L.LI||(f===L.DD||f===L.DT)&&(A===L.DD||A===L.DT)){i.openElements.generateImpliedEndTagsWithExclusion(A),i.openElements.popUntilTagNamePopped(A);break}if(A!==L.ADDRESS&&A!==L.DIV&&A!==L.P&&i._isSpecialElement(i.openElements.items[x],A))break}i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML)}function AE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML),i.tokenizer.state=Is.PLAINTEXT}function SE(i,n){i.openElements.hasInScope(L.BUTTON)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(L.BUTTON)),i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML),i.framesetOk=!1}function CE(i,n){const f=i.activeFormattingElements.getElementEntryInScopeWithTagName(Fe.A);f&&(Bg(i,n),i.openElements.remove(f.element),i.activeFormattingElements.removeEntry(f)),i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML),i.activeFormattingElements.pushElement(i.openElements.current,n)}function ME(i,n){i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML),i.activeFormattingElements.pushElement(i.openElements.current,n)}function IE(i,n){i._reconstructActiveFormattingElements(),i.openElements.hasInScope(L.NOBR)&&(Bg(i,n),i._reconstructActiveFormattingElements()),i._insertElement(n,dt.HTML),i.activeFormattingElements.pushElement(i.openElements.current,n)}function DE(i,n){i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML),i.activeFormattingElements.insertMarker(),i.framesetOk=!1}function RE(i,n){i.treeAdapter.getDocumentMode(i.document)!==ro.QUIRKS&&i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._insertElement(n,dt.HTML),i.framesetOk=!1,i.insertionMode=ye.IN_TABLE}function ay(i,n){i._reconstructActiveFormattingElements(),i._appendElement(n,dt.HTML),i.framesetOk=!1,n.ackSelfClosing=!0}function ny(i){const n=G1(i,md.TYPE);return n!=null&&n.toLowerCase()===XT}function PE(i,n){i._reconstructActiveFormattingElements(),i._appendElement(n,dt.HTML),ny(n)||(i.framesetOk=!1),n.ackSelfClosing=!0}function LE(i,n){i._appendElement(n,dt.HTML),n.ackSelfClosing=!0}function OE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._appendElement(n,dt.HTML),i.framesetOk=!1,n.ackSelfClosing=!0}function NE(i,n){n.tagName=Fe.IMG,n.tagID=L.IMG,ay(i,n)}function kE(i,n){i._insertElement(n,dt.HTML),i.skipNextNewLine=!0,i.tokenizer.state=Is.RCDATA,i.originalInsertionMode=i.insertionMode,i.framesetOk=!1,i.insertionMode=ye.TEXT}function BE(i,n){i.openElements.hasInButtonScope(L.P)&&i._closePElement(),i._reconstructActiveFormattingElements(),i.framesetOk=!1,i._switchToTextParsing(n,Is.RAWTEXT)}function zE(i,n){i.framesetOk=!1,i._switchToTextParsing(n,Is.RAWTEXT)}function F_(i,n){i._switchToTextParsing(n,Is.RAWTEXT)}function FE(i,n){i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML),i.framesetOk=!1,i.insertionMode=i.insertionMode===ye.IN_TABLE||i.insertionMode===ye.IN_CAPTION||i.insertionMode===ye.IN_TABLE_BODY||i.insertionMode===ye.IN_ROW||i.insertionMode===ye.IN_CELL?ye.IN_SELECT_IN_TABLE:ye.IN_SELECT}function UE(i,n){i.openElements.currentTagId===L.OPTION&&i.openElements.pop(),i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML)}function HE(i,n){i.openElements.hasInScope(L.RUBY)&&i.openElements.generateImpliedEndTags(),i._insertElement(n,dt.HTML)}function jE(i,n){i.openElements.hasInScope(L.RUBY)&&i.openElements.generateImpliedEndTagsWithExclusion(L.RTC),i._insertElement(n,dt.HTML)}function qE(i,n){i._reconstructActiveFormattingElements(),K1(n),kg(n),n.selfClosing?i._appendElement(n,dt.MATHML):i._insertElement(n,dt.MATHML),n.ackSelfClosing=!0}function VE(i,n){i._reconstructActiveFormattingElements(),W1(n),kg(n),n.selfClosing?i._appendElement(n,dt.SVG):i._insertElement(n,dt.SVG),n.ackSelfClosing=!0}function U_(i,n){i._reconstructActiveFormattingElements(),i._insertElement(n,dt.HTML)}function zr(i,n){switch(n.tagID){case L.I:case L.S:case L.B:case L.U:case L.EM:case L.TT:case L.BIG:case L.CODE:case L.FONT:case L.SMALL:case L.STRIKE:case L.STRONG:{ME(i,n);break}case L.A:{CE(i,n);break}case L.H1:case L.H2:case L.H3:case L.H4:case L.H5:case L.H6:{vE(i,n);break}case L.P:case L.DL:case L.OL:case L.UL:case L.DIV:case L.DIR:case L.NAV:case L.MAIN:case L.MENU:case L.ASIDE:case L.CENTER:case L.FIGURE:case L.FOOTER:case L.HEADER:case L.HGROUP:case L.DIALOG:case L.DETAILS:case L.ADDRESS:case L.ARTICLE:case L.SEARCH:case L.SECTION:case L.SUMMARY:case L.FIELDSET:case L.BLOCKQUOTE:case L.FIGCAPTION:{xE(i,n);break}case L.LI:case L.DD:case L.DT:{wE(i,n);break}case L.BR:case L.IMG:case L.WBR:case L.AREA:case L.EMBED:case L.KEYGEN:{ay(i,n);break}case L.HR:{OE(i,n);break}case L.RB:case L.RTC:{HE(i,n);break}case L.RT:case L.RP:{jE(i,n);break}case L.PRE:case L.LISTING:{TE(i,n);break}case L.XMP:{BE(i,n);break}case L.SVG:{VE(i,n);break}case L.HTML:{_E(i,n);break}case L.BASE:case L.LINK:case L.META:case L.STYLE:case L.TITLE:case L.SCRIPT:case L.BGSOUND:case L.BASEFONT:case L.TEMPLATE:{Du(i,n);break}case L.BODY:{yE(i,n);break}case L.FORM:{EE(i,n);break}case L.NOBR:{IE(i,n);break}case L.MATH:{qE(i,n);break}case L.TABLE:{RE(i,n);break}case L.INPUT:{PE(i,n);break}case L.PARAM:case L.TRACK:case L.SOURCE:{LE(i,n);break}case L.IMAGE:{NE(i,n);break}case L.BUTTON:{SE(i,n);break}case L.APPLET:case L.OBJECT:case L.MARQUEE:{DE(i,n);break}case L.IFRAME:{zE(i,n);break}case L.SELECT:{FE(i,n);break}case L.OPTION:case L.OPTGROUP:{UE(i,n);break}case L.NOEMBED:case L.NOFRAMES:{F_(i,n);break}case L.FRAMESET:{bE(i,n);break}case L.TEXTAREA:{kE(i,n);break}case L.NOSCRIPT:{i.options.scriptingEnabled?F_(i,n):U_(i,n);break}case L.PLAINTEXT:{AE(i,n);break}case L.COL:case L.TH:case L.TD:case L.TR:case L.HEAD:case L.FRAME:case L.TBODY:case L.TFOOT:case L.THEAD:case L.CAPTION:case L.COLGROUP:break;default:U_(i,n)}}function GE(i,n){if(i.openElements.hasInScope(L.BODY)&&(i.insertionMode=ye.AFTER_BODY,i.options.sourceCodeLocationInfo)){const f=i.openElements.tryPeekProperlyNestedBodyElement();f&&i._setEndLocation(f,n)}}function ZE(i,n){i.openElements.hasInScope(L.BODY)&&(i.insertionMode=ye.AFTER_BODY,py(i,n))}function YE(i,n){const f=n.tagID;i.openElements.hasInScope(f)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(f))}function $E(i){const n=i.openElements.tmplCount>0,{formElement:f}=i;n||(i.formElement=null),(f||n)&&i.openElements.hasInScope(L.FORM)&&(i.openElements.generateImpliedEndTags(),n?i.openElements.popUntilTagNamePopped(L.FORM):f&&i.openElements.remove(f))}function XE(i){i.openElements.hasInButtonScope(L.P)||i._insertFakeElement(Fe.P,L.P),i._closePElement()}function QE(i){i.openElements.hasInListItemScope(L.LI)&&(i.openElements.generateImpliedEndTagsWithExclusion(L.LI),i.openElements.popUntilTagNamePopped(L.LI))}function KE(i,n){const f=n.tagID;i.openElements.hasInScope(f)&&(i.openElements.generateImpliedEndTagsWithExclusion(f),i.openElements.popUntilTagNamePopped(f))}function WE(i){i.openElements.hasNumberedHeaderInScope()&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilNumberedHeaderPopped())}function JE(i,n){const f=n.tagID;i.openElements.hasInScope(f)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(f),i.activeFormattingElements.clearToLastMarker())}function e3(i){i._reconstructActiveFormattingElements(),i._insertFakeElement(Fe.BR,L.BR),i.openElements.pop(),i.framesetOk=!1}function ry(i,n){const f=n.tagName,x=n.tagID;for(let A=i.openElements.stackTop;A>0;A--){const R=i.openElements.items[A],S=i.openElements.tagIDs[A];if(x===S&&(x!==L.UNKNOWN||i.treeAdapter.getTagName(R)===f)){i.openElements.generateImpliedEndTagsWithExclusion(x),i.openElements.stackTop>=A&&i.openElements.shortenToLength(A);break}if(i._isSpecialElement(R,S))break}}function mm(i,n){switch(n.tagID){case L.A:case L.B:case L.I:case L.S:case L.U:case L.EM:case L.TT:case L.BIG:case L.CODE:case L.FONT:case L.NOBR:case L.SMALL:case L.STRIKE:case L.STRONG:{Bg(i,n);break}case L.P:{XE(i);break}case L.DL:case L.UL:case L.OL:case L.DIR:case L.DIV:case L.NAV:case L.PRE:case L.MAIN:case L.MENU:case L.ASIDE:case L.BUTTON:case L.CENTER:case L.FIGURE:case L.FOOTER:case L.HEADER:case L.HGROUP:case L.DIALOG:case L.ADDRESS:case L.ARTICLE:case L.DETAILS:case L.SEARCH:case L.SECTION:case L.SUMMARY:case L.LISTING:case L.FIELDSET:case L.BLOCKQUOTE:case L.FIGCAPTION:{YE(i,n);break}case L.LI:{QE(i);break}case L.DD:case L.DT:{KE(i,n);break}case L.H1:case L.H2:case L.H3:case L.H4:case L.H5:case L.H6:{WE(i);break}case L.BR:{e3(i);break}case L.BODY:{GE(i,n);break}case L.HTML:{ZE(i,n);break}case L.FORM:{$E(i);break}case L.APPLET:case L.OBJECT:case L.MARQUEE:{JE(i,n);break}case L.TEMPLATE:{xd(i,n);break}default:ry(i,n)}}function sy(i,n){i.tmplInsertionModeStack.length>0?fy(i,n):zg(i,n)}function t3(i,n){var f;n.tagID===L.SCRIPT&&((f=i.scriptHandler)===null||f===void 0||f.call(i,i.openElements.current)),i.openElements.pop(),i.insertionMode=i.originalInsertionMode}function i3(i,n){i._err(n,tt.eofInElementThatCanContainOnlyText),i.openElements.pop(),i.insertionMode=i.originalInsertionMode,i.onEof(n)}function ig(i,n){if(i.openElements.currentTagId!==void 0&&J1.has(i.openElements.currentTagId))switch(i.pendingCharacterTokens.length=0,i.hasNonWhitespacePendingCharacterToken=!1,i.originalInsertionMode=i.insertionMode,i.insertionMode=ye.IN_TABLE_TEXT,n.type){case Vi.CHARACTER:{uy(i,n);break}case Vi.WHITESPACE_CHARACTER:{oy(i,n);break}}else np(i,n)}function a3(i,n){i.openElements.clearBackToTableContext(),i.activeFormattingElements.insertMarker(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_CAPTION}function n3(i,n){i.openElements.clearBackToTableContext(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_COLUMN_GROUP}function r3(i,n){i.openElements.clearBackToTableContext(),i._insertFakeElement(Fe.COLGROUP,L.COLGROUP),i.insertionMode=ye.IN_COLUMN_GROUP,Fg(i,n)}function s3(i,n){i.openElements.clearBackToTableContext(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_TABLE_BODY}function o3(i,n){i.openElements.clearBackToTableContext(),i._insertFakeElement(Fe.TBODY,L.TBODY),i.insertionMode=ye.IN_TABLE_BODY,gm(i,n)}function u3(i,n){i.openElements.hasInTableScope(L.TABLE)&&(i.openElements.popUntilTagNamePopped(L.TABLE),i._resetInsertionMode(),i._processStartTag(n))}function l3(i,n){ny(n)?i._appendElement(n,dt.HTML):np(i,n),n.ackSelfClosing=!0}function c3(i,n){!i.formElement&&i.openElements.tmplCount===0&&(i._insertElement(n,dt.HTML),i.formElement=i.openElements.current,i.openElements.pop())}function Nf(i,n){switch(n.tagID){case L.TD:case L.TH:case L.TR:{o3(i,n);break}case L.STYLE:case L.SCRIPT:case L.TEMPLATE:{Du(i,n);break}case L.COL:{r3(i,n);break}case L.FORM:{c3(i,n);break}case L.TABLE:{u3(i,n);break}case L.TBODY:case L.TFOOT:case L.THEAD:{s3(i,n);break}case L.INPUT:{l3(i,n);break}case L.CAPTION:{a3(i,n);break}case L.COLGROUP:{n3(i,n);break}default:np(i,n)}}function J0(i,n){switch(n.tagID){case L.TABLE:{i.openElements.hasInTableScope(L.TABLE)&&(i.openElements.popUntilTagNamePopped(L.TABLE),i._resetInsertionMode());break}case L.TEMPLATE:{xd(i,n);break}case L.BODY:case L.CAPTION:case L.COL:case L.COLGROUP:case L.HTML:case L.TBODY:case L.TD:case L.TFOOT:case L.TH:case L.THEAD:case L.TR:break;default:np(i,n)}}function np(i,n){const f=i.fosterParentingEnabled;i.fosterParentingEnabled=!0,pm(i,n),i.fosterParentingEnabled=f}function oy(i,n){i.pendingCharacterTokens.push(n)}function uy(i,n){i.pendingCharacterTokens.push(n),i.hasNonWhitespacePendingCharacterToken=!0}function U0(i,n){let f=0;if(i.hasNonWhitespacePendingCharacterToken)for(;f<i.pendingCharacterTokens.length;f++)np(i,i.pendingCharacterTokens[f]);else for(;f<i.pendingCharacterTokens.length;f++)i._insertCharacters(i.pendingCharacterTokens[f]);i.insertionMode=i.originalInsertionMode,i._processToken(n)}const ly=new Set([L.CAPTION,L.COL,L.COLGROUP,L.TBODY,L.TD,L.TFOOT,L.TH,L.THEAD,L.TR]);function h3(i,n){const f=n.tagID;ly.has(f)?i.openElements.hasInTableScope(L.CAPTION)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(L.CAPTION),i.activeFormattingElements.clearToLastMarker(),i.insertionMode=ye.IN_TABLE,Nf(i,n)):zr(i,n)}function d3(i,n){const f=n.tagID;switch(f){case L.CAPTION:case L.TABLE:{i.openElements.hasInTableScope(L.CAPTION)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(L.CAPTION),i.activeFormattingElements.clearToLastMarker(),i.insertionMode=ye.IN_TABLE,f===L.TABLE&&J0(i,n));break}case L.BODY:case L.COL:case L.COLGROUP:case L.HTML:case L.TBODY:case L.TD:case L.TFOOT:case L.TH:case L.THEAD:case L.TR:break;default:mm(i,n)}}function Fg(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.COL:{i._appendElement(n,dt.HTML),n.ackSelfClosing=!0;break}case L.TEMPLATE:{Du(i,n);break}default:nm(i,n)}}function f3(i,n){switch(n.tagID){case L.COLGROUP:{i.openElements.currentTagId===L.COLGROUP&&(i.openElements.pop(),i.insertionMode=ye.IN_TABLE);break}case L.TEMPLATE:{xd(i,n);break}case L.COL:break;default:nm(i,n)}}function nm(i,n){i.openElements.currentTagId===L.COLGROUP&&(i.openElements.pop(),i.insertionMode=ye.IN_TABLE,i._processToken(n))}function gm(i,n){switch(n.tagID){case L.TR:{i.openElements.clearBackToTableBodyContext(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_ROW;break}case L.TH:case L.TD:{i.openElements.clearBackToTableBodyContext(),i._insertFakeElement(Fe.TR,L.TR),i.insertionMode=ye.IN_ROW,_m(i,n);break}case L.CAPTION:case L.COL:case L.COLGROUP:case L.TBODY:case L.TFOOT:case L.THEAD:{i.openElements.hasTableBodyContextInTableScope()&&(i.openElements.clearBackToTableBodyContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE,Nf(i,n));break}default:Nf(i,n)}}function gg(i,n){const f=n.tagID;switch(n.tagID){case L.TBODY:case L.TFOOT:case L.THEAD:{i.openElements.hasInTableScope(f)&&(i.openElements.clearBackToTableBodyContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE);break}case L.TABLE:{i.openElements.hasTableBodyContextInTableScope()&&(i.openElements.clearBackToTableBodyContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE,J0(i,n));break}case L.BODY:case L.CAPTION:case L.COL:case L.COLGROUP:case L.HTML:case L.TD:case L.TH:case L.TR:break;default:J0(i,n)}}function _m(i,n){switch(n.tagID){case L.TH:case L.TD:{i.openElements.clearBackToTableRowContext(),i._insertElement(n,dt.HTML),i.insertionMode=ye.IN_CELL,i.activeFormattingElements.insertMarker();break}case L.CAPTION:case L.COL:case L.COLGROUP:case L.TBODY:case L.TFOOT:case L.THEAD:case L.TR:{i.openElements.hasInTableScope(L.TR)&&(i.openElements.clearBackToTableRowContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE_BODY,gm(i,n));break}default:Nf(i,n)}}function cy(i,n){switch(n.tagID){case L.TR:{i.openElements.hasInTableScope(L.TR)&&(i.openElements.clearBackToTableRowContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE_BODY);break}case L.TABLE:{i.openElements.hasInTableScope(L.TR)&&(i.openElements.clearBackToTableRowContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE_BODY,gg(i,n));break}case L.TBODY:case L.TFOOT:case L.THEAD:{(i.openElements.hasInTableScope(n.tagID)||i.openElements.hasInTableScope(L.TR))&&(i.openElements.clearBackToTableRowContext(),i.openElements.pop(),i.insertionMode=ye.IN_TABLE_BODY,gg(i,n));break}case L.BODY:case L.CAPTION:case L.COL:case L.COLGROUP:case L.HTML:case L.TD:case L.TH:break;default:J0(i,n)}}function p3(i,n){const f=n.tagID;ly.has(f)?(i.openElements.hasInTableScope(L.TD)||i.openElements.hasInTableScope(L.TH))&&(i._closeTableCell(),_m(i,n)):zr(i,n)}function m3(i,n){const f=n.tagID;switch(f){case L.TD:case L.TH:{i.openElements.hasInTableScope(f)&&(i.openElements.generateImpliedEndTags(),i.openElements.popUntilTagNamePopped(f),i.activeFormattingElements.clearToLastMarker(),i.insertionMode=ye.IN_ROW);break}case L.TABLE:case L.TBODY:case L.TFOOT:case L.THEAD:case L.TR:{i.openElements.hasInTableScope(f)&&(i._closeTableCell(),cy(i,n));break}case L.BODY:case L.CAPTION:case L.COL:case L.COLGROUP:case L.HTML:break;default:mm(i,n)}}function hy(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.OPTION:{i.openElements.currentTagId===L.OPTION&&i.openElements.pop(),i._insertElement(n,dt.HTML);break}case L.OPTGROUP:{i.openElements.currentTagId===L.OPTION&&i.openElements.pop(),i.openElements.currentTagId===L.OPTGROUP&&i.openElements.pop(),i._insertElement(n,dt.HTML);break}case L.HR:{i.openElements.currentTagId===L.OPTION&&i.openElements.pop(),i.openElements.currentTagId===L.OPTGROUP&&i.openElements.pop(),i._appendElement(n,dt.HTML),n.ackSelfClosing=!0;break}case L.INPUT:case L.KEYGEN:case L.TEXTAREA:case L.SELECT:{i.openElements.hasInSelectScope(L.SELECT)&&(i.openElements.popUntilTagNamePopped(L.SELECT),i._resetInsertionMode(),n.tagID!==L.SELECT&&i._processStartTag(n));break}case L.SCRIPT:case L.TEMPLATE:{Du(i,n);break}}}function dy(i,n){switch(n.tagID){case L.OPTGROUP:{i.openElements.stackTop>0&&i.openElements.currentTagId===L.OPTION&&i.openElements.tagIDs[i.openElements.stackTop-1]===L.OPTGROUP&&i.openElements.pop(),i.openElements.currentTagId===L.OPTGROUP&&i.openElements.pop();break}case L.OPTION:{i.openElements.currentTagId===L.OPTION&&i.openElements.pop();break}case L.SELECT:{i.openElements.hasInSelectScope(L.SELECT)&&(i.openElements.popUntilTagNamePopped(L.SELECT),i._resetInsertionMode());break}case L.TEMPLATE:{xd(i,n);break}}}function g3(i,n){const f=n.tagID;f===L.CAPTION||f===L.TABLE||f===L.TBODY||f===L.TFOOT||f===L.THEAD||f===L.TR||f===L.TD||f===L.TH?(i.openElements.popUntilTagNamePopped(L.SELECT),i._resetInsertionMode(),i._processStartTag(n)):hy(i,n)}function _3(i,n){const f=n.tagID;f===L.CAPTION||f===L.TABLE||f===L.TBODY||f===L.TFOOT||f===L.THEAD||f===L.TR||f===L.TD||f===L.TH?i.openElements.hasInTableScope(f)&&(i.openElements.popUntilTagNamePopped(L.SELECT),i._resetInsertionMode(),i.onEndTag(n)):dy(i,n)}function y3(i,n){switch(n.tagID){case L.BASE:case L.BASEFONT:case L.BGSOUND:case L.LINK:case L.META:case L.NOFRAMES:case L.SCRIPT:case L.STYLE:case L.TEMPLATE:case L.TITLE:{Du(i,n);break}case L.CAPTION:case L.COLGROUP:case L.TBODY:case L.TFOOT:case L.THEAD:{i.tmplInsertionModeStack[0]=ye.IN_TABLE,i.insertionMode=ye.IN_TABLE,Nf(i,n);break}case L.COL:{i.tmplInsertionModeStack[0]=ye.IN_COLUMN_GROUP,i.insertionMode=ye.IN_COLUMN_GROUP,Fg(i,n);break}case L.TR:{i.tmplInsertionModeStack[0]=ye.IN_TABLE_BODY,i.insertionMode=ye.IN_TABLE_BODY,gm(i,n);break}case L.TD:case L.TH:{i.tmplInsertionModeStack[0]=ye.IN_ROW,i.insertionMode=ye.IN_ROW,_m(i,n);break}default:i.tmplInsertionModeStack[0]=ye.IN_BODY,i.insertionMode=ye.IN_BODY,zr(i,n)}}function b3(i,n){n.tagID===L.TEMPLATE&&xd(i,n)}function fy(i,n){i.openElements.tmplCount>0?(i.openElements.popUntilTagNamePopped(L.TEMPLATE),i.activeFormattingElements.clearToLastMarker(),i.tmplInsertionModeStack.shift(),i._resetInsertionMode(),i.onEof(n)):zg(i,n)}function x3(i,n){n.tagID===L.HTML?zr(i,n):rm(i,n)}function py(i,n){var f;if(n.tagID===L.HTML){if(i.fragmentContext||(i.insertionMode=ye.AFTER_AFTER_BODY),i.options.sourceCodeLocationInfo&&i.openElements.tagIDs[0]===L.HTML){i._setEndLocation(i.openElements.items[0],n);const x=i.openElements.items[1];x&&!(!((f=i.treeAdapter.getNodeSourceCodeLocation(x))===null||f===void 0)&&f.endTag)&&i._setEndLocation(x,n)}}else rm(i,n)}function rm(i,n){i.insertionMode=ye.IN_BODY,pm(i,n)}function v3(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.FRAMESET:{i._insertElement(n,dt.HTML);break}case L.FRAME:{i._appendElement(n,dt.HTML),n.ackSelfClosing=!0;break}case L.NOFRAMES:{Du(i,n);break}}}function T3(i,n){n.tagID===L.FRAMESET&&!i.openElements.isRootHtmlElementCurrent()&&(i.openElements.pop(),!i.fragmentContext&&i.openElements.currentTagId!==L.FRAMESET&&(i.insertionMode=ye.AFTER_FRAMESET))}function E3(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.NOFRAMES:{Du(i,n);break}}}function w3(i,n){n.tagID===L.HTML&&(i.insertionMode=ye.AFTER_AFTER_FRAMESET)}function A3(i,n){n.tagID===L.HTML?zr(i,n):Yp(i,n)}function Yp(i,n){i.insertionMode=ye.IN_BODY,pm(i,n)}function S3(i,n){switch(n.tagID){case L.HTML:{zr(i,n);break}case L.NOFRAMES:{Du(i,n);break}}}function C3(i,n){n.chars=Ya,i._insertCharacters(n)}function M3(i,n){i._insertCharacters(n),i.framesetOk=!1}function my(i){for(;i.treeAdapter.getNamespaceURI(i.openElements.current)!==dt.HTML&&i.openElements.currentTagId!==void 0&&!i._isIntegrationPoint(i.openElements.currentTagId,i.openElements.current);)i.openElements.pop()}function I3(i,n){if(VT(n))my(i),i._startTagOutsideForeignContent(n);else{const f=i._getAdjustedCurrentElement(),x=i.treeAdapter.getNamespaceURI(f);x===dt.MATHML?K1(n):x===dt.SVG&&(GT(n),W1(n)),kg(n),n.selfClosing?i._appendElement(n,x):i._insertElement(n,x),n.ackSelfClosing=!0}}function D3(i,n){if(n.tagID===L.P||n.tagID===L.BR){my(i),i._endTagOutsideForeignContent(n);return}for(let f=i.openElements.stackTop;f>0;f--){const x=i.openElements.items[f];if(i.treeAdapter.getNamespaceURI(x)===dt.HTML){i._endTagOutsideForeignContent(n);break}const A=i.treeAdapter.getTagName(x);if(A.toLowerCase()===n.tagName){n.tagName=A,i.openElements.shortenToLength(f);break}}}function gy(i,n){return function(x){let A,R=0,S="";for(;A=i.exec(x);)R!==A.index&&(S+=x.substring(R,A.index)),S+=n.get(A[0].charCodeAt(0)),R=A.index+1;return S+x.substring(R)}}const R3=gy(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),P3=gy(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),L3=new Set([Fe.AREA,Fe.BASE,Fe.BASEFONT,Fe.BGSOUND,Fe.BR,Fe.COL,Fe.EMBED,Fe.FRAME,Fe.HR,Fe.IMG,Fe.INPUT,Fe.KEYGEN,Fe.LINK,Fe.META,Fe.PARAM,Fe.SOURCE,Fe.TRACK,Fe.WBR]);function O3(i,n){return n.treeAdapter.isElementNode(i)&&n.treeAdapter.getNamespaceURI(i)===dt.HTML&&L3.has(n.treeAdapter.getTagName(i))}const N3={treeAdapter:pc,scriptingEnabled:!0};function k3(i,n){const f={...N3,...n};return _y(i,f)}function B3(i,n){let f="";const x=n.treeAdapter.isElementNode(i)&&n.treeAdapter.getTagName(i)===Fe.TEMPLATE&&n.treeAdapter.getNamespaceURI(i)===dt.HTML?n.treeAdapter.getTemplateContent(i):i,A=n.treeAdapter.getChildNodes(x);if(A)for(const R of A)f+=_y(R,n);return f}function _y(i,n){return n.treeAdapter.isElementNode(i)?z3(i,n):n.treeAdapter.isTextNode(i)?U3(i,n):n.treeAdapter.isCommentNode(i)?H3(i,n):n.treeAdapter.isDocumentTypeNode(i)?j3(i,n):""}function z3(i,n){const f=n.treeAdapter.getTagName(i);return`<${f}${F3(i,n)}>${O3(i,n)?"":`${B3(i,n)}</${f}>`}`}function F3(i,{treeAdapter:n}){let f="";for(const x of n.getAttrList(i)){if(f+=" ",x.namespace)switch(x.namespace){case dt.XML:{f+=`xml:${x.name}`;break}case dt.XMLNS:{x.name!=="xmlns"&&(f+="xmlns:"),f+=x.name;break}case dt.XLINK:{f+=`xlink:${x.name}`;break}default:f+=`${x.prefix}:${x.name}`}else f+=x.name;f+=`="${R3(x.value)}"`}return f}function U3(i,n){const{treeAdapter:f}=n,x=f.getTextNodeContent(i),A=f.getParentNode(i),R=A&&f.isElementNode(A)&&f.getTagName(A);return R&&f.getNamespaceURI(A)===dt.HTML&&yT(R,n.scriptingEnabled)?x:P3(x)}function H3(i,{treeAdapter:n}){return`<!--${n.getCommentNodeContent(i)}-->`}function j3(i,{treeAdapter:n}){return`<!DOCTYPE ${n.getDocumentTypeNodeName(i)}>`}function q3(i,n){return ey.parse(i,n)}function V3(i,n,f){typeof i=="string"&&(f=n,n=i,i=null);const x=ey.getFragmentParser(i,f);return x.tokenizer.write(n,!0),x.getFragment()}function H_(i){const n=i.includes('"')?"'":'"';return n+i+n}function G3(i,n,f){let x="!DOCTYPE ";return i&&(x+=i),n?x+=` PUBLIC ${H_(n)}`:f&&(x+=" SYSTEM"),f&&(x+=` ${H_(f)}`),x}const yh={isCommentNode:um,isElementNode:fi,isTextNode:Sl,createDocument(){const i=new gd([]);return i["x-mode"]=ro.NO_QUIRKS,i},createDocumentFragment(){return new gd([])},createElement(i,n,f){const x=Object.create(null),A=Object.create(null),R=Object.create(null);for(let h=0;h<f.length;h++){const Z=f[h].name;x[Z]=f[h].value,A[Z]=f[h].namespace,R[Z]=f[h].prefix}const S=new Tg(i,x,[]);return S.namespace=n,S["x-attribsNamespace"]=A,S["x-attribsPrefix"]=R,S},createCommentNode(i){return new bg(i)},createTextNode(i){return new $0(i)},appendChild(i,n){const f=i.children[i.children.length-1];f&&(f.next=n,n.prev=f),i.children.push(n),n.parent=i},insertBefore(i,n,f){const x=i.children.indexOf(f),{prev:A}=f;A&&(A.next=n,n.prev=A),f.prev=n,n.next=f,i.children.splice(x,0,n),n.parent=i},setTemplateContent(i,n){yh.appendChild(i,n)},getTemplateContent(i){return i.children[0]},setDocumentType(i,n,f,x){const A=G3(n,f,x);let R=i.children.find(S=>ag(S)&&S.name==="!doctype");R?R.data=A??null:(R=new xg("!doctype",A),yh.appendChild(i,R)),R["x-name"]=n,R["x-publicId"]=f,R["x-systemId"]=x},setDocumentMode(i,n){i["x-mode"]=n},getDocumentMode(i){return i["x-mode"]},detachNode(i){if(i.parent){const n=i.parent.children.indexOf(i),{prev:f,next:x}=i;i.prev=null,i.next=null,f&&(f.next=x),x&&(x.prev=f),i.parent.children.splice(n,1),i.parent=null}},insertText(i,n){const f=i.children[i.children.length-1];f&&Sl(f)?f.data+=n:yh.appendChild(i,yh.createTextNode(n))},insertTextBefore(i,n,f){const x=i.children[i.children.indexOf(f)-1];x&&Sl(x)?x.data+=n:yh.insertBefore(i,yh.createTextNode(n),f)},adoptAttributes(i,n){for(let f=0;f<n.length;f++){const x=n[f].name;i.attribs[x]===void 0&&(i.attribs[x]=n[f].value,i["x-attribsNamespace"][x]=n[f].namespace,i["x-attribsPrefix"][x]=n[f].prefix)}},getFirstChild(i){return i.children[0]},getChildNodes(i){return i.children},getParentNode(i){return i.parent},getAttrList(i){return i.attributes},getTagName(i){return i.name},getNamespaceURI(i){return i.namespace},getTextNodeContent(i){return i.data},getCommentNodeContent(i){return i.data},getDocumentTypeNodeName(i){var n;return(n=i["x-name"])!==null&&n!==void 0?n:""},getDocumentTypeNodePublicId(i){var n;return(n=i["x-publicId"])!==null&&n!==void 0?n:""},getDocumentTypeNodeSystemId(i){var n;return(n=i["x-systemId"])!==null&&n!==void 0?n:""},isDocumentTypeNode(i){return ag(i)&&i.name==="!doctype"},setNodeSourceCodeLocation(i,n){n&&(i.startIndex=n.startOffset,i.endIndex=n.endOffset),i.sourceCodeLocation=n},getNodeSourceCodeLocation(i){return i.sourceCodeLocation},updateNodeSourceCodeLocation(i,n){n.endOffset!=null&&(i.endIndex=n.endOffset),i.sourceCodeLocation={...i.sourceCodeLocation,...n}}};function Z3(i,n,f,x){var A;return(A=n.treeAdapter)!==null&&A!==void 0||(n.treeAdapter=yh),n.scriptingEnabled!==!1&&(n.scriptingEnabled=!0),f?q3(i,n):V3(x,i,n)}const Y3={treeAdapter:yh};function $3(i){const n="length"in i?i:[i];for(let x=0;x<n.length;x+=1){const A=n[x];Th(A)&&Array.prototype.splice.call(n,x,1,...A.children)}let f="";for(let x=0;x<n.length;x+=1){const A=n[x];f+=k3(A,Y3)}return f}var ii;(function(i){i[i.Tab=9]="Tab",i[i.NewLine=10]="NewLine",i[i.FormFeed=12]="FormFeed",i[i.CarriageReturn=13]="CarriageReturn",i[i.Space=32]="Space",i[i.ExclamationMark=33]="ExclamationMark",i[i.Number=35]="Number",i[i.Amp=38]="Amp",i[i.SingleQuote=39]="SingleQuote",i[i.DoubleQuote=34]="DoubleQuote",i[i.Dash=45]="Dash",i[i.Slash=47]="Slash",i[i.Zero=48]="Zero",i[i.Nine=57]="Nine",i[i.Semi=59]="Semi",i[i.Lt=60]="Lt",i[i.Eq=61]="Eq",i[i.Gt=62]="Gt",i[i.Questionmark=63]="Questionmark",i[i.UpperA=65]="UpperA",i[i.LowerA=97]="LowerA",i[i.UpperF=70]="UpperF",i[i.LowerF=102]="LowerF",i[i.UpperZ=90]="UpperZ",i[i.LowerZ=122]="LowerZ",i[i.LowerX=120]="LowerX",i[i.OpeningSquareBracket=91]="OpeningSquareBracket"})(ii||(ii={}));var gt;(function(i){i[i.Text=1]="Text",i[i.BeforeTagName=2]="BeforeTagName",i[i.InTagName=3]="InTagName",i[i.InSelfClosingTag=4]="InSelfClosingTag",i[i.BeforeClosingTagName=5]="BeforeClosingTagName",i[i.InClosingTagName=6]="InClosingTagName",i[i.AfterClosingTagName=7]="AfterClosingTagName",i[i.BeforeAttributeName=8]="BeforeAttributeName",i[i.InAttributeName=9]="InAttributeName",i[i.AfterAttributeName=10]="AfterAttributeName",i[i.BeforeAttributeValue=11]="BeforeAttributeValue",i[i.InAttributeValueDq=12]="InAttributeValueDq",i[i.InAttributeValueSq=13]="InAttributeValueSq",i[i.InAttributeValueNq=14]="InAttributeValueNq",i[i.BeforeDeclaration=15]="BeforeDeclaration",i[i.InDeclaration=16]="InDeclaration",i[i.InProcessingInstruction=17]="InProcessingInstruction",i[i.BeforeComment=18]="BeforeComment",i[i.CDATASequence=19]="CDATASequence",i[i.InSpecialComment=20]="InSpecialComment",i[i.InCommentLike=21]="InCommentLike",i[i.BeforeSpecialS=22]="BeforeSpecialS",i[i.BeforeSpecialT=23]="BeforeSpecialT",i[i.SpecialStartSequence=24]="SpecialStartSequence",i[i.InSpecialTag=25]="InSpecialTag",i[i.InEntity=26]="InEntity"})(gt||(gt={}));function fc(i){return i===ii.Space||i===ii.NewLine||i===ii.Tab||i===ii.FormFeed||i===ii.CarriageReturn}function qp(i){return i===ii.Slash||i===ii.Gt||fc(i)}function X3(i){return i>=ii.LowerA&&i<=ii.LowerZ||i>=ii.UpperA&&i<=ii.UpperZ}var Al;(function(i){i[i.NoValue=0]="NoValue",i[i.Unquoted=1]="Unquoted",i[i.Single=2]="Single",i[i.Double=3]="Double"})(Al||(Al={}));const wr={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class Q3{constructor({xmlMode:n=!1,decodeEntities:f=!0},x){this.cbs=x,this.state=gt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=gt.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=n,this.decodeEntities=f,this.entityDecoder=new r1(n?n1:a1,(A,R)=>this.emitCodePoint(A,R))}reset(){this.state=gt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=gt.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(n){this.offset+=this.buffer.length,this.buffer=n,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(n){n===ii.Lt||!this.decodeEntities&&this.fastForwardTo(ii.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=gt.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&n===ii.Amp&&this.startEntity()}stateSpecialStartSequence(n){const f=this.sequenceIndex===this.currentSequence.length;if(!(f?qp(n):(n|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!f){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=gt.InTagName,this.stateInTagName(n)}stateInSpecialTag(n){if(this.sequenceIndex===this.currentSequence.length){if(n===ii.Gt||fc(n)){const f=this.index-this.currentSequence.length;if(this.sectionStart<f){const x=this.index;this.index=f,this.cbs.ontext(this.sectionStart,f),this.index=x}this.isSpecial=!1,this.sectionStart=f+2,this.stateInClosingTagName(n);return}this.sequenceIndex=0}(n|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===wr.TitleEnd?this.decodeEntities&&n===ii.Amp&&this.startEntity():this.fastForwardTo(ii.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(n===ii.Lt)}stateCDATASequence(n){n===wr.Cdata[this.sequenceIndex]?++this.sequenceIndex===wr.Cdata.length&&(this.state=gt.InCommentLike,this.currentSequence=wr.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=gt.InDeclaration,this.stateInDeclaration(n))}fastForwardTo(n){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===n)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(n){n===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===wr.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=gt.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):n!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(n){return this.xmlMode?!qp(n):X3(n)}startSpecial(n,f){this.isSpecial=!0,this.currentSequence=n,this.sequenceIndex=f,this.state=gt.SpecialStartSequence}stateBeforeTagName(n){if(n===ii.ExclamationMark)this.state=gt.BeforeDeclaration,this.sectionStart=this.index+1;else if(n===ii.Questionmark)this.state=gt.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(n)){const f=n|32;this.sectionStart=this.index,this.xmlMode?this.state=gt.InTagName:f===wr.ScriptEnd[2]?this.state=gt.BeforeSpecialS:f===wr.TitleEnd[2]?this.state=gt.BeforeSpecialT:this.state=gt.InTagName}else n===ii.Slash?this.state=gt.BeforeClosingTagName:(this.state=gt.Text,this.stateText(n))}stateInTagName(n){qp(n)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=gt.BeforeAttributeName,this.stateBeforeAttributeName(n))}stateBeforeClosingTagName(n){fc(n)||(n===ii.Gt?this.state=gt.Text:(this.state=this.isTagStartChar(n)?gt.InClosingTagName:gt.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(n){(n===ii.Gt||fc(n))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=gt.AfterClosingTagName,this.stateAfterClosingTagName(n))}stateAfterClosingTagName(n){(n===ii.Gt||this.fastForwardTo(ii.Gt))&&(this.state=gt.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(n){n===ii.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=gt.InSpecialTag,this.sequenceIndex=0):this.state=gt.Text,this.sectionStart=this.index+1):n===ii.Slash?this.state=gt.InSelfClosingTag:fc(n)||(this.state=gt.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(n){n===ii.Gt?(this.cbs.onselfclosingtag(this.index),this.state=gt.Text,this.sectionStart=this.index+1,this.isSpecial=!1):fc(n)||(this.state=gt.BeforeAttributeName,this.stateBeforeAttributeName(n))}stateInAttributeName(n){(n===ii.Eq||qp(n))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=gt.AfterAttributeName,this.stateAfterAttributeName(n))}stateAfterAttributeName(n){n===ii.Eq?this.state=gt.BeforeAttributeValue:n===ii.Slash||n===ii.Gt?(this.cbs.onattribend(Al.NoValue,this.sectionStart),this.sectionStart=-1,this.state=gt.BeforeAttributeName,this.stateBeforeAttributeName(n)):fc(n)||(this.cbs.onattribend(Al.NoValue,this.sectionStart),this.state=gt.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(n){n===ii.DoubleQuote?(this.state=gt.InAttributeValueDq,this.sectionStart=this.index+1):n===ii.SingleQuote?(this.state=gt.InAttributeValueSq,this.sectionStart=this.index+1):fc(n)||(this.sectionStart=this.index,this.state=gt.InAttributeValueNq,this.stateInAttributeValueNoQuotes(n))}handleInAttributeValue(n,f){n===f||!this.decodeEntities&&this.fastForwardTo(f)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(f===ii.DoubleQuote?Al.Double:Al.Single,this.index+1),this.state=gt.BeforeAttributeName):this.decodeEntities&&n===ii.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(n){this.handleInAttributeValue(n,ii.DoubleQuote)}stateInAttributeValueSingleQuotes(n){this.handleInAttributeValue(n,ii.SingleQuote)}stateInAttributeValueNoQuotes(n){fc(n)||n===ii.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Al.Unquoted,this.index),this.state=gt.BeforeAttributeName,this.stateBeforeAttributeName(n)):this.decodeEntities&&n===ii.Amp&&this.startEntity()}stateBeforeDeclaration(n){n===ii.OpeningSquareBracket?(this.state=gt.CDATASequence,this.sequenceIndex=0):this.state=n===ii.Dash?gt.BeforeComment:gt.InDeclaration}stateInDeclaration(n){(n===ii.Gt||this.fastForwardTo(ii.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=gt.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(n){(n===ii.Gt||this.fastForwardTo(ii.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=gt.Text,this.sectionStart=this.index+1)}stateBeforeComment(n){n===ii.Dash?(this.state=gt.InCommentLike,this.currentSequence=wr.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=gt.InDeclaration}stateInSpecialComment(n){(n===ii.Gt||this.fastForwardTo(ii.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=gt.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(n){const f=n|32;f===wr.ScriptEnd[3]?this.startSpecial(wr.ScriptEnd,4):f===wr.StyleEnd[3]?this.startSpecial(wr.StyleEnd,4):(this.state=gt.InTagName,this.stateInTagName(n))}stateBeforeSpecialT(n){const f=n|32;f===wr.TitleEnd[3]?this.startSpecial(wr.TitleEnd,4):f===wr.TextareaEnd[3]?this.startSpecial(wr.TextareaEnd,4):(this.state=gt.InTagName,this.stateInTagName(n))}startEntity(){this.baseState=this.state,this.state=gt.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?wl.Strict:this.baseState===gt.Text||this.baseState===gt.InSpecialTag?wl.Legacy:wl.Attribute)}stateInEntity(){const n=this.entityDecoder.write(this.buffer,this.index-this.offset);n>=0?(this.state=this.baseState,n===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===gt.Text||this.state===gt.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===gt.InAttributeValueDq||this.state===gt.InAttributeValueSq||this.state===gt.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const n=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case gt.Text:{this.stateText(n);break}case gt.SpecialStartSequence:{this.stateSpecialStartSequence(n);break}case gt.InSpecialTag:{this.stateInSpecialTag(n);break}case gt.CDATASequence:{this.stateCDATASequence(n);break}case gt.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(n);break}case gt.InAttributeName:{this.stateInAttributeName(n);break}case gt.InCommentLike:{this.stateInCommentLike(n);break}case gt.InSpecialComment:{this.stateInSpecialComment(n);break}case gt.BeforeAttributeName:{this.stateBeforeAttributeName(n);break}case gt.InTagName:{this.stateInTagName(n);break}case gt.InClosingTagName:{this.stateInClosingTagName(n);break}case gt.BeforeTagName:{this.stateBeforeTagName(n);break}case gt.AfterAttributeName:{this.stateAfterAttributeName(n);break}case gt.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(n);break}case gt.BeforeAttributeValue:{this.stateBeforeAttributeValue(n);break}case gt.BeforeClosingTagName:{this.stateBeforeClosingTagName(n);break}case gt.AfterClosingTagName:{this.stateAfterClosingTagName(n);break}case gt.BeforeSpecialS:{this.stateBeforeSpecialS(n);break}case gt.BeforeSpecialT:{this.stateBeforeSpecialT(n);break}case gt.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(n);break}case gt.InSelfClosingTag:{this.stateInSelfClosingTag(n);break}case gt.InDeclaration:{this.stateInDeclaration(n);break}case gt.BeforeDeclaration:{this.stateBeforeDeclaration(n);break}case gt.BeforeComment:{this.stateBeforeComment(n);break}case gt.InProcessingInstruction:{this.stateInProcessingInstruction(n);break}case gt.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===gt.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const n=this.buffer.length+this.offset;this.sectionStart>=n||(this.state===gt.InCommentLike?this.currentSequence===wr.CdataEnd?this.cbs.oncdata(this.sectionStart,n,0):this.cbs.oncomment(this.sectionStart,n,0):this.state===gt.InTagName||this.state===gt.BeforeAttributeName||this.state===gt.BeforeAttributeValue||this.state===gt.AfterAttributeName||this.state===gt.InAttributeName||this.state===gt.InAttributeValueSq||this.state===gt.InAttributeValueDq||this.state===gt.InAttributeValueNq||this.state===gt.InClosingTagName||this.cbs.ontext(this.sectionStart,n))}emitCodePoint(n,f){this.baseState!==gt.Text&&this.baseState!==gt.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+f,this.index=this.sectionStart-1,this.cbs.onattribentity(n)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+f,this.index=this.sectionStart-1,this.cbs.ontextentity(n,this.sectionStart))}}const Rf=new Set(["input","option","optgroup","select","button","datalist","textarea"]),ba=new Set(["p"]),j_=new Set(["thead","tbody"]),q_=new Set(["dd","dt"]),V_=new Set(["rt","rp"]),K3=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",ba],["h1",ba],["h2",ba],["h3",ba],["h4",ba],["h5",ba],["h6",ba],["select",Rf],["input",Rf],["output",Rf],["button",Rf],["datalist",Rf],["textarea",Rf],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",q_],["dt",q_],["address",ba],["article",ba],["aside",ba],["blockquote",ba],["details",ba],["div",ba],["dl",ba],["fieldset",ba],["figcaption",ba],["figure",ba],["footer",ba],["form",ba],["header",ba],["hr",ba],["main",ba],["nav",ba],["ol",ba],["pre",ba],["section",ba],["table",ba],["ul",ba],["rt",V_],["rp",V_],["tbody",j_],["tfoot",j_]]),W3=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),G_=new Set(["math","svg"]),Z_=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),J3=/\s|\//;class ew{constructor(n,f={}){var x,A,R,S,h,Z;this.options=f,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=n??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(x=f.lowerCaseTags)!==null&&x!==void 0?x:this.htmlMode,this.lowerCaseAttributeNames=(A=f.lowerCaseAttributeNames)!==null&&A!==void 0?A:this.htmlMode,this.recognizeSelfClosing=(R=f.recognizeSelfClosing)!==null&&R!==void 0?R:!this.htmlMode,this.tokenizer=new((S=f.Tokenizer)!==null&&S!==void 0?S:Q3)(this.options,this),this.foreignContext=[!this.htmlMode],(Z=(h=this.cbs).onparserinit)===null||Z===void 0||Z.call(h,this)}ontext(n,f){var x,A;const R=this.getSlice(n,f);this.endIndex=f-1,(A=(x=this.cbs).ontext)===null||A===void 0||A.call(x,R),this.startIndex=f}ontextentity(n,f){var x,A;this.endIndex=f-1,(A=(x=this.cbs).ontext)===null||A===void 0||A.call(x,ng(n)),this.startIndex=f}isVoidElement(n){return this.htmlMode&&W3.has(n)}onopentagname(n,f){this.endIndex=f;let x=this.getSlice(n,f);this.lowerCaseTagNames&&(x=x.toLowerCase()),this.emitOpenTag(x)}emitOpenTag(n){var f,x,A,R;this.openTagStart=this.startIndex,this.tagname=n;const S=this.htmlMode&&K3.get(n);if(S)for(;this.stack.length>0&&S.has(this.stack[0]);){const h=this.stack.shift();(x=(f=this.cbs).onclosetag)===null||x===void 0||x.call(f,h,!0)}this.isVoidElement(n)||(this.stack.unshift(n),this.htmlMode&&(G_.has(n)?this.foreignContext.unshift(!0):Z_.has(n)&&this.foreignContext.unshift(!1))),(R=(A=this.cbs).onopentagname)===null||R===void 0||R.call(A,n),this.cbs.onopentag&&(this.attribs={})}endOpenTag(n){var f,x;this.startIndex=this.openTagStart,this.attribs&&((x=(f=this.cbs).onopentag)===null||x===void 0||x.call(f,this.tagname,this.attribs,n),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(n){this.endIndex=n,this.endOpenTag(!1),this.startIndex=n+1}onclosetag(n,f){var x,A,R,S,h,Z,Q,ge;this.endIndex=f;let Me=this.getSlice(n,f);if(this.lowerCaseTagNames&&(Me=Me.toLowerCase()),this.htmlMode&&(G_.has(Me)||Z_.has(Me))&&this.foreignContext.shift(),this.isVoidElement(Me))this.htmlMode&&Me==="br"&&((S=(R=this.cbs).onopentagname)===null||S===void 0||S.call(R,"br"),(Z=(h=this.cbs).onopentag)===null||Z===void 0||Z.call(h,"br",{},!0),(ge=(Q=this.cbs).onclosetag)===null||ge===void 0||ge.call(Q,"br",!1));else{const Ae=this.stack.indexOf(Me);if(Ae!==-1)for(let he=0;he<=Ae;he++){const Ve=this.stack.shift();(A=(x=this.cbs).onclosetag)===null||A===void 0||A.call(x,Ve,he!==Ae)}else this.htmlMode&&Me==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=f+1}onselfclosingtag(n){this.endIndex=n,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=n+1):this.onopentagend(n)}closeCurrentTag(n){var f,x;const A=this.tagname;this.endOpenTag(n),this.stack[0]===A&&((x=(f=this.cbs).onclosetag)===null||x===void 0||x.call(f,A,!n),this.stack.shift())}onattribname(n,f){this.startIndex=n;const x=this.getSlice(n,f);this.attribname=this.lowerCaseAttributeNames?x.toLowerCase():x}onattribdata(n,f){this.attribvalue+=this.getSlice(n,f)}onattribentity(n){this.attribvalue+=ng(n)}onattribend(n,f){var x,A;this.endIndex=f,(A=(x=this.cbs).onattribute)===null||A===void 0||A.call(x,this.attribname,this.attribvalue,n===Al.Double?'"':n===Al.Single?"'":n===Al.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(n){const f=n.search(J3);let x=f<0?n:n.substr(0,f);return this.lowerCaseTagNames&&(x=x.toLowerCase()),x}ondeclaration(n,f){this.endIndex=f;const x=this.getSlice(n,f);if(this.cbs.onprocessinginstruction){const A=this.getInstructionName(x);this.cbs.onprocessinginstruction(`!${A}`,`!${x}`)}this.startIndex=f+1}onprocessinginstruction(n,f){this.endIndex=f;const x=this.getSlice(n,f);if(this.cbs.onprocessinginstruction){const A=this.getInstructionName(x);this.cbs.onprocessinginstruction(`?${A}`,`?${x}`)}this.startIndex=f+1}oncomment(n,f,x){var A,R,S,h;this.endIndex=f,(R=(A=this.cbs).oncomment)===null||R===void 0||R.call(A,this.getSlice(n,f-x)),(h=(S=this.cbs).oncommentend)===null||h===void 0||h.call(S),this.startIndex=f+1}oncdata(n,f,x){var A,R,S,h,Z,Q,ge,Me,Ae,he;this.endIndex=f;const Ve=this.getSlice(n,f-x);!this.htmlMode||this.options.recognizeCDATA?((R=(A=this.cbs).oncdatastart)===null||R===void 0||R.call(A),(h=(S=this.cbs).ontext)===null||h===void 0||h.call(S,Ve),(Q=(Z=this.cbs).oncdataend)===null||Q===void 0||Q.call(Z)):((Me=(ge=this.cbs).oncomment)===null||Me===void 0||Me.call(ge,`[CDATA[${Ve}]]`),(he=(Ae=this.cbs).oncommentend)===null||he===void 0||he.call(Ae)),this.startIndex=f+1}onend(){var n,f;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let x=0;x<this.stack.length;x++)this.cbs.onclosetag(this.stack[x],!0)}(f=(n=this.cbs).onend)===null||f===void 0||f.call(n)}reset(){var n,f,x,A;(f=(n=this.cbs).onreset)===null||f===void 0||f.call(n),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(A=(x=this.cbs).onparserinit)===null||A===void 0||A.call(x,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(n){this.reset(),this.end(n)}getSlice(n,f){for(;n-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let x=this.buffers[0].slice(n-this.bufferOffset,f-this.bufferOffset);for(;f-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),x+=this.buffers[0].slice(0,f-this.bufferOffset);return x}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(n){var f,x;if(this.ended){(x=(f=this.cbs).onerror)===null||x===void 0||x.call(f,new Error(".write() after done!"));return}this.buffers.push(n),this.tokenizer.running&&(this.tokenizer.write(n),this.writeIndex++)}end(n){var f,x;if(this.ended){(x=(f=this.cbs).onerror)===null||x===void 0||x.call(f,new Error(".end() after done!"));return}n&&this.write(n),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(n){this.write(n)}done(n){this.end(n)}}function tw(i,n){const f=new qb(void 0,n);return new ew(f,n).end(i),f.root}const iw=xv((i,n,f,x)=>n._useHtmlParser2?tw(i,n):Z3(i,n,f,x)),aw=Jv(iw,(i,n)=>n._useHtmlParser2?lm(i,n):$3(i));function nw(i,n,f){return i+n/60+f/3600}function rw(i){const n=/(\d+)(\d+)['"](\d+,?\d*)"\s*(\.\.?|\.\.?)/g,f=[...i.matchAll(n)];return f.length===0?null:f.map(x=>{const[A,R,S,h,Z]=x;return{decimal:nw(parseInt(R),parseInt(S),parseFloat(h.replace(",","."))),direction:Z.includes(".")?"N":"E"}})}const sw=/(?:\d+\.\s*)?(\d+\d+['"][\d,]+"\s*\.\.?\s*\d+\d+['"][\d,]+"\s*\.\.?)/g;function ow(i){return i=i.replace(/\s+/g," ").trim(),[...i.matchAll(sw)].map(f=>f[1]).map((f,x)=>{const A=rw(f);if(!A||A.length!==2)throw console.error("Invalid coordinate",f),new Error("Invalid coordinate");return{index:x+1,lat:A[0].decimal,lon:A[1].decimal,original:f}}).filter(f=>f!==null)}function uw(i){const n=aw(i),f=[],x=n("body").contents().filter(function(){return this.nodeType===1&&n(this).is("p")&&n(this).nextAll("table").length>0}).map(function(){return n(this).text().trim()}).get().join(" ");return n("table").each((A,R)=>{const S={rows:[]};n(R).find("tr").slice(1).each((h,Z)=>{const Q=[];n(Z).find("td").each((ge,Me)=>{const Ae=n(Me).text().trim();Q.push(Ae)}),Q.length>0&&S.rows.push({header:Q.join(" "),points:Q[1]?ow(Q[1]):[]})}),S.rows.length>0&&f.push(S)}),{header:x,rows:f[0].rows}}function lw(){const[i,n]=Ct.useState([]),[f,x]=Ct.useState(null),[A,R]=Ct.useState([]),[S,h]=Ct.useState(null),[Z,Q]=Ct.useState({type:"FeatureCollection",features:[]}),[ge,Me]=Ct.useState({longitude:37.7333,latitude:55.9833,zoom:11}),[Ae,he]=Ct.useState(null),[Ve,Vt]=Ct.useState(null),[li,Pi]=Ct.useState(!0);Ct.useEffect(()=>{fetch("/fishing-ban-regions.json").then(jt=>jt.json()).then(jt=>{const et=[];jt.regions.forEach(Ie=>{Ie.documents.forEach(Oe=>{const pt=uw(Oe.content);Oe.header=pt.header,Oe.rows=pt.rows,Oe.region=Ie,Oe.header.toLowerCase().includes("")&&et.push(Oe)})}),console.log(jt.regions,Z),n(jt.regions||[]),R(et)}).catch(jt=>{console.error("Error loading regions:",jt)})},[]),Ct.useEffect(()=>{const jt={type:"FeatureCollection",features:[]};A.forEach((et,Ie)=>{et.rows.forEach((Oe,pt)=>{!Oe.points||Oe.points.length===0||(Oe.points.length>2?jt.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[Oe.points.map(xt=>[xt.lon,xt.lat])]},properties:{fillColor:"#ff0000",fillOpacity:.3,strokeColor:"#ff0000",name:Oe.header,documentIndex:Ie,rowIndex:pt}}):Oe.points.length===2?jt.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[[Oe.points[0].lon,Oe.points[0].lat],[Oe.points[1].lon,Oe.points[1].lat]]},properties:{color:"#ff0000",width:2,name:Oe.header,documentIndex:Ie,rowIndex:pt}}):Oe.points.length===1&&jt.features.push({type:"Feature",geometry:{type:"Point",coordinates:[Oe.points[0].lon,Oe.points[0].lat]},properties:{color:"#ff0000",radius:5,strokeColor:"#ff0000",strokeWidth:2,name:Oe.header,documentIndex:Ie,rowIndex:pt}}))})}),Q(jt)},[A,i]);const Bi=jt=>{var et,Ie;if(((et=jt.properties)==null?void 0:et.documentIndex)!==void 0&&((Ie=jt.properties)==null?void 0:Ie.rowIndex)!==void 0){const Oe=A[jt.properties.documentIndex];x(Oe.region||null),h(Oe||null),Vt(jt.properties.rowIndex||null)}};return Dt.jsx("div",{className:"flex h-screen w-screen overflow-hidden",children:Dt.jsxs("div",{className:"flex flex-col h-screen w-screen overflow-hidden",children:[li&&Dt.jsxs("div",{className:"p-1 bg-yellow-50 border-b border-yellow-200 text-sm flex items-center justify-center relative",children:[Dt.jsxs("span",{children:["!          ",Dt.jsx("a",{href:"https://fish.gov.ru",target:"_blank",rel:"noopener noreferrer",children:"fish.gov.ru"}),".         .               ."]}),Dt.jsx("button",{onClick:()=>Pi(!1),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:""})]}),Dt.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[Dt.jsx("div",{className:"w-1/3 h-full border-r border-gray-200 overflow-y-auto bg-white",children:Dt.jsx(Oy,{regions:i,selectedRegion:f,onRegionSelect:x,selectedDocuments:A,setSelectedDocuments:R,openedDocument:S,setOpenedDocument:h,map:Ae,selectedRow:Ve,setSelectedRow:Vt})}),Dt.jsx("div",{className:"flex-1 h-full bg-gray-50",children:Dt.jsx(Pb,{geoJson:Z,onFeatureClick:Bi,viewState:ge,setViewState:Me,onMapLoaded:jt=>he(jt)})})]})]})})}Cy.createRoot(document.getElementById("root")).render(Dt.jsx(Ct.StrictMode,{children:Dt.jsx(lw,{})}));
